"use strict";var glance=(()=>{var Rt=Object.defineProperty;var Wt=Object.getOwnPropertyDescriptor;var qt=Object.getOwnPropertyNames;var Kt=Object.prototype.hasOwnProperty;var Zt=(s,t)=>{for(var i in t)Rt(s,i,{get:t[i],enumerable:!0})},Qt=(s,t,i,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of qt(t))!Kt.call(s,n)&&n!==i&&Rt(s,n,{get:()=>t[n],enumerable:!(e=Wt(t,n))||e.enumerable});return s};var Jt=s=>Qt(Rt({},"__esModule",{value:!0}),s);var di={};Zt(di,{AttachmentType:()=>tt,AttributeDataType:()=>p,BlendFunc:()=>rt,BufferUsage:()=>at,CullFace:()=>ot,DepthTest:()=>ut,DrawMode:()=>W,EPSILON:()=>H,FramebufferStack:()=>It,IndexDataType:()=>K,Mat3:()=>V,Mat4:()=>it,Quat:()=>nt,Rect:()=>At,RenderbufferInternalFormat:()=>Tt,ShaderStage:()=>wt,TextureCompareFunc:()=>et,TextureDataTarget:()=>Z,TextureFilter:()=>L,TextureInternalFormat:()=>m,TextureSrcDataType:()=>N,TextureTarget:()=>P,TextureWrap:()=>st,Vec2:()=>k,Vec3:()=>B,Vec4:()=>X,clamp:()=>j,copyCanvasToTexture:()=>oi,countDigits:()=>hs,createAttributeBuffer:()=>fs,createBox:()=>Zs,createCanvasTexture:()=>ri,createCircularPlane:()=>Ks,createDrawCall:()=>_s,createFramebuffer:()=>Es,createIndexBuffer:()=>ls,createPlane:()=>qs,createProgram:()=>us,createRenderbuffer:()=>xs,createScreenQuat:()=>Js,createShader:()=>pt,createSphere:()=>Qs,createTexture:()=>ct,createTorusKnot:()=>ti,createVertexArrayObject:()=>ds,degrees:()=>ss,draw:()=>As,draw2DGrid:()=>ci,getBaricentricCoordinates:()=>hi,getContext:()=>os,hex:()=>es,interleaveArrays:()=>fi,isPowerOf2:()=>ns,loadCodeSnippet:()=>li,loadCubemap:()=>Ys,loadObj:()=>ei,loadTexture:()=>Vs,mapRange:()=>rs,mulberry32:()=>js,nextEven:()=>as,openSimplex2SHeightmap:()=>Ws,radians:()=>ts,range:()=>is,repeat:()=>kt,resetContext:()=>Ms,slice:()=>ui,uniquifyVertices:()=>ni,updateFramebufferLayer:()=>ys,updateTextureData:()=>xt});function C(s){console.log(s())}function v(s){console.warn(s())}function w(s){throw new Error(s())}function g(s,t){if(!s)throw new Error(t?t():"Assertion failed.")}var Ei=async function(){}.constructor;function lt(s,t){if(s===t)return!0;if(s===null||t===null||s===void 0||t===void 0||typeof s!=typeof t||typeof s!="object")return!1;if(Array.isArray(s)){if(!Array.isArray(t)||s.length!==t.length)return!1;for(let i=0;i<s.length;i++)if(!lt(s[i],t[i]))return!1}else{let i=Object.keys(s);if(i.length!==Object.keys(t).length)return!1;for(let e of i)if(!lt(s[e],t[e]))return!1}return!0}function q(s){if(typeof s!="object"||s===null)return s;let t,i,e=Object.prototype.toString.call(s);if(e==="[object Object]"){if(s.constructor!==Object&&typeof s.constructor=="function"){i=new s.constructor;for(t in s)s.hasOwnProperty(t)&&i[t]!==s[t]&&(i[t]=q(s[t]))}else{i={};for(t in s)t==="__proto__"?Object.defineProperty(i,t,{value:q(s[t]),configurable:!0,enumerable:!0,writable:!0}):i[t]=q(s[t])}return i}if(e==="[object Array]"){for(t=s.length,i=Array(t);t--;)i[t]=q(s[t]);return i}return e==="[object Set]"?(i=new Set,s.forEach(function(n){i.add(q(n))}),i):e==="[object Map]"?(i=new Map,s.forEach(function(n,h){i.set(q(h),q(n))}),i):e==="[object Date]"?new Date(+s):e==="[object RegExp]"?(i=new RegExp(s.source,s.flags),i.lastIndex=s.lastIndex,i):e==="[object DataView]"?new s.constructor(q(s.buffer)):e==="[object ArrayBuffer]"?s.slice(0):e.slice(-6)==="Array]"?new s.constructor(s):s}function ht(s){throw new Error(`Unexpected object: ${s}`)}var H=1e-7;function ts(s){return s*Math.PI/180}function ss(s){return s*180/Math.PI}function j(s,t,i){return Math.min(Math.max(s,t),i)}function*is(s,t,i=1){s=Math.round(s),t===void 0?(t=s,s=0):t=Math.round(t),i=Math.max(1,Math.round(Math.abs(i)));let e=Math.sign(t-s)||1;for(;Math.sign(t-s)!==-e;)yield s,s+=i*e}function es(s){return s.toString(16).padStart(2,"0")}function ns(s){return Number.isInteger(s)&&(s&s-1)===0}function hs(s){return s===0?1:Math.floor(Math.log10(Math.abs(s)))+1}function as(s){return Math.ceil(s/2)*2}function rs(s,t,i,e=0,n=1){return e+(s-t)/(i-t)*(n-e)}var wt;(function(s){s[s.VERTEX=35633]="VERTEX",s[s.FRAGMENT=35632]="FRAGMENT"})(wt||(wt={}));var tt;(function(s){s[s.TEXTURE=1]="TEXTURE",s[s.RENDERBUFFER=2]="RENDERBUFFER"})(tt||(tt={}));var p;(function(s){s[s.BYTE=5120]="BYTE",s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.SHORT=5122]="SHORT",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.INT=5124]="INT",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.FLOAT=5126]="FLOAT",s[s.HALF_FLOAT=5131]="HALF_FLOAT",s[s.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV"})(p||(p={}));var K;(function(s){s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT"})(K||(K={}));var at;(function(s){s[s.STATIC_DRAW=35044]="STATIC_DRAW",s[s.STREAM_DRAW=35040]="STREAM_DRAW",s[s.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",s[s.STATIC_READ=35045]="STATIC_READ",s[s.DYNAMIC_READ=35049]="DYNAMIC_READ",s[s.STREAM_READ=35041]="STREAM_READ",s[s.STATIC_COPY=35046]="STATIC_COPY",s[s.DYNAMIC_COPY=35050]="DYNAMIC_COPY",s[s.STREAM_COPY=35042]="STREAM_COPY"})(at||(at={}));var P;(function(s){s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_3D=32879]="TEXTURE_3D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(P||(P={}));var Z;(function(s){s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s[s.TEXTURE_3D=32879]="TEXTURE_3D",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(Z||(Z={}));var N;(function(s){s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.HALF_FLOAT=5131]="HALF_FLOAT",s[s.FLOAT=5126]="FLOAT"})(N||(N={}));var m;(function(s){s[s.R8=33321]="R8",s[s.R16F=33325]="R16F",s[s.R32F=33326]="R32F",s[s.R8UI=33330]="R8UI",s[s.RG8=33323]="RG8",s[s.RG16F=33327]="RG16F",s[s.RG32F=33328]="RG32F",s[s.RG8UI=33336]="RG8UI",s[s.RGB8=32849]="RGB8",s[s.SRGB8=35905]="SRGB8",s[s.RGB565=36194]="RGB565",s[s.R11F_G11F_B10F=35898]="R11F_G11F_B10F",s[s.RGB9_E5=35901]="RGB9_E5",s[s.RGB16F=34843]="RGB16F",s[s.RGB32F=34837]="RGB32F",s[s.RGB8UI=36221]="RGB8UI",s[s.RGBA8=32856]="RGBA8",s[s.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",s[s.RGB5_A1=32855]="RGB5_A1",s[s.RGBA4=32854]="RGBA4",s[s.RGB10_A2=32857]="RGB10_A2",s[s.RGBA16F=34842]="RGBA16F",s[s.RGBA32F=34836]="RGBA32F",s[s.RGBA8UI=36220]="RGBA8UI",s[s.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",s[s.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",s[s.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",s[s.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",s[s.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",s[s.STENCIL_INDEX8=36168]="STENCIL_INDEX8"})(m||(m={}));var L;(function(s){s[s.NEAREST=9728]="NEAREST",s[s.LINEAR=9729]="LINEAR",s[s.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",s[s.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",s[s.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",s[s.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(L||(L={}));var st;(function(s){s[s.REPEAT=10497]="REPEAT",s[s.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(st||(st={}));var et;(function(s){s[s.NONE=0]="NONE",s[s.NEVER=512]="NEVER",s[s.LESS=513]="LESS",s[s.EQUAL=514]="EQUAL",s[s.LEQUAL=515]="LEQUAL",s[s.GREATER=516]="GREATER",s[s.NOTEQUAL=517]="NOTEQUAL",s[s.GEQUAL=518]="GEQUAL",s[s.ALWAYS=519]="ALWAYS"})(et||(et={}));var Tt;(function(s){s[s.RGBA4=32854]="RGBA4",s[s.RGB565=36194]="RGB565",s[s.RGB5_A1=32855]="RGB5_A1",s[s.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",s[s.STENCIL_INDEX8=36168]="STENCIL_INDEX8",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s[s.R8=33321]="R8",s[s.R8UI=33330]="R8UI",s[s.R8I=33329]="R8I",s[s.R16UI=33332]="R16UI",s[s.R16I=33331]="R16I",s[s.R32UI=33334]="R32UI",s[s.R32I=33333]="R32I",s[s.RG8=33323]="RG8",s[s.RG8UI=33336]="RG8UI",s[s.RG8I=33335]="RG8I",s[s.RG16UI=33338]="RG16UI",s[s.RG16I=33337]="RG16I",s[s.RG32UI=33340]="RG32UI",s[s.RG32I=33339]="RG32I",s[s.RGB8=32849]="RGB8",s[s.RGBA8=32856]="RGBA8",s[s.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",s[s.RGB10_A2=32857]="RGB10_A2",s[s.RGBA8UI=36220]="RGBA8UI",s[s.RGBA8I=36238]="RGBA8I",s[s.RGB10_A2UI=36975]="RGB10_A2UI",s[s.RGBA16UI=36214]="RGBA16UI",s[s.RGBA16I=36232]="RGBA16I",s[s.RGBA32I=36226]="RGBA32I",s[s.RGBA32UI=36208]="RGBA32UI",s[s.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",s[s.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",s[s.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",s[s.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",s[s.R16F=33325]="R16F",s[s.RG16F=33327]="RG16F",s[s.RGBA16F=34842]="RGBA16F",s[s.R32F=33326]="R32F",s[s.RG32F=33328]="RG32F",s[s.RGBA32F=34836]="RGBA32F",s[s.R11F_G11F_B10F=35898]="R11F_G11F_B10F"})(Tt||(Tt={}));var ot;(function(s){s[s.NONE=0]="NONE",s[s.FRONT=1028]="FRONT",s[s.BACK=1029]="BACK",s[s.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(ot||(ot={}));var ut;(function(s){s[s.NONE=0]="NONE",s[s.NEVER=512]="NEVER",s[s.LESS=513]="LESS",s[s.EQUAL=514]="EQUAL",s[s.LEQUAL=515]="LEQUAL",s[s.GREATER=516]="GREATER",s[s.NOTEQUAL=517]="NOTEQUAL",s[s.GEQUAL=518]="GEQUAL",s[s.ALWAYS=519]="ALWAYS"})(ut||(ut={}));var rt;(function(s){s[s.ZERO=0]="ZERO",s[s.ONE=1]="ONE",s[s.SRC_COLOR=768]="SRC_COLOR",s[s.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",s[s.DST_COLOR=774]="DST_COLOR",s[s.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",s[s.SRC_ALPHA=770]="SRC_ALPHA",s[s.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",s[s.DST_ALPHA=772]="DST_ALPHA",s[s.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",s[s.CONSTANT_COLOR=32769]="CONSTANT_COLOR",s[s.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",s[s.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",s[s.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",s[s.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(rt||(rt={}));var W;(function(s){s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP"})(W||(W={}));function os(s,t={}){let i=null;typeof s=="string"?(i=document.querySelector(`#${s}`),i==null&&w(()=>`Could not find canvas element with id "${s}"`)):s instanceof HTMLCanvasElement?i=s:w(()=>`Invalid canvas element "${s}"`);let e=i.id??"unnamed canvas",n=i.getContext("webgl2",{alpha:t.alpha??!0,depth:t.depth??!0,stencil:t.stencil??!1,antialias:t.antialias??!1,premultipliedAlpha:t.premultipliedAlpha??!1,preserveDrawingBuffer:t.preserveDrawingBuffer??!0,powerPreference:t.powerPreference??"high-performance",desynchronized:t.desynchronized??!0});return n===null&&w(()=>`Could not acquire a WebGL2 context from canvas "${e}"`),n.getExtension("EXT_color_buffer_float")===null&&v(()=>"Extension 'EXT_color_buffer_float' is not supported."),n.getExtension("EXT_texture_filter_anisotropic")===null&&v(()=>"Extension 'EXT_texture_filter_anisotropic' is not supported."),n.__glance={generation:1,shaders:new Map,programs:new Map,buffers:new Array,vaos:new Array,textures:new Array,renderbuffers:new Array,framebuffers:new Array},n}function pt(s,t,i,e){i!==s.VERTEX_SHADER&&i!==s.FRAGMENT_SHADER&&w(()=>`Invalid shader stage ${i} for shader "${t}"`);let n=i===s.VERTEX_SHADER?"vertex":"fragment";{let r=s.__glance.shaders.get(e);if(r){let c=r.object;return c.stage!==i&&w(()=>`Shader "${t}" already exists as a ${c.stage===s.VERTEX_SHADER?"vertex":"fragment"} shader.`),r.generation=s.__glance.generation,C(()=>`Reusing cached ${n} shader "${t}"`),c}}let h=s.createShader(i);if(h||w(()=>`Failed to create ${n} shader "${t}"`),s.shaderSource(h,e),s.compileShader(h),!s.getShaderParameter(h,s.COMPILE_STATUS)){let r=s.getShaderInfoLog(h);s.deleteShader(h),w(()=>`Failed to compile ${n} shader "${t}": ${r}`)}let a={glo:h,name:t,stage:i,source:e};return C(()=>`Created ${n} shader "${t}"`),s.__glance.shaders.set(e,{object:a,generation:s.__glance.generation}),a}function us(s,t,i,e,n){typeof i=="string"?i=pt(s,`${t}-vertex`,s.VERTEX_SHADER,i):(!s.isShader(i.glo)||i.stage!==s.VERTEX_SHADER)&&w(()=>`Invalid vertex shader for program "${t}"`),typeof e=="string"?e=pt(s,`${t}-fragment`,s.FRAGMENT_SHADER,e):(!s.isShader(e.glo)||e.stage!==s.FRAGMENT_SHADER)&&w(()=>`Invalid fragment shader for program "${t}"`);let h=`${i.source}
${e.source}`,a=s.__glance.programs.get(h);if(a)return a.generation=s.__glance.generation,C(()=>`Reusing cached program "${t}"`),a.object;let r=s.createProgram();r||w(()=>`Failed to create program "${t}"`),s.attachShader(r,i.glo),s.attachShader(r,e.glo),s.linkProgram(r);try{s.getProgramParameter(r,s.LINK_STATUS)||w(()=>`Failed to link shader program "${t}": ${s.getProgramInfoLog(r)}
Vertex Shader log: ${s.getShaderInfoLog(i.glo)}
Fragent Shader log: ${s.getShaderInfoLog(e.glo)}`);let c={name:t,vertex:i,fragment:e,glo:r,attributes:new Map,uniforms:new Map};return bs(s,c),Is(s,c,n??{}),C(()=>`Created program "${t}"`),s.__glance.programs.set(h,{object:c,generation:s.__glance.generation}),c}catch(c){throw s.deleteProgram(r),c}}function fs(s,t,i,e){e=e??at.STATIC_DRAW;let n=new Map,h,a=0;for(let[l,u]of Object.entries(i)){let x={type:u.type??p.FLOAT,height:u.height,width:u.width??1,normalized:u.normalized,divisor:u.divisor},E=x.height*x.width;E===0&&w(()=>`Invalid size ${E} for Attribute "${l}" of ABO "${t}"`);let y=u.data.length/E;y===0&&w(()=>`The data for Attribute "${l}" of ABO "${t}" must not be empty.`),y%1!==0&&w(()=>`The data length for Attribute "${l}" of ABO "${t}" must be a multiple of the number of scalars required per attribute. Data length is ${u.data.length}, attribute length is ${E}.`),ws(x.type)&&(x.height!==3&&x.height!==4&&w(()=>`Attribute "${l}" of ABO "${t}" must have a height of 3 or 4 when using packed integer data.`),x.width!==1&&w(()=>`Attribute "${l}" of ABO "${t}" must have a width of 1 when using packed integer data.`)),h===void 0?h=y:h!==y&&w(()=>`Attribute buffer "${t}" has inconsistent vertex counts`),n.set(l,x),a+=E*dt(x.type)}h===void 0&&w(()=>`Attribute Buffer "${t}" must have at least one attribute.`);let r=new ArrayBuffer(h*a),c=new DataView(r),o=new Map([[p.BYTE,c.setInt8.bind(c)],[p.UNSIGNED_BYTE,c.setUint8.bind(c)],[p.SHORT,c.setInt16.bind(c)],[p.UNSIGNED_SHORT,c.setUint16.bind(c)],[p.INT,c.setInt32.bind(c)],[p.UNSIGNED_INT,c.setUint32.bind(c)],[p.FLOAT,c.setFloat32.bind(c)],[p.HALF_FLOAT,(l,u)=>c.setUint16(l,zs(u),!0)]]),f=0;for(let[l,u]of n.entries()){let x=i[l].data,E=u.height*u.width,y=dt(u.type),A=E*y,M=a-A,_=f,b=o.get(u.type);if(b)for(let R=0;R<x.length;R++)g(_<r.byteLength,()=>`Attribute "${l}" of ABO "${t}" is out of bounds.`),b(_,x[R],!0),_+=y,(R+1)%E===0&&(_+=M);else{let R;switch(u.type){case p.INT_2_10_10_10_REV:{R=ps;break}case p.UNSIGNED_INT_2_10_10_10_REV:{R=Ss;break}default:w(()=>`Unsupported data type for attribute "${l}" of buffer "${t}"`)}if(u.height===3)for(let T=0;T<x.length;T+=3)c.setUint32(_,R(x[T],x[T+1],x[T+2],1),!1),_+=M;else for(let T=0;T<x.length;T+=4)c.setUint32(_,R(x[T],x[T+1],x[T+2],x[T+3]),!1),_+=M}f+=A}let d=s.createBuffer();d||w(()=>`Failed to create attribute buffer "${t}"`);try{return s.bindBuffer(s.ARRAY_BUFFER,d),s.bufferData(s.ARRAY_BUFFER,r,e),C(()=>`Created Attribute Buffer "${t}" with ${n.size} attributes for ${h} vertices and a size of ${r.byteLength} bytes.`),s.__glance.buffers.push(d),{glo:d,name:t,vertexCount:h,attributes:n,usage:e}}catch(l){throw s.deleteBuffer(d),l}finally{s.bindBuffer(s.ARRAY_BUFFER,null)}}function ls(s,t,i,e={}){let n=e.drawMode??W.TRIANGLES;switch(g(i.length>0,()=>`Index buffer "${t}" must have at least one index.`),n){case W.TRIANGLES:g(i.length%3===0,()=>`Size of Index buffer "${t}" with draw mode 'TRIANGLES' must be a multiple of 3.`);break;case W.TRIANGLE_STRIP:g(i.length>=3,()=>`Size of Index buffer "${t}" draw mode 'TRIANGLE_STRIP' must be at least 3.`);break;case W.LINES:g(i.length%2===0,()=>`Size of Index buffer "${t}" with draw mode 'LINES' must be a multiple of 2.`);break;case W.LINE_STRIP:g(i.length>=2,()=>`Size of Index buffer "${t}" with draw mode 'LINE_STRIP' must be at least 2.`);break;case W.LINE_LOOP:g(i.length>=2,()=>`Size of Index buffer "${t}" with draw mode 'LINE_LOOP' must be at least 2.`);break;case W.POINTS:break;default:w(()=>`Index buffer "${t}" has invalid draw mode: ${n}.`)}let h=0;for(let f of i)h=Math.max(h,f);let a;h<256?a=K.UNSIGNED_BYTE:h<65536?a=K.UNSIGNED_SHORT:h<4294967296?a=K.UNSIGNED_INT:w(()=>`Index ${h} does not fit in a 32-bit unsigned integer.`);let r;switch(a){case K.UNSIGNED_BYTE:r=new Uint8Array(i);break;case K.UNSIGNED_SHORT:r=new Uint16Array(i);break;case K.UNSIGNED_INT:r=new Uint32Array(i);break}let c=s.createBuffer();c||w(()=>`Failed to create index buffer "${t}"`);let o=e.usage??at.STATIC_DRAW;try{return s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,c),s.bufferData(s.ELEMENT_ARRAY_BUFFER,r,o),C(()=>`Created Index Buffer "${t}" with ${i.length} indices and a size of ${r.byteLength} bytes.`),s.__glance.buffers.push(c),{glo:c,name:t,type:a,size:i.length,usage:o,drawMode:n}}catch(f){throw s.deleteBuffer(c),f}finally{s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null)}}function ds(s,t,i,e,n){let h=s.createVertexArray();h||w(()=>`Failed to create VAO "${t}"`);let a=new Map;try{s.bindVertexArray(h),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glo),Array.isArray(e)||(e=[e]);let r=s.getParameter(s.MAX_VERTEX_ATTRIBS);for(let c of e){s.bindBuffer(s.ARRAY_BUFFER,c.glo);let o=Ts(c),f=0;for(let[d,l]of c.attributes){let u=f;f+=Pt(l);let x=n.attributes.get(d);if(!x)continue;if(a.has(x.location)){let y=a.get(x.location).buffer;console.warn(`Ignoring attribute "${d}" in buffer "${c.name}" as the attribute is already bound to buffer "${y.name}".`);continue}a.set(x.location,{buffer:c,name:d});let E=l.height*dt(l.type);for(let y=0;y<l.width;++y){let A=x.location+y;A>=r&&w(()=>`Attribute "${d}" of VAO "${t}" cannot be bound to location ${A}, because it would exceed the maximum number of vertex attributes (${r}).`);let M=u+y*E;s.enableVertexAttribArray(A),Rs(l.type)?s.vertexAttribIPointer(A,l.height,l.type,o,M):s.vertexAttribPointer(A,l.height,l.type,l.normalized||!1,o,M),s.vertexAttribDivisor(A,l.divisor||0)}}}return C(()=>`Created Vertex Array Object "${t}" with ${a.size} attributes.`),s.__glance.vaos.push(h),{glo:h,name:t,ibo:i,attributes:a}}catch(r){throw s.deleteVertexArray(h),r}finally{s.bindVertexArray(null),s.bindBuffer(s.ARRAY_BUFFER,null),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null)}}function ct(s,t,i,e,n={}){let h=n.target??P.TEXTURE_2D;n.depth!==void 0&&(!Number.isSafeInteger(n.depth)||n.depth<1)&&w(()=>`Invalid depth ${n.depth} for texture "${t}"`);let a=n.depth??1,r=$s(h);h==P.TEXTURE_2D||h==P.TEXTURE_CUBE_MAP?(a!==1&&v(()=>`Ignoring given depth ${a} of ${r} texture "${t}".`),(i<1||e<1||!Number.isSafeInteger(i)||!Number.isSafeInteger(e))&&w(()=>`Invalid texture dimensions: ${i}x${e} of ${r} texture "${t}".`)):(i<1||e<1||a<1||!Number.isSafeInteger(i)||!Number.isSafeInteger(e)||!Number.isSafeInteger(a))&&w(()=>`Invalid texture dimensions: ${i}x${e}x${a} of ${r} texture "${t}".`);let c=Math.floor(Math.log2(Math.max(i,e,a)))+1;n.levels!==void 0&&((n.levels<1||!Number.isSafeInteger(n.levels))&&w(()=>`Invalid number of levels for ${r} texture "${t}": ${n.levels}.`),n.levels>c&&(v(()=>`Ignoring given number of levels for ${r} texture "${t}" because ${n.levels} is larger than the maximum possible number of levels ${c}.`),n.levels=c));let o=n.levels??c,f=n.internalFormat??m.RGBA8;n.compareFunc&&!Fs(f)&&(v(()=>`Ignoring given comparison function for ${r} texture "${t}" because it is not a depth texture.`),n.compareFunc=et.NONE);let d=n.compareFunc??et.NONE,l=s.createTexture();l===null&&w(()=>`Failed to create WebGL texture for ${r} texture "${t}"`);try{let u=n.wipTextureUnit??Lt(s,n.wipTextureUnit);if(s.activeTexture(s.TEXTURE0+u),s.bindTexture(h,l),a===1){if(s.texStorage2D(h,o,f,i,e),f===m.RGBA8){let _=new Uint8Array(i*e*4);if(h===P.TEXTURE_2D)s.texSubImage2D(h,0,0,0,i,e,s.RGBA,s.UNSIGNED_BYTE,_);else for(let b=0;b<6;++b)s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+b,0,0,0,i,e,s.RGBA,s.UNSIGNED_BYTE,_);o>1&&s.generateMipmap(h)}d!==et.NONE&&(s.texParameteri(h,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(h,s.TEXTURE_COMPARE_FUNC,d))}else s.texStorage3D(h,o,f,i,e,a);let x,E;n.filter===void 0?(o>1?x=L.LINEAR_MIPMAP_LINEAR:x=L.LINEAR,E=L.LINEAR):Array.isArray(n.filter)?(x=n.filter[0],E=n.filter[1]):(x=n.filter,E=n.filter),o===1&&([L.NEAREST,L.LINEAR].includes(x)||(v(()=>`Ignoring given minification filter for ${r} texture "${t}" because it has only one level.`),[L.NEAREST_MIPMAP_NEAREST,L.NEAREST_MIPMAP_LINEAR].includes(x)?x=L.NEAREST:x=L.LINEAR)),[L.NEAREST,L.LINEAR].includes(E)||(v(()=>`Ignoring given magnification filter for ${r} texture "${t}".`),[L.NEAREST_MIPMAP_NEAREST,L.NEAREST_MIPMAP_LINEAR].includes(E)?E=L.NEAREST:E=L.LINEAR),Cs(f)&&(![L.NEAREST,L.NEAREST_MIPMAP_NEAREST].includes(x)||E!==L.NEAREST)&&s.getExtension("OES_texture_float_linear")===null&&(v(()=>"Linear filtering for floating point textures is not supported on this system."),x=L.NEAREST,E=L.NEAREST),s.texParameteri(h,s.TEXTURE_MIN_FILTER,x),s.texParameteri(h,s.TEXTURE_MAG_FILTER,E);let y,A,M;if(n.wrap===void 0?(y=st.CLAMP_TO_EDGE,A=st.CLAMP_TO_EDGE,M=st.CLAMP_TO_EDGE):Array.isArray(n.wrap)?(y=n.wrap[0],A=n.wrap[1],M=n.wrap[2]??st.CLAMP_TO_EDGE,h===P.TEXTURE_2D&&n.wrap.length>2&&v(()=>`Ignoring given wrap R mode for ${r} texture "${t}" because it has only two dimensions.`)):(y=n.wrap,A=n.wrap,M=n.wrap),s.texParameteri(h,s.TEXTURE_WRAP_S,y),s.texParameteri(h,s.TEXTURE_WRAP_T,A),h!==P.TEXTURE_2D&&s.texParameteri(h,s.TEXTURE_WRAP_R,M),n.useAnisotropy){let _=s.getExtension("EXT_texture_filter_anisotropic");_?s.texParameterf(s.TEXTURE_2D,_.TEXTURE_MAX_ANISOTROPY_EXT,s.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):v(()=>"Anisotropic filtering is not supported.")}return C(()=>`Created ${r} texture "${t}" with dimensions ${i}x${e}x${a} and ${o} levels.`),s.__glance.textures.push(l),{glo:l,name:t,target:h,width:i,height:e,depth:a,levels:o,internalFormat:f,compareFunc:d,attachmentType:tt.TEXTURE}}catch(u){throw s.deleteTexture(l),u.message=`Failed to create ${r} texture "${t}": ${u.message}`,u}finally{s.bindTexture(h,null),s.activeTexture(s.TEXTURE0)}}function xt(s,t,i,e={}){e.dataTarget===void 0?t.target===P.TEXTURE_CUBE_MAP&&w(()=>`You need to specify an explicit target when updating a face of cube map texture "${t.name}".`):t.target===P.TEXTURE_CUBE_MAP&&(e.dataTarget>=Z.TEXTURE_CUBE_MAP_POSITIVE_X&&e.dataTarget<=Z.TEXTURE_CUBE_MAP_NEGATIVE_Z||w(()=>`Invalid data target '${e.dataTarget}' for cube map texture: "${t.name}".`));let n=e.dataTarget??t.target;e.level!==void 0&&(e.level<0||!Number.isSafeInteger(e.level))&&w(()=>`Invalid mipmap level: ${e.level}.`);let h=e.level??0,a=Lt(s,e.wipTextureUnit);e.srcDataType===void 0?ArrayBuffer.isView(i)?e.srcDataType=Ds(i):e.srcDataType=N.UNSIGNED_BYTE:ArrayBuffer.isView(i)?vs(i,e.srcDataType):e.srcDataType!==N.UNSIGNED_BYTE&&w(()=>"When defining a texture with a 'TexImageSource', the source data type must be 'UNSIGNED_BYTE'");let r=e.srcDataType;Bs(t.internalFormat,r);let c=Ls(s,t.internalFormat),o=e.flipY??t.target===P.TEXTURE_2D,f=e.createMipMaps??t.levels>1;try{s.activeTexture(s.TEXTURE0+a),s.bindTexture(t.target,t.glo),o&&s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),t.depth>1?s.texSubImage3D(n,h,0,0,0,t.width,t.height,t.depth,c,r,i):s.texSubImage2D(n,h,0,0,t.width,t.height,c,r,i),f&&s.generateMipmap(t.target)}catch(d){throw d.message=`Failed to define texture "${t.name}": ${d.message}`,d}finally{s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE0)}}function xs(s,t,i,e,n){(i<1||e<1||!Number.isSafeInteger(i)||!Number.isSafeInteger(e))&&w(()=>`Invalid renderbuffer dimensions: ${i}x${e} of renderbuffer "${t}".`);let h=s.getParameter(s.MAX_RENDERBUFFER_SIZE);(i>h||e>h)&&w(()=>`Renderbuffer "${t}" exceeds the maximum renderbuffer size of ${h}.`);let a=s.createRenderbuffer();a===null&&w(()=>`Failed to create a new WebGL renderbuffer object for "${t}".`);try{return s.bindRenderbuffer(s.RENDERBUFFER,a),s.renderbufferStorage(s.RENDERBUFFER,n,i,e),C(()=>`Created Renderbuffer "${t}" with dimensions ${i}x${e} and internal format ${n}.`),s.__glance.renderbuffers.push(a),{glo:a,name:t,width:i,height:e,internalFormat:n,attachmentType:tt.RENDERBUFFER}}catch(r){throw s.deleteRenderbuffer(a),r}finally{s.bindRenderbuffer(s.RENDERBUFFER,null)}}function Es(s,t,i=null,e=null,n=null){let h=u=>Object.hasOwn(u,"attachmentType"),a=(Array.isArray(i)?i:i===null?[]:[i]).map(u=>h(u)?{attachment:u}:u),r=e===null?null:h(e)?{attachment:e}:e,c=n===null?null:h(n)?{attachment:n}:n,o=s.getParameter(s.MAX_COLOR_ATTACHMENTS);a.length>o&&w(()=>`Framebuffer "${t}" has ${a.length} color attachments, but the maximum is ${o}.`);let f;for(let u=0;u<a.length;++u){let x=a[u].attachment;f===void 0?f=[x.width,x.height]:(x.width!==f[0]||x.height!==f[1])&&w(()=>`Framebuffer "${t}" has color attachments with different dimensions.`)}if(r!==null){let u=r.attachment;f===void 0?f=[u.width,u.height]:(u.width!==f[0]||u.height!==f[1])&&w(()=>`Framebuffer "${t}" has color/depth attachments with different dimensions.`)}let d=s.createFramebuffer();d===null&&w(()=>`Failed to create a new WebGL framebuffer object for "${t}".`);function l(u,x){let E=x===s.DEPTH_ATTACHMENT?"depth":`color[${x-s.COLOR_ATTACHMENT0}]`;if(u.attachment.attachmentType===tt.TEXTURE){let y=u.attachment;if(y.target===P.TEXTURE_2D)(u.target??Z.TEXTURE_2D)!==Z.TEXTURE_2D&&v(()=>`Ignoring the target "${u.target}" for ${E} attachment of framebuffer "${t}", using 'gl.TEXTURE_2D' instead.`),s.framebufferTexture2D(s.FRAMEBUFFER,x,s.TEXTURE_2D,y.glo,u.level??0);else if(y.target===P.TEXTURE_CUBE_MAP)u.target===void 0&&w(()=>`Missing target for cubemap ${E} attachment of framebuffer "${t}".`),u.target>=Z.TEXTURE_CUBE_MAP_POSITIVE_X&&u.target<=Z.TEXTURE_CUBE_MAP_NEGATIVE_Z||w(()=>`Invalid data target for cube map texture: ${u.target}.`),s.framebufferTexture2D(s.FRAMEBUFFER,x,u.target,y.glo,u.level??0);else{if(u.target??y.target!==y.target){let A=y.target===P.TEXTURE_2D_ARRAY?"gl.TEXTURE_2D_ARRAY":"gl.TEXTURE_3D";v(()=>`Ignoring the target "${u.target}" for ${E} attachment of framebuffer "${t}", using ${A} instead.`)}if(u.layer===void 0){let A=y.target===P.TEXTURE_2D_ARRAY?"2D array":"3D";v(()=>`Missing layer for ${E} attachment (which is a ${A} texture) of framebuffer "${t}", using layer 0 by default.`)}s.framebufferTextureLayer(s.FRAMEBUFFER,x,y.glo,u.level??0,u.layer??0)}}else{let y=u.attachment;u.level!==void 0&&v(()=>`Ignoring given level ${u.level} for renderbuffer ${E} attachment of framebuffer "${t}".`),u.target!==void 0&&v(()=>`Ignoring given target ${u.target} for renderbuffer ${E} attachment of framebuffer "${t}".`),s.framebufferRenderbuffer(s.FRAMEBUFFER,x,s.RENDERBUFFER,y.glo)}}try{if(s.bindFramebuffer(s.FRAMEBUFFER,d),a.length===0)s.drawBuffers([s.NONE]),s.readBuffer(s.NONE);else{let x=[];for(let E=0;E<a.length;++E){let y=s.COLOR_ATTACHMENT0+E;l(a[E],y),x.push(y)}s.drawBuffers(x)}r!==null&&l(r,s.DEPTH_ATTACHMENT),c!==null&&w(()=>"Stencil attachments are not supported yet.");let u=s.checkFramebufferStatus(s.FRAMEBUFFER);return u!==s.FRAMEBUFFER_COMPLETE&&w(()=>{switch(u){case s.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return`Incomplete framebuffer '${t}'! One or more framebuffer attachment points are incomplete.`;case s.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return`Incomplete framebuffer '${t}'! One or more of the framebuffer attachment's dimensions are not the same.`;case s.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return`Incomplete framebuffer '${t}'! No images are attached to the framebuffer.`;case s.FRAMEBUFFER_UNSUPPORTED:return`Incomplete framebuffer '${t}'! The combination of internal formats of the attached images violates an implementation-dependent set of restrictions.`;case s.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return`Incomplete framebuffer '${t}'! The value of GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES is not the same for all attached textures.`;default:return`Incomplete framebuffer '${t}'! Unknown error code ${u}.`}}),r!==null?c!==null?C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments, and a depth- and stencil attachment.`):C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments and a depth attachment.`):c!==null?C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments and a stencil attachment.`):C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments.`),s.__glance.framebuffers.push(d),{glo:d,name:t,color:a,depth:r,stencil:c}}catch(u){throw s.deleteFramebuffer(d),u.message=`Failed to define framebuffer "${t}": ${u.message}`,u}finally{s.bindFramebuffer(s.FRAMEBUFFER,null)}}function ys(s,t,i,e,n=0){let h,a;switch(i){case s.DEPTH_ATTACHMENT:h=t.depth??w(()=>`Framebuffer "${t.name}" has no depth attachment.`),a="depth";break;case s.STENCIL_ATTACHMENT:h=t.stencil??w(()=>`Framebuffer "${t.name}" has no stencil attachment.`),a="stencil";break;default:h=t.color[i-s.COLOR_ATTACHMENT0]??w(()=>`Framebuffer "${t.name}" has no color attachment at location ${i}.`),a=`color[${i-s.COLOR_ATTACHMENT0}]`}if(h.layer===e&&h.level===(n??h.level))return;h.attachment.attachmentType!==tt.TEXTURE&&w(()=>`Framebuffer "${t.name}" has no texture as its ${a} attachment, but a renderbuffer.`);let r=h.attachment;if(r.target!==P.TEXTURE_2D_ARRAY&&r.target!==P.TEXTURE_3D){let o=r.target===P.TEXTURE_2D?"2D":"cubemap";w(()=>`Framebuffer "${t.name}" has no 3D or 2D array texture as its ${a} attachment, but a ${o} texture.`)}(e<0||e>=r.depth)&&w(()=>`Invalid layer ${e} for ${a} attachment of framebuffer "${t.name}", which has a depth of ${r.depth}.`);let c=s.getParameter(s.FRAMEBUFFER_BINDING);try{s.bindFramebuffer(s.FRAMEBUFFER,t.glo),s.framebufferTextureLayer(s.FRAMEBUFFER,i,r.glo,n??h.level??0,e)}finally{s.bindFramebuffer(s.FRAMEBUFFER,c)}}function _s(s,t,i,e,n={}){n.indexCount!==void 0&&n.indexCount<=0&&w(()=>`Invalid index count: ${n.indexCount}.`),n.indexOffset!==void 0&&(n.indexOffset<0&&w(()=>`Invalid index offset: ${n.indexOffset}.`),n.indexOffset=Math.ceil(n.indexOffset));let h=n.indexCount??i.ibo.size,a=n.indexOffset??0;a+h>i.ibo.size&&w(()=>`Index offset ${a} and count ${h} exceed the size of the index buffer (${i.ibo.size}).`),n.instances!==void 0&&(n.instances<=0&&w(()=>`Instance count cannot be <= 0, is: ${n.instances}.`),Number.isSafeInteger(n.instances)||v(()=>`Instance count is not an integer, is: ${n.instances}.`),n.instances=Math.ceil(n.instances));for(let[o,f]of e.attributes.entries()){let d=i.attributes.get(f.location);d===void 0&&w(()=>`VAO "${i.name}" does not provide an attribute for "${o}" (at location ${f.location}) of shader program "${e.name}"!`);let l=d.buffer.attributes.get(d.name);l===void 0&&w(()=>`Missing attribute "${d.name}" in VBO "${d.buffer.name}"!`),ms(l,f.type)||w(()=>{let u=Ns(l);return`Attribute "${d.name}" in VBO "${d.buffer.name}" has type '${u}' but shader program "${e.name}" expects type '${f.type} at location ${f.location}'!`}),o!=d.name&&v(()=>`Attribute "${o}" of shader program "${e.name}" at location ${f.location} is bound to attribute "${d.name}" in VBO "${d.buffer.name}"!`)}for(let o of Object.keys(n.uniforms??{}))e.uniforms.has(o)||v(()=>`Uniform "${o}" of Draw Call "${t}" not found in shader program "${e.name}"!`);let r=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS),c=new Map;if(n.textures!==void 0)for(let[o,f]of Object.entries(n.textures)){let d=e.uniforms.get(o);if(d===void 0){v(()=>`Uniform "${o}" of Draw Call "${t}" not found in shader program "${e.name}".`);continue}St(d.type)||w(()=>`Uniform "${o}" in program "${e.name}" is not a texture sampler.`);let l=d.value;(typeof l!="number"||!Number.isSafeInteger(l)||l<0||l>=r)&&w(()=>`Invalid texture unit id: ${l}. Valid range is [0, ${r}).`);let u=c.get(l);u===void 0?c.set(l,Xs(f)):Hs(u,f,l)}return{name:t,vao:i,program:e,textures:c,indexCount:h,indexOffset:a,drawMode:n.drawModeOverride??i.ibo.drawMode,instances:n.instances??1,uniform:n.uniforms??{},cullFace:n.cullFace,depthTest:n.depthTest,blendFunc:n.blendFunc,updateDepthBuffer:n.updateDepthBuffer}}function As(s,t){let i=t.vao,e=t.program;try{s.bindVertexArray(i.glo),s.useProgram(e.glo),t.cullFace!==void 0&&(t.cullFace===ot.NONE?s.disable(s.CULL_FACE):(s.enable(s.CULL_FACE),s.cullFace(t.cullFace))),t.depthTest!==void 0&&(t.depthTest===ut.NONE?s.disable(s.DEPTH_TEST):(s.enable(s.DEPTH_TEST),s.depthFunc(t.depthTest))),t.blendFunc!==void 0&&(t.blendFunc[0]===rt.ONE&&t.blendFunc[1]===rt.ZERO?s.disable(s.BLEND):(s.enable(s.BLEND),t.blendFunc.length===4?s.blendFuncSeparate(t.blendFunc[0],t.blendFunc[1],t.blendFunc[2],t.blendFunc[3]):t.blendFunc.length===2?s.blendFunc(t.blendFunc[0],t.blendFunc[1]):w(()=>`Invalid blend function array length: ${t.blendFunc.length}.`))),t.updateDepthBuffer!==void 0&&s.depthMask(t.updateDepthBuffer);for(let[h,a]of Object.entries(t.uniform)){let r=e.uniforms.get(h);r||w(()=>`Uniform "${h}" not found in program "${e.name}"`),lt(r.value,a)||(r.value=q(a),Bt(s,r))}for(let[h,a]of t.textures)s.activeTexture(s.TEXTURE0+h),a.texture_2d!==void 0&&s.bindTexture(s.TEXTURE_2D,a.texture_2d.glo),a.texture_3d!==void 0&&s.bindTexture(s.TEXTURE_3D,a.texture_3d.glo),a.texture_cube!==void 0&&s.bindTexture(s.TEXTURE_CUBE_MAP,a.texture_cube.glo),a.texture_2d_array!==void 0&&s.bindTexture(s.TEXTURE_2D_ARRAY,a.texture_2d_array.glo);let n=t.instances??1;(isNaN(n)||!isFinite(n)||n<1)&&w(()=>`Invalid instance count: ${n}.`),n=Math.ceil(n),n==1?s.drawElements(t.drawMode,t.indexCount,t.vao.ibo.type,t.indexOffset):s.drawElementsInstanced(t.drawMode,t.indexCount,t.vao.ibo.type,t.indexOffset,n)}finally{t.textures.size>0&&(s.bindTexture(s.TEXTURE_2D_ARRAY,null),s.bindTexture(s.TEXTURE_CUBE_MAP,null),s.bindTexture(s.TEXTURE_3D,null),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE0)),t.updateDepthBuffer!==void 0&&s.depthMask(!0),t.blendFunc!==void 0&&(s.blendFunc(s.ONE,s.ZERO),s.disable(s.BLEND)),t.depthTest!==void 0&&(s.depthFunc(s.ALWAYS),s.disable(s.DEPTH_TEST)),t.cullFace!==void 0&&(s.cullFace(s.BACK),s.disable(s.CULL_FACE)),s.useProgram(null),s.bindVertexArray(null)}}function Ms(s,t=0){let i=!1,e=s.__glance.generation-t,n=(u,x)=>{let E=0;for(let[y,A]of u.entries())A.generation<=e&&(x(A.object),u.delete(y),E++,i=!0);return E},h=(u,x)=>{let E=u.length;for(let y=0;y<E;++y)x(u[y]),i=!0;return u.length=0,E},a=n(s.__glance.shaders,u=>s.deleteShader(u.glo)),r=n(s.__glance.programs,u=>s.deleteProgram(u.glo)),c=h(s.__glance.buffers,u=>s.deleteBuffer(u)),o=h(s.__glance.vaos,u=>s.deleteVertexArray(u)),f=h(s.__glance.textures,u=>s.deleteTexture(u)),d=h(s.__glance.renderbuffers,u=>s.deleteRenderbuffer(u)),l=h(s.__glance.framebuffers,u=>s.deleteFramebuffer(u));if(i){let u=`Cleaned up WebGL resources:
`;a>0&&(u+=` - ${a} shader${a>1?"s":""}
`),r>0&&(u+=` - ${r} program${r>1?"s":""}
`),c>0&&(u+=` - ${c} buffer${c>1?"s":""}
`),o>0&&(u+=` - ${o} VAO${o>1?"s":""}
`),f>0&&(u+=` - ${f} texture${f>1?"s":""}
`),d>0&&(u+=` - ${d} renderbuffer${d>1?"s":""}
`),l>0&&(u+=` - ${l} framebuffer${l>1?"s":""}
`),C(()=>u.slice(0,-1))}s.__glance.generation+=1,ks(s)}function bs(s,t){let i=/^\s*(?:layout\s*\(location\s*=\s*(?<location>\d+)\)\s*)?in\s+(?:(?<precision>lowp|mediump|highp)\s+)?(?<type>\w+)\s+(?<name>\w+)\s*;/gm;if(t.attributes.size>0){v(()=>`Attributes of shader program "${t.name}" are already defined.`);return}let e;for(;(e=i.exec(t.vertex.source))!==null;){let{name:n,type:h,location:a,precision:r}=e.groups,c=s.getAttribLocation(t.glo,n);c<0||(a!==void 0&&c!==parseInt(a)&&v(()=>`Vertex shader of shader program "${n}" specifies the location of attribute "${n}" to be ${a}, but it was found at ${c}.`),(n.startsWith("webgl_")||n.startsWith("_webgl_"))&&w(()=>`Attribute name "${n}" is reserved by WebGL.`),t.attributes.set(n,{type:h,location:c,precision:r}))}}function Rs(s){switch(s){case p.BYTE:case p.UNSIGNED_BYTE:case p.SHORT:case p.UNSIGNED_SHORT:case p.INT:case p.UNSIGNED_INT:return!0;default:return!1}}function ws(s){switch(s){case p.INT_2_10_10_10_REV:case p.UNSIGNED_INT_2_10_10_10_REV:return!0;default:return!1}}function dt(s){switch(s){case p.BYTE:case p.UNSIGNED_BYTE:return 1;case p.SHORT:case p.UNSIGNED_SHORT:case p.HALF_FLOAT:return 2;case p.INT:case p.UNSIGNED_INT:case p.FLOAT:case p.INT_2_10_10_10_REV:case p.UNSIGNED_INT_2_10_10_10_REV:return 4;default:ht(s)}}function Pt(s){return dt(s.type)*s.height*s.width}function Ts(s){let t=0;for(let i of s.attributes.values())t+=Pt(i);return t}function ms(s,t){switch(s.type){case p.BYTE:case p.UNSIGNED_BYTE:case p.SHORT:case p.UNSIGNED_SHORT:case p.INT:case p.UNSIGNED_INT:switch(t){case"int":case"uint":return s.height===1&&s.width===1;case"ivec2":case"uvec2":return s.height===2&&s.width===1;case"ivec3":case"uvec3":return s.height===3&&s.width===1;case"ivec4":case"uvec4":return s.height===4&&s.width===1;default:return!1}case p.INT_2_10_10_10_REV:return t==="int";case p.UNSIGNED_INT_2_10_10_10_REV:return t==="uint";case p.FLOAT:case p.HALF_FLOAT:switch(t){case"float":return s.height===1&&s.width===1;case"vec2":return s.height===2&&s.width===1;case"vec3":return s.height===3&&s.width===1;case"vec4":return s.height===4&&s.width===1;case"mat2":case"mat2x2":return s.height===2&&s.width===2;case"mat2x3":return s.height===3&&s.width===2;case"mat2x4":return s.height===4&&s.width===2;case"mat3x2":return s.height===2&&s.width===3;case"mat3":case"mat3x3":return s.height===3&&s.width===3;case"mat3x4":return s.height===4&&s.width===3;case"mat4x2":return s.height===2&&s.width===4;case"mat4x3":return s.height===3&&s.width===4;case"mat4":case"mat4x4":return s.height===4&&s.width===4;default:return!1}default:ht(s.type)}}function Ns(s){switch(s.type){case p.BYTE:case p.SHORT:case p.INT:switch(s.width){case 1:switch(s.height){case 1:return"int";case 2:return"ivec2";case 3:return"ivec3";case 4:return"ivec4"}}break;case p.INT_2_10_10_10_REV:return"int";case p.UNSIGNED_INT_2_10_10_10_REV:return"uint";case p.UNSIGNED_BYTE:case p.UNSIGNED_SHORT:case p.UNSIGNED_INT:switch(s.width){case 1:switch(s.height){case 1:return"uint";case 2:return"uvec2";case 3:return"uvec3";case 4:return"uvec4"}}break;case p.FLOAT:case p.HALF_FLOAT:switch(s.width){case 1:switch(s.height){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}break;case 2:switch(s.height){case 2:return"mat2";case 3:return"mat2x3";case 4:return"mat2x4"}break;case 3:switch(s.height){case 2:return"mat3x2";case 3:return"mat3";case 4:return"mat3x4"}break;case 4:switch(s.height){case 2:return"mat4x2";case 3:return"mat4x3";case 4:return"mat4"}break}}w(()=>`Invalid attribute type: ${s.type} with a size of ${s.height} and a width of ${s.width}.`)}function zs(s){let t=new Float32Array(1),i=new Uint16Array(t.buffer);t[0]=s;let e=i[1]<<16|i[0],n=e>>31<<15,h=(e>>23&255)-127+15,a=e&8388607;return h<0?(h=0,a=(a|8388608)>>1-h):h>31&&(h=31,a=0),n|h<<10|a>>13}function ps(s,t,i,e){return j(Math.round(e),0,3)<<30|j(Math.round(i),0,1023)<<20|j(Math.round(t),0,1023)<<10|j(Math.round(s),0,1023)}function Ss(s,t,i,e){return Math.sign(e)<<31|j(Math.round(Math.abs(e)),0,1)<<30|Math.sign(i)<<29|j(Math.round(Math.abs(i)),0,511)<<20|Math.sign(t)<<19|j(Math.round(Math.abs(t)),0,511)<<10|Math.sign(s)<<9|j(Math.round(Math.abs(s)),0,511)}function Is(s,t,i){let e=/^\s*uniform\s+(?<precision>lowp|mediump|highp)?\s*(?<type>\w+)\s+(?<name>\w+)(?:\s*\[\s*(?<sizeString>\d+)\s*\])?\s*;/gm;t.uniforms.clear();let n=[],h=new Set,a;for(let r of[t.vertex.source,t.fragment.source])for(;(a=e.exec(r))!==null;){let{name:c,type:o,precision:f,sizeString:d}=a.groups;if(t.uniforms.has(c))continue;let l=s.getUniformLocation(t.glo,c);if(!l)continue;let u=d?parseInt(d):1,x=i[c];if(x===void 0){if(St(o)){n.push([c,{type:o,location:l,size:u,value:x,precision:f}]);continue}x=Us(o,u)}else St(o)&&h.add(x);t.uniforms.set(c,{type:o,location:l,size:u,value:x,precision:f})}for(let[r,c]of n){let o=0;for(;h.has(o);)o++;h.add(o),c.value=o,C(()=>`Auto-assigning texture sampler "${r}" to texture unit ${o}.`),t.uniforms.set(r,c)}try{s.useProgram(t.glo);for(let r of t.uniforms.values())Bt(s,r)}finally{s.useProgram(null)}}function St(s){return s.indexOf("sampler")!==-1}function Us(s,t){let i;switch(s){case"float":case"int":case"uint":case"bool":case"sampler2D":case"sampler2DArray":case"samplerCube":case"sampler3D":case"isampler2D":case"isampler2DArray":case"isamplerCube":case"isampler3D":case"usampler2D":case"usampler2DArray":case"usamplerCube":case"usampler3D":case"sampler2DShadow":case"sampler2DArrayShadow":case"samplerCubeShadow":i=0;break;case"vec2":case"ivec2":case"uvec2":case"bvec2":i=[0,0];break;case"vec3":case"ivec3":case"uvec3":case"bvec3":i=[0,0,0];break;case"vec4":case"ivec4":case"uvec4":case"bvec4":i=[0,0,0,0];break;case"mat2":case"mat2x2":i=[1,0,0,1];break;case"mat3":case"mat3x3":i=[1,0,0,0,1,0,0,0,1];break;case"mat4":case"mat4x4":i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];break;case"mat2x3":i=[1,0,0,1,0,0];break;case"mat2x4":i=[1,0,0,1,0,0,0,0];break;case"mat3x2":i=[1,0,0,0,1,0];break;case"mat3x4":i=[1,0,0,0,1,0,0,0,1,0,0,0];break;case"mat4x2":i=[1,0,0,0,0,1,0,0];break;case"mat4x3":i=[1,0,0,0,0,1,0,0,0,0,1,0];break;default:ht(s)}return t===1?i:Array(t).fill(i).flat()}var $t=s=>typeof s=="number",Et=s=>Number.isSafeInteger(s),Dt=s=>Et(s)&&s>=0,vt=s=>typeof s=="boolean"||Et(s)&&(s===0||s===1),yt=s=>Array.isArray(s)||ArrayBuffer.isView(s),Y=(s,t)=>yt(s.value)&&s.value.length==t*s.size&&s.value.every(i=>$t(i)),mt=(s,t)=>yt(s.value)&&s.value.length==t*s.size&&s.value.every(i=>vt(i)),Nt=(s,t)=>yt(s.value)&&s.value.length==t*s.size&&s.value.every(i=>Et(i)),zt=(s,t)=>yt(s.value)&&s.value.length==t*s.size&&s.value.every(i=>Dt(i)),Os=s=>(s.value.isVec2??!1)||Y(s,2),gs=s=>(s.value.isVec3??!1)||Y(s,3),Gs=s=>(s.value.isMat3??!1)||Y(s,9),Ps=s=>(s.value.isMat4??!1)||Y(s,16),F=(s,t,i)=>`Value of uniform must be an array of ${t*s.size} ${i}s, but is: ${JSON.stringify(s.value)}.`;function Bt(s,t){switch(t.type){case"float":return g($t(t.value),()=>"Value of uniform must be a number!"),s.uniform1f(t.location,t.value);case"vec2":return g(Os(t),()=>F(t,2,"number")),s.uniform2fv(t.location,t.value);case"vec3":return g(gs(t),()=>F(t,3,"number")),s.uniform3fv(t.location,t.value);case"vec4":return g(Y(t,4),()=>F(t,4,"number")),s.uniform4fv(t.location,t.value);case"mat2":case"mat2x2":return g(Y(t,4),()=>F(t,4,"number")),s.uniformMatrix2fv(t.location,!1,t.value);case"mat3":case"mat3x3":return g(Gs(t),()=>F(t,9,"number")),s.uniformMatrix3fv(t.location,!1,t.value);case"mat4":case"mat4x4":return g(Ps(t),()=>F(t,16,"number")),s.uniformMatrix4fv(t.location,!1,t.value);case"int":case"sampler2D":case"sampler2DArray":case"samplerCube":case"sampler3D":case"isampler2D":case"isampler2DArray":case"isamplerCube":case"isampler3D":case"usampler2D":case"usampler2DArray":case"usamplerCube":case"usampler3D":case"sampler2DShadow":case"sampler2DArrayShadow":case"samplerCubeShadow":return g(Et(t.value),()=>"Value of uniform must be an integer!"),s.uniform1i(t.location,t.value);case"uint":return g(Dt(t.value),()=>"Value of uniform must be a positive integer!"),s.uniform1ui(t.location,t.value);case"bool":return g(vt(t.value),()=>"Value of uniform must be a boolean, zero or one!"),s.uniform1i(t.location,t.value?1:0);case"mat2x3":return g(Y(t,6),()=>F(t,6,"number")),s.uniformMatrix2x3fv(t.location,!1,t.value);case"mat3x2":return g(Y(t,6),()=>F(t,6,"number")),s.uniformMatrix3x2fv(t.location,!1,t.value);case"mat2x4":return g(Y(t,8),()=>F(t,8,"number")),s.uniformMatrix2x4fv(t.location,!1,t.value);case"mat4x2":return g(Y(t,8),()=>F(t,8,"number")),s.uniformMatrix4x2fv(t.location,!1,t.value);case"mat3x4":return g(Y(t,12),()=>F(t,12,"number")),s.uniformMatrix3x4fv(t.location,!1,t.value);case"mat4x3":return g(Y(t,12),()=>F(t,12,"number")),s.uniformMatrix4x3fv(t.location,!1,t.value);case"ivec2":return g(Nt(t,2),()=>F(t,2,"integer")),s.uniform2iv(t.location,t.value);case"ivec3":return g(Nt(t,3),()=>F(t,3,"integer")),s.uniform3iv(t.location,t.value);case"ivec4":return g(Nt(t,4),()=>F(t,4,"integer")),s.uniform4iv(t.location,t.value);case"uvec2":return g(zt(t,2),()=>F(t,2,"positive integer")),s.uniform2uiv(t.location,t.value);case"uvec3":return g(zt(t,3),()=>F(t,3,"positive integer")),s.uniform3uiv(t.location,t.value);case"uvec4":return g(zt(t,4),()=>F(t,4,"positive integer")),s.uniform4uiv(t.location,t.value);case"bvec2":return g(mt(t,2),()=>F(t,2,"boolean")),s.uniform2iv(t.location,t.value);case"bvec3":return g(mt(t,3),()=>F(t,3,"boolean")),s.uniform3iv(t.location,t.value);case"bvec4":return g(mt(t,4),()=>F(t,4,"boolean")),s.uniform4iv(t.location,t.value);default:w(()=>`Unsupported uniform type "${t.type}"`)}}function $s(s){switch(s){case P.TEXTURE_2D:return"2D";case P.TEXTURE_3D:return"3D";case P.TEXTURE_CUBE_MAP:return"cubemap";case P.TEXTURE_2D_ARRAY:return"2D array"}}function Lt(s,t){let i=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);return t===void 0?i-1:(t<0&&w(()=>`WIP texture unit cannot be negative, got: ${t}.`),t>=i&&w(()=>`Invalid WIP texture unit: ${t}, maximal texture unit available is ${i-1}.`),t)}function Ds(s){if(s instanceof Uint8Array)return N.UNSIGNED_BYTE;if(s instanceof Uint16Array)return N.UNSIGNED_SHORT;if(s instanceof Uint32Array)return N.UNSIGNED_INT;if(s instanceof Float32Array)return N.FLOAT;s instanceof Int8Array||s instanceof Int16Array||s instanceof Int32Array?w(()=>"Signed integer buffers are not supported when defining a texture."):w(()=>`Invalid data type: ${s.constructor.name}.`)}function vs(s,t){s instanceof Uint8Array?t!==N.UNSIGNED_BYTE&&w(()=>"When defining a texture with a 'Uint8Array', the source data type must be 'UNSIGNED_BYTE'"):s instanceof Uint8ClampedArray?t!==N.UNSIGNED_BYTE&&w(()=>"When defining a texture with a 'Uint8ClampedArray'source data type must be 'UNSIGNED_BYTE'"):s instanceof Float32Array?t!==N.FLOAT&&w(()=>"When defining a texture with a 'Float32Array', the source data type must be 'FLOAT'"):s instanceof Uint16Array?[N.UNSIGNED_SHORT,N.UNSIGNED_SHORT_5_6_5,N.UNSIGNED_SHORT_5_5_5_1,N.UNSIGNED_SHORT_4_4_4_4,N.HALF_FLOAT].includes(t)||w(()=>"When defining a texture with a 'Uint16Array', the source data type must be one of 'UNSIGNED_SHORT', 'UNSIGNED_SHORT_5_6_5', 'UNSIGNED_SHORT_5_5_5_1', 'UNSIGNED_SHORT_4_4_4_4', or 'HALF_FLOAT'"):s instanceof Uint32Array?[N.UNSIGNED_INT,N.UNSIGNED_INT_5_9_9_9_REV,N.UNSIGNED_INT_2_10_10_10_REV,N.UNSIGNED_INT_10F_11F_11F_REV,N.UNSIGNED_INT_24_8].includes(t)||w(()=>"When defining a texture with a 'Uint32Array', the source data type must be one of 'UNSIGNED_INT', 'UNSIGNED_INT_5_9_9_9_REV', 'UNSIGNED_INT_2_10_10_10_REV', 'UNSIGNED_INT_10F_11F_11F_REV', or'UNSIGNED_INT_24_8'"):s instanceof Int8Array||s instanceof Int16Array||s instanceof Int32Array?w(()=>"Signed integer buffers are not supported when defining a texture."):w(()=>`Invalid data type for texture: ${s.constructor.name}`)}function Bs(s,t){switch(s){case m.R8:return t===N.UNSIGNED_BYTE;case m.R16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case m.R32F:return t==N.FLOAT;case m.R8UI:return t===N.UNSIGNED_BYTE;case m.RG8:return t===N.UNSIGNED_BYTE;case m.RG16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case m.RG32F:return t==N.FLOAT;case m.RG8UI:return t===N.UNSIGNED_BYTE;case m.RGB8:return t===N.UNSIGNED_BYTE;case m.SRGB8:return t===N.UNSIGNED_BYTE;case m.RGB565:return[N.UNSIGNED_BYTE,N.UNSIGNED_SHORT_5_6_5].includes(t);case m.R11F_G11F_B10F:return[N.UNSIGNED_INT_10F_11F_11F_REV,N.HALF_FLOAT,N.FLOAT].includes(t);case m.RGB9_E5:return[N.HALF_FLOAT,N.FLOAT].includes(t);case m.RGB16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case m.RGB32F:return t==N.FLOAT;case m.RGB8UI:return t===N.UNSIGNED_BYTE;case m.RGBA8:return t===N.UNSIGNED_BYTE;case m.SRGB8_ALPHA8:return t===N.UNSIGNED_BYTE;case m.RGB5_A1:return[N.UNSIGNED_BYTE,N.UNSIGNED_SHORT_5_5_5_1].includes(t);case m.RGB10_A2:return t===N.UNSIGNED_INT_2_10_10_10_REV;case m.RGBA4:return[N.UNSIGNED_BYTE,N.UNSIGNED_SHORT_4_4_4_4].includes(t);case m.RGBA16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case m.RGBA32F:return t==N.FLOAT;case m.RGBA8UI:return t===N.UNSIGNED_BYTE;case m.DEPTH_COMPONENT16:return t===N.UNSIGNED_SHORT;case m.DEPTH_COMPONENT24:return t===N.UNSIGNED_INT;case m.DEPTH_COMPONENT32F:return t===N.FLOAT}return!1}function Ls(s,t){switch(t){case m.R8:return s.RED;case m.R16F:return s.RED;case m.R32F:return s.RED;case m.R8UI:return s.RED_INTEGER;case m.RG8:return s.RG;case m.RG16F:return s.RG;case m.RG32F:return s.RG;case m.RG8UI:return s.RG_INTEGER;case m.RGB8:return s.RGB;case m.SRGB8:return s.RGB;case m.RGB565:return s.RGB;case m.R11F_G11F_B10F:return s.RGB;case m.RGB9_E5:return s.RGB;case m.RGB16F:return s.RGB;case m.RGB32F:return s.RGB;case m.RGB8UI:return s.RGB_INTEGER;case m.RGBA8:return s.RGBA;case m.SRGB8_ALPHA8:return s.RGBA;case m.RGB5_A1:return s.RGBA;case m.RGB10_A2:return s.RGBA;case m.RGBA4:return s.RGBA;case m.RGBA16F:return s.RGBA;case m.RGBA32F:return s.RGBA;case m.RGBA8UI:return s.RGBA_INTEGER;case m.DEPTH_COMPONENT16:case m.DEPTH_COMPONENT24:case m.DEPTH_COMPONENT32F:return s.DEPTH_COMPONENT;default:w(()=>`Invalid internal format: ${t}.`)}}function Fs(s){switch(s){case m.DEPTH_COMPONENT16:case m.DEPTH_COMPONENT24:case m.DEPTH_COMPONENT32F:return!0;default:return!1}}function Cs(s){switch(s){case m.R16F:case m.R32F:case m.RG16F:case m.RG32F:case m.RGB16F:case m.RGB32F:case m.RGBA16F:case m.RGBA32F:case m.DEPTH_COMPONENT32F:return!0;default:return!1}}function Xs(s){switch(s.target){case P.TEXTURE_2D:return{texture_2d:s};case P.TEXTURE_3D:return{texture_3d:s};case P.TEXTURE_CUBE_MAP:return{texture_cube:s};case P.TEXTURE_2D_ARRAY:return{texture_2d_array:s};default:ht(s.target)}}function Hs(s,t,i){switch(t.target){case P.TEXTURE_2D:s.texture_2d!==void 0&&w(()=>`Texture unit ${i} already contains a 2D texture!`),s.texture_2d=t;break;case P.TEXTURE_3D:s.texture_3d!==void 0&&w(()=>`Texture unit ${i} already contains a 3D texture!`),s.texture_3d=t;break;case P.TEXTURE_CUBE_MAP:s.texture_cube!==void 0&&w(()=>`Texture unit ${i} already contains a cube map!`),s.texture_cube=t;break;case P.TEXTURE_2D_ARRAY:s.texture_2d_array!==void 0&&w(()=>`Texture unit ${i} already contains a 2D array texture!`),s.texture_2d_array=t;break;default:ht(t.target)}}function ks(s){let t=!!s.createTransformFeedback;t&&s.bindVertexArray(null);let i=s.getParameter(s.MAX_VERTEX_ATTRIBS),e=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,e);for(let h=0;h<i;++h)s.disableVertexAttribArray(h),s.vertexAttribPointer(h,4,s.FLOAT,!1,0,0),s.vertexAttrib1f(h,0),t&&s.vertexAttribDivisor(h,0);s.deleteBuffer(e);let n=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS);for(let h=0;h<n;++h)s.activeTexture(s.TEXTURE0+h),s.bindTexture(s.TEXTURE_CUBE_MAP,null),s.bindTexture(s.TEXTURE_2D,null),t&&(s.bindTexture(s.TEXTURE_2D_ARRAY,null),s.bindTexture(s.TEXTURE_3D,null),s.bindSampler(h,null));if(s.activeTexture(s.TEXTURE0),s.useProgram(null),s.bindBuffer(s.ARRAY_BUFFER,null),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindRenderbuffer(s.RENDERBUFFER,null),s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.DITHER),s.disable(s.SCISSOR_TEST),s.blendColor(0,0,0,0),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.clearColor(0,0,0,0),s.clearDepth(1),s.clearStencil(-1),s.colorMask(!0,!0,!0,!0),s.cullFace(s.BACK),s.depthFunc(s.LESS),s.depthMask(!0),s.depthRange(0,1),s.frontFace(s.CCW),s.hint(s.GENERATE_MIPMAP_HINT,s.DONT_CARE),s.lineWidth(1),s.pixelStorei(s.PACK_ALIGNMENT,4),s.pixelStorei(s.UNPACK_ALIGNMENT,4),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.BROWSER_DEFAULT_WEBGL),s.polygonOffset(0,0),s.sampleCoverage(1,!1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilMask(4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.viewport(0,0,s.canvas.width,s.canvas.height),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT|s.STENCIL_BUFFER_BIT),t){s.drawBuffers([s.BACK]),s.readBuffer(s.BACK),s.bindBuffer(s.COPY_READ_BUFFER,null),s.bindBuffer(s.COPY_WRITE_BUFFER,null),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),s.bindBuffer(s.PIXEL_UNPACK_BUFFER,null);let h=s.getParameter(s.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(let r=0;r<h;++r)s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,r,null);let a=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS);for(let r=0;r<a;++r)s.bindBufferBase(s.UNIFORM_BUFFER,r,null);s.disable(s.RASTERIZER_DISCARD),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,0),s.pixelStorei(s.UNPACK_SKIP_IMAGES,0),s.pixelStorei(s.UNPACK_ROW_LENGTH,0),s.pixelStorei(s.UNPACK_SKIP_ROWS,0),s.pixelStorei(s.UNPACK_SKIP_PIXELS,0),s.pixelStorei(s.PACK_ROW_LENGTH,0),s.pixelStorei(s.PACK_SKIP_ROWS,0),s.pixelStorei(s.PACK_SKIP_PIXELS,0),s.hint(s.FRAGMENT_SHADER_DERIVATIVE_HINT,s.DONT_CARE)}}async function Vs(s,t,i={}){let e=new Promise((h,a)=>{let r=new Image;r.onload=()=>h(r),r.onerror=a,new URL(t,window.location.href).origin!==window.location.origin&&(r.crossOrigin="anonymous"),r.src=t}),n=t.split("/").at(-1).split(".").at(0);try{let h=await e,a=ct(s,n,h.naturalWidth,h.naturalHeight,i);return xt(s,a,h,i),a}catch(h){w(()=>`Failed to create texture from url: "${t}": ${h.message}`)}}async function Ys(s,t,i){if(t.length!==6)throw new Error(`loadCubemap requires 6 URLs, got ${t.length}`);let e=t.map(h=>new Promise((a,r)=>{let c=new Image;c.onload=()=>a(c),c.onerror=r,new URL(h,window.location.href).origin!==window.location.origin&&(c.crossOrigin="anonymous"),c.src=h})),n=t[0].split("/").at(-1).split(".").at(0);n.endsWith("-px")?n=n.slice(0,-3):n.endsWith("-right")&&(n=n.slice(0,-6));try{let h=await Promise.all(e),[a,r]=[h[0].naturalWidth,h[0].naturalHeight];for(let o=1;o<6;o++)(h[o].naturalWidth!==a||h[o].naturalHeight!==r)&&w(()=>`Cubemap images at index 0 and ${o} have different dimensions: ${a}x${r} vs ${h[o].naturalWidth}x${h[o].naturalHeight}`);let c=ct(s,n,a,r,{...i,target:s.TEXTURE_CUBE_MAP});for(let o=0;o<6;o++)xt(s,c,h[o],{...i,dataTarget:s.TEXTURE_CUBE_MAP_POSITIVE_X+o});return c}catch(h){w(()=>`Failed to create cubemap texture from urls: "${t}": ${h.message}`)}}var It=class{_stack=[];push(t,i,e){e===i&&(e=void 0);let[n,h]=this._stack.at(-1)??[null,void 0];if(!(n===i&&h===e)){this._stack.push([i,e]);try{this._bindFramebuffer(t,i,e)}catch(a){throw this.pop(t),a}}}pop(t,i=1){i=Math.max(0,i);for(let e=0;e<i;e++){this._stack.pop();let[n,h]=this._stack.at(-1)??[null,void 0];this._bindFramebuffer(t,n,h)}}_bindFramebuffer(t,i,e){if(e===void 0){let[n,h]=i===null?[t.canvas.width,t.canvas.height]:Ft(i);t.bindFramebuffer(t.FRAMEBUFFER,i?.glo??null),t.viewport(0,0,n,h)}else{let[n,h]=e===null?[t.canvas.width,t.canvas.height]:Ft(e);t.bindFramebuffer(t.READ_FRAMEBUFFER,i?.glo??null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e?.glo??null),t.viewport(0,0,n,h)}}};function Ft(s){if(s.color.length>0){let t=s.color[0].attachment;return[t.width,t.height]}else if(s.depth!==null){let t=s.depth.attachment;return[t.width,t.height]}else if(s.stencil!==null){let t=s.stencil.attachment;return[t.width,t.height]}else w(()=>`Framebuffer ${s.name} has no attachments`)}var V=class s{a;b;c;d;e;f;g;h;i;static of(t,i,e,n,h,a,r,c,o){return new s(t,i,e,n,h,a,r,c,o)}static all(t){return new s(t,t,t,t,t,t,t,t,t)}static random(){return new s(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random())}static fromArray(t,i=0){return new s(t[i+0],t[i+1],t[i+2],t[i+3],t[i+4],t[i+5],t[i+6],t[i+7],t[i+8])}static identity(){return new s}static translate(t){return new s(1,0,0,0,1,0,t.x,t.y,1)}static fromTranslation=s.translate;static translateX(t){return new s(1,0,0,0,1,0,t,0,1)}static fromTranslationX=s.translateX;static translateY(t){return new s(1,0,0,0,1,0,0,t,1)}static fromTranslationY=s.translateY;static rotate(t){let i=Math.sin(t),e=Math.cos(t);return new s(e,i,0,-i,e,0,0,0,1)}static fromRotation=s.rotate;static scale(t,i){return typeof t=="number"?i===void 0?new s(t,0,0,0,t,0,0,0,1):new s(t,0,0,0,i,0,0,0,1):new s(t.x,0,0,0,t.y,0,0,0,1)}static fromScale=s.scale;static fromMat4(t){return new s(t.a,t.b,t.c,t.e,t.f,t.g,t.i,t.j,t.k)}static projection(t,i){return new s(2/t,0,0,0,-2/i,0,-1,1,1)}static normalMatrixOf(t){let i=t.a,e=t.b,n=t.c,h=t.e,a=t.f,r=t.g,c=t.i,o=t.j,f=t.k,d=f*a-r*o,l=-f*h+r*c,u=o*h-a*c,x=i*d+e*l+n*u;return x?(x=1/x,new s(d*x,l*x,u*x,(-f*e+n*o)*x,(f*i-n*c)*x,(-o*i+e*c)*x,(r*e-n*a)*x,(-r*i+n*h)*x,(a*i-e*h)*x)):null}constructor(t=1,i=0,e=0,n=0,h=1,a=0,r=0,c=0,o=1){this.a=t,this.b=i,this.c=e,this.d=n,this.e=h,this.f=a,this.g=r,this.h=c,this.i=o}get 0(){return this.a}get 1(){return this.b}get 2(){return this.c}get 3(){return this.d}get 4(){return this.e}get 5(){return this.f}get 6(){return this.g}get 7(){return this.h}get 8(){return this.i}get length(){return 9}reset(){return this.a=1,this.b=0,this.c=0,this.d=0,this.e=1,this.f=0,this.g=0,this.h=0,this.i=1,this}fromArray(t,i=0){return this.a=t[i+0],this.b=t[i+1],this.c=t[i+2],this.d=t[i+3],this.e=t[i+4],this.f=t[i+5],this.g=t[i+6],this.h=t[i+7],this.i=t[i+8],this}toArray(t=null,i=0){return t===null&&(t=new Array(9)),t[i+0]=this.a,t[i+1]=this.b,t[i+2]=this.c,t[i+3]=this.d,t[i+4]=this.e,t[i+5]=this.f,t[i+6]=this.g,t[i+7]=this.h,t[i+8]=this.i,t}clone(){return new s(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i)}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this}equals(t,i=H){return Math.abs(this.a-t.a)<=i&&Math.abs(this.b-t.b)<=i&&Math.abs(this.c-t.c)<=i&&Math.abs(this.d-t.d)<=i&&Math.abs(this.e-t.e)<=i&&Math.abs(this.f-t.f)<=i&&Math.abs(this.g-t.g)<=i&&Math.abs(this.h-t.h)<=i&&Math.abs(this.i-t.i)<=i}transpose(){let t;return t=this.b,this.b=this.d,this.d=t,t=this.c,this.c=this.g,this.g=t,t=this.f,this.f=this.h,this.h=t,this}transposeOf(t){return this.a=t.a,this.b=t.d,this.c=t.g,this.d=t.b,this.e=t.e,this.f=t.h,this.g=t.c,this.h=t.f,this.i=t.i,this}invert(){let t=this.a,i=this.b,e=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=o*h-a*c,d=-o*n+a*r,l=c*n-h*r,u=t*f+i*d+e*l;return u?(u=1/u,this.a=f*u,this.b=(-o*i+e*c)*u,this.c=(a*i-e*h)*u,this.d=d*u,this.e=(o*t-e*r)*u,this.f=(-a*t+e*n)*u,this.g=l*u,this.h=(-c*t+i*r)*u,this.i=(h*t-i*n)*u,this):null}inverseOf(t){let i=t.a,e=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=f*a-r*o,l=-f*h+r*c,u=o*h-a*c,x=i*d+e*l+n*u;return x?(x=1/x,this.a=d*x,this.b=(-f*e+n*o)*x,this.c=(r*e-n*a)*x,this.d=l*x,this.e=(f*i-n*c)*x,this.f=(-r*i+n*h)*x,this.g=u*x,this.h=(-o*i+e*c)*x,this.i=(a*i-e*h)*x,this):null}adjoint(){let t=this.a,i=this.b,e=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i;return this.a=h*o-a*c,this.b=e*c-i*o,this.c=i*a-e*h,this.d=a*r-n*o,this.e=t*o-e*r,this.f=e*n-t*a,this.g=n*c-h*r,this.h=i*r-t*c,this.i=t*h-i*n,this}adjointOf(t){let i=t.a,e=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i;return this.a=a*f-r*o,this.b=n*o-e*f,this.c=e*r-n*a,this.d=r*c-h*f,this.e=i*f-n*c,this.f=n*h-i*r,this.g=h*o-a*c,this.h=e*c-i*o,this.i=i*a-e*h,this}determinant(){let t=this.d,i=this.e,e=this.f,n=this.g,h=this.h,a=this.i;return this.a*(a*i-e*h)+this.b*(-a*t+e*n)+this.c*(h*t-i*n)}multiply(t){let i=this.a,e=this.d,n=this.g,h=this.b,a=this.e,r=this.h,c=this.c,o=this.f,f=this.i,d=t.a,l=t.b,u=t.c;return this.a=i*d+e*l+n*u,this.b=h*d+a*l+r*u,this.c=c*d+o*l+f*u,d=t.d,l=t.e,u=t.f,this.d=i*d+e*l+n*u,this.e=h*d+a*l+r*u,this.f=c*d+o*l+f*u,d=t.g,l=t.h,u=t.i,this.g=i*d+e*l+n*u,this.h=h*d+a*l+r*u,this.i=c*d+o*l+f*u,this}preMultiply(t){let i=t.a,e=t.d,n=t.g,h=t.b,a=t.e,r=t.h,c=t.c,o=t.f,f=t.i,d=this.a,l=this.b,u=this.c;return this.a=i*d+e*l+n*u,this.b=h*d+a*l+r*u,this.c=c*d+o*l+f*u,d=this.d,l=this.e,u=this.f,this.d=i*d+e*l+n*u,this.e=h*d+a*l+r*u,this.f=c*d+o*l+f*u,d=this.g,l=this.h,u=this.i,this.g=i*d+e*l+n*u,this.h=h*d+a*l+r*u,this.i=c*d+o*l+f*u,this}productOf(t,i){let e=t.a,n=t.d,h=t.g,a=t.b,r=t.e,c=t.h,o=t.c,f=t.f,d=t.i,l=i.a,u=i.b,x=i.c;return this.a=e*l+n*u+h*x,this.b=a*l+r*u+c*x,this.c=o*l+f*u+d*x,l=i.d,u=i.e,x=i.f,this.d=e*l+n*u+h*x,this.e=a*l+r*u+c*x,this.f=o*l+f*u+d*x,l=i.g,u=i.h,x=i.i,this.g=e*l+n*u+h*x,this.h=a*l+r*u+c*x,this.i=o*l+f*u+d*x,this}translate(t,i){let e;return typeof t=="number"?(e=t,i=i??0):(e=t.x,i=t.y),this.g+=this.a*e+this.d*i,this.h+=this.b*e+this.e*i,this.i+=this.c*e+this.f*i,this}translateX(t){return this.g+=this.a*t,this.h+=this.b*t,this.i+=this.c*t,this}translateY(t){return this.g+=this.d*t,this.h+=this.e*t,this.i+=this.f*t,this}rotate(t){let i=this.a,e=this.b,n=this.c,h=this.d,a=this.e,r=this.f,c=Math.sin(t),o=Math.cos(t);return this.a=o*i+c*h,this.b=o*e+c*a,this.c=o*n+c*r,this.d=o*h-c*i,this.e=o*a-c*e,this.f=o*r-c*n,this}scale(t,i){let e;return typeof t=="number"?(e=t,i=i??e):(e=t.x,i=t.y),this.a*=e,this.b*=e,this.c*=e,this.d*=i,this.e*=i,this.f*=i,this}scaleX(t){return this.a*=t,this.b*=t,this.c*=t,this}scaleY(t){return this.d*=t,this.e*=t,this.f*=t,this}fromMat4(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.e,this.e=t.f,this.f=t.g,this.g=t.i,this.h=t.j,this.i=t.k,this}*[Symbol.iterator](){yield this.a,yield this.b,yield this.c,yield this.d,yield this.e,yield this.f,yield this.g,yield this.h,yield this.i}};V.prototype.isMat3=!0;V.prototype.isMathPrimitive=!0;var B=class s{x;y;z;static of(t,i,e){return new s(t,i,e)}static zero(){return new s(0,0,0)}static all(t){return new s(t,t,t)}static random(){return new s(Math.random(),Math.random(),Math.random())}static xAxis(){return new s(1,0,0)}static yAxis(){return new s(0,1,0)}static zAxis(){return new s(0,0,1)}static translateX(t){return new s(t,0,0)}static translateY(t){return new s(0,t,0)}static translateZ(t){return new s(0,0,t)}static randomDir(){let t=Math.random()*2-1,i=Math.random()*2-1,e=Math.random()*2-1,n=Math.hypot(t,i,e);return new s(t/n,i/n,e/n)}static fromArray(t,i=0){return new s(t[i],t[i+1],t[i+2])}static fromSpherical(t,i,e=1){let n=Math.sin(i)*e;return new s(n*Math.sin(t),Math.cos(i)*e,n*Math.cos(t))}static fromCylindrical(t,i,e=1){return new s(Math.sin(t)*e,i,Math.cos(t)*e)}static sumOf(t,i){return new s(t.x+i.x,t.y+i.y,t.z+i.z)}static differenceOf(t,i){return new s(t.x-i.x,t.y-i.y,t.z-i.z)}static productOf(t,i){return new s(t.x*i.x,t.y*i.y,t.z*i.z)}static quotientOf(t,i){return new s(t.x/i.x,t.y/i.y,t.z/i.z)}static scaled(t,i){return new s(t.x*i,t.y*i,t.z*i)}static normalOf(t){let i=t.x*t.x+t.y*t.y;if(i>0){let e=1/Math.sqrt(i);return new s(t.x*e,t.y*e,t.z*e)}else return new s(0,0,0)}static minOf(t,i){return new s(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.min(t.z,i.z))}static maxOf(t,i){return new s(Math.max(t.x,i.x),Math.max(t.y,i.y),Math.max(t.z,i.z))}constructor(t=0,i=0,e=0){this.x=t,this.y=i,this.z=e}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get 2(){return this.z}set 2(t){this.z=t}get length(){return 3}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get depth(){return this.z}set depth(t){this.z=t}get r(){return this.x}set r(t){this.x=t}get g(){return this.y}set g(t){this.y=t}get b(){return this.z}set b(t){this.z=t}get u(){return this.x}set u(t){this.x=t}get v(){return this.y}set v(t){this.y=t}get w(){return this.z}set w(t){this.z=t}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error(`Invalid Vec3 index: ${t}`)}}setIndex(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error(`Invalid Vec3 index: ${t}`)}}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=null,i=0){return t===null&&(t=new Array(3)),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}clone(){return new s(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equals(t,i=H){return Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i&&Math.abs(this.z-t.z)<=i}any(){return this.x!=0||this.y!=0||this.z!=0}set(t,i,e){return this.x=t,this.y=i??t,this.z=e??(i===void 0?t:0),this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}randomize(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addAll(t){return this.x+=t,this.y+=t,this.z+=t,this}sumOf(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subtractAll(t){return this.x-=t,this.y-=t,this.z-=t,this}differenceOf(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}productOf(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}divideBy(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}quotientOf(t,i){return this.x=t.x/i.x,this.y=t.y/i.y,this.z=t.z/i.z,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}invert(){return this.x=this.x==0?0:1/this.x,this.y=this.y==0?0:1/this.y,this.z=this.z==0?0:1/this.z,this}inverseOf(t){return this.x=t.x==0?0:1/t.x,this.y=t.y==0?0:1/t.y,this.z=t.z==0?0:1/t.z,this}addScaled(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}mod(t){return this.x%=t.x,this.y%=t.y,this.z%=t.z,this}modAll(t){return this.x%=t,this.y%=t,this.z%=t,this}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpOf(t,i,e){return this.x=t.x+(i.x-t.x)*e,this.y=t.y+(i.y-t.y)*e,this.z=t.z+(i.z-t.z)*e,this}slerp(t,i){let e=this.x,n=this.y,h=this.z,a=t.x,r=t.y,c=t.z,o=Math.acos(Math.min(Math.max(e*a+n*r+e*c,-1),1)),f=o?Math.sin(o):1,d=Math.sin((1-i)*o)/f,l=Math.sin(i*o)/f;return this.x=d*e+l*a,this.y=d*n+l*r,this.z=d*e+l*c,this}slerpOf(t,i,e){let n=t.x,h=t.y,a=t.z,r=i.x,c=i.y,o=i.z,f=Math.acos(Math.min(Math.max(n*r+h*c+n*o,-1),1)),d=f?Math.sin(f):1,l=Math.sin((1-e)*f)/d,u=Math.sin(e*f)/d;return this.x=l*n+u*r,this.y=l*h+u*c,this.z=l*n+u*o,this}hermiteOf(t,i,e,n,h){let a=h*h,r=a*(2*h-3)+1,c=a*(h-2)+h,o=a*(h-1),f=a*(3-2*h);return this.x=t.x*r+i.x*c+e.x*o+n.x*f,this.y=t.y*r+i.y*c+e.y*o+n.y*f,this.z=t.z*r+i.z*c+e.z*o+n.z*f,this}bezierOf(t,i,e,n,h){let a=h*h,r=1-h,c=r*r,o=c*r,f=3*h*c,d=3*a*r,l=a*h;return this.x=t.x*o+i.x*f+e.x*d+n.x*l,this.y=t.y*o+i.y*f+e.y*d+n.y*l,this.z=t.z*o+i.z*f+e.z*d+n.z*l,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){let i=this.x,e=this.y,n=this.z,h=t.x,a=t.y,r=t.z;return this.x=e*r-n*a,this.y=n*h-i*r,this.z=i*a-e*h,this}crossOf(t,i){let e=t.x,n=t.y,h=t.z,a=i.x,r=i.y,c=i.z;return this.x=n*c-h*r,this.y=h*a-e*c,this.z=e*r-n*a,this}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z}magnitude(){return Math.hypot(this.x,this.y,this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;if(t>0){let i=1/Math.sqrt(t);this.x*=i,this.y*=i,this.z*=i}return this}normalOf(t){let i=t.x*t.x+t.y*t.y+t.z*t.z;if(i>0){let e=1/Math.sqrt(i);this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}else this.x=0,this.y=0,this.z=0;return this}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z)}distanceToSq(t){let i=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return i*i+e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}minOf(t,i){return this.x=Math.min(t.x,i.x),this.y=Math.min(t.y,i.y),this.z=Math.min(t.z,i.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}maxOf(t,i){return this.x=Math.max(t.x,i.x),this.y=Math.max(t.y,i.y),this.z=Math.max(t.z,i.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampMagnitude(t,i){let e=this.x*this.x+this.y*this.y+this.z*this.z;if(e>0){let n=Math.sqrt(e),h=Math.max(t,Math.min(i,n))/n;this.x*=h,this.y*=h,this.z*=h}return this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}projectOnVector(t){let i=t.x,e=t.y,n=t.z,h=i*i+e*e+n*n;if(h==0)this.x=0,this.y=0,this.z=0;else{let a=(this.x*i+this.y*e+this.z*n)/h;this.x=i*a,this.y=e*a,this.z=n*a}return this}projectOnPlane(t){let i=t.x,e=t.y,n=t.z,h=this.x*i+this.y*e+this.z*n;return this.x-=i*h,this.y-=e*h,this.z-=n*h,this}reflect(t){let i=t.x,e=t.y,n=t.z,h=2*(this.x*i+this.y*e+this.z*n);return this.x-=i*h,this.y-=e*h,this.z-=n*h,this}angleTo(t){let i=this.x,e=this.y,n=this.z,h=t.x,a=t.y,r=t.z,c=Math.sqrt((i*i+e*e+n*n)*(h*h+a*a+r*r)),o=c&&(i*h+e*a+n*r)/c;return Math.acos(Math.min(Math.max(o,-1),1))}rotateAround(t,i){let e=this.x,n=this.y,h=this.z,a=t.x,r=t.y,c=t.z,o=Math.cos(i),f=Math.sin(i),d=(a*e+r*n+c*h)*(1-o);return this.x=a*d+e*o+(-c*n+r*h)*f,this.y=r*d+n*o+(c*e-a*h)*f,this.z=c*d+h*o+(-r*e+a*n)*f,this}translateX(t){return this.x+=t,this}translateY(t){return this.y+=t,this}translateZ(t){return this.z+=t,this}rotateX(t){let i=this.y,e=this.z,n=Math.cos(t),h=Math.sin(t);return this.y=i*n-e*h,this.z=i*h+e*n,this}rotateY(t){let i=this.x,e=this.z,n=Math.cos(t),h=Math.sin(t);return this.x=i*n+e*h,this.z=-i*h+e*n,this}rotateZ(t){let i=this.x,e=this.y,n=Math.cos(t),h=Math.sin(t);return this.x=i*n-e*h,this.y=i*h+e*n,this}applyMat3(t){let i=this.x,e=this.y,n=this.z;return this.x=i*t.a+e*t.d+n*t.g,this.y=i*t.b+e*t.e+n*t.h,this.z=i*t.c+e*t.f+n*t.i,this}applyMat4(t){let i=this.x,e=this.y,n=this.z,h=t.d*i+t.h*e+t.l*n+t.p||1;return this.x=(i*t.a+e*t.e+n*t.i+t.m)/h,this.y=(i*t.b+e*t.f+n*t.j+t.n)/h,this.z=(i*t.c+e*t.g+n*t.k+t.o)/h,this}rotateMat4(t){let i=this.x,e=this.y,n=this.z;return this.x=i*t.a+e*t.e+n*t.i,this.y=i*t.b+e*t.f+n*t.j,this.z=i*t.c+e*t.g+n*t.k,this}rotateQuat(t){let i=this.x,e=this.y,n=this.z,h=t.x,a=t.y,r=t.z,c=t.w,o=2*(a*n-r*e),f=2*(r*i-h*n),d=2*(h*e-a*i);return this.x=i+c*o+a*d-r*f,this.y=e+c*f+r*o-h*d,this.z=n+c*d+h*f-a*o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};B.prototype.isVec3=!0;B.prototype.isMathPrimitive=!0;var it=class s{a;b;c;d;e;f;g;h;i;j;k;l;m;n;o;p;static of(t,i,e,n,h,a,r,c,o,f,d,l,u,x,E,y){return new s(t,i,e,n,h,a,r,c,o,f,d,l,u,x,E,y)}static all(t){return new s(t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t)}static random(){return new s(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random())}static fromArray(t,i=0){return new s(t[i+0],t[i+1],t[i+2],t[i+3],t[i+4],t[i+5],t[i+6],t[i+7],t[i+8],t[i+9],t[i+10],t[i+11],t[i+12],t[i+13],t[i+14],t[i+15])}static identity(){return new s}static translate(t,i,e){return typeof t=="number"?new s(1,0,0,0,0,1,0,0,0,0,1,0,t,i??t,e??t,1):new s(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1)}static fromTranslation=s.translate;static fromVec3s(t,i,e,n){return new s(t.x,t.y,t.z,0,i.x,i.y,i.z,0,e.x,e.y,e.z,0,n.x,n.y,n.z,1)}static fromVec4s(t,i,e,n){return new s(t.x,t.y,t.z,t.w,i.x,i.y,i.z,i.w,e.x,e.y,e.z,e.w,n.x,n.y,n.z,n.w)}static translateX(t){return new s(1,0,0,0,0,1,0,0,0,0,1,0,t,0,0,1)}static fromTranslationX=s.translateX;static translateY(t){return new s(1,0,0,0,0,1,0,0,0,0,1,0,0,t,0,1)}static fromTranslationY=s.translateY;static translateZ(t){return new s(1,0,0,0,0,1,0,0,0,0,1,0,0,0,t,1)}static fromTranslationZ=s.translateZ;static rotate(t,i){let e=Math.sin(i),n=Math.cos(i),h=1-n,a=t.x,r=t.y,c=t.z,o=h*a,f=h*r,d=h*c,l=e*a,u=e*r,x=e*c;return new s(o*a+n,o*r+x,o*c-u,0,f*a-x,f*r+n,f*c+l,0,d*a+u,d*r-l,d*c+n,0,0,0,0,1)}static fromRotation=s.rotate;static rotateX(t){let i=Math.sin(t),e=Math.cos(t);return new s(1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1)}static fromRotationX=s.rotateX;static rotateY(t){let i=Math.sin(t),e=Math.cos(t);return new s(e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1)}static fromRotationY=s.rotateY;static rotateZ(t){let i=Math.sin(t),e=Math.cos(t);return new s(e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1)}static fromRotationZ=s.rotateZ;static fromQuat(t){let i=t.x,e=t.y,n=t.z,h=t.w,a=i+i,r=e+e,c=n+n,o=i*a,f=i*r,d=i*c,l=e*r,u=e*c,x=n*c,E=h*a,y=h*r,A=h*c;return new s(1-(l+x),f+A,d-y,0,f-A,1-(o+x),u+E,0,d+y,u-E,1-(o+l),0,0,0,0,1)}static scale(t){let i,e,n;return typeof t=="number"?(i=t,e=t,n=t):(i=t.x,e=t.y,n=t.z),new s(i,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1)}static fromScale=s.scale;static fromBasis(t,i,e){return new s(t.x,t.y,t.z,0,i.x,i.y,i.z,0,e.x,e.y,e.z,0,0,0,0,1)}static compose(t,i,e){let n=i.x,h=i.y,a=i.z,r=i.w,c=e.x,o=e.y,f=e.z,d=n+n,l=h+h,u=a+a,x=n*d,E=n*l,y=n*u,A=h*l,M=h*u,_=a*u,b=r*d,R=r*l,T=r*u;return new s((1-(A+_))*c,(E+T)*c,(y-R)*c,0,(E-T)*o,(1-(x+_))*o,(M+b)*o,0,(y+R)*f,(M-b)*f,(1-(x+A))*f,0,t.x,t.y,t.z,1)}static fromMat3(t){return new s(t.a,t.b,t.c,0,t.d,t.e,t.f,0,t.g,t.h,t.i,0,0,0,0,1)}static ortho(t,i,e,n,h,a){let r=1/(t-i),c=1/(e-n),o=1/(h-a);return new s(-2*r,0,0,0,0,-2*c,0,0,0,0,2*o,0,(t+i)*r,(n+e)*c,(a+h)*o,1)}static perspective(t,i,e,n){let h=1/Math.tan(t/2),a=1/(e-n);return new s(h/i,0,0,0,0,h,0,0,0,0,(n+e)*a,-1,0,0,2*n*e*a,0)}static lookAt(t,i,e){let n=t.x,h=t.y,a=t.z,r=n-i.x,c=h-i.y,o=a-i.z;if(Math.abs(r)==0&&Math.abs(c)==0&&Math.abs(o)==0)return new s;let f=1/Math.hypot(r,c,o);r*=f,c*=f,o*=f;let d=e.x,l=e.y,u=e.z,x=l*o-u*c,E=u*r-d*o,y=d*c-l*r;f=Math.hypot(x,E,y),f==0?(x=0,E=0,y=0):(f=1/f,x*=f,E*=f,y*=f);let A=c*y-o*E,M=o*x-r*y,_=r*E-c*x;return f=Math.hypot(A,M,_),f==0?(A=0,M=0,_=0):(f=1/f,A*=f,M*=f,_*=f),new s(x,A,r,0,E,M,c,0,y,_,o,0,-(x*n+E*h+y*a),-(A*n+M*h+_*a),-(r*n+c*h+o*a),1)}static inverseOf(t){let i=t.a,e=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,x=t.m,E=t.n,y=t.o,A=t.p,M=i*r-e*a,_=i*c-n*a,b=i*o-h*a,R=e*c-n*r,T=e*o-h*r,U=n*o-h*c,O=f*E-d*x,z=f*y-l*x,G=f*A-u*x,$=d*y-l*E,D=d*A-u*E,I=l*A-u*y,S=M*I-_*D+b*$+R*G-T*z+U*O;return S?(S=1/S,new s((r*I-c*D+o*$)*S,(n*D-e*I-h*$)*S,(E*U-y*T+A*R)*S,(l*T-d*U-u*R)*S,(c*G-a*I-o*z)*S,(i*I-n*G+h*z)*S,(y*b-x*U-A*_)*S,(f*U-l*b+u*_)*S,(a*D-r*G+o*O)*S,(e*G-i*D-h*O)*S,(x*T-E*b+A*M)*S,(d*b-f*T-u*M)*S,(r*z-a*$-c*O)*S,(i*$-e*z+n*O)*S,(E*_-x*R-y*M)*S,(f*R-d*_+l*M)*S)):null}constructor(t=1,i=0,e=0,n=0,h=0,a=1,r=0,c=0,o=0,f=0,d=1,l=0,u=0,x=0,E=0,y=1){this.a=t,this.b=i,this.c=e,this.d=n,this.e=h,this.f=a,this.g=r,this.h=c,this.i=o,this.j=f,this.k=d,this.l=l,this.m=u,this.n=x,this.o=E,this.p=y}get 0(){return this.a}get 1(){return this.b}get 2(){return this.c}get 3(){return this.d}get 4(){return this.e}get 5(){return this.f}get 6(){return this.g}get 7(){return this.h}get 8(){return this.i}get 9(){return this.j}get 10(){return this.k}get 11(){return this.l}get 12(){return this.m}get 13(){return this.n}get 14(){return this.o}get 15(){return this.p}get length(){return 16}reset(){return this.a=1,this.b=0,this.c=0,this.d=0,this.e=0,this.f=1,this.g=0,this.h=0,this.i=0,this.j=0,this.k=1,this.l=0,this.m=0,this.n=0,this.o=0,this.p=1,this}set(t,i,e,n,h,a,r,c,o,f,d,l,u,x,E,y){return this.a=t,this.b=i,this.c=e,this.d=n,this.e=h,this.f=a,this.g=r,this.h=c,this.i=o,this.j=f,this.k=d,this.l=l,this.m=u,this.n=x,this.o=E,this.p=y,this}fromArray(t,i=0){return this.a=t[i+0],this.b=t[i+1],this.c=t[i+2],this.d=t[i+3],this.e=t[i+4],this.f=t[i+5],this.g=t[i+6],this.h=t[i+7],this.i=t[i+8],this.j=t[i+9],this.k=t[i+10],this.l=t[i+11],this.m=t[i+12],this.n=t[i+13],this.o=t[i+14],this.p=t[i+15],this}toArray(t=null,i=0){return t===null&&(t=new Array(16)),t[i+0]=this.a,t[i+1]=this.b,t[i+2]=this.c,t[i+3]=this.d,t[i+4]=this.e,t[i+5]=this.f,t[i+6]=this.g,t[i+7]=this.h,t[i+8]=this.i,t[i+9]=this.j,t[i+10]=this.k,t[i+11]=this.l,t[i+12]=this.m,t[i+13]=this.n,t[i+14]=this.o,t[i+15]=this.p,t}clone(){return new s(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m,this.n,this.o,this.p)}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this.j=t.j,this.k=t.k,this.l=t.l,this.m=t.m,this.n=t.n,this.o=t.o,this.p=t.p,this}compose(t,i,e){let n=i.x,h=i.y,a=i.z,r=i.w,c=e.x,o=e.y,f=e.z,d=n+n,l=h+h,u=a+a,x=n*d,E=n*l,y=n*u,A=h*l,M=h*u,_=a*u,b=r*d,R=r*l,T=r*u;return this.a=(1-(A+_))*c,this.b=(E+T)*c,this.c=(y-R)*c,this.d=0,this.e=(E-T)*o,this.f=(1-(x+_))*o,this.g=(M+b)*o,this.h=0,this.i=(y+R)*f,this.j=(M-b)*f,this.k=(1-(x+A))*f,this.l=0,this.m=t.x,this.n=t.y,this.o=t.z,this.p=1,this}decompose(t,i,e){let n=this.a,h=this.b,a=this.c,r=this.d,c=this.e,o=this.f,f=this.g,d=this.h,l=this.i,u=this.j,x=this.k,E=this.l,y=this.m,A=this.n,M=this.o,_=this.p,b=(n*o-h*c)*(x*_-E*M)-(n*f-a*c)*(u*_-E*A)+(n*d-r*c)*(u*M-x*A)+(h*f-a*o)*(l*_-E*y)-(h*d-r*o)*(l*M-x*y)+(a*d-r*f)*(l*A-u*y),R=Math.hypot(n,h,a)*Math.sign(b),T=Math.hypot(c,o,f),U=Math.hypot(l,u,x);t.x=y,t.y=A,t.z=M,n/=R,h/=R,a/=R,c/=T,o/=T,f/=T,l/=U,u/=U,x/=U;let O=n+o+x;if(O>0){let z=.5/Math.sqrt(O+1);i.x=(f-u)*z,i.y=(l-a)*z,i.z=(h-c)*z,i.w=.25/z}else if(n>o&&n>x){let z=2*Math.sqrt(1+n-o-x);i.x=.25*z,i.y=(c+h)/z,i.z=(l+a)/z,i.w=(f-u)/z}else if(o>x){let z=2*Math.sqrt(1+o-n-x);i.x=(c+h)/z,i.y=.25*z,i.z=(u+f)/z,i.w=(l-a)/z}else{let z=2*Math.sqrt(1+x-n-o);i.x=(l+a)/z,i.y=(u+f)/z,i.z=.25*z,i.w=(h-c)/z}return e.x=R,e.y=T,e.z=U,this}equals(t,i=H){return Math.abs(this.a-t.a)<=i&&Math.abs(this.b-t.b)<=i&&Math.abs(this.c-t.c)<=i&&Math.abs(this.d-t.d)<=i&&Math.abs(this.e-t.e)<=i&&Math.abs(this.f-t.f)<=i&&Math.abs(this.g-t.g)<=i&&Math.abs(this.h-t.h)<=i&&Math.abs(this.i-t.i)<=i&&Math.abs(this.j-t.j)<=i&&Math.abs(this.k-t.k)<=i&&Math.abs(this.l-t.l)<=i&&Math.abs(this.m-t.m)<=i&&Math.abs(this.n-t.n)<=i&&Math.abs(this.o-t.o)<=i&&Math.abs(this.p-t.p)<=i}transpose(){let t;return t=this.b,this.b=this.e,this.e=t,t=this.c,this.c=this.i,this.i=t,t=this.g,this.g=this.j,this.j=t,t=this.d,this.d=this.m,this.m=t,t=this.h,this.h=this.n,this.n=t,t=this.l,this.l=this.o,this.o=t,this}transposeOf(t){return this.a=t.a,this.b=t.e,this.c=t.i,this.d=t.m,this.e=t.b,this.f=t.f,this.g=t.j,this.h=t.n,this.i=t.c,this.j=t.g,this.k=t.k,this.l=t.o,this.m=t.d,this.n=t.h,this.o=t.l,this.p=t.p,this}invert(){let t=this.a,i=this.b,e=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=this.j,d=this.k,l=this.l,u=this.m,x=this.n,E=this.o,y=this.p,A=t*a-i*h,M=t*r-e*h,_=t*c-n*h,b=i*r-e*a,R=i*c-n*a,T=e*c-n*r,U=o*x-f*u,O=o*E-d*u,z=o*y-l*u,G=f*E-d*x,$=f*y-l*x,D=d*y-l*E,I=A*D-M*$+_*G+b*z-R*O+T*U;return I?(I=1/I,this.a=(a*D-r*$+c*G)*I,this.b=(e*$-i*D-n*G)*I,this.c=(x*T-E*R+y*b)*I,this.d=(d*R-f*T-l*b)*I,this.e=(r*z-h*D-c*O)*I,this.f=(t*D-e*z+n*O)*I,this.g=(E*_-u*T-y*M)*I,this.h=(o*T-d*_+l*M)*I,this.i=(h*$-a*z+c*U)*I,this.j=(i*z-t*$-n*U)*I,this.k=(u*R-x*_+y*A)*I,this.l=(f*_-o*R-l*A)*I,this.m=(a*O-h*G-r*U)*I,this.n=(t*G-i*O+e*U)*I,this.o=(x*M-u*b-E*A)*I,this.p=(o*b-f*M+d*A)*I,this):null}inverseOf(t){let i=t.a,e=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,x=t.m,E=t.n,y=t.o,A=t.p,M=i*r-e*a,_=i*c-n*a,b=i*o-h*a,R=e*c-n*r,T=e*o-h*r,U=n*o-h*c,O=f*E-d*x,z=f*y-l*x,G=f*A-u*x,$=d*y-l*E,D=d*A-u*E,I=l*A-u*y,S=M*I-_*D+b*$+R*G-T*z+U*O;return S?(S=1/S,this.a=(r*I-c*D+o*$)*S,this.b=(n*D-e*I-h*$)*S,this.c=(E*U-y*T+A*R)*S,this.d=(l*T-d*U-u*R)*S,this.e=(c*G-a*I-o*z)*S,this.f=(i*I-n*G+h*z)*S,this.g=(y*b-x*U-A*_)*S,this.h=(f*U-l*b+u*_)*S,this.i=(a*D-r*G+o*O)*S,this.j=(e*G-i*D-h*O)*S,this.k=(x*T-E*b+A*M)*S,this.l=(d*b-f*T-u*M)*S,this.m=(r*z-a*$-c*O)*S,this.n=(i*$-e*z+n*O)*S,this.o=(E*_-x*R-y*M)*S,this.p=(f*R-d*_+l*M)*S,this):null}adjoint(){let t=this.a,i=this.b,e=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=this.j,d=this.k,l=this.l,u=this.m,x=this.n,E=this.o,y=this.p;return this.a=+(a*(d*y-l*E)-f*(r*y-c*E)+x*(r*l-c*d)),this.b=-(i*(d*y-l*E)-f*(e*y-n*E)+x*(e*l-n*d)),this.c=+(i*(r*y-c*E)-a*(e*y-n*E)+x*(e*c-n*r)),this.d=-(i*(r*l-c*d)-a*(e*l-n*d)+f*(e*c-n*r)),this.e=-(h*(d*y-l*E)-o*(r*y-c*E)+u*(r*l-c*d)),this.f=+(t*(d*y-l*E)-o*(e*y-n*E)+u*(e*l-n*d)),this.g=-(t*(r*y-c*E)-h*(e*y-n*E)+u*(e*c-n*r)),this.h=+(t*(r*l-c*d)-h*(e*l-n*d)+o*(e*c-n*r)),this.i=+(h*(f*y-l*x)-o*(a*y-c*x)+u*(a*l-c*f)),this.j=-(t*(f*y-l*x)-o*(i*y-n*x)+u*(i*l-n*f)),this.k=+(t*(a*y-c*x)-h*(i*y-n*x)+u*(i*c-n*a)),this.l=-(t*(a*l-c*f)-h*(i*l-n*f)+o*(i*c-n*a)),this.m=-(h*(f*E-d*x)-o*(a*E-r*x)+u*(a*d-r*f)),this.n=+(t*(f*E-d*x)-o*(i*E-e*x)+u*(i*d-e*f)),this.o=-(t*(a*E-r*x)-h*(i*E-e*x)+u*(i*r-e*a)),this.p=+(t*(a*d-r*f)-h*(i*d-e*f)+o*(i*r-e*a)),this}adjointOf(t){let i=t.a,e=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,x=t.m,E=t.n,y=t.o,A=t.p;return this.a=+(r*(l*A-u*y)-d*(c*A-o*y)+E*(c*u-o*l)),this.b=-(e*(l*A-u*y)-d*(n*A-h*y)+E*(n*u-h*l)),this.c=+(e*(c*A-o*y)-r*(n*A-h*y)+E*(n*o-h*c)),this.d=-(e*(c*u-o*l)-r*(n*u-h*l)+d*(n*o-h*c)),this.e=-(a*(l*A-u*y)-f*(c*A-o*y)+x*(c*u-o*l)),this.f=+(i*(l*A-u*y)-f*(n*A-h*y)+x*(n*u-h*l)),this.g=-(i*(c*A-o*y)-a*(n*A-h*y)+x*(n*o-h*c)),this.h=+(i*(c*u-o*l)-a*(n*u-h*l)+f*(n*o-h*c)),this.i=+(a*(d*A-u*E)-f*(r*A-o*E)+x*(r*u-o*d)),this.j=-(i*(d*A-u*E)-f*(e*A-h*E)+x*(e*u-h*d)),this.k=+(i*(r*A-o*E)-a*(e*A-h*E)+x*(e*o-h*r)),this.l=-(i*(r*u-o*d)-a*(e*u-h*d)+f*(e*o-h*r)),this.m=-(a*(d*y-l*E)-f*(r*y-c*E)+x*(r*l-c*d)),this.n=+(i*(d*y-l*E)-f*(e*y-n*E)+x*(e*l-n*d)),this.o=-(i*(r*y-c*E)-a*(e*y-n*E)+x*(e*c-n*r)),this.p=+(i*(r*l-c*d)-a*(e*l-n*d)+f*(e*c-n*r)),this}determinant(){let t=this.a,i=this.b,e=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=this.j,d=this.k,l=this.l,u=this.m,x=this.n,E=this.o,y=this.p;return(t*a-i*h)*(d*y-l*E)-(t*r-e*h)*(f*y-l*x)+(t*c-n*h)*(f*E-d*x)+(i*r-e*a)*(o*y-l*u)-(i*c-n*a)*(o*E-d*u)+(e*c-n*r)*(o*x-f*u)}multiply(t){let i=this.a,e=this.b,n=this.c,h=this.d,a=this.e,r=this.f,c=this.g,o=this.h,f=this.i,d=this.j,l=this.k,u=this.l,x=this.m,E=this.n,y=this.o,A=this.p,M=t.a,_=t.b,b=t.c,R=t.d;return this.a=M*i+_*a+b*f+R*x,this.b=M*e+_*r+b*d+R*E,this.c=M*n+_*c+b*l+R*y,this.d=M*h+_*o+b*u+R*A,M=t.e,_=t.f,b=t.g,R=t.h,this.e=M*i+_*a+b*f+R*x,this.f=M*e+_*r+b*d+R*E,this.g=M*n+_*c+b*l+R*y,this.h=M*h+_*o+b*u+R*A,M=t.i,_=t.j,b=t.k,R=t.l,this.i=M*i+_*a+b*f+R*x,this.j=M*e+_*r+b*d+R*E,this.k=M*n+_*c+b*l+R*y,this.l=M*h+_*o+b*u+R*A,M=t.m,_=t.n,b=t.o,R=t.p,this.m=M*i+_*a+b*f+R*x,this.n=M*e+_*r+b*d+R*E,this.o=M*n+_*c+b*l+R*y,this.p=M*h+_*o+b*u+R*A,this}preMultiply(t){let i=t.a,e=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,x=t.m,E=t.n,y=t.o,A=t.p,M=this.a,_=this.b,b=this.c,R=this.d;return this.a=M*i+_*a+b*f+R*x,this.b=M*e+_*r+b*d+R*E,this.c=M*n+_*c+b*l+R*y,this.d=M*h+_*o+b*u+R*A,M=this.e,_=this.f,b=this.g,R=this.h,this.e=M*i+_*a+b*f+R*x,this.f=M*e+_*r+b*d+R*E,this.g=M*n+_*c+b*l+R*y,this.h=M*h+_*o+b*u+R*A,M=this.i,_=this.j,b=this.k,R=this.l,this.i=M*i+_*a+b*f+R*x,this.j=M*e+_*r+b*d+R*E,this.k=M*n+_*c+b*l+R*y,this.l=M*h+_*o+b*u+R*A,M=this.m,_=this.n,b=this.o,R=this.p,this.m=M*i+_*a+b*f+R*x,this.n=M*e+_*r+b*d+R*E,this.o=M*n+_*c+b*l+R*y,this.p=M*h+_*o+b*u+R*A,this}productOf(t,i){let e=t.a,n=t.b,h=t.c,a=t.d,r=t.e,c=t.f,o=t.g,f=t.h,d=t.i,l=t.j,u=t.k,x=t.l,E=t.m,y=t.n,A=t.o,M=t.p,_=i.a,b=i.b,R=i.c,T=i.d;return this.a=_*e+b*r+R*d+T*E,this.b=_*n+b*c+R*l+T*y,this.c=_*h+b*o+R*u+T*A,this.d=_*a+b*f+R*x+T*M,_=i.e,b=i.f,R=i.g,T=i.h,this.e=_*e+b*r+R*d+T*E,this.f=_*n+b*c+R*l+T*y,this.g=_*h+b*o+R*u+T*A,this.h=_*a+b*f+R*x+T*M,_=i.i,b=i.j,R=i.k,T=i.l,this.i=_*e+b*r+R*d+T*E,this.j=_*n+b*c+R*l+T*y,this.k=_*h+b*o+R*u+T*A,this.l=_*a+b*f+R*x+T*M,_=i.m,b=i.n,R=i.o,T=i.p,this.m=_*e+b*r+R*d+T*E,this.n=_*n+b*c+R*l+T*y,this.o=_*h+b*o+R*u+T*A,this.p=_*a+b*f+R*x+T*M,this}translate(t,i,e){let n;return typeof t=="number"?(n=t,i=i??0,e=e??0):(n=t.x,i=t.y,e=t.z),this.m+=this.a*n+this.e*i+this.i*e,this.n+=this.b*n+this.f*i+this.j*e,this.o+=this.c*n+this.g*i+this.k*e,this.p+=this.d*n+this.h*i+this.l*e,this}translateX(t){return this.m+=this.a*t,this.n+=this.b*t,this.o+=this.c*t,this.p+=this.d*t,this}translateY(t){return this.m+=this.e*t,this.n+=this.f*t,this.o+=this.g*t,this.p+=this.h*t,this}translateZ(t){return this.m+=this.i*t,this.n+=this.j*t,this.o+=this.k*t,this.p+=this.l*t,this}rotate(t,i){let e=t.x,n=t.y,h=t.z,a=Math.sin(i),r=Math.cos(i),c=1-r,o=e*e*c+r,f=n*e*c+h*a,d=h*e*c-n*a,l=e*n*c-h*a,u=n*n*c+r,x=h*n*c+e*a,E=e*h*c+n*a,y=n*h*c-e*a,A=h*h*c+r,M=this.a,_=this.b,b=this.c,R=this.d,T=this.e,U=this.f,O=this.g,z=this.h,G=this.i,$=this.j,D=this.k,I=this.l;return this.a=M*o+T*f+G*d,this.b=_*o+U*f+$*d,this.c=b*o+O*f+D*d,this.d=R*o+z*f+I*d,this.e=M*l+T*u+G*x,this.f=_*l+U*u+$*x,this.g=b*l+O*u+D*x,this.h=R*l+z*u+I*x,this.i=M*E+T*y+G*A,this.j=_*E+U*y+$*A,this.k=b*E+O*y+D*A,this.l=R*E+z*y+I*A,this}rotateX(t){let i=Math.sin(t),e=Math.cos(t),n=this.e,h=this.f,a=this.g,r=this.h,c=this.i,o=this.j,f=this.k,d=this.l;return this.e=n*e+c*i,this.f=h*e+o*i,this.g=a*e+f*i,this.h=r*e+d*i,this.i=c*e-n*i,this.j=o*e-h*i,this.k=f*e-a*i,this.l=d*e-r*i,this}rotateY(t){let i=Math.sin(t),e=Math.cos(t),n=this.a,h=this.b,a=this.c,r=this.d,c=this.i,o=this.j,f=this.k,d=this.l;return this.a=n*e-c*i,this.b=h*e-o*i,this.c=a*e-f*i,this.d=r*e-d*i,this.i=c*e+n*i,this.j=o*e+h*i,this.k=f*e+a*i,this.l=d*e+r*i,this}rotateZ(t){let i=Math.sin(t),e=Math.cos(t),n=this.a,h=this.b,a=this.c,r=this.d,c=this.e,o=this.f,f=this.g,d=this.h;return this.a=n*e+c*i,this.b=h*e+o*i,this.c=a*e+f*i,this.d=r*e+d*i,this.e=c*e-n*i,this.f=o*e-h*i,this.g=f*e-a*i,this.h=d*e-r*i,this}scale(t,i,e){let n;return typeof t=="number"?(n=t,i=i??t,e=e??t):(n=t.x,i=t.y,e=t.z),this.a*=n,this.b*=n,this.c*=n,this.d*=n,this.e*=i,this.f*=i,this.g*=i,this.h*=i,this.i*=e,this.j*=e,this.k*=e,this.l*=e,this}perspective(t,i,e,n){let h=1/Math.tan(t/2),a=1/(e-n);return this.set(h/i,0,0,0,0,h,0,0,0,0,(n+e)*a,-1,0,0,2*n*e*a,0)}ortho(t,i,e,n,h,a){let r=1/(t-i),c=1/(e-n),o=1/(h-a);return this.set(-2*r,0,0,0,0,-2*c,0,0,0,0,2*o,0,(t+i)*r,(n+e)*c,(a+h)*o,1)}lookAt(t,i,e){let n=t.x,h=t.y,a=t.z,r=n-i.x,c=h-i.y,o=a-i.z;if(Math.abs(r)==0&&Math.abs(c)==0&&Math.abs(o)==0)return this.reset();let f=1/Math.hypot(r,c,o);r*=f,c*=f,o*=f;let d=e.x,l=e.y,u=e.z,x=l*o-u*c,E=u*r-d*o,y=d*c-l*r;f=Math.hypot(x,E,y),f==0?(x=0,E=0,y=0):(f=1/f,x*=f,E*=f,y*=f);let A=c*y-o*E,M=o*x-r*y,_=r*E-c*x;return f=Math.hypot(A,M,_),f==0?(A=0,M=0,_=0):(f=1/f,A*=f,M*=f,_*=f),this.set(x,A,r,0,E,M,c,0,y,_,o,0,-(x*n+E*h+y*a),-(A*n+M*h+_*a),-(r*n+c*h+o*a),1)}fromQuat(t){let i=t.x,e=t.y,n=t.z,h=t.w,a=i+i,r=e+e,c=n+n,o=i*a,f=i*r,d=i*c,l=e*r,u=e*c,x=n*c,E=h*a,y=h*r,A=h*c;return this.a=1-(l+x),this.b=f+A,this.c=d-y,this.d=0,this.e=f-A,this.f=1-(o+x),this.g=u+E,this.h=0,this.i=d+y,this.j=u-E,this.k=1-(o+l),this.l=0,this.m=0,this.n=0,this.o=0,this.p=1,this}getTranslation(){return new B(this.m,this.n,this.o)}getMat3(){return new V(this.a,this.b,this.c,this.e,this.f,this.g,this.i,this.j,this.k)}getScaling(){return new B(Math.hypot(this.a,this.b,this.c),Math.hypot(this.e,this.f,this.g),Math.hypot(this.i,this.j,this.k))}*[Symbol.iterator](){yield this.a,yield this.b,yield this.c,yield this.d,yield this.e,yield this.f,yield this.g,yield this.h,yield this.i,yield this.j,yield this.k,yield this.l,yield this.m,yield this.n,yield this.o,yield this.p}};it.prototype.isMat4=!0;it.prototype.isMathPrimitive=!0;var X=class s{x;y;z;w;static of(t,i,e,n=1){return new s(t,i,e,n)}static zero(){return new s(0,0,0,0)}static all(t){return new s(t,t,t,t)}static random(){return new s(Math.random(),Math.random(),Math.random(),Math.random())}static xAxis(){return new s(1,0,0)}static yAxis(){return new s(0,1,0)}static zAxis(){return new s(0,0,1)}static translateX(t){return new s(t,0,0,1)}static translateY(t){return new s(0,t,0,1)}static translateZ(t){return new s(0,0,t,1)}static randomDir(){let t=Math.random()*2-1,i=Math.random()*2-1,e=Math.random()*2-1,n=Math.hypot(t,i,e);return new s(t/n,i/n,e/n,0)}static fromArray(t,i=0){return new s(t[i],t[i+1],t[i+2],t[i+3])}static sumOf(t,i){return new s(t.x+i.x,t.y+i.y,t.z+i.z,t.w+i.w)}static differenceOf(t,i){return new s(t.x-i.x,t.y-i.y,t.z-i.z,t.w-i.w)}static productOf(t,i){return new s(t.x*i.x,t.y*i.y,t.z*i.z,t.w*i.w)}static quotientOf(t,i){return new s(t.x/i.x,t.y/i.y,t.z/i.z,t.w/i.w)}static minOf(t,i){return new s(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.min(t.z,i.z),Math.min(t.w,i.w))}static maxOf(t,i){return new s(Math.max(t.x,i.x),Math.max(t.y,i.y),Math.max(t.z,i.z),Math.max(t.w,i.w))}constructor(t=0,i=0,e=0,n=1){this.x=t,this.y=i,this.z=e,this.w=n}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get 2(){return this.z}set 2(t){this.z=t}get 3(){return this.w}set 3(t){this.w=t}get length(){return 4}get xyz(){return new B(this.x,this.y,this.z)}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error(`Invalid Vec4 index: ${t}`)}}setIndex(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error(`Invalid Vec4 index: ${t}`)}}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=null,i=0){return t===null&&(t=new Array(3)),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}clone(){return new s(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}equals(t,i=H){return Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i&&Math.abs(this.z-t.z)<=i&&Math.abs(this.w-t.w)<=i}any(){return this.x!=0||this.y!=0||this.z!=0||this.w!=0}set(t,i,e,n){return this.x=t,this.y=i??t,this.z=e??(i===void 0?t:0),this.w=n??1,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}randomize(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addAll(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}sumOf(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subtractAll(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}differenceOf(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}productOf(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this.w=t.w*i.w,this}divideBy(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}quotientOf(t,i){return this.x=t.x/i.x,this.y=t.y/i.y,this.z=t.z/i.z,this.w=t.w/i.w,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}invert(){return this.x=this.x==0?0:1/this.x,this.y=this.y==0?0:1/this.y,this.z=this.z==0?0:1/this.z,this.w=this.w==0?0:1/this.w,this}inverseOf(t){return this.x=t.x==0?0:1/t.x,this.y=t.y==0?0:1/t.y,this.z=t.z==0?0:1/t.z,this.w=t.w==0?0:1/t.w,this}addScaled(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}mod(t){return this.x%=t.x,this.y%=t.y,this.z%=t.z,this.w%=t.w,this}modAll(t){return this.x%=t,this.y%=t,this.z%=t,this.w%=t,this}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpOf(t,i,e){return this.x=t.x+(i.x-t.x)*e,this.y=t.y+(i.y-t.y)*e,this.z=t.z+(i.z-t.z)*e,this.w=t.w+(i.w-t.w)*e,this}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.w!==0&&(this.x/=this.w,this.y/=this.w,this.z/=this.w,this.w=1),this}normalOf(t){return t.w===0?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x/=t.w,this.y/=t.w,this.z/=t.w,this.w=1),this}min(t){return typeof t=="number"?(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t),this.z=Math.min(this.z,t),this.w=Math.min(this.w,t)):(this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w)),this}minOf(t,i){return this.x=Math.min(t.x,i.x),this.y=Math.min(t.y,i.y),this.z=Math.min(t.z,i.z),this.w=Math.min(t.w,i.w),this}max(t){return typeof t=="number"?(this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),this.z=Math.max(this.z,t),this.w=Math.max(this.w,t)):(this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w)),this}maxOf(t,i){return this.x=Math.max(t.x,i.x),this.y=Math.max(t.y,i.y),this.z=Math.max(t.z,i.z),this.w=Math.max(t.w,i.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}applyMat4(t){let i=this.x,e=this.y,n=this.z,h=this.w;return this.x=i*t.a+e*t.e+n*t.i+h*t.m,this.y=i*t.b+e*t.f+n*t.j+h*t.n,this.z=i*t.c+e*t.g+n*t.k+h*t.o,this.w=i*t.d+e*t.h+n*t.l+h*t.p,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};X.prototype.isVec4=!0;X.prototype.isMathPrimitive=!0;function js(s){return function(){var t=s+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function Ut(s){return s.x*=s.x*34+133,s.y*=s.y*34+133,s.z*=s.z*34+133,s.w*=s.w*34+133,s}function _t(s){let t=new B(s,s/2,s/4).floor().modAll(2).scale(2).subtractAll(1),i=t.clone();i.setIndex(Math.max(0,Math.floor(s/16)),0);let e=Math.floor(s/8)%2,n=t.clone().scale(1-e).add(t.cross(i).add(i).scale(e)),h=i.scale(1.22474487139).add(n);return h.scale((1-.042942436724648037*e)*3.5946317686139184),h}function Ct(s){let t=s.clone().floor(),i=new X(s.x-t.x,s.y-t.y,s.z-t.z,2.5),e=t.clone().addAll(Math.floor(i.dot(X.all(.25)))),n=t.clone().add(B.xAxis()).add(new B(-1,1,1).scale(Math.floor(i.dot(new X(-.25,.25,.25,.35))))),h=t.clone().add(B.yAxis()).add(new B(1,-1,1).scale(Math.floor(i.dot(new X(.25,-.25,.25,.35))))),a=t.add(B.zAxis()).add(new B(1,1,-1).scale(Math.floor(i.dot(new X(.25,.25,-.25,.35))))),r=Ut(new X(e.x,n.x,h.x,a.x).modAll(289));Ut(r.add(new X(e.y,n.y,h.y,a.y)).modAll(289)),Ut(r.add(new X(e.z,n.z,h.z,a.z)).modAll(289)).modAll(48);let c=s.clone().subtract(e),o=s.clone().subtract(n),f=s.clone().subtract(h),d=s.subtract(a),l=X.all(.75).subtract(new X(c.dot(c),o.dot(o),f.dot(f),d.dot(d))).max(0),u=l.clone().multiply(l),x=u.clone().multiply(u),E=_t(r.x),y=_t(r.y),A=_t(r.z),M=_t(r.w),_=new X(c.dot(E),o.dot(y),f.dot(A),d.dot(M)),b=x.dot(_),R=u.multiply(l).multiply(_).applyMat4(it.fromVec3s(c,o,f,d)).scale(-8).add(x.applyMat4(it.fromVec3s(E,y,A,M)));return new X(R.x,R.y,R.z,b)}var Xt=new V(.788675134594813,-.211324865405187,-.577350269189626,-.211324865405187,.788675134594813,-.577350269189626,.577350269189626,.577350269189626,.577350269189626);function Ws(s){s.applyMat3(Xt);let t=Ct(s.clone()).add(Ct(s.addAll(144.5))),i=t.xyz.applyMat3(Xt);return new X(i.x,i.y,i.z,t.w)}var nt=class s{x;y;z;w;static identity(){return new s(0,0,0,1)}static random(){let t=Math.random(),i=Math.random()*2*Math.PI,e=Math.random()*2*Math.PI,n=Math.sqrt(1-t),h=Math.sqrt(t);return new s(n*Math.cos(i),h*Math.sin(e),h*Math.cos(e),n*Math.sin(i))}static fromArray(t,i=0){return new s(t[i],t[i+1],t[i+2],t[i+3])}static fromAxisAngle(t,i){let e=i/2,n=Math.sin(e);return new s(t.x*n,t.y*n,t.z*n,Math.cos(e))}static fromMat3(t){let i=t.a,e=t.d,n=t.g,h=t.b,a=t.e,r=t.h,c=t.c,o=t.f,f=t.i,d=i+a+f;if(d>0){let l=.5/Math.sqrt(d+1);return new s((o-r)*l,(n-c)*l,(h-e)*l,.25/l)}else if(i>a&&i>f){let l=2*Math.sqrt(1+i-a-f);return new s(.25*l,(e+h)/l,(n+c)/l,(o-r)/l)}else if(a>f){let l=2*Math.sqrt(1+a-i-f);return new s((e+h)/l,.25*l,(r+o)/l,(n-c)/l)}else{let l=2*Math.sqrt(1+f-i-a);return new s((n+c)/l,(r+o)/l,.25*l,(h-e)/l)}}static fromDirections(t,i){let e=t.dot(i)+1;if(e<H)if(Math.abs(t.x)>Math.abs(t.z)){let n=Math.hypot(t.x,t.y);return new s(-t.y/n,t.x/n,0,0)}else{let n=Math.hypot(t.y,t.z);return new s(0,-t.z/n,t.y/n,0)}else{let n=t.y*i.z-t.z*i.y,h=t.z*i.x-t.x*i.z,a=t.x*i.y-t.y*i.x,r=Math.hypot(n,h,a,e);return new s(n/r,h/r,a/r,e/r)}}static slerpOf(t,i,e){let n=t.x,h=t.y,a=t.z,r=t.w,c=i.x,o=i.y,f=i.z,d=i.w,l=n*c+h*o+a*f+r*d;l<0&&(l=-l,c=-c,o=-o,f=-f,d=-d);let u,x;if(1-l>H){let E=Math.acos(l),y=Math.sin(E);u=Math.sin((1-e)*E)/y,x=Math.sin(e*E)/y}else u=1-e,x=e;return new s(u*n+x*c,u*h+x*o,u*a+x*f,u*r+x*d)}static sqlerpOf(t,i,e,n,h){return s.slerpOf(t,i,h).slerp(s.slerpOf(e,n,h),2*h*(1-h))}constructor(t=0,i=0,e=0,n=1){this.x=t,this.y=i,this.z=e,this.w=n}get 0(){return this.x}get 1(){return this.y}get 2(){return this.x}get 3(){return this.w}get length(){return 4}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=null,i=0){return t===null&&(t=new Array(4)),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}clone(){return new s(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}fromAxisAngle(t,i){let e=i/2,n=Math.sin(e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(e),this}equals(t,i=H){return Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i&&Math.abs(this.z-t.z)<=i&&Math.abs(this.w-t.w)<=i}invert(){let t=this.x,i=this.y,e=this.z,n=this.w,h=t*t+i*i+e*e+n*n;return h===0?(this.x=0,this.y=0,this.z=0,this.w=1):(h=1/h,this.x=-t*h,this.y=-i*h,this.z=-e*h,this.w=n*h),this}inverseOf(t){let i=t.x,e=t.y,n=t.z,h=t.w,a=i*i+e*e+n*n+h*h;return a===0?(this.x=0,this.y=0,this.z=0,this.w=1):(a=1/a,this.x=-i*a,this.y=-e*a,this.z=-n*a,this.w=h*a),this}conjugate(){return new s(-this.x,-this.y,-this.z,this.w)}conjugateOf(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalize(){let t=Math.hypot(this.x,this.y,this.z,this.w);return t===0?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this}normalizeOf(t){let i=Math.hypot(t.x,t.y,t.z,t.w);return i===0?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i,this.w=t.w/i),this}multiply(t){let i=this.x,e=this.y,n=this.z,h=this.w,a=t.x,r=t.y,c=t.z,o=t.w;return this.x=i*o+h*a+e*c-n*r,this.y=e*o+h*r+n*a-i*c,this.z=n*o+h*c+i*r-e*a,this.w=h*o-i*a-e*r-n*c,this}preMultiply(t){let i=t.x,e=t.y,n=t.z,h=t.w,a=this.x,r=this.y,c=this.z,o=this.w;return this.x=i*o+h*a+e*c-n*r,this.y=e*o+h*r+n*a-i*c,this.z=n*o+h*c+i*r-e*a,this.w=h*o-i*a-e*r-n*c,this}productOf(t,i){let e=t.x,n=t.y,h=t.z,a=t.w,r=i.x,c=i.y,o=i.z,f=i.w;return this.x=e*f+a*r+n*o-h*c,this.y=n*f+a*c+h*r-e*o,this.z=h*f+a*o+e*c-n*r,this.w=a*f-e*r-n*c-h*o,this}slerp(t,i){let e=this.x,n=this.y,h=this.z,a=this.w,r=t.x,c=t.y,o=t.z,f=t.w,d=e*r+n*c+h*o+a*f;d<0&&(d=-d,r=-r,c=-c,o=-o,f=-f);let l,u;if(1-d>H){let x=Math.acos(d),E=Math.sin(x);l=Math.sin((1-i)*x)/E,u=Math.sin(i*x)/E}else l=1-i,u=i;return this.x=l*e+u*r,this.y=l*n+u*c,this.z=l*h+u*o,this.w=l*a+u*f,this}slerpOf(t,i,e){let n=t.x,h=t.y,a=t.z,r=t.w,c=i.x,o=i.y,f=i.z,d=i.w,l=n*c+h*o+a*f+r*d;l<0&&(l=-l,c=-c,o=-o,f=-f,d=-d);let u,x;if(1-l>H){let E=Math.acos(l),y=Math.sin(E);u=Math.sin((1-e)*E)/y,x=Math.sin(e*E)/y}else u=1-e,x=e;return this.x=u*n+x*c,this.y=u*h+x*o,this.z=u*a+x*f,this.w=u*r+x*d,this}angleTo(t){let i=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;return Math.acos(2*i*i-1)}getAxisAngle(t){let i=Math.acos(this.w)*2,e=Math.sin(i/2);return e>H?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=1,t.y=0,t.z=0),i}rotateX(t){t*=.5;let i=Math.sin(t),e=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return this.x=n*e+r*i,this.y=h*e+a*i,this.z=a*e-h*i,this.w=r*e-n*i,this}rotateY(t){t*=.5;let i=Math.sin(t),e=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return this.x=n*e-a*i,this.y=h*e+r*i,this.z=a*e+n*i,this.w=r*e-h*i,this}rotateZ(t){t*=.5;let i=Math.sin(t),e=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return this.x=n*e+h*i,this.y=h*e-n*i,this.z=a*e+r*i,this.w=r*e-a*i,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};nt.prototype.isQuat=!0;nt.prototype.isMathPrimitive=!0;var k=class s{x;y;static of(t,i){return new s(t,i)}static zero(){return new s(0,0)}static all(t){return new s(t,t)}static random(){return new s(Math.random(),Math.random())}static xAxis(){return new s(1,0)}static yAxis(){return new s(0,1)}static translateX(t){return new s(t,0)}static translateY(t){return new s(0,t)}static randomDir(){let t=Math.random()*2-1,i=Math.random()*2-1,e=Math.hypot(t,i);return new s(t/e,i/e)}static fromArray(t,i=0){return new s(t[i],t[i+1])}static sumOf(t,i){return new s(t.x+i.x,t.y+i.y)}static differenceOf(t,i){return new s(t.x-i.x,t.y-i.y)}static productOf(t,i){return new s(t.x*i.x,t.y*i.y)}static quotientOf(t,i){return new s(t.x/i.x,t.y/i.y)}static normalOf(t){let i=t.x*t.x+t.y*t.y;if(i>0){let e=1/Math.sqrt(i);return new s(t.x*e,t.y*e)}else return new s(0,0)}static minOf(t,i){return new s(Math.min(t.x,i.x),Math.min(t.y,i.y))}static maxOf(t,i){return new s(Math.max(t.x,i.x),Math.max(t.y,i.y))}constructor(t=0,i=0){this.x=t,this.y=i}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get length(){return 2}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get ratio(){return this.y===0?0:this.x/this.y}get u(){return this.x}set u(t){this.x=t}get v(){return this.y}set v(t){this.y=t}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error(`Invalid Vec2 index: ${t}`)}}setIndex(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error(`Invalid Vec2 index: ${t}`)}}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=null,i=0){return t===null&&(t=new Array(2)),t[i]=this.x,t[i+1]=this.y,t}clone(){return new s(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}equals(t,i=H){return Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i}any(){return this.x!=0||this.y!=0}set(t,i){return this.x=t,this.y=i??t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}randomize(){return this.x=Math.random(),this.y=Math.random(),this}add(t){return this.x+=t.x,this.y+=t.y,this}addAll(t){return this.x+=t,this.y+=t,this}sumOf(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}subtractAll(t){return this.x-=t,this.y-=t,this}differenceOf(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}productOf(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this}divideBy(t){return this.x/=t.x,this.y/=t.y,this}quotientOf(t,i){return this.x=t.x/i.x,this.y=t.y/i.y,this}scale(t){return this.x*=t,this.y*=t,this}invert(){return this.x=this.x==0?0:1/this.x,this.y=this.y==0?0:1/this.y,this}inverseOf(t){return this.x=t.x==0?0:1/t.x,this.y=t.y==0?0:1/t.y,this}addScaled(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}mod(t){return this.x%=t.x,this.y%=t.y,this}modAll(t){return this.x%=t,this.y%=t,this}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpOf(t,i,e){return this.x=t.x+(i.x-t.x)*e,this.y=t.y+(i.y-t.y)*e,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}magSq(){return this.x*this.x+this.y*this.y}magnitude(){return Math.hypot(this.x,this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){let t=this.x*this.x+this.y*this.y;if(t>0){let i=1/Math.sqrt(t);this.x*=i,this.y*=i}return this}normalOf(t){let i=t.x*t.x+t.y*t.y;if(i>0){let e=1/Math.sqrt(i);this.x=t.x*e,this.y=t.y*e}else this.x=0,this.y=0;return this}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y)}distanceToSq(t){let i=this.x-t.x,e=this.y-t.y;return i*i+e*e}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}minOf(t,i){return this.x=Math.min(t.x,i.x),this.y=Math.min(t.y,i.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}maxOf(t,i){return this.x=Math.max(t.x,i.x),this.y=Math.max(t.y,i.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampMagnitude(t,i){let e=this.x*this.x+this.y*this.y;if(e>0){let n=Math.sqrt(e),h=Math.max(t,Math.min(i,n))/n;this.x*=h,this.y*=h}return this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}angle(){return Math.atan2(this.y,this.x)}angleTo(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)}rotate(t){let i=Math.cos(t),e=Math.sin(t),n=this.x,h=this.y;return this.x=n*i-h*e,this.y=n*e+h*i,this}rotateAround(t,i){let e=Math.cos(t),n=Math.sin(t),h=this.x-i.x,a=this.y-i.y;return this.x=h*e-a*n+i.x,this.y=h*n+a*e+i.y,this}translateX(t){return this.x+=t,this}translateY(t){return this.y+=t,this}applyMat3(t){let i=this.x,e=this.y;return this.x=i*t.a+e*t.d+t.g,this.y=i*t.b+e*t.e+t.h,this}*[Symbol.iterator](){yield this.x,yield this.y}};k.prototype.isVec2=!0;k.prototype.isMathPrimitive=!0;var At=class s{x;y;width;height;static unionOf(t){if(t.length===0)return new s;let i=t[0].clone();for(let e=1;e<t.length;e++)i.union(t[e]);return i}static fromCorners(t,i){return new s(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.abs(t.x-i.x),Math.abs(t.y-i.y))}constructor(t=0,i=0,e=0,n=0){this.x=t,this.y=i,this.width=e,this.height=n}clone(){return new s(this.x,this.y,this.width,this.height)}set(t,i,e,n){return this.x=t,this.y=i,this.width=e,this.height=n,this}get size(){return new k(this.width,this.height)}set size(t){this.width=t.x,this.height=t.y}get left(){return this.x}set left(t){this.x=t}get top(){return this.y}set top(t){this.y=t}get right(){return this.x+this.width}set right(t){this.width=Math.max(0,t-this.x)}get bottom(){return this.y+this.height}set bottom(t){this.height=Math.max(0,t-this.y)}get topLeft(){return new k(this.x,this.y)}get topRight(){return new k(this.x+this.width,this.y)}get bottomLeft(){return new k(this.x,this.y+this.height)}get bottomRight(){return new k(this.x+this.width,this.y+this.height)}get center(){return new k(this.x+this.width*.5,this.y+this.height*.5)}contains(t,i){return t>=this.x&&t<=this.x+this.width&&i>=this.y&&i<=this.y+this.height}containsRect(t){return t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom}containsRect4(t,i,e,n){return t>=this.x&&i>=this.y&&t+e<=this.right&&i+n<=this.bottom}intersects(t){return this.x<t.right&&this.right>t.x&&this.y<t.bottom&&this.bottom>t.y}intersects4(t,i,e,n){return this.x<t+e&&this.right>t&&this.y<i+n&&this.bottom>i}union(t){let i=this.right,e=this.bottom;this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(i,t.right)-this.x,this.height=Math.max(e,t.bottom)-this.y}unionOf(t){if(t.length===0)this.x=this.y=this.width=this.height=0;else{this.x=t[0].x,this.y=t[0].y,this.width=t[0].width,this.height=t[0].height;for(let i=1;i<t.length;i++)this.union(t[i])}return this}isEmpty(){return this.width<=0||this.height<=0}clear(){this.x=this.y=this.width=this.height=0}include(t,i){return t<this.x?(this.width+=this.x-t,this.x=t):t>this.right&&(this.width=t-this.x),i<this.y?(this.height+=this.y-i,this.y=i):i>this.bottom&&(this.height=i-this.y),this}grow(t){return this.x-=t,this.y-=t,this.width+=t*2,this.height+=t*2,this}fromCorners(t,i){return this.x=Math.min(t.x,i.x),this.y=Math.min(t.y,i.y),this.width=Math.abs(t.x-i.x),this.height=Math.abs(t.y-i.y),this}fromCorners4(t,i,e,n){return this.x=Math.min(t,e),this.y=Math.min(i,n),this.width=Math.abs(t-e),this.height=Math.abs(i-n),this}};At.prototype.isRect=!0;function qs(s,t={}){let i=Math.abs(t.width??1),e=Math.abs(t.height??1),n=Math.max(Math.round(t.widthSegments??1),1),h=Math.max(Math.round(t.heightSegments??1),1),a=t.textureXform??V.identity(),r=new Array,c=new Array,o=new Array,f=new Array,d=new Array,l=new k;for(let u=0;u<=h;u++){let x=u/h;for(let E=0;E<=n;E++){let y=E/n;if(r.push((2*y-1)*i,(2*x-1)*e,0),E<n&&u<h){let A=(n+1)*(u+0)+(E+0),M=(n+1)*(u+0)+(E+1),_=(n+1)*(u+1)+(E+1),b=(n+1)*(u+1)+(E+0);c.push(A,M,b,M,_,b)}f.push(0,0,1),d.push(1,0,0),l.x=y,l.y=x,l.applyMat3(a),o.push(l.x,l.y)}}return{name:s,positions:r,indices:c,texCoords:o,normals:f,tangents:d}}function Ks(s,t={}){let i=Math.abs(t.radius??1),e=Math.max(Math.round(t.segments??32),3),n=Math.max(Math.round(t.internalSegments??1),1),h=new Array,a=new Array,r=new Array,c=new Array,o=new Array;for(let f=0;f<=n;f++){let d=i*(f/n);for(let l=0;l<=e;l++){let u=2*Math.PI*(l/e),x=-d*Math.cos(u),E=d*Math.sin(u);if(h.push(x,E,0),c.push(0,0,1),o.push(1,0,0),r.push((x/i+1)/2,(E/i+1)/2),f<n&&l<e){let y=f*(e+1)+l,A=f*(e+1)+l+1,M=(f+1)*(e+1)+l+1,_=(f+1)*(e+1)+l;a.push(y,A,_),a.push(A,M,_)}}}return{name:s,positions:h,indices:a,texCoords:r,normals:c,tangents:o}}function Zs(s,t={}){let i=t.width??1,e=t.height??1,n=t.depth??1,h=Math.max(1,Math.round(t.widthSegments??1)),a=Math.max(1,Math.round(t.heightSegments??1)),r=Math.max(1,Math.round(t.depthSegments??1)),c=t.textureXform??V.identity(),o=new Array,f=new Array,d=new Array,l=new Array,u=new Array;function x(A,M,_,b,R,T){let U=A/2,O=M/2,z=_/2,G=A/b,$=M/R,D=o.length/3,I=b+1,S=new B,ft=new k,Mt=new B(0,0,1).rotateQuat(T),bt=new B(1,0,0).rotateQuat(T);for(let Q=0;Q<=R;Q++){let Vt=Q*$-O;for(let J=0;J<=b;J++)if(S.set(J*G-U,Vt,z).rotateQuat(T),o.push(S.x,S.y,S.z),ft.set(J/b,Q/R),ft.applyMat3(c),d.push(ft.x,ft.y),l.push(Mt.x,Mt.y,Mt.z),u.push(bt.x,bt.y,bt.z),Q<R&&J<b){let Yt=D+J+I*Q,gt=D+J+I*(Q+1),jt=D+(J+1)+I*(Q+1),Gt=D+(J+1)+I*Q;f.push(Yt,Gt,gt),f.push(gt,Gt,jt)}}}let E=new B,y=new nt;return x(n,e,i,r,a,y.fromAxisAngle(E.set(0,1,0),Math.PI/-2)),x(n,e,i,r,a,y.fromAxisAngle(E.set(0,1,0),Math.PI/2)),x(i,n,e,h,r,y.fromAxisAngle(E.set(1,0,0),Math.PI/2)),x(i,n,e,h,r,y.fromAxisAngle(E.set(1,0,0),Math.PI/-2)),x(i,e,n,h,a,y.fromAxisAngle(E.set(0,1,0),Math.PI)),x(i,e,n,h,a,y.fromAxisAngle(E.set(0,1,0),0)),{name:s,positions:o,indices:f,texCoords:d,normals:l,tangents:u}}function Qs(s,t={}){let i=Math.max(0,t.radius??1),e=Math.max(3,Math.floor(t.widthSegments??32)),n=Math.max(2,Math.floor(t.heightSegments??16)),h=t.textureXform??V.identity(),a=new Array,r=new Array,c=new Array,o=new Array,f=new k;for(let d=0;d<=n;d++){let l=d*Math.PI/n,u=Math.sin(l),x=Math.cos(l),E=0;d===0?E=.5/e:d===n&&(E=-.5/e);for(let y=0;y<=e;y++){let A=y*2*Math.PI/e,M=Math.cos(A)*u,_=x,b=Math.sin(A)*u;if(f.x=1-y/e+E,f.y=1-d/n,f.applyMat3(h),a.push(i*M,i*_,i*b),o.push(M,_,b),c.push(f.x,f.y),d<n&&y<e){let R=d*(e+1)+y,T=R+e+1;r.push(R,R+1,T),r.push(T,R+1,T+1)}}}return Ht(s,r,a,c,o),{name:s,positions:a,indices:r,texCoords:c,normals:o,tangents:Ot(a,c,r,o)}}function Js(s,t={}){let i=t.in2D??!1,e=t.left??-1,n=t.right??1,h=t.top??1,a=t.bottom??-1;return{name:s,positions:i?[e,a,e,h,n,h,n,a]:[e,a,0,e,h,0,n,h,0,n,a,0],indices:[0,1,2,0,2,3],texCoords:[0,0,0,1,1,1,1,0],normals:i?[]:[0,0,1,0,0,1,0,0,1,0,0,1],tangents:i?[]:[1,0,0,1,0,0,1,0,0,1,0,0]}}function ti(s,t={}){let i=Math.max(0,t.knotRadius??1),e=Math.max(0,t.tubeRadius??.4),n=Math.max(3,Math.floor(t.tubeSegments??64)),h=Math.max(3,Math.floor(t.radialSegments??8)),a=Math.max(1,Math.floor(t.p??2)),r=Math.max(1,Math.floor(t.q??3)),c=[],o=[],f=[],d=[],l=(M,_,b,R,T)=>{let U=Math.cos(M),O=Math.sin(M),z=b/_*M,G=Math.cos(z);T.x=R*(2+G)*.5*U,T.y=R*(2+G)*O*.5,T.z=R*Math.sin(z)*.5},u=new B,x=new B,E=new B,y=new B,A=new B;for(let M=0;M<=n;++M){let _=M/n*a*Math.PI*2;l(_,a,r,i,x),l(_+.01,a,r,i,A),y.copy(A).subtract(x),E.crossOf(y,A),A.crossOf(E,y),E.normalize(),A.normalize();for(let b=0;b<=h;++b){let R=b/h*Math.PI*2,T=-e*Math.cos(R),U=e*Math.sin(R);if(u.x=x.x+(T*A.x+U*E.x),u.y=x.y+(T*A.y+U*E.y),u.z=x.z+(T*A.z+U*E.z),c.push(u.x,u.y,u.z),u.subtract(x).normalize(),f.push(u.x,u.y,u.z),d.push(M/n),d.push(b/h),M>=1&&b>=1){let O=(h+1)*(M-1)+(b-1),z=(h+1)*M+(b-1),G=(h+1)*M+b,$=(h+1)*(M-1)+b;o.push(O,z,$,z,G,$)}}}return{name:s,positions:c,indices:o,texCoords:d,normals:f,tangents:Ot(c,d,o,f)}}function si(s){let t=new Set(["#","mtllib","usemtl","g","l","s",""]),i,e=[],n=[],h=[],a=[],r=s.split(`
`);for(let[c,o]of r.entries()){let f=o.split(" "),d=f[0];if(!t.has(d))if(d==="o")i===void 0?i=f[1]:w(()=>`Multiple object names defined in OBJ file (on line ${c})`);else if(d==="v")e.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(d==="vn")h.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(d==="vt")a.push(parseFloat(f[1]),parseFloat(f[2]));else if(d==="f")for(let l=1;l<=3;l++){let u=f[l].split("/"),x=parseInt(u[0])-1,E=u.length>1&&u[1]!==""?parseInt(u[1])-1:x,y=u.length>2?parseInt(u[2])-1:x;n.push([x,E,y])}else v(()=>`Unexpected OBJ token: "${d}" on line ${c}`)}return i===void 0&&w(()=>`No object name defined in OBJ file: "${s}"`),h.length===0&&(console.log(`Calculating normals for object "${i}"`),h.push(...ai(e,n.map(c=>c[2])))),a.length===0&&(v(()=>`No texture coordinates defined for object "${i}"`),a.push(...new Array(e.length/3*2).fill(0))),{name:i,positions:e,texCoords:a,normals:h,splitIndices:n}}function ii(s,t){let i=t.positions,e=t.texCoords,n=t.normals,h=t.indices,a=0,r=new Map;for(let c of s.splitIndices){let o=c.join("|"),f=r.get(o);if(f!==void 0){h.push(f);continue}let[d,l,u]=c,x=d*3;i.push(...s.positions.slice(x,x+3));let E=l*2;e.push(...s.texCoords.slice(E,E+2));let y=u*3;n.push(...s.normals.slice(y,y+3)),h.push(a),r.set(o,a),a++}t.tangents=Ot(i,e,h,n)}async function ei(s){let i=await(await fetch(s,{mode:"cors",method:"GET",headers:{"Content-Type":"text/plain"}})).text(),e=si(i),n={name:e.name,positions:[],indices:[],texCoords:[],normals:[],tangents:[]};return ii(e,n),n.name,n.indices,n.positions,Ht(n.name,n.indices,n.positions,n.texCoords,n.normals,n.tangents),n}function ni(s){let t=new Set,i=s.indices.length,e=s.positions.length/3,n=e;for(let h=0;h<i;h++){let a=s.indices[h];t.has(a)?(s.indices[h]=n,t.add(n++),s.positions.push(s.positions[a*3],s.positions[a*3+1],s.positions[a*3+2]),s.texCoords.push(s.texCoords[a*2],s.texCoords[a*2+1]),s.normals.push(s.normals[a*3],s.normals[a*3+1],s.normals[a*3+2]),s.tangents.push(s.tangents[a*3],s.tangents[a*3+1],s.tangents[a*3+2])):t.add(a)}e!==n&&C(()=>`Uniquified ${n-e} vertices.`)}function hi(s){new Set(s.indices).size!==s.indices.length&&w(()=>`The geometry "${s.name}" must have unique vertices to generate barycentric coordinates.`);let t=new Array(s.positions.length).fill(0),i=s.indices;for(let e=0;e<s.indices.length;e+=3)t[i[e]*3]=1,t[i[e+1]*3+1]=1,t[i[e+2]*3+2]=1;return g(t.length===s.positions.length,()=>`Failed to calculate barycentric coordinates for geometry "${s.name}"`),t}function Ht(s,t,i,e,n,h){i.length%3!==0&&w(()=>`The positions array of "${s}" must have a length that is a multiple of 3, but it is ${i.length}.`),t.length%3!==0&&w(()=>`The indices array of "${s}" must have a length that is a multiple of 3, but it is ${t.length}.`),e&&e.length%2!==0&&w(()=>`The UVs array of "${s}" must have a length that is a multiple of 2, but it is ${e.length}.`),n&&n.length%3!==0&&w(()=>`The normals array of "${s}" must have a length that is a multiple of 3, but it is ${n.length}.`),h&&h.length%3!==0&&w(()=>`The tangents array of "${s}" must have a length that is a multiple of 3, but it is ${h.length}.`);let a=i.length/3;e&&e.length/2!==a&&w(()=>`The UVs array of "${s}" must have the same number of elements as the positions array.`),n&&n.length!==i.length&&w(()=>`The normals array of "${s}" must have the same number of elements as the positions array.`),h&&h.length!==i.length&&w(()=>`The tangents array of "${s}" must have the same number of elements as the positions array.`);let r=new Set;for(let f of t)r.add(f);if(r.size===a)return;let c=new Array;for(let f=0;f<a;f++)r.has(f)||c.push(f);for(let f=c.length-1;f>=0;f--){let d=c[f];i.splice(d*3,3),e&&e.splice(d*2,2),n&&n.splice(d*3,3),h&&h.splice(d*3,3)}let o=[];{let f=0,d=c[0],l=1;for(let u=0;u<a;u++)u===d&&(f++,d=c[l++]),o.push(f)}for(let f=0;f<t.length;f++)t[f]-=o[t[f]];C(()=>`Removed ${c.length} unused vertices from "${s}".`)}function ai(s,t){if(s.length===0||t.length===0)return v(()=>"Skipping computation of normals for an empty mesh."),[];t.length%3!==0&&w(()=>"The indices array must be a multiple of 3."),s.length%3!==0&&w(()=>"The positions array must be a multiple of 3.");let i=new Array(s.length).fill(0);for(let e=0;e<t.length;e+=3){let n=t[e]*3,h=t[e+1]*3,a=t[e+2]*3,r=s[n],c=s[n+1],o=s[n+2],f=s[h]-r,d=s[h+1]-c,l=s[h+2]-o,u=s[a]-r,x=s[a+1]-c,E=s[a+2]-o,y=d*E-l*x,A=l*u-f*E,M=f*x-d*u;i[n]+=y,i[n+1]+=A,i[n+2]+=M,i[h]+=y,i[h+1]+=A,i[h+2]+=M,i[a]+=y,i[a+1]+=A,i[a+2]+=M}for(let e=0;e<i.length;e+=3){let n=Math.hypot(i[e],i[e+1],i[e+2]);if(n===0){v(()=>`Cannot generate normal for vertex ${e/3} because it is not part of a face.`);continue}i[e]/=n,i[e+1]/=n,i[e+2]/=n}return i}function Ot(s,t,i,e){if(s.length===0||t.length===0||i.length===0)return v(()=>"Skipping computation of tangents for an empty mesh."),[];i.length%3!==0&&w(()=>"The indices array must be a multiple of 3."),s.length%3!==0&&w(()=>"The positions array must be a multiple of 3."),t.length%2!==0&&w(()=>"The UVs array must be a multiple of 2."),e&&e.length%3!==0&&w(()=>"The normals array must be a multiple of 3.");let n=s.length/3;t.length/2!==n&&w(()=>"The UVs array must have the same number of elements as the positions array."),e&&e.length!==s.length&&w(()=>"The normals array must have the same number of elements as the positions array.");let h=Array(s.length).fill(0);for(let a=0;a<i.length;a+=3){let r=i[a],c=i[a+1],o=i[a+2],f=s[r*3],d=s[r*3+1],l=s[r*3+2],u=s[c*3]-f,x=s[c*3+1]-d,E=s[c*3+2]-l,y=s[o*3]-f,A=s[o*3+1]-d,M=s[o*3+2]-l,_=t[r*2],b=t[r*2+1],R=t[c*2]-_,T=t[c*2+1]-b,U=t[o*2]-_,O=t[o*2+1]-b,z=1/(R*O-U*T),G=(O*u-T*y)*z,$=(O*x-T*A)*z,D=(O*E-T*M)*z;h[r*3]+=G,h[r*3+1]+=$,h[r*3+2]+=D,h[c*3]+=G,h[c*3+1]+=$,h[c*3+2]+=D,h[o*3]+=G,h[o*3+1]+=$,h[o*3+2]+=D}if(e)for(let a=0;a<h.length;a+=3){let r=h[a],c=h[a+1],o=h[a+2],f=e[a],d=e[a+1],l=e[a+2],u=f*r+d*c+l*o;r-=u*f,c-=u*d,o-=u*l;let x=Math.hypot(r,c,o);x!==0&&(h[a]=r/x,h[a+1]=c/x,h[a+2]=o/x)}else for(let a=0;a<h.length;a+=3){let r=Math.hypot(h[a],h[a+1],h[a+2]);r!==0&&(h[a]/=r,h[a+1]/=r,h[a+2]/=r)}return h}function ri(s){if(s.ctx===void 0&&(s.width===void 0||s.height===void 0))throw new Error("Either ctx or width and height must be provided.");let t=s.width??s.ctx.canvas.width,i=s.height??s.ctx.canvas.height;return ct(s.gl,s.name,t,i,{useAnisotropy:!0,internalFormat:m.RGBA8})}function ci(s,t={}){let i=t.gridSize??10,e=t.axisWidth??2,n=t.gridWidth??1,h=t.axisColorX??"rgb(255, 255, 255)",a=t.axisColorY??"rgb(255, 255, 255)",r=t.gridColor??"rgb(255, 255, 255)",c=t.axisAlpha??1,o=t.gridAlpha??.9;if(i%2!=0)throw new Error(`Grid Size must be an even number, got ${i}`);let f=s.canvas.width,d=s.canvas.height,l=Math.max(e,n),u=(f-l*2)/i;s.lineWidth=n,s.lineCap="round",s.globalAlpha=1,s.strokeStyle=r;for(let E=0;E<=i;E++){let y=l+E*u;s.beginPath(),s.moveTo(y,l),s.lineTo(y,d-l),s.stroke(),s.beginPath(),s.moveTo(l,y),s.lineTo(f-l,y),s.stroke()}if(o<1){var x=s.getImageData(0,0,s.canvas.width,s.canvas.height);let E=x.data;for(let y=0;y<E.length;y+=4)E[y+3]*=o;s.putImageData(x,0,0)}s.lineWidth=e,s.globalAlpha=c,s.strokeStyle=h,s.beginPath(),s.moveTo(l,d/2),s.lineTo(f-l,d/2),s.stroke(),s.strokeStyle=a,s.beginPath(),s.moveTo(f/2,l),s.lineTo(f/2,d-l),s.stroke(),s.globalAlpha=1}function oi(s,t,i){try{s.bindTexture(s.TEXTURE_2D,i.glo),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,t.canvas),s.generateMipmap(s.TEXTURE_2D)}finally{s.bindTexture(s.TEXTURE_2D,null)}}function kt(s,t){return Array.from({length:t},()=>s).flat()}function ui(s,t,i){return s.slice(t,t+i)}function fi(s,t=1){if(s.length===0)return[];if(s.length===1)return s[0];Array.isArray(t)?t.length!==s.length&&w(()=>`'quantities' must be either a number or an array with the same length as 'arrays'.
    'quantities' length: ${t.length}
    'arrays' length: ${s.length}`):t=kt([t],s.length);let i=s[0].length/t[0];for(let n=0;n<s.length;n++){let h=t[n];h<1&&w(()=>`'quantity' must be greater than 0, but the value at index ${n} is ${h}`),h%1!==0&&w(()=>`'quantity' must be an integer, but the value at index ${n} is ${h}`),s[n].length%h!==0&&w(()=>`The length of the corresponding array must be a multiple of 'quantity'
    but the quantity at index ${n} is ${h}
    whereas the length of the corresponding array is ${s[n].length}`),s[n].length/h!==i&&w(()=>`All arrays must have the same number of quantities,
    but array ${n} of size ${s[n].length} contains ${s[n].length/h} times ${h} quantities,
    whereas the first array conttains ${s[0].length/h} times ${t[0]} quantities.`)}let e=[];for(let n=0;n<i;n++)for(let h=0;h<s.length;h++){let a=s[h],r=t[h];e.push(...a.slice(n*r,(n+1)*r))}return e}async function li(s){try{return await(await fetch(s)).text()}catch(t){throw new Error(`Failed to load code snippet from ${s}: ${t}`)}}return Jt(di);})();
/// @license MIT

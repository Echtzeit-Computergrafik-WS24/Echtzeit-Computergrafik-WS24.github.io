"use strict";var glance=(()=>{var It=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var fe=Object.getOwnPropertyNames;var le=Object.prototype.hasOwnProperty;var de=(e,t)=>{for(var s in t)It(e,s,{get:t[s],enumerable:!0})},Ee=(e,t,s,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of fe(t))!le.call(e,n)&&n!==s&&It(e,n,{get:()=>t[n],enumerable:!(i=ue(t,n))||i.enumerable});return e};var xe=e=>Ee(It({},"__esModule",{value:!0}),e);var bs={};de(bs,{AttachmentType:()=>it,AttributeDataType:()=>S,BlendEquation:()=>ct,BlendFunc:()=>tt,BufferUsage:()=>ft,CullFace:()=>Z,DepthTest:()=>J,DrawMode:()=>q,EPSILON:()=>H,FramebufferStack:()=>Ft,IndexDataType:()=>K,Mat3:()=>V,Mat4:()=>at,Profiler:()=>Ct,Quat:()=>ut,Rect:()=>Nt,RenderbufferInternalFormat:()=>Ot,ShaderStage:()=>xt,TextureCompareFunc:()=>rt,TextureDataTarget:()=>Q,TextureFilter:()=>L,TextureInternalFormat:()=>T,TextureSrcDataType:()=>N,TextureTarget:()=>B,TextureWrap:()=>nt,Vec2:()=>k,Vec3:()=>P,Vec4:()=>X,WebGLTimer:()=>St,clamp:()=>Y,copyCanvasToTexture:()=>ms,countDigits:()=>Re,createAttributeBuffer:()=>jt,createBPGeometry:()=>ls,createBox:()=>$t,createCanvasTexture:()=>_s,createCircularPlane:()=>es,createDrawCall:()=>dt,createFlatGeometry:()=>ds,createFramebuffer:()=>pe,createIndexBuffer:()=>qt,createPlane:()=>ts,createProgram:()=>lt,createRenderbuffer:()=>Ne,createScreenPass:()=>xs,createScreenQuad:()=>Gt,createShader:()=>_t,createSkybox:()=>Es,createSphere:()=>ss,createTexture:()=>ht,createTorusKnot:()=>is,createVertexArrayObject:()=>ot,degrees:()=>ye,draw:()=>ze,draw2DGrid:()=>ys,getBaricentricCoordinates:()=>rs,getContext:()=>Te,hex:()=>Ae,interleaveArrays:()=>Ms,isPowerOf2:()=>Me,loadCodeSnippet:()=>Rs,loadCubemap:()=>he,loadDataVolume:()=>fs,loadHDR:()=>Lt,loadObj:()=>pt,loadTexture:()=>Xt,mapRange:()=>we,mulberry32:()=>Ze,nextEven:()=>be,openSimplex2SHeightmap:()=>Je,radians:()=>_e,range:()=>me,repeat:()=>ae,resetContext:()=>Ue,slice:()=>As,uniquifyVertices:()=>as,updateFramebufferLayer:()=>Se,updateTextureData:()=>yt});function C(e){console.log(e())}function v(e){console.warn(e())}function M(e){throw new Error(e())}function g(e,t){if(!e)throw new Error(t?t():"Assertion failed.")}var Ts=async function(){}.constructor;function At(e,t){if(e===t)return!0;if(e===null||t===null||e===void 0||t===void 0||typeof e!=typeof t||typeof e!="object")return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!At(e[s],t[s]))return!1}else{let s=Object.keys(e);if(s.length!==Object.keys(t).length)return!1;for(let i of s)if(!At(e[i],t[i]))return!1}return!0}function W(e){if(typeof e!="object"||e===null)return e;let t,s,i=Object.prototype.toString.call(e);if(i==="[object Object]"){if(e.constructor!==Object&&typeof e.constructor=="function"){s=new e.constructor;for(t in e)e.hasOwnProperty(t)&&s[t]!==e[t]&&(s[t]=W(e[t]))}else{s={};for(t in e)t==="__proto__"?Object.defineProperty(s,t,{value:W(e[t]),configurable:!0,enumerable:!0,writable:!0}):s[t]=W(e[t])}return s}if(i==="[object Array]"){for(t=e.length,s=Array(t);t--;)s[t]=W(e[t]);return s}return i==="[object Set]"?(s=new Set,e.forEach(function(n){s.add(W(n))}),s):i==="[object Map]"?(s=new Map,e.forEach(function(n,h){s.set(W(h),W(n))}),s):i==="[object Date]"?new Date(+e):i==="[object RegExp]"?(s=new RegExp(e.source,e.flags),s.lastIndex=e.lastIndex,s):i==="[object DataView]"?new e.constructor(W(e.buffer)):i==="[object ArrayBuffer]"?e.slice(0):i.slice(-6)==="Array]"?new e.constructor(e):e}function Et(e){throw new Error(`Unexpected object: ${e}`)}var H=1e-7;function _e(e){return e*Math.PI/180}function ye(e){return e*180/Math.PI}function Y(e,t,s){return Math.min(Math.max(e,t),s)}function*me(e,t,s=1){e=Math.round(e),t===void 0?(t=e,e=0):t=Math.round(t),s=Math.max(1,Math.round(Math.abs(s)));let i=Math.sign(t-e)||1;for(;Math.sign(t-e)!==-i;)yield e,e+=s*i}function Ae(e){return e.toString(16).padStart(2,"0")}function Me(e){return Number.isInteger(e)&&(e&e-1)===0}function Re(e){return e===0?1:Math.floor(Math.log10(Math.abs(e)))+1}function be(e){return Math.ceil(e/2)*2}function we(e,t,s,i=0,n=1){return i+(e-t)/(s-t)*(n-i)}var xt;(function(e){e[e.VERTEX=35633]="VERTEX",e[e.FRAGMENT=35632]="FRAGMENT"})(xt||(xt={}));var it;(function(e){e[e.TEXTURE=1]="TEXTURE",e[e.RENDERBUFFER=2]="RENDERBUFFER"})(it||(it={}));var S;(function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV"})(S||(S={}));var K;(function(e){e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT"})(K||(K={}));var ft;(function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"})(ft||(ft={}));var B;(function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(B||(B={}));var Q;(function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(Q||(Q={}));var N;(function(e){e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.FLOAT=5126]="FLOAT"})(N||(N={}));var T;(function(e){e[e.R8=33321]="R8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.R8UI=33330]="R8UI",e[e.RG8=33323]="RG8",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.RG8UI=33336]="RG8UI",e[e.RGB8=32849]="RGB8",e[e.SRGB8=35905]="SRGB8",e[e.RGB565=36194]="RGB565",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGB16F=34843]="RGB16F",e[e.RGB32F=34837]="RGB32F",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA8=32856]="RGBA8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGBA4=32854]="RGBA4",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGBA16F=34842]="RGBA16F",e[e.RGBA32F=34836]="RGBA32F",e[e.RGBA8UI=36220]="RGBA8UI",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8"})(T||(T={}));var L;(function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(L||(L={}));var nt;(function(e){e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(nt||(nt={}));var rt;(function(e){e[e.NONE=0]="NONE",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(rt||(rt={}));var Ot;(function(e){e[e.RGBA4=32854]="RGBA4",e[e.RGB565=36194]="RGB565",e[e.RGB5_A1=32855]="RGB5_A1",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.R8=33321]="R8",e[e.R8UI=33330]="R8UI",e[e.R8I=33329]="R8I",e[e.R16UI=33332]="R16UI",e[e.R16I=33331]="R16I",e[e.R32UI=33334]="R32UI",e[e.R32I=33333]="R32I",e[e.RG8=33323]="RG8",e[e.RG8UI=33336]="RG8UI",e[e.RG8I=33335]="RG8I",e[e.RG16UI=33338]="RG16UI",e[e.RG16I=33337]="RG16I",e[e.RG32UI=33340]="RG32UI",e[e.RG32I=33339]="RG32I",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGBA16I=36232]="RGBA16I",e[e.RGBA32I=36226]="RGBA32I",e[e.RGBA32UI=36208]="RGBA32UI",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F"})(Ot||(Ot={}));var Z;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(Z||(Z={}));var J;(function(e){e[e.NONE=0]="NONE",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(J||(J={}));var tt;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(tt||(tt={}));var ct;(function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(ct||(ct={}));var q;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP"})(q||(q={}));function Te(e,t={}){let s=null;typeof e=="string"?(s=document.querySelector(`#${e}`),s==null&&M(()=>`Could not find canvas element with id "${e}"`)):e instanceof HTMLCanvasElement?s=e:M(()=>`Invalid canvas element "${e}"`);let i=s.id??"unnamed canvas",n=s.getContext("webgl2",{alpha:t.alpha??!0,depth:t.depth??!0,stencil:t.stencil??!1,antialias:t.antialias??!1,premultipliedAlpha:t.premultipliedAlpha??!1,preserveDrawingBuffer:t.preserveDrawingBuffer??!0,powerPreference:t.powerPreference??"high-performance",desynchronized:t.desynchronized??!0});return n===null&&M(()=>`Could not acquire a WebGL2 context from canvas "${i}"`),n.getExtension("EXT_color_buffer_float")===null&&v(()=>"Extension 'EXT_color_buffer_float' is not supported."),n.getExtension("OES_texture_float_linear")===null&&v(()=>"Extension 'OES_texture_float_linear' is not supported."),n.getExtension("EXT_float_blend")===null&&v(()=>"Extension 'EXT_float_blend' is not supported."),n.getExtension("EXT_texture_filter_anisotropic")===null&&v(()=>"Extension 'EXT_texture_filter_anisotropic' is not supported."),n.__glance={generation:1,shaders:new Map,programs:new Map,buffers:new Array,vaos:new Array,textures:new Array,renderbuffers:new Array,framebuffers:new Array},n}function _t(e,t,s,i){s!==e.VERTEX_SHADER&&s!==e.FRAGMENT_SHADER&&M(()=>`Invalid shader stage ${s} for shader "${t}"`);let n=s===e.VERTEX_SHADER?"vertex":"fragment";{let r=e.__glance.shaders.get(i);if(r){let c=r.object;return c.stage!==s&&M(()=>`Shader "${t}" already exists as a ${c.stage===e.VERTEX_SHADER?"vertex":"fragment"} shader.`),r.generation=e.__glance.generation,C(()=>`Reusing cached ${n} shader "${t}"`),c}}let h=e.createShader(s);if(h||M(()=>`Failed to create ${n} shader "${t}"`),e.shaderSource(h,i),e.compileShader(h),!e.getShaderParameter(h,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(h);e.deleteShader(h),M(()=>`Failed to compile ${n} shader "${t}": ${r}`)}let a={glo:h,name:t,stage:s,source:i};return C(()=>`Created ${n} shader "${t}"`),e.__glance.shaders.set(i,{object:a,generation:e.__glance.generation}),a}function lt(e,t,s,i,n){let h=`${typeof s=="string"?s:s.source}
${typeof i=="string"?i:i.source}`,a=e.__glance.programs.get(h);if(a)return a.generation=e.__glance.generation,n!==void 0&&Vt(e,a.object,n),C(()=>`Reusing cached program "${t}"`),a.object;let r=t.replace(/(-program|-shader)$/,"");typeof s=="string"?s=_t(e,`${r}-vertex`,e.VERTEX_SHADER,s):(!e.isShader(s.glo)||s.stage!==e.VERTEX_SHADER)&&M(()=>`Invalid vertex shader for program "${t}"`),typeof i=="string"?i=_t(e,`${r}-fragment`,e.FRAGMENT_SHADER,i):(!e.isShader(i.glo)||i.stage!==e.FRAGMENT_SHADER)&&M(()=>`Invalid fragment shader for program "${t}"`);let c=e.createProgram();c||M(()=>`Failed to create program "${t}"`),e.attachShader(c,s.glo),e.attachShader(c,i.glo),e.linkProgram(c);try{e.getProgramParameter(c,e.LINK_STATUS)||M(()=>`Failed to link shader program "${t}": ${e.getProgramInfoLog(c)}
Vertex Shader log: ${e.getShaderInfoLog(s.glo)}
Fragent Shader log: ${e.getShaderInfoLog(i.glo)}`);let o={name:t,vertex:s,fragment:i,glo:c,attributes:new Map,uniforms:new Map};return Ie(e,o),Vt(e,o,n??{}),C(()=>`Created program "${t}"`),e.__glance.programs.set(h,{object:o,generation:e.__glance.generation}),o}catch(o){throw e.deleteProgram(c),o}}function jt(e,t,s,i){i=i??ft.STATIC_DRAW;let n=new Map,h,a=0;for(let[l,u]of Object.entries(s)){let E={type:u.type??S.FLOAT,height:u.height,width:u.width??1,normalized:u.normalized,divisor:u.divisor},x=E.height*E.width;x===0&&M(()=>`Invalid size ${x} for Attribute "${l}" of ABO "${t}"`);let _=u.data.length/x;_===0&&M(()=>`The data for Attribute "${l}" of ABO "${t}" must not be empty.`),_%1!==0&&M(()=>`The data length for Attribute "${l}" of ABO "${t}" must be a multiple of the number of scalars required per attribute. Data length is ${u.data.length}, attribute length is ${x}.`),ge(E.type)&&(E.height!==3&&E.height!==4&&M(()=>`Attribute "${l}" of ABO "${t}" must have a height of 3 or 4 when using packed integer data.`),E.width!==1&&M(()=>`Attribute "${l}" of ABO "${t}" must have a width of 1 when using packed integer data.`)),h===void 0?h=_:h!==_&&M(()=>`Attribute buffer "${t}" has inconsistent vertex counts`),n.set(l,E),a+=x*Mt(E.type)}h===void 0&&M(()=>`Attribute Buffer "${t}" must have at least one attribute.`);let r=new ArrayBuffer(h*a),c=new DataView(r),o=new Map([[S.BYTE,c.setInt8.bind(c)],[S.UNSIGNED_BYTE,c.setUint8.bind(c)],[S.SHORT,c.setInt16.bind(c)],[S.UNSIGNED_SHORT,c.setUint16.bind(c)],[S.INT,c.setInt32.bind(c)],[S.UNSIGNED_INT,c.setUint32.bind(c)],[S.FLOAT,c.setFloat32.bind(c)],[S.HALF_FLOAT,(l,u)=>c.setUint16(l,$e(u),!0)]]),f=0;for(let[l,u]of n.entries()){let E=s[l].data,x=u.height*u.width,_=Mt(u.type),y=x*_,A=a-y,m=f,R=o.get(u.type);if(R)for(let b=0;b<E.length;b++)g(m<r.byteLength,()=>`Attribute "${l}" of ABO "${t}" is out of bounds.`),R(m,E[b],!0),m+=_,(b+1)%x===0&&(m+=A);else{let b;switch(u.type){case S.INT_2_10_10_10_REV:{b=Ge;break}case S.UNSIGNED_INT_2_10_10_10_REV:{b=Be;break}default:M(()=>`Unsupported data type for attribute "${l}" of buffer "${t}"`)}if(u.height===3)for(let w=0;w<E.length;w+=3)c.setUint32(m,b(E[w],E[w+1],E[w+2],1),!1),m+=A;else for(let w=0;w<E.length;w+=4)c.setUint32(m,b(E[w],E[w+1],E[w+2],E[w+3]),!1),m+=A}f+=y}let d=e.createBuffer();d||M(()=>`Failed to create attribute buffer "${t}"`);try{return e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,r,i),C(()=>`Created Attribute Buffer "${t}" with ${n.size} attributes for ${h} vertices and a size of ${r.byteLength} bytes.`),e.__glance.buffers.push(d),{glo:d,name:t,vertexCount:h,attributes:n,usage:i}}catch(l){throw e.deleteBuffer(d),l}finally{e.bindBuffer(e.ARRAY_BUFFER,null)}}function qt(e,t,s,i={}){let n=i.drawMode??q.TRIANGLES;switch(g(s.length>0,()=>`Index buffer "${t}" must have at least one index.`),n){case q.TRIANGLES:g(s.length%3===0,()=>`Size of Index buffer "${t}" with draw mode 'TRIANGLES' must be a multiple of 3.`);break;case q.TRIANGLE_STRIP:g(s.length>=3,()=>`Size of Index buffer "${t}" draw mode 'TRIANGLE_STRIP' must be at least 3.`);break;case q.LINES:g(s.length%2===0,()=>`Size of Index buffer "${t}" with draw mode 'LINES' must be a multiple of 2.`);break;case q.LINE_STRIP:g(s.length>=2,()=>`Size of Index buffer "${t}" with draw mode 'LINE_STRIP' must be at least 2.`);break;case q.LINE_LOOP:g(s.length>=2,()=>`Size of Index buffer "${t}" with draw mode 'LINE_LOOP' must be at least 2.`);break;case q.POINTS:break;default:M(()=>`Index buffer "${t}" has invalid draw mode: ${n}.`)}s.some(f=>!Number.isSafeInteger(f))&&M(()=>`Index buffer "${t}" must contain only (safe) integers.`);let h=0;for(let f of s)h=Math.max(h,f);let a;h<256?a=K.UNSIGNED_BYTE:h<65536?a=K.UNSIGNED_SHORT:h<4294967296?a=K.UNSIGNED_INT:M(()=>`Index ${h} does not fit in a 32-bit unsigned integer.`);let r;switch(a){case K.UNSIGNED_BYTE:r=new Uint8Array(s);break;case K.UNSIGNED_SHORT:r=new Uint16Array(s);break;case K.UNSIGNED_INT:r=new Uint32Array(s);break}let c=e.createBuffer();c||M(()=>`Failed to create index buffer "${t}"`);let o=i.usage??ft.STATIC_DRAW;try{return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,o),C(()=>`Created Index Buffer "${t}" with ${s.length} indices and a size of ${r.byteLength} bytes.`),e.__glance.buffers.push(c),{glo:c,name:t,type:a,size:s.length,usage:o,drawMode:n}}catch(f){throw e.deleteBuffer(c),f}finally{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}function ot(e,t,s,i,n){let h=t.replace(/-vao$/,"");Array.isArray(s)&&(s=qt(e,`${h}-ibo`,s)),Array.isArray(i)?i.length===0&&M(()=>`Need at least one Attribute Buffer for VAO "${t}"`):(i.hasOwnProperty("glo")||(i=jt(e,`${h}-abo`,i)),i=[i]);let a=e.createVertexArray();a||M(()=>`Failed to create VAO "${t}"`);let r=new Map;try{e.bindVertexArray(a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.glo);let c=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(let o of i){e.bindBuffer(e.ARRAY_BUFFER,o.glo);let f=ve(o),d=0;for(let[l,u]of o.attributes){let E=d;d+=Wt(u);let x=n.attributes.get(l);if(!x)continue;if(r.has(x.location)){let y=r.get(x.location).buffer;console.warn(`Ignoring attribute "${l}" in buffer "${o.name}" as the attribute is already bound to buffer "${y.name}".`);continue}r.set(x.location,{buffer:o,name:l});let _=u.height*Mt(u.type);for(let y=0;y<u.width;++y){let A=x.location+y;A>=c&&M(()=>`Attribute "${l}" of VAO "${t}" cannot be bound to location ${A}, because it would exceed the maximum number of vertex attributes (${c}).`);let m=E+y*_;e.enableVertexAttribArray(A),Oe(u.type)?e.vertexAttribIPointer(A,u.height,u.type,f,m):e.vertexAttribPointer(A,u.height,u.type,u.normalized||!1,f,m),e.vertexAttribDivisor(A,u.divisor||0)}}}return C(()=>`Created Vertex Array Object "${t}" with ${r.size} attributes.`),e.__glance.vaos.push(a),{glo:a,name:t,ibo:s,attributes:r}}catch(c){throw e.deleteVertexArray(a),c}finally{e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}function ht(e,t,s,i,n={}){let h=n.target??B.TEXTURE_2D;n.depth!==void 0&&(!Number.isSafeInteger(n.depth)||n.depth<1)&&M(()=>`Invalid depth ${n.depth} for texture "${t}"`);let a=n.depth??1,r=ke(h);h==B.TEXTURE_2D||h==B.TEXTURE_CUBE_MAP?(a!==1&&v(()=>`Ignoring given depth ${a} of ${r} texture "${t}".`),(s<1||i<1||!Number.isSafeInteger(s)||!Number.isSafeInteger(i))&&M(()=>`Invalid texture dimensions: ${s}x${i} of ${r} texture "${t}".`)):(s<1||i<1||a<1||!Number.isSafeInteger(s)||!Number.isSafeInteger(i)||!Number.isSafeInteger(a))&&M(()=>`Invalid texture dimensions: ${s}x${i}x${a} of ${r} texture "${t}".`);let c=Math.floor(Math.log2(Math.max(s,i,a)))+1;n.levels!==void 0&&((n.levels<1||!Number.isSafeInteger(n.levels))&&M(()=>`Invalid number of levels for ${r} texture "${t}": ${n.levels}.`),n.levels>c&&(v(()=>`Ignoring given number of levels for ${r} texture "${t}" because ${n.levels} is larger than the maximum possible number of levels ${c}.`),n.levels=c));let o=n.levels??c,f=n.internalFormat??T.RGBA8;n.compareFunc&&!We(f)&&(v(()=>`Ignoring given comparison function for ${r} texture "${t}" because it is not a depth texture.`),n.compareFunc=rt.NONE);let d=n.compareFunc??rt.NONE,l=e.createTexture();l===null&&M(()=>`Failed to create WebGL texture for ${r} texture "${t}"`);try{let u=n.wipTextureUnit??te(e,n.wipTextureUnit);if(e.activeTexture(e.TEXTURE0+u),e.bindTexture(h,l),a===1){if(e.texStorage2D(h,o,f,s,i),f===T.RGBA8){let m=new Uint8Array(s*i*4);if(h===B.TEXTURE_2D)e.texSubImage2D(h,0,0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,m);else for(let R=0;R<6;++R)e.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,0,0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,m);o>1&&e.generateMipmap(h)}d!==rt.NONE&&(e.texParameteri(h,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(h,e.TEXTURE_COMPARE_FUNC,d))}else e.texStorage3D(h,o,f,s,i,a);let E,x;n.filter===void 0?(o>1?E=L.LINEAR_MIPMAP_LINEAR:E=L.LINEAR,x=L.LINEAR):Array.isArray(n.filter)?(E=n.filter[0],x=n.filter[1]):(E=n.filter,x=n.filter),o===1&&([L.NEAREST,L.LINEAR].includes(E)||(v(()=>`Ignoring given minification filter for ${r} texture "${t}" because it has only one level.`),[L.NEAREST_MIPMAP_NEAREST,L.NEAREST_MIPMAP_LINEAR].includes(E)?E=L.NEAREST:E=L.LINEAR)),[L.NEAREST,L.LINEAR].includes(x)||(v(()=>`Ignoring given magnification filter for ${r} texture "${t}".`),[L.NEAREST_MIPMAP_NEAREST,L.NEAREST_MIPMAP_LINEAR].includes(x)?x=L.NEAREST:x=L.LINEAR),Ke(f)&&(![L.NEAREST,L.NEAREST_MIPMAP_NEAREST].includes(E)||x!==L.NEAREST)&&e.getExtension("OES_texture_float_linear")===null&&(v(()=>"Linear filtering for floating point textures is not supported on this system."),E=L.NEAREST,x=L.NEAREST),e.texParameteri(h,e.TEXTURE_MIN_FILTER,E),e.texParameteri(h,e.TEXTURE_MAG_FILTER,x);let _,y,A;if(n.wrap===void 0?(_=nt.CLAMP_TO_EDGE,y=nt.CLAMP_TO_EDGE,A=nt.CLAMP_TO_EDGE):Array.isArray(n.wrap)?(_=n.wrap[0],y=n.wrap[1],A=n.wrap[2]??nt.CLAMP_TO_EDGE,h===B.TEXTURE_2D&&n.wrap.length>2&&v(()=>`Ignoring given wrap R mode for ${r} texture "${t}" because it has only two dimensions.`)):(_=n.wrap,y=n.wrap,A=n.wrap),e.texParameteri(h,e.TEXTURE_WRAP_S,_),e.texParameteri(h,e.TEXTURE_WRAP_T,y),h!==B.TEXTURE_2D&&e.texParameteri(h,e.TEXTURE_WRAP_R,A),n.useAnisotropy||n.useAnisotropy===void 0&&o>1){let m=e.getExtension("EXT_texture_filter_anisotropic");m?e.texParameterf(h,m.TEXTURE_MAX_ANISOTROPY_EXT,e.getParameter(m.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):n.useAnisotropy&&v(()=>"Anisotropic filtering is not supported.")}return C(()=>`Created ${r} texture "${t}" with dimensions ${s}x${i}x${a} and ${o} levels.`),e.__glance.textures.push(l),{glo:l,name:t,target:h,width:s,height:i,depth:a,levels:o,internalFormat:f,compareFunc:d,attachmentType:it.TEXTURE}}catch(u){throw e.deleteTexture(l),u.message=`Failed to create ${r} texture "${t}": ${u.message}`,u}finally{e.bindTexture(h,null),e.activeTexture(e.TEXTURE0)}}function yt(e,t,s,i={}){i.dataTarget===void 0?t.target===B.TEXTURE_CUBE_MAP&&M(()=>`You need to specify an explicit target when updating a face of cube map texture "${t.name}".`):t.target===B.TEXTURE_CUBE_MAP&&(i.dataTarget>=Q.TEXTURE_CUBE_MAP_POSITIVE_X&&i.dataTarget<=Q.TEXTURE_CUBE_MAP_NEGATIVE_Z||M(()=>`Invalid data target '${i.dataTarget}' for cube map texture: "${t.name}".`));let n=i.dataTarget??t.target;i.level!==void 0&&(i.level<0||!Number.isSafeInteger(i.level))&&M(()=>`Invalid mipmap level: ${i.level}.`);let h=i.level??0,a=te(e,i.wipTextureUnit);i.srcDataType===void 0?ArrayBuffer.isView(s)?i.srcDataType=Ve(s):i.srcDataType=N.UNSIGNED_BYTE:ArrayBuffer.isView(s)?Ye(s,i.srcDataType):i.srcDataType!==N.UNSIGNED_BYTE&&M(()=>"When defining a texture with a 'TexImageSource', the source data type must be 'UNSIGNED_BYTE'");let r=i.srcDataType;je(t.internalFormat,r)||M(()=>`Invalid combination of internal format ${t.internalFormat} and source data type ${r}. See https://registry.khronos.org/webgl/specs/latest/2.0/#TEXTURE_TYPES_FORMATS_FROM_DOM_ELEMENTS_TABLE`);let c=qe(e,t.internalFormat),o=i.flipY??t.target===B.TEXTURE_2D,f=i.createMipMaps??t.levels>1;try{e.activeTexture(e.TEXTURE0+a),e.bindTexture(t.target,t.glo),o&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),t.depth>1?e.texSubImage3D(n,h,0,0,0,t.width,t.height,t.depth,c,r,s):e.texSubImage2D(n,h,0,0,t.width,t.height,c,r,s),f&&e.generateMipmap(t.target)}catch(d){throw d.message=`Failed to define texture "${t.name}": ${d.message}`,d}finally{e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)}}function Ne(e,t,s,i,n){(s<1||i<1||!Number.isSafeInteger(s)||!Number.isSafeInteger(i))&&M(()=>`Invalid renderbuffer dimensions: ${s}x${i} of renderbuffer "${t}".`),n===void 0&&M(()=>`Missing internal format for renderbuffer "${t}".`);let h=e.getParameter(e.MAX_RENDERBUFFER_SIZE);(s>h||i>h)&&M(()=>`Renderbuffer "${t}" exceeds the maximum renderbuffer size of ${h}.`);let a=e.createRenderbuffer();a===null&&M(()=>`Failed to create a new WebGL renderbuffer object for "${t}".`);try{return e.bindRenderbuffer(e.RENDERBUFFER,a),e.renderbufferStorage(e.RENDERBUFFER,n,s,i),C(()=>`Created Renderbuffer "${t}" with dimensions ${s}x${i} and internal format ${n}.`),e.__glance.renderbuffers.push(a),{glo:a,name:t,width:s,height:i,internalFormat:n,attachmentType:it.RENDERBUFFER}}catch(r){throw e.deleteRenderbuffer(a),r}finally{e.bindRenderbuffer(e.RENDERBUFFER,null)}}function pe(e,t,s=null,i=null,n=null){let h=u=>Object.hasOwn(u,"attachmentType"),a=(Array.isArray(s)?s:s===null?[]:[s]).map(u=>h(u)?{attachment:u}:u),r=i===null?null:h(i)?{attachment:i}:i,c=n===null?null:h(n)?{attachment:n}:n,o=e.getParameter(e.MAX_COLOR_ATTACHMENTS);a.length>o&&M(()=>`Framebuffer "${t}" has ${a.length} color attachments, but the maximum is ${o}.`);let f;for(let u=0;u<a.length;++u){let E=a[u].attachment;f===void 0?f=[E.width,E.height]:(E.width!==f[0]||E.height!==f[1])&&M(()=>`Framebuffer "${t}" has color attachments with different dimensions.`)}if(r!==null){let u=r.attachment;f===void 0?f=[u.width,u.height]:(u.width!==f[0]||u.height!==f[1])&&M(()=>`Framebuffer "${t}" has color/depth attachments with different dimensions.`)}let d=e.createFramebuffer();d===null&&M(()=>`Failed to create a new WebGL framebuffer object for "${t}".`);function l(u,E){let x=E===e.DEPTH_ATTACHMENT?"depth":`color[${E-e.COLOR_ATTACHMENT0}]`;if(u.attachment.attachmentType===it.TEXTURE){let _=u.attachment;if(_.target===B.TEXTURE_2D)(u.target??Q.TEXTURE_2D)!==Q.TEXTURE_2D&&v(()=>`Ignoring the target "${u.target}" for ${x} attachment of framebuffer "${t}", using 'gl.TEXTURE_2D' instead.`),e.framebufferTexture2D(e.FRAMEBUFFER,E,e.TEXTURE_2D,_.glo,u.level??0);else if(_.target===B.TEXTURE_CUBE_MAP)u.target===void 0&&M(()=>`Missing target for cubemap ${x} attachment of framebuffer "${t}".`),u.target>=Q.TEXTURE_CUBE_MAP_POSITIVE_X&&u.target<=Q.TEXTURE_CUBE_MAP_NEGATIVE_Z||M(()=>`Invalid data target for cube map texture: ${u.target}.`),e.framebufferTexture2D(e.FRAMEBUFFER,E,u.target,_.glo,u.level??0);else{if(u.target??_.target!==_.target){let y=_.target===B.TEXTURE_2D_ARRAY?"gl.TEXTURE_2D_ARRAY":"gl.TEXTURE_3D";v(()=>`Ignoring the target "${u.target}" for ${x} attachment of framebuffer "${t}", using ${y} instead.`)}if(u.layer===void 0){let y=_.target===B.TEXTURE_2D_ARRAY?"2D array":"3D";v(()=>`Missing layer for ${x} attachment (which is a ${y} texture) of framebuffer "${t}", using layer 0 by default.`)}e.framebufferTextureLayer(e.FRAMEBUFFER,E,_.glo,u.level??0,u.layer??0)}}else{let _=u.attachment;u.level!==void 0&&v(()=>`Ignoring given level ${u.level} for renderbuffer ${x} attachment of framebuffer "${t}".`),u.target!==void 0&&v(()=>`Ignoring given target ${u.target} for renderbuffer ${x} attachment of framebuffer "${t}".`),e.framebufferRenderbuffer(e.FRAMEBUFFER,E,e.RENDERBUFFER,_.glo)}}try{if(e.bindFramebuffer(e.FRAMEBUFFER,d),a.length===0)e.drawBuffers([e.NONE]),e.readBuffer(e.NONE);else{let E=[];for(let x=0;x<a.length;++x){let _=e.COLOR_ATTACHMENT0+x;l(a[x],_),E.push(_)}e.drawBuffers(E)}r!==null&&l(r,e.DEPTH_ATTACHMENT),c!==null&&M(()=>"Stencil attachments are not supported yet.");let u=e.checkFramebufferStatus(e.FRAMEBUFFER);return u!==e.FRAMEBUFFER_COMPLETE&&M(()=>{switch(u){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return`Incomplete framebuffer '${t}'! One or more framebuffer attachment points are incomplete.`;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return`Incomplete framebuffer '${t}'! One or more of the framebuffer attachment's dimensions are not the same.`;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return`Incomplete framebuffer '${t}'! No images are attached to the framebuffer.`;case e.FRAMEBUFFER_UNSUPPORTED:return`Incomplete framebuffer '${t}'! The combination of internal formats of the attached images violates an implementation-dependent set of restrictions.`;case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return`Incomplete framebuffer '${t}'! The value of GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES is not the same for all attached textures.`;default:return`Incomplete framebuffer '${t}'! Unknown error code ${u}.`}}),r!==null?c!==null?C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments, and a depth- and stencil attachment.`):C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments and a depth attachment.`):c!==null?C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments and a stencil attachment.`):C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments.`),e.__glance.framebuffers.push(d),{glo:d,name:t,color:a,depth:r,stencil:c}}catch(u){throw e.deleteFramebuffer(d),u.message=`Failed to define framebuffer "${t}": ${u.message}`,u}finally{e.bindFramebuffer(e.FRAMEBUFFER,null)}}function Se(e,t,s,i,n=0){let h,a;switch(s){case e.DEPTH_ATTACHMENT:h=t.depth??M(()=>`Framebuffer "${t.name}" has no depth attachment.`),a="depth";break;case e.STENCIL_ATTACHMENT:h=t.stencil??M(()=>`Framebuffer "${t.name}" has no stencil attachment.`),a="stencil";break;default:h=t.color[s-e.COLOR_ATTACHMENT0]??M(()=>`Framebuffer "${t.name}" has no color attachment at location ${s}.`),a=`color[${s-e.COLOR_ATTACHMENT0}]`}if(h.layer===i&&h.level===(n??h.level))return;h.attachment.attachmentType!==it.TEXTURE&&M(()=>`Framebuffer "${t.name}" has no texture as its ${a} attachment, but a renderbuffer.`);let r=h.attachment;if(r.target!==B.TEXTURE_2D_ARRAY&&r.target!==B.TEXTURE_3D){let o=r.target===B.TEXTURE_2D?"2D":"cubemap";M(()=>`Framebuffer "${t.name}" has no 3D or 2D array texture as its ${a} attachment, but a ${o} texture.`)}(i<0||i>=r.depth)&&M(()=>`Invalid layer ${i} for ${a} attachment of framebuffer "${t.name}", which has a depth of ${r.depth}.`);let c=e.getParameter(e.FRAMEBUFFER_BINDING);try{e.bindFramebuffer(e.FRAMEBUFFER,t.glo),e.framebufferTextureLayer(e.FRAMEBUFFER,s,r.glo,n??h.level??0,i)}finally{e.bindFramebuffer(e.FRAMEBUFFER,c)}}function dt(e,t,s,i,n={}){Object.hasOwn(s,"glo")||(s=ot(e,`${t}-vao`,s.ibo,s.attributes,i)),s=s,n.indexCount!==void 0&&n.indexCount<=0&&M(()=>`Invalid index count: ${n.indexCount}.`),n.indexOffset!==void 0&&(n.indexOffset<0&&M(()=>`Invalid index offset: ${n.indexOffset}.`),n.indexOffset=Math.ceil(n.indexOffset));let h=n.indexCount??s.ibo.size,a=n.indexOffset??0;a+h>s.ibo.size&&M(()=>`Index offset ${a} and count ${h} exceed the size of the index buffer (${s.ibo.size}).`),n.instances!==void 0&&(n.instances<=0&&M(()=>`Instance count cannot be <= 0, is: ${n.instances}.`),Number.isSafeInteger(n.instances)||v(()=>`Instance count is not an integer, is: ${n.instances}.`),n.instances=Math.ceil(n.instances));for(let[r,c]of i.attributes.entries()){let o=s.attributes.get(c.location);o===void 0&&M(()=>`VAO "${s.name}" does not provide an attribute for "${r}" (at location ${c.location}) of shader program "${i.name}"!`);let f=o.buffer.attributes.get(o.name);f===void 0&&M(()=>`Missing attribute "${o.name}" in VBO "${o.buffer.name}"!`),De(f,c.type)||M(()=>{let d=Pe(f);return`Attribute "${o.name}" in VBO "${o.buffer.name}" has type '${d}' but shader program "${i.name}" expects type '${c.type} at location ${c.location}'!`}),r!=o.name&&v(()=>`Attribute "${r}" of shader program "${i.name}" at location ${c.location} is bound to attribute "${o.name}" in VBO "${o.buffer.name}"!`)}n.uniforms===void 0&&(n.uniforms={}),n.textures===void 0&&(n.textures={});for(let[r,c]of Object.entries(n.uniforms)){let o=i.uniforms.get(r);if(o===void 0){v(()=>`Uniform "${r}" of Draw Call "${t}" not found in shader program "${i.name}"!`);continue}Rt(o.type)&&typeof c!="number"&&(c?.attachmentType!==it.TEXTURE&&M(()=>`Uniform "${r}" is not a texture or a number.`),n.textures[r]=c,delete n.uniforms[r])}for(let r of Object.keys(n.textures??{}))i.uniforms.has(r)||v(()=>`Sampler Uniform "${r}" of Draw Call "${t}" not found in shader program "${i.name}"!`);return{name:t,vao:s,program:i,indexCount:h,indexOffset:a,drawMode:n.drawModeOverride??s.ibo.drawMode,instances:n.instances??1,uniform:n.uniforms,textures:n.textures,cullFace:n.cullFace,depthTest:n.depthTest,blendFunc:n.blendFunc,blendEquation:n.blendEquation,updateDepthBuffer:n.updateDepthBuffer}}function ze(e,t){let s=t.vao,i=t.program,n=!0,h=!0;try{e.bindVertexArray(s.glo),e.useProgram(i.glo),t.cullFace!==void 0&&(t.cullFace===Z.NONE?e.disable(e.CULL_FACE):(e.enable(e.CULL_FACE),e.cullFace(t.cullFace))),t.depthTest!==void 0&&(t.depthTest===J.NONE?e.disable(e.DEPTH_TEST):(e.enable(e.DEPTH_TEST),e.depthFunc(t.depthTest))),t.blendFunc!==void 0&&(t.blendFunc.length===2?(t.blendFunc[0]!==tt.ONE||t.blendFunc[1]!==tt.ZERO)&&(e.enable(e.BLEND),e.blendFunc(t.blendFunc[0],t.blendFunc[1]),n=!1):t.blendFunc.length===4?(t.blendFunc[0]!==tt.ONE||t.blendFunc[1]!==tt.ZERO&&t.blendFunc[2]!==tt.ONE||t.blendFunc[3]!==tt.ZERO)&&(e.enable(e.BLEND),e.blendFuncSeparate(t.blendFunc[0],t.blendFunc[1],t.blendFunc[2],t.blendFunc[3]),n=!1):M(()=>`Invalid blend function array length: ${t.blendFunc.length}.`)),t.blendEquation!==void 0&&(Array.isArray(t.blendEquation)?(t.blendEquation[0]!==ct.FUNC_ADD||t.blendEquation[1]!==ct.FUNC_ADD)&&(n&&e.enable(e.BLEND),e.blendEquationSeparate(t.blendEquation[0],t.blendEquation[1]),h=!1):t.blendEquation!==ct.FUNC_ADD&&(n&&e.enable(e.BLEND),e.blendEquation(t.blendEquation),h=!1)),t.updateDepthBuffer!==void 0&&e.depthMask(t.updateDepthBuffer);for(let[r,c]of Object.entries(t.uniform)){let o=i.uniforms.get(r);o||M(()=>`Uniform "${r}" not found in program "${i.name}"`),At(o.value,c)||(o.value=W(c),Jt(e,o))}{let r=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),c=new Map;for(let[o,f]of Object.entries(t.textures)){let d=i.uniforms.get(o);d||M(()=>`Sampler Uniform "${o}" not found in program "${i.name}"`),Rt(d.type)||M(()=>`Uniform "${o}" in program "${i.name}" is not a sampler.`);let l=d.value;(l===void 0||typeof l!="number"||!Number.isSafeInteger(l))&&M(()=>`Value of Uniform "${o}" in program "${i.name}" is not a texture unit.`),(l<0||l>=r)&&M(()=>`Invalid texture unit ${l} for uniform "${o}" in program "${i.name}".`);let u=c.get(l)||{};switch(e.activeTexture(e.TEXTURE0+l),f.target){case B.TEXTURE_2D:{u.texture_2d!==void 0&&M(()=>`Texture unit ${l} is already used by another 2D texture.`),e.bindTexture(e.TEXTURE_2D,f.glo),u.texture_2d=f;break}case B.TEXTURE_3D:{u.texture_3d!==void 0&&M(()=>`Texture unit ${l} is already used by another 3D texture.`),e.bindTexture(e.TEXTURE_3D,f.glo),u.texture_3d=f;break}case B.TEXTURE_CUBE_MAP:{u.texture_cube!==void 0&&M(()=>`Texture unit ${l} is already used by another cube map texture.`),e.bindTexture(e.TEXTURE_CUBE_MAP,f.glo),u.texture_cube=f;break}case B.TEXTURE_2D_ARRAY:{u.texture_2d_array!==void 0&&M(()=>`Texture unit ${l} is already used by another 2D array texture.`),e.bindTexture(e.TEXTURE_2D_ARRAY,f.glo),u.texture_2d_array=f;break}default:Et(f.target)}c.set(l,u)}}let a=t.instances??1;(isNaN(a)||!isFinite(a)||a<1)&&M(()=>`Invalid instance count: ${a}.`),a=Math.ceil(a),a==1?e.drawElements(t.drawMode,t.indexCount,t.vao.ibo.type,t.indexOffset):e.drawElementsInstanced(t.drawMode,t.indexCount,t.vao.ibo.type,t.indexOffset,a)}finally{Object.keys(t.textures).length>0&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_3D,null),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)),t.updateDepthBuffer!==void 0&&e.depthMask(!0),(!n||!h)&&(e.disable(e.BLEND),n||e.blendFunc(e.ONE,e.ZERO),h||e.blendEquation(e.FUNC_ADD)),t.depthTest!==void 0&&(e.depthFunc(e.ALWAYS),e.disable(e.DEPTH_TEST)),t.cullFace!==void 0&&(e.cullFace(e.BACK),e.disable(e.CULL_FACE)),e.useProgram(null),e.bindVertexArray(null)}}function Ue(e,t=0){let s=!1,i=e.__glance.generation-t,n=(u,E)=>{let x=0;for(let[_,y]of u.entries())y.generation<=i&&(E(y.object),u.delete(_),x++,s=!0);return x},h=(u,E)=>{let x=u.length;for(let _=0;_<x;++_)E(u[_]),s=!0;return u.length=0,x},a=n(e.__glance.shaders,u=>e.deleteShader(u.glo)),r=n(e.__glance.programs,u=>e.deleteProgram(u.glo)),c=h(e.__glance.buffers,u=>e.deleteBuffer(u)),o=h(e.__glance.vaos,u=>e.deleteVertexArray(u)),f=h(e.__glance.textures,u=>e.deleteTexture(u)),d=h(e.__glance.renderbuffers,u=>e.deleteRenderbuffer(u)),l=h(e.__glance.framebuffers,u=>e.deleteFramebuffer(u));if(s){let u=`Cleaned up WebGL resources:
`;a>0&&(u+=` - ${a} shader${a>1?"s":""}
`),r>0&&(u+=` - ${r} program${r>1?"s":""}
`),c>0&&(u+=` - ${c} buffer${c>1?"s":""}
`),o>0&&(u+=` - ${o} VAO${o>1?"s":""}
`),f>0&&(u+=` - ${f} texture${f>1?"s":""}
`),d>0&&(u+=` - ${d} renderbuffer${d>1?"s":""}
`),l>0&&(u+=` - ${l} framebuffer${l>1?"s":""}
`),C(()=>u.slice(0,-1))}e.__glance.generation+=1,Qe(e)}function Ie(e,t){let s=/^\s*(?:layout\s*\(location\s*=\s*(?<location>\d+)\)\s*)?in\s+(?:(?<precision>lowp|mediump|highp)\s+)?(?<type>\w+)\s+(?<name>\w+)\s*;/gm;if(t.attributes.size>0){v(()=>`Attributes of shader program "${t.name}" are already defined.`);return}let i;for(;(i=s.exec(t.vertex.source))!==null;){let{name:n,type:h,location:a,precision:r}=i.groups,c=e.getAttribLocation(t.glo,n);c<0||(a!==void 0&&c!==parseInt(a)&&v(()=>`Vertex shader of shader program "${n}" specifies the location of attribute "${n}" to be ${a}, but it was found at ${c}.`),(n.startsWith("webgl_")||n.startsWith("_webgl_"))&&M(()=>`Attribute name "${n}" is reserved by WebGL.`),t.attributes.set(n,{type:h,location:c,precision:r}))}}function Oe(e){switch(e){case S.BYTE:case S.UNSIGNED_BYTE:case S.SHORT:case S.UNSIGNED_SHORT:case S.INT:case S.UNSIGNED_INT:return!0;default:return!1}}function ge(e){switch(e){case S.INT_2_10_10_10_REV:case S.UNSIGNED_INT_2_10_10_10_REV:return!0;default:return!1}}function Mt(e){switch(e){case S.BYTE:case S.UNSIGNED_BYTE:return 1;case S.SHORT:case S.UNSIGNED_SHORT:case S.HALF_FLOAT:return 2;case S.INT:case S.UNSIGNED_INT:case S.FLOAT:case S.INT_2_10_10_10_REV:case S.UNSIGNED_INT_2_10_10_10_REV:return 4;default:Et(e)}}function Wt(e){return Mt(e.type)*e.height*e.width}function ve(e){let t=0;for(let s of e.attributes.values())t+=Wt(s);return t}function De(e,t){switch(e.type){case S.BYTE:case S.UNSIGNED_BYTE:case S.SHORT:case S.UNSIGNED_SHORT:case S.INT:case S.UNSIGNED_INT:switch(t){case"int":case"uint":return e.height===1&&e.width===1;case"ivec2":case"uvec2":return e.height===2&&e.width===1;case"ivec3":case"uvec3":return e.height===3&&e.width===1;case"ivec4":case"uvec4":return e.height===4&&e.width===1;default:return!1}case S.INT_2_10_10_10_REV:return t==="int";case S.UNSIGNED_INT_2_10_10_10_REV:return t==="uint";case S.FLOAT:case S.HALF_FLOAT:switch(t){case"float":return e.height===1&&e.width===1;case"vec2":return e.height===2&&e.width===1;case"vec3":return e.height===3&&e.width===1;case"vec4":return e.height===4&&e.width===1;case"mat2":case"mat2x2":return e.height===2&&e.width===2;case"mat2x3":return e.height===3&&e.width===2;case"mat2x4":return e.height===4&&e.width===2;case"mat3x2":return e.height===2&&e.width===3;case"mat3":case"mat3x3":return e.height===3&&e.width===3;case"mat3x4":return e.height===4&&e.width===3;case"mat4x2":return e.height===2&&e.width===4;case"mat4x3":return e.height===3&&e.width===4;case"mat4":case"mat4x4":return e.height===4&&e.width===4;default:return!1}default:Et(e.type)}}function Pe(e){switch(e.type){case S.BYTE:case S.SHORT:case S.INT:switch(e.width){case 1:switch(e.height){case 1:return"int";case 2:return"ivec2";case 3:return"ivec3";case 4:return"ivec4"}}break;case S.INT_2_10_10_10_REV:return"int";case S.UNSIGNED_INT_2_10_10_10_REV:return"uint";case S.UNSIGNED_BYTE:case S.UNSIGNED_SHORT:case S.UNSIGNED_INT:switch(e.width){case 1:switch(e.height){case 1:return"uint";case 2:return"uvec2";case 3:return"uvec3";case 4:return"uvec4"}}break;case S.FLOAT:case S.HALF_FLOAT:switch(e.width){case 1:switch(e.height){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}break;case 2:switch(e.height){case 2:return"mat2";case 3:return"mat2x3";case 4:return"mat2x4"}break;case 3:switch(e.height){case 2:return"mat3x2";case 3:return"mat3";case 4:return"mat3x4"}break;case 4:switch(e.height){case 2:return"mat4x2";case 3:return"mat4x3";case 4:return"mat4"}break}}M(()=>`Invalid attribute type: ${e.type} with a size of ${e.height} and a width of ${e.width}.`)}function $e(e){let t=new Float32Array(1),s=new Uint16Array(t.buffer);t[0]=e;let i=s[1]<<16|s[0],n=i>>31<<15,h=(i>>23&255)-127+15,a=i&8388607;return h<0?(h=0,a=(a|8388608)>>1-h):h>31&&(h=31,a=0),n|h<<10|a>>13}function Ge(e,t,s,i){return Y(Math.round(i),0,3)<<30|Y(Math.round(s),0,1023)<<20|Y(Math.round(t),0,1023)<<10|Y(Math.round(e),0,1023)}function Be(e,t,s,i){return Math.sign(i)<<31|Y(Math.round(Math.abs(i)),0,1)<<30|Math.sign(s)<<29|Y(Math.round(Math.abs(s)),0,511)<<20|Math.sign(t)<<19|Y(Math.round(Math.abs(t)),0,511)<<10|Math.sign(e)<<9|Y(Math.round(Math.abs(e)),0,511)}function Vt(e,t,s){let i=/^\s*uniform\s+(?<precision>lowp|mediump|highp)?\s*(?<type>\w+)\s+(?<name>\w+)(?:\s*\[\s*(?<sizeString>\d+)\s*\])?\s*;/gm;t.uniforms.clear();let n=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),h=[],a=new Set,r;for(let c of[t.vertex.source,t.fragment.source])for(;(r=i.exec(c))!==null;){let{name:o,type:f,precision:d,sizeString:l}=r.groups;if(t.uniforms.has(o))continue;let u=e.getUniformLocation(t.glo,o);if(!u)continue;let E=l?parseInt(l):1,x=s[o];if(x===void 0){if(Rt(f)){h.push([o,{type:f,location:u,size:E,value:x,precision:d}]);continue}x=Le(f,E)}else Rt(f)&&((typeof x!="number"||!Number.isSafeInteger(x)||x<0||x>=n)&&M(()=>`Invalid texture unit id: ${x}. Valid range is [0, ${n}).`),a.add(x));t.uniforms.set(o,{type:f,location:u,size:E,value:x,precision:d})}for(let[c,o]of h){let f=0;for(;a.has(f);)f++,f>=n&&M(()=>`No more texture units available for sampler "${c}".`);a.add(f),o.value=f,C(()=>`Auto-assigning texture sampler "${c}" to texture unit ${f}.`),t.uniforms.set(c,o)}try{e.useProgram(t.glo);for(let c of t.uniforms.values())Jt(e,c)}finally{e.useProgram(null)}}function Rt(e){return e.indexOf("sampler")!==-1}function Le(e,t){let s;switch(e){case"float":case"int":case"uint":case"bool":case"sampler2D":case"sampler2DArray":case"samplerCube":case"sampler3D":case"isampler2D":case"isampler2DArray":case"isamplerCube":case"isampler3D":case"usampler2D":case"usampler2DArray":case"usamplerCube":case"usampler3D":case"sampler2DShadow":case"sampler2DArrayShadow":case"samplerCubeShadow":s=0;break;case"vec2":case"ivec2":case"uvec2":case"bvec2":s=[0,0];break;case"vec3":case"ivec3":case"uvec3":case"bvec3":s=[0,0,0];break;case"vec4":case"ivec4":case"uvec4":case"bvec4":s=[0,0,0,0];break;case"mat2":case"mat2x2":s=[1,0,0,1];break;case"mat3":case"mat3x3":s=[1,0,0,0,1,0,0,0,1];break;case"mat4":case"mat4x4":s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];break;case"mat2x3":s=[1,0,0,1,0,0];break;case"mat2x4":s=[1,0,0,1,0,0,0,0];break;case"mat3x2":s=[1,0,0,0,1,0];break;case"mat3x4":s=[1,0,0,0,1,0,0,0,1,0,0,0];break;case"mat4x2":s=[1,0,0,0,0,1,0,0];break;case"mat4x3":s=[1,0,0,0,0,1,0,0,0,0,1,0];break;default:Et(e)}return t===1?s:Array(t).fill(s).flat()}var Kt=e=>typeof e=="number",bt=e=>Number.isSafeInteger(e),Qt=e=>bt(e)&&e>=0,Zt=e=>typeof e=="boolean"||bt(e)&&(e===0||e===1),wt=e=>Array.isArray(e)||ArrayBuffer.isView(e),j=(e,t)=>wt(e.value)&&e.value.length==t*e.size&&e.value.every(s=>Kt(s)),gt=(e,t)=>wt(e.value)&&e.value.length==t*e.size&&e.value.every(s=>Zt(s)),vt=(e,t)=>wt(e.value)&&e.value.length==t*e.size&&e.value.every(s=>bt(s)),Dt=(e,t)=>wt(e.value)&&e.value.length==t*e.size&&e.value.every(s=>Qt(s)),Fe=e=>(e.value.isVec2??!1)||j(e,2),Ce=e=>(e.value.isVec3??!1)||j(e,3),Xe=e=>(e.value.isMat3??!1)||j(e,9),He=e=>(e.value.isMat4??!1)||j(e,16),F=(e,t,s)=>`Value of uniform must be an array of ${t*e.size} ${s}s, but is: ${JSON.stringify(e.value)}.`;function Jt(e,t){switch(t.type){case"float":return g(Kt(t.value),()=>"Value of uniform must be a number!"),e.uniform1f(t.location,t.value);case"vec2":return g(Fe(t),()=>F(t,2,"number")),e.uniform2fv(t.location,t.value);case"vec3":return g(Ce(t),()=>F(t,3,"number")),e.uniform3fv(t.location,t.value);case"vec4":return g(j(t,4),()=>F(t,4,"number")),e.uniform4fv(t.location,t.value);case"mat2":case"mat2x2":return g(j(t,4),()=>F(t,4,"number")),e.uniformMatrix2fv(t.location,!1,t.value);case"mat3":case"mat3x3":return g(Xe(t),()=>F(t,9,"number")),e.uniformMatrix3fv(t.location,!1,t.value);case"mat4":case"mat4x4":return g(He(t),()=>F(t,16,"number")),e.uniformMatrix4fv(t.location,!1,t.value);case"int":case"sampler2D":case"sampler2DArray":case"samplerCube":case"sampler3D":case"isampler2D":case"isampler2DArray":case"isamplerCube":case"isampler3D":case"usampler2D":case"usampler2DArray":case"usamplerCube":case"usampler3D":case"sampler2DShadow":case"sampler2DArrayShadow":case"samplerCubeShadow":return g(bt(t.value),()=>"Value of uniform must be an integer!"),e.uniform1i(t.location,t.value);case"uint":return g(Qt(t.value),()=>"Value of uniform must be a positive integer!"),e.uniform1ui(t.location,t.value);case"bool":return g(Zt(t.value),()=>"Value of uniform must be a boolean, zero or one!"),e.uniform1i(t.location,t.value?1:0);case"mat2x3":return g(j(t,6),()=>F(t,6,"number")),e.uniformMatrix2x3fv(t.location,!1,t.value);case"mat3x2":return g(j(t,6),()=>F(t,6,"number")),e.uniformMatrix3x2fv(t.location,!1,t.value);case"mat2x4":return g(j(t,8),()=>F(t,8,"number")),e.uniformMatrix2x4fv(t.location,!1,t.value);case"mat4x2":return g(j(t,8),()=>F(t,8,"number")),e.uniformMatrix4x2fv(t.location,!1,t.value);case"mat3x4":return g(j(t,12),()=>F(t,12,"number")),e.uniformMatrix3x4fv(t.location,!1,t.value);case"mat4x3":return g(j(t,12),()=>F(t,12,"number")),e.uniformMatrix4x3fv(t.location,!1,t.value);case"ivec2":return g(vt(t,2),()=>F(t,2,"integer")),e.uniform2iv(t.location,t.value);case"ivec3":return g(vt(t,3),()=>F(t,3,"integer")),e.uniform3iv(t.location,t.value);case"ivec4":return g(vt(t,4),()=>F(t,4,"integer")),e.uniform4iv(t.location,t.value);case"uvec2":return g(Dt(t,2),()=>F(t,2,"positive integer")),e.uniform2uiv(t.location,t.value);case"uvec3":return g(Dt(t,3),()=>F(t,3,"positive integer")),e.uniform3uiv(t.location,t.value);case"uvec4":return g(Dt(t,4),()=>F(t,4,"positive integer")),e.uniform4uiv(t.location,t.value);case"bvec2":return g(gt(t,2),()=>F(t,2,"boolean")),e.uniform2iv(t.location,t.value);case"bvec3":return g(gt(t,3),()=>F(t,3,"boolean")),e.uniform3iv(t.location,t.value);case"bvec4":return g(gt(t,4),()=>F(t,4,"boolean")),e.uniform4iv(t.location,t.value);default:M(()=>`Unsupported uniform type "${t.type}"`)}}function ke(e){switch(e){case B.TEXTURE_2D:return"2D";case B.TEXTURE_3D:return"3D";case B.TEXTURE_CUBE_MAP:return"cubemap";case B.TEXTURE_2D_ARRAY:return"2D array"}}function te(e,t){let s=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);return t===void 0?s-1:(t<0&&M(()=>`WIP texture unit cannot be negative, got: ${t}.`),t>=s&&M(()=>`Invalid WIP texture unit: ${t}, maximal texture unit available is ${s-1}.`),t)}function Ve(e){if(e instanceof Uint8Array)return N.UNSIGNED_BYTE;if(e instanceof Uint16Array)return N.UNSIGNED_SHORT;if(e instanceof Uint32Array)return N.UNSIGNED_INT;if(e instanceof Float32Array)return N.FLOAT;e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array?M(()=>"Signed integer buffers are not supported when defining a texture."):M(()=>`Invalid data type: ${e.constructor.name}.`)}function Ye(e,t){e instanceof Uint8Array?t!==N.UNSIGNED_BYTE&&M(()=>"When defining a texture with a 'Uint8Array', the source data type must be 'UNSIGNED_BYTE'"):e instanceof Uint8ClampedArray?t!==N.UNSIGNED_BYTE&&M(()=>"When defining a texture with a 'Uint8ClampedArray'source data type must be 'UNSIGNED_BYTE'"):e instanceof Float32Array?t!==N.FLOAT&&M(()=>"When defining a texture with a 'Float32Array', the source data type must be 'FLOAT'"):e instanceof Uint16Array?[N.UNSIGNED_SHORT,N.UNSIGNED_SHORT_5_6_5,N.UNSIGNED_SHORT_5_5_5_1,N.UNSIGNED_SHORT_4_4_4_4,N.HALF_FLOAT].includes(t)||M(()=>"When defining a texture with a 'Uint16Array', the source data type must be one of 'UNSIGNED_SHORT', 'UNSIGNED_SHORT_5_6_5', 'UNSIGNED_SHORT_5_5_5_1', 'UNSIGNED_SHORT_4_4_4_4', or 'HALF_FLOAT'"):e instanceof Uint32Array?[N.UNSIGNED_INT,N.UNSIGNED_INT_5_9_9_9_REV,N.UNSIGNED_INT_2_10_10_10_REV,N.UNSIGNED_INT_10F_11F_11F_REV,N.UNSIGNED_INT_24_8].includes(t)||M(()=>"When defining a texture with a 'Uint32Array', the source data type must be one of 'UNSIGNED_INT', 'UNSIGNED_INT_5_9_9_9_REV', 'UNSIGNED_INT_2_10_10_10_REV', 'UNSIGNED_INT_10F_11F_11F_REV', or'UNSIGNED_INT_24_8'"):e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array?M(()=>"Signed integer buffers are not supported when defining a texture."):M(()=>`Invalid data type for texture: ${e.constructor.name}`)}function je(e,t){switch(e){case T.R8:return t===N.UNSIGNED_BYTE;case T.R16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.R32F:return t==N.FLOAT;case T.R8UI:return t===N.UNSIGNED_BYTE;case T.RG8:return t===N.UNSIGNED_BYTE;case T.RG16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.RG32F:return t==N.FLOAT;case T.RG8UI:return t===N.UNSIGNED_BYTE;case T.RGB8:return t===N.UNSIGNED_BYTE;case T.SRGB8:return t===N.UNSIGNED_BYTE;case T.RGB565:return[N.UNSIGNED_BYTE,N.UNSIGNED_SHORT_5_6_5].includes(t);case T.R11F_G11F_B10F:return[N.UNSIGNED_INT_10F_11F_11F_REV,N.HALF_FLOAT,N.FLOAT].includes(t);case T.RGB9_E5:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.RGB16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.RGB32F:return t==N.FLOAT;case T.RGB8UI:return t===N.UNSIGNED_BYTE;case T.RGBA8:return t===N.UNSIGNED_BYTE;case T.SRGB8_ALPHA8:return t===N.UNSIGNED_BYTE;case T.RGB5_A1:return[N.UNSIGNED_BYTE,N.UNSIGNED_SHORT_5_5_5_1].includes(t);case T.RGB10_A2:return t===N.UNSIGNED_INT_2_10_10_10_REV;case T.RGBA4:return[N.UNSIGNED_BYTE,N.UNSIGNED_SHORT_4_4_4_4].includes(t);case T.RGBA16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.RGBA32F:return t==N.FLOAT;case T.RGBA8UI:return t===N.UNSIGNED_BYTE;case T.DEPTH_COMPONENT16:return t===N.UNSIGNED_SHORT;case T.DEPTH_COMPONENT24:return t===N.UNSIGNED_INT;case T.DEPTH_COMPONENT32F:return t===N.FLOAT}return!1}function qe(e,t){switch(t){case T.R8:return e.RED;case T.R16F:return e.RED;case T.R32F:return e.RED;case T.R8UI:return e.RED_INTEGER;case T.RG8:return e.RG;case T.RG16F:return e.RG;case T.RG32F:return e.RG;case T.RG8UI:return e.RG_INTEGER;case T.RGB8:return e.RGB;case T.SRGB8:return e.RGB;case T.RGB565:return e.RGB;case T.R11F_G11F_B10F:return e.RGB;case T.RGB9_E5:return e.RGB;case T.RGB16F:return e.RGB;case T.RGB32F:return e.RGB;case T.RGB8UI:return e.RGB_INTEGER;case T.RGBA8:return e.RGBA;case T.SRGB8_ALPHA8:return e.RGBA;case T.RGB5_A1:return e.RGBA;case T.RGB10_A2:return e.RGBA;case T.RGBA4:return e.RGBA;case T.RGBA16F:return e.RGBA;case T.RGBA32F:return e.RGBA;case T.RGBA8UI:return e.RGBA_INTEGER;case T.DEPTH_COMPONENT16:case T.DEPTH_COMPONENT24:case T.DEPTH_COMPONENT32F:return e.DEPTH_COMPONENT;default:M(()=>`Invalid internal format: ${t}.`)}}function We(e){switch(e){case T.DEPTH_COMPONENT16:case T.DEPTH_COMPONENT24:case T.DEPTH_COMPONENT32F:return!0;default:return!1}}function Ke(e){switch(e){case T.R16F:case T.R32F:case T.RG16F:case T.RG32F:case T.RGB16F:case T.RGB32F:case T.RGBA16F:case T.RGBA32F:case T.DEPTH_COMPONENT32F:return!0;default:return!1}}function Qe(e){let t=!!e.createTransformFeedback;t&&e.bindVertexArray(null);let s=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);for(let h=0;h<s;++h)e.disableVertexAttribArray(h),e.vertexAttribPointer(h,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(h,0),t&&e.vertexAttribDivisor(h,0);e.deleteBuffer(i);let n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let h=0;h<n;++h)e.activeTexture(e.TEXTURE0+h),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null),t&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(h,null));if(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),t){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);let h=e.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(let r=0;r<h;++r)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r,null);let a=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);for(let r=0;r<a;++r)e.bindBufferBase(e.UNIFORM_BUFFER,r,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}}var V=class e{a;b;c;d;e;f;g;h;i;static of(t,s,i,n,h,a,r,c,o){return new e(t,s,i,n,h,a,r,c,o)}static all(t){return new e(t,t,t,t,t,t,t,t,t)}static random(){return new e(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random())}static fromArray(t,s=0){return new e(t[s+0],t[s+1],t[s+2],t[s+3],t[s+4],t[s+5],t[s+6],t[s+7],t[s+8])}static identity(){return new e}static translate(t){return new e(1,0,0,0,1,0,t.x,t.y,1)}static fromTranslation=e.translate;static translateX(t){return new e(1,0,0,0,1,0,t,0,1)}static fromTranslationX=e.translateX;static translateY(t){return new e(1,0,0,0,1,0,0,t,1)}static fromTranslationY=e.translateY;static rotate(t){let s=Math.sin(t),i=Math.cos(t);return new e(i,s,0,-s,i,0,0,0,1)}static fromRotation=e.rotate;static scale(t,s){return typeof t=="number"?s===void 0?new e(t,0,0,0,t,0,0,0,1):new e(t,0,0,0,s,0,0,0,1):new e(t.x,0,0,0,t.y,0,0,0,1)}static fromScale=e.scale;static fromMat4(t){return new e(t.a,t.b,t.c,t.e,t.f,t.g,t.i,t.j,t.k)}static projection(t,s){return new e(2/t,0,0,0,-2/s,0,-1,1,1)}static normalMatrixOf(t){let s=t.a,i=t.b,n=t.c,h=t.e,a=t.f,r=t.g,c=t.i,o=t.j,f=t.k,d=f*a-r*o,l=-f*h+r*c,u=o*h-a*c,E=s*d+i*l+n*u;return E?(E=1/E,new e(d*E,l*E,u*E,(-f*i+n*o)*E,(f*s-n*c)*E,(-o*s+i*c)*E,(r*i-n*a)*E,(-r*s+n*h)*E,(a*s-i*h)*E)):null}constructor(t=1,s=0,i=0,n=0,h=1,a=0,r=0,c=0,o=1){this.a=t,this.b=s,this.c=i,this.d=n,this.e=h,this.f=a,this.g=r,this.h=c,this.i=o}get 0(){return this.a}get 1(){return this.b}get 2(){return this.c}get 3(){return this.d}get 4(){return this.e}get 5(){return this.f}get 6(){return this.g}get 7(){return this.h}get 8(){return this.i}get length(){return 9}reset(){return this.a=1,this.b=0,this.c=0,this.d=0,this.e=1,this.f=0,this.g=0,this.h=0,this.i=1,this}fromArray(t,s=0){return this.a=t[s+0],this.b=t[s+1],this.c=t[s+2],this.d=t[s+3],this.e=t[s+4],this.f=t[s+5],this.g=t[s+6],this.h=t[s+7],this.i=t[s+8],this}toArray(t=null,s=0){return t===null&&(t=new Array(9)),t[s+0]=this.a,t[s+1]=this.b,t[s+2]=this.c,t[s+3]=this.d,t[s+4]=this.e,t[s+5]=this.f,t[s+6]=this.g,t[s+7]=this.h,t[s+8]=this.i,t}clone(){return new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i)}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this}equals(t,s=H){return Math.abs(this.a-t.a)<=s&&Math.abs(this.b-t.b)<=s&&Math.abs(this.c-t.c)<=s&&Math.abs(this.d-t.d)<=s&&Math.abs(this.e-t.e)<=s&&Math.abs(this.f-t.f)<=s&&Math.abs(this.g-t.g)<=s&&Math.abs(this.h-t.h)<=s&&Math.abs(this.i-t.i)<=s}transpose(){let t;return t=this.b,this.b=this.d,this.d=t,t=this.c,this.c=this.g,this.g=t,t=this.f,this.f=this.h,this.h=t,this}transposeOf(t){return this.a=t.a,this.b=t.d,this.c=t.g,this.d=t.b,this.e=t.e,this.f=t.h,this.g=t.c,this.h=t.f,this.i=t.i,this}invert(){let t=this.a,s=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=o*h-a*c,d=-o*n+a*r,l=c*n-h*r,u=t*f+s*d+i*l;return u?(u=1/u,this.a=f*u,this.b=(-o*s+i*c)*u,this.c=(a*s-i*h)*u,this.d=d*u,this.e=(o*t-i*r)*u,this.f=(-a*t+i*n)*u,this.g=l*u,this.h=(-c*t+s*r)*u,this.i=(h*t-s*n)*u,this):null}inverseOf(t){let s=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=f*a-r*o,l=-f*h+r*c,u=o*h-a*c,E=s*d+i*l+n*u;return E?(E=1/E,this.a=d*E,this.b=(-f*i+n*o)*E,this.c=(r*i-n*a)*E,this.d=l*E,this.e=(f*s-n*c)*E,this.f=(-r*s+n*h)*E,this.g=u*E,this.h=(-o*s+i*c)*E,this.i=(a*s-i*h)*E,this):null}adjoint(){let t=this.a,s=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i;return this.a=h*o-a*c,this.b=i*c-s*o,this.c=s*a-i*h,this.d=a*r-n*o,this.e=t*o-i*r,this.f=i*n-t*a,this.g=n*c-h*r,this.h=s*r-t*c,this.i=t*h-s*n,this}adjointOf(t){let s=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i;return this.a=a*f-r*o,this.b=n*o-i*f,this.c=i*r-n*a,this.d=r*c-h*f,this.e=s*f-n*c,this.f=n*h-s*r,this.g=h*o-a*c,this.h=i*c-s*o,this.i=s*a-i*h,this}determinant(){let t=this.d,s=this.e,i=this.f,n=this.g,h=this.h,a=this.i;return this.a*(a*s-i*h)+this.b*(-a*t+i*n)+this.c*(h*t-s*n)}multiply(t){let s=this.a,i=this.d,n=this.g,h=this.b,a=this.e,r=this.h,c=this.c,o=this.f,f=this.i,d=t.a,l=t.b,u=t.c;return this.a=s*d+i*l+n*u,this.b=h*d+a*l+r*u,this.c=c*d+o*l+f*u,d=t.d,l=t.e,u=t.f,this.d=s*d+i*l+n*u,this.e=h*d+a*l+r*u,this.f=c*d+o*l+f*u,d=t.g,l=t.h,u=t.i,this.g=s*d+i*l+n*u,this.h=h*d+a*l+r*u,this.i=c*d+o*l+f*u,this}preMultiply(t){let s=t.a,i=t.d,n=t.g,h=t.b,a=t.e,r=t.h,c=t.c,o=t.f,f=t.i,d=this.a,l=this.b,u=this.c;return this.a=s*d+i*l+n*u,this.b=h*d+a*l+r*u,this.c=c*d+o*l+f*u,d=this.d,l=this.e,u=this.f,this.d=s*d+i*l+n*u,this.e=h*d+a*l+r*u,this.f=c*d+o*l+f*u,d=this.g,l=this.h,u=this.i,this.g=s*d+i*l+n*u,this.h=h*d+a*l+r*u,this.i=c*d+o*l+f*u,this}productOf(t,s){let i=t.a,n=t.d,h=t.g,a=t.b,r=t.e,c=t.h,o=t.c,f=t.f,d=t.i,l=s.a,u=s.b,E=s.c;return this.a=i*l+n*u+h*E,this.b=a*l+r*u+c*E,this.c=o*l+f*u+d*E,l=s.d,u=s.e,E=s.f,this.d=i*l+n*u+h*E,this.e=a*l+r*u+c*E,this.f=o*l+f*u+d*E,l=s.g,u=s.h,E=s.i,this.g=i*l+n*u+h*E,this.h=a*l+r*u+c*E,this.i=o*l+f*u+d*E,this}translate(t,s){let i;return typeof t=="number"?(i=t,s=s??0):(i=t.x,s=t.y),this.g+=this.a*i+this.d*s,this.h+=this.b*i+this.e*s,this.i+=this.c*i+this.f*s,this}translateX(t){return this.g+=this.a*t,this.h+=this.b*t,this.i+=this.c*t,this}translateY(t){return this.g+=this.d*t,this.h+=this.e*t,this.i+=this.f*t,this}rotate(t){let s=this.a,i=this.b,n=this.c,h=this.d,a=this.e,r=this.f,c=Math.sin(t),o=Math.cos(t);return this.a=o*s+c*h,this.b=o*i+c*a,this.c=o*n+c*r,this.d=o*h-c*s,this.e=o*a-c*i,this.f=o*r-c*n,this}scale(t,s){let i;return typeof t=="number"?(i=t,s=s??i):(i=t.x,s=t.y),this.a*=i,this.b*=i,this.c*=i,this.d*=s,this.e*=s,this.f*=s,this}scaleX(t){return this.a*=t,this.b*=t,this.c*=t,this}scaleY(t){return this.d*=t,this.e*=t,this.f*=t,this}fromMat4(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.e,this.e=t.f,this.f=t.g,this.g=t.i,this.h=t.j,this.i=t.k,this}*[Symbol.iterator](){yield this.a,yield this.b,yield this.c,yield this.d,yield this.e,yield this.f,yield this.g,yield this.h,yield this.i}};V.prototype.isMat3=!0;V.prototype.isMathPrimitive=!0;var P=class e{x;y;z;static of(t,s,i){return new e(t,s??t,i??t)}static zero(){return new e(0,0,0)}static all(t){return new e(t,t,t)}static random(){return new e(Math.random(),Math.random(),Math.random())}static xAxis(){return new e(1,0,0)}static yAxis(){return new e(0,1,0)}static zAxis(){return new e(0,0,1)}static translateX(t){return new e(t,0,0)}static translateY(t){return new e(0,t,0)}static translateZ(t){return new e(0,0,t)}static randomDir(){let t=Math.random()*2-1,s=Math.random()*2-1,i=Math.random()*2-1,n=Math.hypot(t,s,i);return new e(t/n,s/n,i/n)}static fromArray(t,s=0){return new e(t[s],t[s+1],t[s+2])}static fromSpherical(t,s,i=1){let n=Math.sin(s)*i;return new e(n*Math.sin(t),Math.cos(s)*i,n*Math.cos(t))}static fromCylindrical(t,s,i=1){return new e(Math.sin(t)*i,s,Math.cos(t)*i)}static sumOf(t,s){return new e(t.x+s.x,t.y+s.y,t.z+s.z)}static differenceOf(t,s){return new e(t.x-s.x,t.y-s.y,t.z-s.z)}static productOf(t,s){return new e(t.x*s.x,t.y*s.y,t.z*s.z)}static quotientOf(t,s){return new e(t.x/s.x,t.y/s.y,t.z/s.z)}static scaled(t,s){return new e(t.x*s,t.y*s,t.z*s)}static normalOf(t,s,i){typeof t!="number"?(i=t.z,s=t.y,t=t.x):(s=s??t,i=i??t);let n=t*t+s*s+i*i;if(n>0){let h=1/Math.sqrt(n);return new e(t*h,s*h,i*h)}else return new e(0,0,0)}static minOf(t,s){return new e(Math.min(t.x,s.x),Math.min(t.y,s.y),Math.min(t.z,s.z))}static maxOf(t,s){return new e(Math.max(t.x,s.x),Math.max(t.y,s.y),Math.max(t.z,s.z))}constructor(t=0,s=0,i=0){this.x=t,this.y=s,this.z=i}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get 2(){return this.z}set 2(t){this.z=t}get length(){return 3}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get depth(){return this.z}set depth(t){this.z=t}get r(){return this.x}set r(t){this.x=t}get g(){return this.y}set g(t){this.y=t}get b(){return this.z}set b(t){this.z=t}get u(){return this.x}set u(t){this.x=t}get v(){return this.y}set v(t){this.y=t}get w(){return this.z}set w(t){this.z=t}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error(`Invalid Vec3 index: ${t}`)}}setIndex(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error(`Invalid Vec3 index: ${t}`)}}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this}toArray(t=null,s=0){return t===null&&(t=new Array(3)),t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t}clone(){return new e(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equals(t,s=H){return Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s&&Math.abs(this.z-t.z)<=s}any(){return this.x!=0||this.y!=0||this.z!=0}set(t,s,i){return this.x=t,this.y=s??t,this.z=i??(s===void 0?t:0),this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}randomize(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addAll(t){return this.x+=t,this.y+=t,this.z+=t,this}sumOf(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subtractAll(t){return this.x-=t,this.y-=t,this.z-=t,this}differenceOf(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}productOf(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this}divideBy(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}quotientOf(t,s){return this.x=t.x/s.x,this.y=t.y/s.y,this.z=t.z/s.z,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}invert(){return this.x=this.x==0?0:1/this.x,this.y=this.y==0?0:1/this.y,this.z=this.z==0?0:1/this.z,this}inverseOf(t){return this.x=t.x==0?0:1/t.x,this.y=t.y==0?0:1/t.y,this.z=t.z==0?0:1/t.z,this}addScaled(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this}mod(t){return this.x%=t.x,this.y%=t.y,this.z%=t.z,this}modAll(t){return this.x%=t,this.y%=t,this.z%=t,this}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this.z+=(t.z-this.z)*s,this}lerpOf(t,s,i){return this.x=t.x+(s.x-t.x)*i,this.y=t.y+(s.y-t.y)*i,this.z=t.z+(s.z-t.z)*i,this}slerp(t,s){let i=this.x,n=this.y,h=this.z,a=t.x,r=t.y,c=t.z,o=Math.acos(Math.min(Math.max(i*a+n*r+i*c,-1),1)),f=o?Math.sin(o):1,d=Math.sin((1-s)*o)/f,l=Math.sin(s*o)/f;return this.x=d*i+l*a,this.y=d*n+l*r,this.z=d*i+l*c,this}slerpOf(t,s,i){let n=t.x,h=t.y,a=t.z,r=s.x,c=s.y,o=s.z,f=Math.acos(Math.min(Math.max(n*r+h*c+n*o,-1),1)),d=f?Math.sin(f):1,l=Math.sin((1-i)*f)/d,u=Math.sin(i*f)/d;return this.x=l*n+u*r,this.y=l*h+u*c,this.z=l*n+u*o,this}hermiteOf(t,s,i,n,h){let a=h*h,r=a*(2*h-3)+1,c=a*(h-2)+h,o=a*(h-1),f=a*(3-2*h);return this.x=t.x*r+s.x*c+i.x*o+n.x*f,this.y=t.y*r+s.y*c+i.y*o+n.y*f,this.z=t.z*r+s.z*c+i.z*o+n.z*f,this}bezierOf(t,s,i,n,h){let a=h*h,r=1-h,c=r*r,o=c*r,f=3*h*c,d=3*a*r,l=a*h;return this.x=t.x*o+s.x*f+i.x*d+n.x*l,this.y=t.y*o+s.y*f+i.y*d+n.y*l,this.z=t.z*o+s.z*f+i.z*d+n.z*l,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){let s=this.x,i=this.y,n=this.z,h=t.x,a=t.y,r=t.z;return this.x=i*r-n*a,this.y=n*h-s*r,this.z=s*a-i*h,this}crossOf(t,s){let i=t.x,n=t.y,h=t.z,a=s.x,r=s.y,c=s.z;return this.x=n*c-h*r,this.y=h*a-i*c,this.z=i*r-n*a,this}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z}magnitude(){return Math.hypot(this.x,this.y,this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;if(t>0){let s=1/Math.sqrt(t);this.x*=s,this.y*=s,this.z*=s}return this}normalOf(t){let s=t.x*t.x+t.y*t.y+t.z*t.z;if(s>0){let i=1/Math.sqrt(s);this.x=t.x*i,this.y=t.y*i,this.z=t.z*i}else this.x=0,this.y=0,this.z=0;return this}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z)}distanceToSq(t){let s=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return s*s+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}minOf(t,s){return this.x=Math.min(t.x,s.x),this.y=Math.min(t.y,s.y),this.z=Math.min(t.z,s.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}maxOf(t,s){return this.x=Math.max(t.x,s.x),this.y=Math.max(t.y,s.y),this.z=Math.max(t.z,s.z),this}clamp(t,s){return this.x=Math.max(t.x,Math.min(s.x,this.x)),this.y=Math.max(t.y,Math.min(s.y,this.y)),this.z=Math.max(t.z,Math.min(s.z,this.z)),this}clampScalar(t,s){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(t,Math.min(s,this.y)),this.z=Math.max(t,Math.min(s,this.z)),this}clampMagnitude(t,s){let i=this.x*this.x+this.y*this.y+this.z*this.z;if(i>0){let n=Math.sqrt(i),h=Math.max(t,Math.min(s,n))/n;this.x*=h,this.y*=h,this.z*=h}return this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}projectOnVector(t){let s=t.x,i=t.y,n=t.z,h=s*s+i*i+n*n;if(h==0)this.x=0,this.y=0,this.z=0;else{let a=(this.x*s+this.y*i+this.z*n)/h;this.x=s*a,this.y=i*a,this.z=n*a}return this}projectOnPlane(t){let s=t.x,i=t.y,n=t.z,h=this.x*s+this.y*i+this.z*n;return this.x-=s*h,this.y-=i*h,this.z-=n*h,this}reflect(t){let s=t.x,i=t.y,n=t.z,h=2*(this.x*s+this.y*i+this.z*n);return this.x-=s*h,this.y-=i*h,this.z-=n*h,this}angleTo(t){let s=this.x,i=this.y,n=this.z,h=t.x,a=t.y,r=t.z,c=Math.sqrt((s*s+i*i+n*n)*(h*h+a*a+r*r)),o=c&&(s*h+i*a+n*r)/c;return Math.acos(Math.min(Math.max(o,-1),1))}rotateAround(t,s){let i=this.x,n=this.y,h=this.z,a=t.x,r=t.y,c=t.z,o=Math.cos(s),f=Math.sin(s),d=(a*i+r*n+c*h)*(1-o);return this.x=a*d+i*o+(-c*n+r*h)*f,this.y=r*d+n*o+(c*i-a*h)*f,this.z=c*d+h*o+(-r*i+a*n)*f,this}translateX(t){return this.x+=t,this}translateY(t){return this.y+=t,this}translateZ(t){return this.z+=t,this}rotateX(t){let s=this.y,i=this.z,n=Math.cos(t),h=Math.sin(t);return this.y=s*n-i*h,this.z=s*h+i*n,this}rotateY(t){let s=this.x,i=this.z,n=Math.cos(t),h=Math.sin(t);return this.x=s*n+i*h,this.z=-s*h+i*n,this}rotateZ(t){let s=this.x,i=this.y,n=Math.cos(t),h=Math.sin(t);return this.x=s*n-i*h,this.y=s*h+i*n,this}applyMat3(t){let s=this.x,i=this.y,n=this.z;return this.x=s*t.a+i*t.d+n*t.g,this.y=s*t.b+i*t.e+n*t.h,this.z=s*t.c+i*t.f+n*t.i,this}applyMat4(t){let s=this.x,i=this.y,n=this.z,h=t.d*s+t.h*i+t.l*n+t.p||1;return this.x=(s*t.a+i*t.e+n*t.i+t.m)/h,this.y=(s*t.b+i*t.f+n*t.j+t.n)/h,this.z=(s*t.c+i*t.g+n*t.k+t.o)/h,this}rotateMat4(t){let s=this.x,i=this.y,n=this.z;return this.x=s*t.a+i*t.e+n*t.i,this.y=s*t.b+i*t.f+n*t.j,this.z=s*t.c+i*t.g+n*t.k,this}rotateQuat(t){let s=this.x,i=this.y,n=this.z,h=t.x,a=t.y,r=t.z,c=t.w,o=2*(a*n-r*i),f=2*(r*s-h*n),d=2*(h*i-a*s);return this.x=s+c*o+a*d-r*f,this.y=i+c*f+r*o-h*d,this.z=n+c*d+h*f-a*o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};P.prototype.isVec3=!0;P.prototype.isMathPrimitive=!0;var at=class e{a;b;c;d;e;f;g;h;i;j;k;l;m;n;o;p;static of(t,s,i,n,h,a,r,c,o,f,d,l,u,E,x,_){return new e(t,s,i,n,h,a,r,c,o,f,d,l,u,E,x,_)}static all(t){return new e(t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t)}static random(){return new e(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random())}static fromArray(t,s=0){return new e(t[s+0],t[s+1],t[s+2],t[s+3],t[s+4],t[s+5],t[s+6],t[s+7],t[s+8],t[s+9],t[s+10],t[s+11],t[s+12],t[s+13],t[s+14],t[s+15])}static identity(){return new e}static translate(t,s,i){return typeof t=="number"?new e(1,0,0,0,0,1,0,0,0,0,1,0,t,s??t,i??t,1):new e(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1)}static fromTranslation=e.translate;static fromVec3s(t,s,i,n){return new e(t.x,t.y,t.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,1)}static fromVec4s(t,s,i,n){return new e(t.x,t.y,t.z,t.w,s.x,s.y,s.z,s.w,i.x,i.y,i.z,i.w,n.x,n.y,n.z,n.w)}static translateX(t){return new e(1,0,0,0,0,1,0,0,0,0,1,0,t,0,0,1)}static fromTranslationX=e.translateX;static translateY(t){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,t,0,1)}static fromTranslationY=e.translateY;static translateZ(t){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,t,1)}static fromTranslationZ=e.translateZ;static rotate(t,s){let i=Math.sin(s),n=Math.cos(s),h=1-n,a=t.x,r=t.y,c=t.z,o=h*a,f=h*r,d=h*c,l=i*a,u=i*r,E=i*c;return new e(o*a+n,o*r+E,o*c-u,0,f*a-E,f*r+n,f*c+l,0,d*a+u,d*r-l,d*c+n,0,0,0,0,1)}static fromRotation=e.rotate;static rotateX(t){let s=Math.sin(t),i=Math.cos(t);return new e(1,0,0,0,0,i,s,0,0,-s,i,0,0,0,0,1)}static fromRotationX=e.rotateX;static rotateY(t){let s=Math.sin(t),i=Math.cos(t);return new e(i,0,-s,0,0,1,0,0,s,0,i,0,0,0,0,1)}static fromRotationY=e.rotateY;static rotateZ(t){let s=Math.sin(t),i=Math.cos(t);return new e(i,s,0,0,-s,i,0,0,0,0,1,0,0,0,0,1)}static fromRotationZ=e.rotateZ;static fromQuat(t){let s=t.x,i=t.y,n=t.z,h=t.w,a=s+s,r=i+i,c=n+n,o=s*a,f=s*r,d=s*c,l=i*r,u=i*c,E=n*c,x=h*a,_=h*r,y=h*c;return new e(1-(l+E),f+y,d-_,0,f-y,1-(o+E),u+x,0,d+_,u-x,1-(o+l),0,0,0,0,1)}static scale(t){let s,i,n;return typeof t=="number"?(s=t,i=t,n=t):(s=t.x,i=t.y,n=t.z),new e(s,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1)}static fromScale=e.scale;static fromBasis(t,s,i){return new e(t.x,t.y,t.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,0,0,0,0,1)}static compose(t,s,i){let n=s.x,h=s.y,a=s.z,r=s.w,c=i.x,o=i.y,f=i.z,d=n+n,l=h+h,u=a+a,E=n*d,x=n*l,_=n*u,y=h*l,A=h*u,m=a*u,R=r*d,b=r*l,w=r*u;return new e((1-(y+m))*c,(x+w)*c,(_-b)*c,0,(x-w)*o,(1-(E+m))*o,(A+R)*o,0,(_+b)*f,(A-R)*f,(1-(E+y))*f,0,t.x,t.y,t.z,1)}static fromMat3(t){return new e(t.a,t.b,t.c,0,t.d,t.e,t.f,0,t.g,t.h,t.i,0,0,0,0,1)}static ortho(t,s,i,n,h,a){let r=1/(t-s),c=1/(i-n),o=1/(h-a);return new e(-2*r,0,0,0,0,-2*c,0,0,0,0,2*o,0,(t+s)*r,(n+i)*c,(a+h)*o,1)}static perspective(t,s,i,n){let h=1/Math.tan(t/2),a=1/(i-n);return new e(h/s,0,0,0,0,h,0,0,0,0,(n+i)*a,-1,0,0,2*n*i*a,0)}static lookAt(t,s,i){let n=t.x,h=t.y,a=t.z,r=n-s.x,c=h-s.y,o=a-s.z;if(Math.abs(r)==0&&Math.abs(c)==0&&Math.abs(o)==0)return new e;let f=1/Math.hypot(r,c,o);r*=f,c*=f,o*=f;let d=i.x,l=i.y,u=i.z,E=l*o-u*c,x=u*r-d*o,_=d*c-l*r;f=Math.hypot(E,x,_),f==0?(E=0,x=0,_=0):(f=1/f,E*=f,x*=f,_*=f);let y=c*_-o*x,A=o*E-r*_,m=r*x-c*E;return f=Math.hypot(y,A,m),f==0?(y=0,A=0,m=0):(f=1/f,y*=f,A*=f,m*=f),new e(E,y,r,0,x,A,c,0,_,m,o,0,-(E*n+x*h+_*a),-(y*n+A*h+m*a),-(r*n+c*h+o*a),1)}static transposeOf(t){return new e(t.a,t.e,t.i,t.m,t.b,t.f,t.j,t.n,t.c,t.g,t.k,t.o,t.d,t.h,t.l,t.p)}static inverseOf(t){let s=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,E=t.m,x=t.n,_=t.o,y=t.p,A=s*r-i*a,m=s*c-n*a,R=s*o-h*a,b=i*c-n*r,w=i*o-h*r,I=n*o-h*c,O=f*x-d*E,p=f*_-l*E,D=f*y-u*E,$=d*_-l*x,G=d*y-u*x,U=l*y-u*_,z=A*U-m*G+R*$+b*D-w*p+I*O;return z?(z=1/z,new e((r*U-c*G+o*$)*z,(n*G-i*U-h*$)*z,(x*I-_*w+y*b)*z,(l*w-d*I-u*b)*z,(c*D-a*U-o*p)*z,(s*U-n*D+h*p)*z,(_*R-E*I-y*m)*z,(f*I-l*R+u*m)*z,(a*G-r*D+o*O)*z,(i*D-s*G-h*O)*z,(E*w-x*R+y*A)*z,(d*R-f*w-u*A)*z,(r*p-a*$-c*O)*z,(s*$-i*p+n*O)*z,(x*m-E*b-_*A)*z,(f*b-d*m+l*A)*z)):null}constructor(t=1,s=0,i=0,n=0,h=0,a=1,r=0,c=0,o=0,f=0,d=1,l=0,u=0,E=0,x=0,_=1){this.a=t,this.b=s,this.c=i,this.d=n,this.e=h,this.f=a,this.g=r,this.h=c,this.i=o,this.j=f,this.k=d,this.l=l,this.m=u,this.n=E,this.o=x,this.p=_}get 0(){return this.a}get 1(){return this.b}get 2(){return this.c}get 3(){return this.d}get 4(){return this.e}get 5(){return this.f}get 6(){return this.g}get 7(){return this.h}get 8(){return this.i}get 9(){return this.j}get 10(){return this.k}get 11(){return this.l}get 12(){return this.m}get 13(){return this.n}get 14(){return this.o}get 15(){return this.p}get length(){return 16}reset(){return this.a=1,this.b=0,this.c=0,this.d=0,this.e=0,this.f=1,this.g=0,this.h=0,this.i=0,this.j=0,this.k=1,this.l=0,this.m=0,this.n=0,this.o=0,this.p=1,this}set(t,s,i,n,h,a,r,c,o,f,d,l,u,E,x,_){return this.a=t,this.b=s,this.c=i,this.d=n,this.e=h,this.f=a,this.g=r,this.h=c,this.i=o,this.j=f,this.k=d,this.l=l,this.m=u,this.n=E,this.o=x,this.p=_,this}fromArray(t,s=0){return this.a=t[s+0],this.b=t[s+1],this.c=t[s+2],this.d=t[s+3],this.e=t[s+4],this.f=t[s+5],this.g=t[s+6],this.h=t[s+7],this.i=t[s+8],this.j=t[s+9],this.k=t[s+10],this.l=t[s+11],this.m=t[s+12],this.n=t[s+13],this.o=t[s+14],this.p=t[s+15],this}toArray(t=null,s=0){return t===null&&(t=new Array(16)),t[s+0]=this.a,t[s+1]=this.b,t[s+2]=this.c,t[s+3]=this.d,t[s+4]=this.e,t[s+5]=this.f,t[s+6]=this.g,t[s+7]=this.h,t[s+8]=this.i,t[s+9]=this.j,t[s+10]=this.k,t[s+11]=this.l,t[s+12]=this.m,t[s+13]=this.n,t[s+14]=this.o,t[s+15]=this.p,t}clone(){return new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m,this.n,this.o,this.p)}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this.j=t.j,this.k=t.k,this.l=t.l,this.m=t.m,this.n=t.n,this.o=t.o,this.p=t.p,this}compose(t,s,i){let n=s.x,h=s.y,a=s.z,r=s.w,c=i.x,o=i.y,f=i.z,d=n+n,l=h+h,u=a+a,E=n*d,x=n*l,_=n*u,y=h*l,A=h*u,m=a*u,R=r*d,b=r*l,w=r*u;return this.a=(1-(y+m))*c,this.b=(x+w)*c,this.c=(_-b)*c,this.d=0,this.e=(x-w)*o,this.f=(1-(E+m))*o,this.g=(A+R)*o,this.h=0,this.i=(_+b)*f,this.j=(A-R)*f,this.k=(1-(E+y))*f,this.l=0,this.m=t.x,this.n=t.y,this.o=t.z,this.p=1,this}decompose(t,s,i){let n=this.a,h=this.b,a=this.c,r=this.d,c=this.e,o=this.f,f=this.g,d=this.h,l=this.i,u=this.j,E=this.k,x=this.l,_=this.m,y=this.n,A=this.o,m=this.p,R=(n*o-h*c)*(E*m-x*A)-(n*f-a*c)*(u*m-x*y)+(n*d-r*c)*(u*A-E*y)+(h*f-a*o)*(l*m-x*_)-(h*d-r*o)*(l*A-E*_)+(a*d-r*f)*(l*y-u*_),b=Math.hypot(n,h,a)*Math.sign(R),w=Math.hypot(c,o,f),I=Math.hypot(l,u,E);t.x=_,t.y=y,t.z=A,n/=b,h/=b,a/=b,c/=w,o/=w,f/=w,l/=I,u/=I,E/=I;let O=n+o+E;if(O>0){let p=.5/Math.sqrt(O+1);s.x=(f-u)*p,s.y=(l-a)*p,s.z=(h-c)*p,s.w=.25/p}else if(n>o&&n>E){let p=2*Math.sqrt(1+n-o-E);s.x=.25*p,s.y=(c+h)/p,s.z=(l+a)/p,s.w=(f-u)/p}else if(o>E){let p=2*Math.sqrt(1+o-n-E);s.x=(c+h)/p,s.y=.25*p,s.z=(u+f)/p,s.w=(l-a)/p}else{let p=2*Math.sqrt(1+E-n-o);s.x=(l+a)/p,s.y=(u+f)/p,s.z=.25*p,s.w=(h-c)/p}return i.x=b,i.y=w,i.z=I,this}equals(t,s=H){return Math.abs(this.a-t.a)<=s&&Math.abs(this.b-t.b)<=s&&Math.abs(this.c-t.c)<=s&&Math.abs(this.d-t.d)<=s&&Math.abs(this.e-t.e)<=s&&Math.abs(this.f-t.f)<=s&&Math.abs(this.g-t.g)<=s&&Math.abs(this.h-t.h)<=s&&Math.abs(this.i-t.i)<=s&&Math.abs(this.j-t.j)<=s&&Math.abs(this.k-t.k)<=s&&Math.abs(this.l-t.l)<=s&&Math.abs(this.m-t.m)<=s&&Math.abs(this.n-t.n)<=s&&Math.abs(this.o-t.o)<=s&&Math.abs(this.p-t.p)<=s}transpose(){let t;return t=this.b,this.b=this.e,this.e=t,t=this.c,this.c=this.i,this.i=t,t=this.g,this.g=this.j,this.j=t,t=this.d,this.d=this.m,this.m=t,t=this.h,this.h=this.n,this.n=t,t=this.l,this.l=this.o,this.o=t,this}transposeOf(t){return this.a=t.a,this.b=t.e,this.c=t.i,this.d=t.m,this.e=t.b,this.f=t.f,this.g=t.j,this.h=t.n,this.i=t.c,this.j=t.g,this.k=t.k,this.l=t.o,this.m=t.d,this.n=t.h,this.o=t.l,this.p=t.p,this}invert(){let t=this.a,s=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=this.j,d=this.k,l=this.l,u=this.m,E=this.n,x=this.o,_=this.p,y=t*a-s*h,A=t*r-i*h,m=t*c-n*h,R=s*r-i*a,b=s*c-n*a,w=i*c-n*r,I=o*E-f*u,O=o*x-d*u,p=o*_-l*u,D=f*x-d*E,$=f*_-l*E,G=d*_-l*x,U=y*G-A*$+m*D+R*p-b*O+w*I;return U?(U=1/U,this.a=(a*G-r*$+c*D)*U,this.b=(i*$-s*G-n*D)*U,this.c=(E*w-x*b+_*R)*U,this.d=(d*b-f*w-l*R)*U,this.e=(r*p-h*G-c*O)*U,this.f=(t*G-i*p+n*O)*U,this.g=(x*m-u*w-_*A)*U,this.h=(o*w-d*m+l*A)*U,this.i=(h*$-a*p+c*I)*U,this.j=(s*p-t*$-n*I)*U,this.k=(u*b-E*m+_*y)*U,this.l=(f*m-o*b-l*y)*U,this.m=(a*O-h*D-r*I)*U,this.n=(t*D-s*O+i*I)*U,this.o=(E*A-u*R-x*y)*U,this.p=(o*R-f*A+d*y)*U,this):null}inverseOf(t){let s=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,E=t.m,x=t.n,_=t.o,y=t.p,A=s*r-i*a,m=s*c-n*a,R=s*o-h*a,b=i*c-n*r,w=i*o-h*r,I=n*o-h*c,O=f*x-d*E,p=f*_-l*E,D=f*y-u*E,$=d*_-l*x,G=d*y-u*x,U=l*y-u*_,z=A*U-m*G+R*$+b*D-w*p+I*O;return z?(z=1/z,this.a=(r*U-c*G+o*$)*z,this.b=(n*G-i*U-h*$)*z,this.c=(x*I-_*w+y*b)*z,this.d=(l*w-d*I-u*b)*z,this.e=(c*D-a*U-o*p)*z,this.f=(s*U-n*D+h*p)*z,this.g=(_*R-E*I-y*m)*z,this.h=(f*I-l*R+u*m)*z,this.i=(a*G-r*D+o*O)*z,this.j=(i*D-s*G-h*O)*z,this.k=(E*w-x*R+y*A)*z,this.l=(d*R-f*w-u*A)*z,this.m=(r*p-a*$-c*O)*z,this.n=(s*$-i*p+n*O)*z,this.o=(x*m-E*b-_*A)*z,this.p=(f*b-d*m+l*A)*z,this):null}adjoint(){let t=this.a,s=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=this.j,d=this.k,l=this.l,u=this.m,E=this.n,x=this.o,_=this.p;return this.a=+(a*(d*_-l*x)-f*(r*_-c*x)+E*(r*l-c*d)),this.b=-(s*(d*_-l*x)-f*(i*_-n*x)+E*(i*l-n*d)),this.c=+(s*(r*_-c*x)-a*(i*_-n*x)+E*(i*c-n*r)),this.d=-(s*(r*l-c*d)-a*(i*l-n*d)+f*(i*c-n*r)),this.e=-(h*(d*_-l*x)-o*(r*_-c*x)+u*(r*l-c*d)),this.f=+(t*(d*_-l*x)-o*(i*_-n*x)+u*(i*l-n*d)),this.g=-(t*(r*_-c*x)-h*(i*_-n*x)+u*(i*c-n*r)),this.h=+(t*(r*l-c*d)-h*(i*l-n*d)+o*(i*c-n*r)),this.i=+(h*(f*_-l*E)-o*(a*_-c*E)+u*(a*l-c*f)),this.j=-(t*(f*_-l*E)-o*(s*_-n*E)+u*(s*l-n*f)),this.k=+(t*(a*_-c*E)-h*(s*_-n*E)+u*(s*c-n*a)),this.l=-(t*(a*l-c*f)-h*(s*l-n*f)+o*(s*c-n*a)),this.m=-(h*(f*x-d*E)-o*(a*x-r*E)+u*(a*d-r*f)),this.n=+(t*(f*x-d*E)-o*(s*x-i*E)+u*(s*d-i*f)),this.o=-(t*(a*x-r*E)-h*(s*x-i*E)+u*(s*r-i*a)),this.p=+(t*(a*d-r*f)-h*(s*d-i*f)+o*(s*r-i*a)),this}adjointOf(t){let s=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,E=t.m,x=t.n,_=t.o,y=t.p;return this.a=+(r*(l*y-u*_)-d*(c*y-o*_)+x*(c*u-o*l)),this.b=-(i*(l*y-u*_)-d*(n*y-h*_)+x*(n*u-h*l)),this.c=+(i*(c*y-o*_)-r*(n*y-h*_)+x*(n*o-h*c)),this.d=-(i*(c*u-o*l)-r*(n*u-h*l)+d*(n*o-h*c)),this.e=-(a*(l*y-u*_)-f*(c*y-o*_)+E*(c*u-o*l)),this.f=+(s*(l*y-u*_)-f*(n*y-h*_)+E*(n*u-h*l)),this.g=-(s*(c*y-o*_)-a*(n*y-h*_)+E*(n*o-h*c)),this.h=+(s*(c*u-o*l)-a*(n*u-h*l)+f*(n*o-h*c)),this.i=+(a*(d*y-u*x)-f*(r*y-o*x)+E*(r*u-o*d)),this.j=-(s*(d*y-u*x)-f*(i*y-h*x)+E*(i*u-h*d)),this.k=+(s*(r*y-o*x)-a*(i*y-h*x)+E*(i*o-h*r)),this.l=-(s*(r*u-o*d)-a*(i*u-h*d)+f*(i*o-h*r)),this.m=-(a*(d*_-l*x)-f*(r*_-c*x)+E*(r*l-c*d)),this.n=+(s*(d*_-l*x)-f*(i*_-n*x)+E*(i*l-n*d)),this.o=-(s*(r*_-c*x)-a*(i*_-n*x)+E*(i*c-n*r)),this.p=+(s*(r*l-c*d)-a*(i*l-n*d)+f*(i*c-n*r)),this}determinant(){let t=this.a,s=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=this.j,d=this.k,l=this.l,u=this.m,E=this.n,x=this.o,_=this.p;return(t*a-s*h)*(d*_-l*x)-(t*r-i*h)*(f*_-l*E)+(t*c-n*h)*(f*x-d*E)+(s*r-i*a)*(o*_-l*u)-(s*c-n*a)*(o*x-d*u)+(i*c-n*r)*(o*E-f*u)}multiply(t){let s=this.a,i=this.b,n=this.c,h=this.d,a=this.e,r=this.f,c=this.g,o=this.h,f=this.i,d=this.j,l=this.k,u=this.l,E=this.m,x=this.n,_=this.o,y=this.p,A=t.a,m=t.b,R=t.c,b=t.d;return this.a=A*s+m*a+R*f+b*E,this.b=A*i+m*r+R*d+b*x,this.c=A*n+m*c+R*l+b*_,this.d=A*h+m*o+R*u+b*y,A=t.e,m=t.f,R=t.g,b=t.h,this.e=A*s+m*a+R*f+b*E,this.f=A*i+m*r+R*d+b*x,this.g=A*n+m*c+R*l+b*_,this.h=A*h+m*o+R*u+b*y,A=t.i,m=t.j,R=t.k,b=t.l,this.i=A*s+m*a+R*f+b*E,this.j=A*i+m*r+R*d+b*x,this.k=A*n+m*c+R*l+b*_,this.l=A*h+m*o+R*u+b*y,A=t.m,m=t.n,R=t.o,b=t.p,this.m=A*s+m*a+R*f+b*E,this.n=A*i+m*r+R*d+b*x,this.o=A*n+m*c+R*l+b*_,this.p=A*h+m*o+R*u+b*y,this}preMultiply(t){let s=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,E=t.m,x=t.n,_=t.o,y=t.p,A=this.a,m=this.b,R=this.c,b=this.d;return this.a=A*s+m*a+R*f+b*E,this.b=A*i+m*r+R*d+b*x,this.c=A*n+m*c+R*l+b*_,this.d=A*h+m*o+R*u+b*y,A=this.e,m=this.f,R=this.g,b=this.h,this.e=A*s+m*a+R*f+b*E,this.f=A*i+m*r+R*d+b*x,this.g=A*n+m*c+R*l+b*_,this.h=A*h+m*o+R*u+b*y,A=this.i,m=this.j,R=this.k,b=this.l,this.i=A*s+m*a+R*f+b*E,this.j=A*i+m*r+R*d+b*x,this.k=A*n+m*c+R*l+b*_,this.l=A*h+m*o+R*u+b*y,A=this.m,m=this.n,R=this.o,b=this.p,this.m=A*s+m*a+R*f+b*E,this.n=A*i+m*r+R*d+b*x,this.o=A*n+m*c+R*l+b*_,this.p=A*h+m*o+R*u+b*y,this}productOf(t,s){let i=t.a,n=t.b,h=t.c,a=t.d,r=t.e,c=t.f,o=t.g,f=t.h,d=t.i,l=t.j,u=t.k,E=t.l,x=t.m,_=t.n,y=t.o,A=t.p,m=s.a,R=s.b,b=s.c,w=s.d;return this.a=m*i+R*r+b*d+w*x,this.b=m*n+R*c+b*l+w*_,this.c=m*h+R*o+b*u+w*y,this.d=m*a+R*f+b*E+w*A,m=s.e,R=s.f,b=s.g,w=s.h,this.e=m*i+R*r+b*d+w*x,this.f=m*n+R*c+b*l+w*_,this.g=m*h+R*o+b*u+w*y,this.h=m*a+R*f+b*E+w*A,m=s.i,R=s.j,b=s.k,w=s.l,this.i=m*i+R*r+b*d+w*x,this.j=m*n+R*c+b*l+w*_,this.k=m*h+R*o+b*u+w*y,this.l=m*a+R*f+b*E+w*A,m=s.m,R=s.n,b=s.o,w=s.p,this.m=m*i+R*r+b*d+w*x,this.n=m*n+R*c+b*l+w*_,this.o=m*h+R*o+b*u+w*y,this.p=m*a+R*f+b*E+w*A,this}fromTranslation(t,s,i){return typeof t=="number"?this.set(1,0,0,0,0,1,0,0,0,0,1,0,t,s??t,i??t,1):this.set(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1)}translate(t,s,i){let n;return typeof t=="number"?(n=t,s=s??0,i=i??0):(n=t.x,s=t.y,i=t.z),this.m+=this.a*n+this.e*s+this.i*i,this.n+=this.b*n+this.f*s+this.j*i,this.o+=this.c*n+this.g*s+this.k*i,this.p+=this.d*n+this.h*s+this.l*i,this}translateX(t){return this.m+=this.a*t,this.n+=this.b*t,this.o+=this.c*t,this.p+=this.d*t,this}translateY(t){return this.m+=this.e*t,this.n+=this.f*t,this.o+=this.g*t,this.p+=this.h*t,this}translateZ(t){return this.m+=this.i*t,this.n+=this.j*t,this.o+=this.k*t,this.p+=this.l*t,this}rotate(t,s){let i=t.x,n=t.y,h=t.z,a=Math.sin(s),r=Math.cos(s),c=1-r,o=i*i*c+r,f=n*i*c+h*a,d=h*i*c-n*a,l=i*n*c-h*a,u=n*n*c+r,E=h*n*c+i*a,x=i*h*c+n*a,_=n*h*c-i*a,y=h*h*c+r,A=this.a,m=this.b,R=this.c,b=this.d,w=this.e,I=this.f,O=this.g,p=this.h,D=this.i,$=this.j,G=this.k,U=this.l;return this.a=A*o+w*f+D*d,this.b=m*o+I*f+$*d,this.c=R*o+O*f+G*d,this.d=b*o+p*f+U*d,this.e=A*l+w*u+D*E,this.f=m*l+I*u+$*E,this.g=R*l+O*u+G*E,this.h=b*l+p*u+U*E,this.i=A*x+w*_+D*y,this.j=m*x+I*_+$*y,this.k=R*x+O*_+G*y,this.l=b*x+p*_+U*y,this}rotateX(t){let s=Math.sin(t),i=Math.cos(t),n=this.e,h=this.f,a=this.g,r=this.h,c=this.i,o=this.j,f=this.k,d=this.l;return this.e=n*i+c*s,this.f=h*i+o*s,this.g=a*i+f*s,this.h=r*i+d*s,this.i=c*i-n*s,this.j=o*i-h*s,this.k=f*i-a*s,this.l=d*i-r*s,this}rotateY(t){let s=Math.sin(t),i=Math.cos(t),n=this.a,h=this.b,a=this.c,r=this.d,c=this.i,o=this.j,f=this.k,d=this.l;return this.a=n*i-c*s,this.b=h*i-o*s,this.c=a*i-f*s,this.d=r*i-d*s,this.i=c*i+n*s,this.j=o*i+h*s,this.k=f*i+a*s,this.l=d*i+r*s,this}rotateZ(t){let s=Math.sin(t),i=Math.cos(t),n=this.a,h=this.b,a=this.c,r=this.d,c=this.e,o=this.f,f=this.g,d=this.h;return this.a=n*i+c*s,this.b=h*i+o*s,this.c=a*i+f*s,this.d=r*i+d*s,this.e=c*i-n*s,this.f=o*i-h*s,this.g=f*i-a*s,this.h=d*i-r*s,this}scale(t,s,i){let n;return typeof t=="number"?(n=t,s=s??t,i=i??t):(n=t.x,s=t.y,i=t.z),this.a*=n,this.b*=n,this.c*=n,this.d*=n,this.e*=s,this.f*=s,this.g*=s,this.h*=s,this.i*=i,this.j*=i,this.k*=i,this.l*=i,this}perspective(t,s,i,n){let h=1/Math.tan(t/2),a=1/(i-n);return this.set(h/s,0,0,0,0,h,0,0,0,0,(n+i)*a,-1,0,0,2*n*i*a,0)}ortho(t,s,i,n,h,a){let r=1/(t-s),c=1/(i-n),o=1/(h-a);return this.set(-2*r,0,0,0,0,-2*c,0,0,0,0,2*o,0,(t+s)*r,(n+i)*c,(a+h)*o,1)}lookAt(t,s,i){let n=t.x,h=t.y,a=t.z,r=n-s.x,c=h-s.y,o=a-s.z;if(Math.abs(r)==0&&Math.abs(c)==0&&Math.abs(o)==0)return this.reset();let f=1/Math.hypot(r,c,o);r*=f,c*=f,o*=f;let d=i.x,l=i.y,u=i.z,E=l*o-u*c,x=u*r-d*o,_=d*c-l*r;f=Math.hypot(E,x,_),f==0?(E=0,x=0,_=0):(f=1/f,E*=f,x*=f,_*=f);let y=c*_-o*x,A=o*E-r*_,m=r*x-c*E;return f=Math.hypot(y,A,m),f==0?(y=0,A=0,m=0):(f=1/f,y*=f,A*=f,m*=f),this.set(E,y,r,0,x,A,c,0,_,m,o,0,-(E*n+x*h+_*a),-(y*n+A*h+m*a),-(r*n+c*h+o*a),1)}fromQuat(t){let s=t.x,i=t.y,n=t.z,h=t.w,a=s+s,r=i+i,c=n+n,o=s*a,f=s*r,d=s*c,l=i*r,u=i*c,E=n*c,x=h*a,_=h*r,y=h*c;return this.a=1-(l+E),this.b=f+y,this.c=d-_,this.d=0,this.e=f-y,this.f=1-(o+E),this.g=u+x,this.h=0,this.i=d+_,this.j=u-x,this.k=1-(o+l),this.l=0,this.m=0,this.n=0,this.o=0,this.p=1,this}getTranslation(){return new P(this.m,this.n,this.o)}getMat3(){return new V(this.a,this.b,this.c,this.e,this.f,this.g,this.i,this.j,this.k)}getScaling(){return new P(Math.hypot(this.a,this.b,this.c),Math.hypot(this.e,this.f,this.g),Math.hypot(this.i,this.j,this.k))}*[Symbol.iterator](){yield this.a,yield this.b,yield this.c,yield this.d,yield this.e,yield this.f,yield this.g,yield this.h,yield this.i,yield this.j,yield this.k,yield this.l,yield this.m,yield this.n,yield this.o,yield this.p}};at.prototype.isMat4=!0;at.prototype.isMathPrimitive=!0;var X=class e{x;y;z;w;static of(t,s,i,n){return new e(t,s??t,i??t,n??1)}static zero(){return new e(0,0,0,0)}static all(t){return new e(t,t,t,t)}static random(){return new e(Math.random(),Math.random(),Math.random(),Math.random())}static xAxis(){return new e(1,0,0)}static yAxis(){return new e(0,1,0)}static zAxis(){return new e(0,0,1)}static translateX(t){return new e(t,0,0,1)}static translateY(t){return new e(0,t,0,1)}static translateZ(t){return new e(0,0,t,1)}static randomDir(){let t=Math.random()*2-1,s=Math.random()*2-1,i=Math.random()*2-1,n=Math.hypot(t,s,i);return new e(t/n,s/n,i/n,0)}static fromArray(t,s=0){return new e(t[s],t[s+1],t[s+2],t[s+3])}static sumOf(t,s){return new e(t.x+s.x,t.y+s.y,t.z+s.z,t.w+s.w)}static differenceOf(t,s){return new e(t.x-s.x,t.y-s.y,t.z-s.z,t.w-s.w)}static productOf(t,s){return new e(t.x*s.x,t.y*s.y,t.z*s.z,t.w*s.w)}static quotientOf(t,s){return new e(t.x/s.x,t.y/s.y,t.z/s.z,t.w/s.w)}static minOf(t,s){return new e(Math.min(t.x,s.x),Math.min(t.y,s.y),Math.min(t.z,s.z),Math.min(t.w,s.w))}static maxOf(t,s){return new e(Math.max(t.x,s.x),Math.max(t.y,s.y),Math.max(t.z,s.z),Math.max(t.w,s.w))}constructor(t=0,s=0,i=0,n=1){this.x=t,this.y=s,this.z=i,this.w=n}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get 2(){return this.z}set 2(t){this.z=t}get 3(){return this.w}set 3(t){this.w=t}get length(){return 4}get xyz(){return new P(this.x,this.y,this.z)}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error(`Invalid Vec4 index: ${t}`)}}setIndex(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;case 3:this.w=s;break;default:throw new Error(`Invalid Vec4 index: ${t}`)}}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this.w=t[s+3],this}toArray(t=null,s=0){return t===null&&(t=new Array(3)),t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t[s+3]=this.w,t}clone(){return new e(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}equals(t,s=H){return Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s&&Math.abs(this.z-t.z)<=s&&Math.abs(this.w-t.w)<=s}any(){return this.x!=0||this.y!=0||this.z!=0||this.w!=0}set(t,s,i,n){return this.x=t,this.y=s??t,this.z=i??(s===void 0?t:0),this.w=n??1,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}randomize(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addAll(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}sumOf(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this.w=t.w+s.w,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subtractAll(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}differenceOf(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this.w=t.w-s.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}productOf(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this.w=t.w*s.w,this}divideBy(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}quotientOf(t,s){return this.x=t.x/s.x,this.y=t.y/s.y,this.z=t.z/s.z,this.w=t.w/s.w,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}invert(){return this.x=this.x==0?0:1/this.x,this.y=this.y==0?0:1/this.y,this.z=this.z==0?0:1/this.z,this.w=this.w==0?0:1/this.w,this}inverseOf(t){return this.x=t.x==0?0:1/t.x,this.y=t.y==0?0:1/t.y,this.z=t.z==0?0:1/t.z,this.w=t.w==0?0:1/t.w,this}addScaled(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this.w+=t.w*s,this}mod(t){return this.x%=t.x,this.y%=t.y,this.z%=t.z,this.w%=t.w,this}modAll(t){return this.x%=t,this.y%=t,this.z%=t,this.w%=t,this}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this.z+=(t.z-this.z)*s,this.w+=(t.w-this.w)*s,this}lerpOf(t,s,i){return this.x=t.x+(s.x-t.x)*i,this.y=t.y+(s.y-t.y)*i,this.z=t.z+(s.z-t.z)*i,this.w=t.w+(s.w-t.w)*i,this}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.w!==0&&(this.x/=this.w,this.y/=this.w,this.z/=this.w,this.w=1),this}normalOf(t){return t.w===0?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x/=t.w,this.y/=t.w,this.z/=t.w,this.w=1),this}min(t){return typeof t=="number"?(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t),this.z=Math.min(this.z,t),this.w=Math.min(this.w,t)):(this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w)),this}minOf(t,s){return this.x=Math.min(t.x,s.x),this.y=Math.min(t.y,s.y),this.z=Math.min(t.z,s.z),this.w=Math.min(t.w,s.w),this}max(t){return typeof t=="number"?(this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),this.z=Math.max(this.z,t),this.w=Math.max(this.w,t)):(this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w)),this}maxOf(t,s){return this.x=Math.max(t.x,s.x),this.y=Math.max(t.y,s.y),this.z=Math.max(t.z,s.z),this.w=Math.max(t.w,s.w),this}clamp(t,s){return this.x=Math.max(t.x,Math.min(s.x,this.x)),this.y=Math.max(t.y,Math.min(s.y,this.y)),this.z=Math.max(t.z,Math.min(s.z,this.z)),this.w=Math.max(t.w,Math.min(s.w,this.w)),this}clampScalar(t,s){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(t,Math.min(s,this.y)),this.z=Math.max(t,Math.min(s,this.z)),this.w=Math.max(t,Math.min(s,this.w)),this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}applyMat4(t){let s=this.x,i=this.y,n=this.z,h=this.w;return this.x=s*t.a+i*t.e+n*t.i+h*t.m,this.y=s*t.b+i*t.f+n*t.j+h*t.n,this.z=s*t.c+i*t.g+n*t.k+h*t.o,this.w=s*t.d+i*t.h+n*t.l+h*t.p,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};X.prototype.isVec4=!0;X.prototype.isMathPrimitive=!0;function Ze(e){return function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function Pt(e){return e.x*=e.x*34+133,e.y*=e.y*34+133,e.z*=e.z*34+133,e.w*=e.w*34+133,e}function Tt(e){let t=new P(e,e/2,e/4).floor().modAll(2).scale(2).subtractAll(1),s=t.clone();s.setIndex(Math.max(0,Math.floor(e/16)),0);let i=Math.floor(e/8)%2,n=t.clone().scale(1-i).add(t.cross(s).add(s).scale(i)),h=s.scale(1.22474487139).add(n);return h.scale((1-.042942436724648037*i)*3.5946317686139184),h}function ee(e){let t=e.clone().floor(),s=new X(e.x-t.x,e.y-t.y,e.z-t.z,2.5),i=t.clone().addAll(Math.floor(s.dot(X.all(.25)))),n=t.clone().add(P.xAxis()).add(new P(-1,1,1).scale(Math.floor(s.dot(new X(-.25,.25,.25,.35))))),h=t.clone().add(P.yAxis()).add(new P(1,-1,1).scale(Math.floor(s.dot(new X(.25,-.25,.25,.35))))),a=t.add(P.zAxis()).add(new P(1,1,-1).scale(Math.floor(s.dot(new X(.25,.25,-.25,.35))))),r=Pt(new X(i.x,n.x,h.x,a.x).modAll(289));Pt(r.add(new X(i.y,n.y,h.y,a.y)).modAll(289)),Pt(r.add(new X(i.z,n.z,h.z,a.z)).modAll(289)).modAll(48);let c=e.clone().subtract(i),o=e.clone().subtract(n),f=e.clone().subtract(h),d=e.subtract(a),l=X.all(.75).subtract(new X(c.dot(c),o.dot(o),f.dot(f),d.dot(d))).max(0),u=l.clone().multiply(l),E=u.clone().multiply(u),x=Tt(r.x),_=Tt(r.y),y=Tt(r.z),A=Tt(r.w),m=new X(c.dot(x),o.dot(_),f.dot(y),d.dot(A)),R=E.dot(m),b=u.multiply(l).multiply(m).applyMat4(at.fromVec3s(c,o,f,d)).scale(-8).add(E.applyMat4(at.fromVec3s(x,_,y,A)));return new X(b.x,b.y,b.z,R)}var se=new V(.788675134594813,-.211324865405187,-.577350269189626,-.211324865405187,.788675134594813,-.577350269189626,.577350269189626,.577350269189626,.577350269189626);function Je(e){e.applyMat3(se);let t=ee(e.clone()).add(ee(e.addAll(144.5))),s=t.xyz.applyMat3(se);return new X(s.x,s.y,s.z,t.w)}var ut=class e{x;y;z;w;static identity(){return new e(0,0,0,1)}static random(){let t=Math.random(),s=Math.random()*2*Math.PI,i=Math.random()*2*Math.PI,n=Math.sqrt(1-t),h=Math.sqrt(t);return new e(n*Math.cos(s),h*Math.sin(i),h*Math.cos(i),n*Math.sin(s))}static fromArray(t,s=0){return new e(t[s],t[s+1],t[s+2],t[s+3])}static fromAxisAngle(t,s){let i=s/2,n=Math.sin(i);return new e(t.x*n,t.y*n,t.z*n,Math.cos(i))}static fromMat3(t){let s=t.a,i=t.d,n=t.g,h=t.b,a=t.e,r=t.h,c=t.c,o=t.f,f=t.i,d=s+a+f;if(d>0){let l=.5/Math.sqrt(d+1);return new e((o-r)*l,(n-c)*l,(h-i)*l,.25/l)}else if(s>a&&s>f){let l=2*Math.sqrt(1+s-a-f);return new e(.25*l,(i+h)/l,(n+c)/l,(o-r)/l)}else if(a>f){let l=2*Math.sqrt(1+a-s-f);return new e((i+h)/l,.25*l,(r+o)/l,(n-c)/l)}else{let l=2*Math.sqrt(1+f-s-a);return new e((n+c)/l,(r+o)/l,.25*l,(h-i)/l)}}static fromDirections(t,s){let i=t.dot(s)+1;if(i<H)if(Math.abs(t.x)>Math.abs(t.z)){let n=Math.hypot(t.x,t.y);return new e(-t.y/n,t.x/n,0,0)}else{let n=Math.hypot(t.y,t.z);return new e(0,-t.z/n,t.y/n,0)}else{let n=t.y*s.z-t.z*s.y,h=t.z*s.x-t.x*s.z,a=t.x*s.y-t.y*s.x,r=Math.hypot(n,h,a,i);return new e(n/r,h/r,a/r,i/r)}}static slerpOf(t,s,i){let n=t.x,h=t.y,a=t.z,r=t.w,c=s.x,o=s.y,f=s.z,d=s.w,l=n*c+h*o+a*f+r*d;l<0&&(l=-l,c=-c,o=-o,f=-f,d=-d);let u,E;if(1-l>H){let x=Math.acos(l),_=Math.sin(x);u=Math.sin((1-i)*x)/_,E=Math.sin(i*x)/_}else u=1-i,E=i;return new e(u*n+E*c,u*h+E*o,u*a+E*f,u*r+E*d)}static sqlerpOf(t,s,i,n,h){return e.slerpOf(t,s,h).slerp(e.slerpOf(i,n,h),2*h*(1-h))}constructor(t=0,s=0,i=0,n=1){this.x=t,this.y=s,this.z=i,this.w=n}get 0(){return this.x}get 1(){return this.y}get 2(){return this.x}get 3(){return this.w}get length(){return 4}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this.w=t[s+3],this}toArray(t=null,s=0){return t===null&&(t=new Array(4)),t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t[s+3]=this.w,t}clone(){return new e(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}fromAxisAngle(t,s){let i=s/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this}equals(t,s=H){return Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s&&Math.abs(this.z-t.z)<=s&&Math.abs(this.w-t.w)<=s}invert(){let t=this.x,s=this.y,i=this.z,n=this.w,h=t*t+s*s+i*i+n*n;return h===0?(this.x=0,this.y=0,this.z=0,this.w=1):(h=1/h,this.x=-t*h,this.y=-s*h,this.z=-i*h,this.w=n*h),this}inverseOf(t){let s=t.x,i=t.y,n=t.z,h=t.w,a=s*s+i*i+n*n+h*h;return a===0?(this.x=0,this.y=0,this.z=0,this.w=1):(a=1/a,this.x=-s*a,this.y=-i*a,this.z=-n*a,this.w=h*a),this}conjugate(){return new e(-this.x,-this.y,-this.z,this.w)}conjugateOf(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalize(){let t=Math.hypot(this.x,this.y,this.z,this.w);return t===0?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this}normalizeOf(t){let s=Math.hypot(t.x,t.y,t.z,t.w);return s===0?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x=t.x/s,this.y=t.y/s,this.z=t.z/s,this.w=t.w/s),this}multiply(t){let s=this.x,i=this.y,n=this.z,h=this.w,a=t.x,r=t.y,c=t.z,o=t.w;return this.x=s*o+h*a+i*c-n*r,this.y=i*o+h*r+n*a-s*c,this.z=n*o+h*c+s*r-i*a,this.w=h*o-s*a-i*r-n*c,this}preMultiply(t){let s=t.x,i=t.y,n=t.z,h=t.w,a=this.x,r=this.y,c=this.z,o=this.w;return this.x=s*o+h*a+i*c-n*r,this.y=i*o+h*r+n*a-s*c,this.z=n*o+h*c+s*r-i*a,this.w=h*o-s*a-i*r-n*c,this}productOf(t,s){let i=t.x,n=t.y,h=t.z,a=t.w,r=s.x,c=s.y,o=s.z,f=s.w;return this.x=i*f+a*r+n*o-h*c,this.y=n*f+a*c+h*r-i*o,this.z=h*f+a*o+i*c-n*r,this.w=a*f-i*r-n*c-h*o,this}slerp(t,s){let i=this.x,n=this.y,h=this.z,a=this.w,r=t.x,c=t.y,o=t.z,f=t.w,d=i*r+n*c+h*o+a*f;d<0&&(d=-d,r=-r,c=-c,o=-o,f=-f);let l,u;if(1-d>H){let E=Math.acos(d),x=Math.sin(E);l=Math.sin((1-s)*E)/x,u=Math.sin(s*E)/x}else l=1-s,u=s;return this.x=l*i+u*r,this.y=l*n+u*c,this.z=l*h+u*o,this.w=l*a+u*f,this}slerpOf(t,s,i){let n=t.x,h=t.y,a=t.z,r=t.w,c=s.x,o=s.y,f=s.z,d=s.w,l=n*c+h*o+a*f+r*d;l<0&&(l=-l,c=-c,o=-o,f=-f,d=-d);let u,E;if(1-l>H){let x=Math.acos(l),_=Math.sin(x);u=Math.sin((1-i)*x)/_,E=Math.sin(i*x)/_}else u=1-i,E=i;return this.x=u*n+E*c,this.y=u*h+E*o,this.z=u*a+E*f,this.w=u*r+E*d,this}angleTo(t){let s=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;return Math.acos(2*s*s-1)}getAxisAngle(t){let s=Math.acos(this.w)*2,i=Math.sin(s/2);return i>H?(t.x=this.x/i,t.y=this.y/i,t.z=this.z/i):(t.x=1,t.y=0,t.z=0),s}rotateX(t){t*=.5;let s=Math.sin(t),i=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return this.x=n*i+r*s,this.y=h*i+a*s,this.z=a*i-h*s,this.w=r*i-n*s,this}rotateY(t){t*=.5;let s=Math.sin(t),i=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return this.x=n*i-a*s,this.y=h*i+r*s,this.z=a*i+n*s,this.w=r*i-h*s,this}rotateZ(t){t*=.5;let s=Math.sin(t),i=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return this.x=n*i+h*s,this.y=h*i-n*s,this.z=a*i+r*s,this.w=r*i-a*s,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};ut.prototype.isQuat=!0;ut.prototype.isMathPrimitive=!0;var k=class e{x;y;static of(t,s){return new e(t,s??t)}static zero(){return new e(0,0)}static all(t){return new e(t,t)}static random(){return new e(Math.random(),Math.random())}static xAxis(){return new e(1,0)}static yAxis(){return new e(0,1)}static translateX(t){return new e(t,0)}static translateY(t){return new e(0,t)}static randomDir(){let t=Math.random()*2-1,s=Math.random()*2-1,i=Math.hypot(t,s);return new e(t/i,s/i)}static fromArray(t,s=0){return new e(t[s],t[s+1])}static sumOf(t,s){return new e(t.x+s.x,t.y+s.y)}static differenceOf(t,s){return new e(t.x-s.x,t.y-s.y)}static productOf(t,s){return new e(t.x*s.x,t.y*s.y)}static quotientOf(t,s){return new e(t.x/s.x,t.y/s.y)}static normalOf(t){let s=t.x*t.x+t.y*t.y;if(s>0){let i=1/Math.sqrt(s);return new e(t.x*i,t.y*i)}else return new e(0,0)}static minOf(t,s){return new e(Math.min(t.x,s.x),Math.min(t.y,s.y))}static maxOf(t,s){return new e(Math.max(t.x,s.x),Math.max(t.y,s.y))}constructor(t=0,s=0){this.x=t,this.y=s}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get length(){return 2}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get ratio(){return this.y===0?0:this.x/this.y}get u(){return this.x}set u(t){this.x=t}get v(){return this.y}set v(t){this.y=t}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error(`Invalid Vec2 index: ${t}`)}}setIndex(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;default:throw new Error(`Invalid Vec2 index: ${t}`)}}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this}toArray(t=null,s=0){return t===null&&(t=new Array(2)),t[s]=this.x,t[s+1]=this.y,t}clone(){return new e(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}equals(t,s=H){return Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s}any(){return this.x!=0||this.y!=0}set(t,s){return this.x=t,this.y=s??t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}randomize(){return this.x=Math.random(),this.y=Math.random(),this}add(t){return this.x+=t.x,this.y+=t.y,this}addAll(t){return this.x+=t,this.y+=t,this}sumOf(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}subtractAll(t){return this.x-=t,this.y-=t,this}differenceOf(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}productOf(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this}divideBy(t){return this.x/=t.x,this.y/=t.y,this}quotientOf(t,s){return this.x=t.x/s.x,this.y=t.y/s.y,this}scale(t){return this.x*=t,this.y*=t,this}invert(){return this.x=this.x==0?0:1/this.x,this.y=this.y==0?0:1/this.y,this}inverseOf(t){return this.x=t.x==0?0:1/t.x,this.y=t.y==0?0:1/t.y,this}addScaled(t,s){return this.x+=t.x*s,this.y+=t.y*s,this}mod(t){return this.x%=t.x,this.y%=t.y,this}modAll(t){return this.x%=t,this.y%=t,this}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this}lerpOf(t,s,i){return this.x=t.x+(s.x-t.x)*i,this.y=t.y+(s.y-t.y)*i,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}magSq(){return this.x*this.x+this.y*this.y}magnitude(){return Math.hypot(this.x,this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){let t=this.x*this.x+this.y*this.y;if(t>0){let s=1/Math.sqrt(t);this.x*=s,this.y*=s}return this}normalOf(t){let s=t.x*t.x+t.y*t.y;if(s>0){let i=1/Math.sqrt(s);this.x=t.x*i,this.y=t.y*i}else this.x=0,this.y=0;return this}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y)}distanceToSq(t){let s=this.x-t.x,i=this.y-t.y;return s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}minOf(t,s){return this.x=Math.min(t.x,s.x),this.y=Math.min(t.y,s.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}maxOf(t,s){return this.x=Math.max(t.x,s.x),this.y=Math.max(t.y,s.y),this}clamp(t,s){return this.x=Math.max(t.x,Math.min(s.x,this.x)),this.y=Math.max(t.y,Math.min(s.y,this.y)),this}clampScalar(t,s){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(t,Math.min(s,this.y)),this}clampMagnitude(t,s){let i=this.x*this.x+this.y*this.y;if(i>0){let n=Math.sqrt(i),h=Math.max(t,Math.min(s,n))/n;this.x*=h,this.y*=h}return this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}angle(){return Math.atan2(this.y,this.x)}angleTo(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)}rotate(t){let s=Math.cos(t),i=Math.sin(t),n=this.x,h=this.y;return this.x=n*s-h*i,this.y=n*i+h*s,this}rotateAround(t,s){let i=Math.cos(t),n=Math.sin(t),h=this.x-s.x,a=this.y-s.y;return this.x=h*i-a*n+s.x,this.y=h*n+a*i+s.y,this}translateX(t){return this.x+=t,this}translateY(t){return this.y+=t,this}applyMat3(t){let s=this.x,i=this.y;return this.x=s*t.a+i*t.d+t.g,this.y=s*t.b+i*t.e+t.h,this}*[Symbol.iterator](){yield this.x,yield this.y}};k.prototype.isVec2=!0;k.prototype.isMathPrimitive=!0;var Nt=class e{x;y;width;height;static unionOf(t){if(t.length===0)return new e;let s=t[0].clone();for(let i=1;i<t.length;i++)s.union(t[i]);return s}static fromCorners(t,s){return new e(Math.min(t.x,s.x),Math.min(t.y,s.y),Math.abs(t.x-s.x),Math.abs(t.y-s.y))}constructor(t=0,s=0,i=0,n=0){this.x=t,this.y=s,this.width=i,this.height=n}clone(){return new e(this.x,this.y,this.width,this.height)}set(t,s,i,n){return this.x=t,this.y=s,this.width=i,this.height=n,this}get size(){return new k(this.width,this.height)}set size(t){this.width=t.x,this.height=t.y}get left(){return this.x}set left(t){this.x=t}get top(){return this.y}set top(t){this.y=t}get right(){return this.x+this.width}set right(t){this.width=Math.max(0,t-this.x)}get bottom(){return this.y+this.height}set bottom(t){this.height=Math.max(0,t-this.y)}get topLeft(){return new k(this.x,this.y)}get topRight(){return new k(this.x+this.width,this.y)}get bottomLeft(){return new k(this.x,this.y+this.height)}get bottomRight(){return new k(this.x+this.width,this.y+this.height)}get center(){return new k(this.x+this.width*.5,this.y+this.height*.5)}contains(t,s){return t>=this.x&&t<=this.x+this.width&&s>=this.y&&s<=this.y+this.height}containsRect(t){return t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom}containsRect4(t,s,i,n){return t>=this.x&&s>=this.y&&t+i<=this.right&&s+n<=this.bottom}intersects(t){return this.x<t.right&&this.right>t.x&&this.y<t.bottom&&this.bottom>t.y}intersects4(t,s,i,n){return this.x<t+i&&this.right>t&&this.y<s+n&&this.bottom>s}union(t){let s=this.right,i=this.bottom;this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(s,t.right)-this.x,this.height=Math.max(i,t.bottom)-this.y}unionOf(t){if(t.length===0)this.x=this.y=this.width=this.height=0;else{this.x=t[0].x,this.y=t[0].y,this.width=t[0].width,this.height=t[0].height;for(let s=1;s<t.length;s++)this.union(t[s])}return this}isEmpty(){return this.width<=0||this.height<=0}clear(){this.x=this.y=this.width=this.height=0}include(t,s){return t<this.x?(this.width+=this.x-t,this.x=t):t>this.right&&(this.width=t-this.x),s<this.y?(this.height+=this.y-s,this.y=s):s>this.bottom&&(this.height=s-this.y),this}grow(t){return this.x-=t,this.y-=t,this.width+=t*2,this.height+=t*2,this}fromCorners(t,s){return this.x=Math.min(t.x,s.x),this.y=Math.min(t.y,s.y),this.width=Math.abs(t.x-s.x),this.height=Math.abs(t.y-s.y),this}fromCorners4(t,s,i,n){return this.x=Math.min(t,i),this.y=Math.min(s,n),this.width=Math.abs(t-i),this.height=Math.abs(s-n),this}};Nt.prototype.isRect=!0;function ts(e,t={}){let s=Math.abs(t.width??1),i=Math.abs(t.height??1),n=Math.max(Math.round(t.widthSegments??1),1),h=Math.max(Math.round(t.heightSegments??1),1),a=t.textureXform??V.identity(),r=new Array,c=new Array,o=new Array,f=new Array,d=new Array,l=new k;for(let u=0;u<=h;u++){let E=u/h;for(let x=0;x<=n;x++){let _=x/n;if(r.push((2*_-1)*s,(2*E-1)*i,0),x<n&&u<h){let y=(n+1)*(u+0)+(x+0),A=(n+1)*(u+0)+(x+1),m=(n+1)*(u+1)+(x+1),R=(n+1)*(u+1)+(x+0);c.push(y,A,R,A,m,R)}f.push(0,0,1),d.push(1,0,0),l.x=_,l.y=E,l.applyMat3(a),o.push(l.x,l.y)}}return{name:e,positions:r,indices:c,texCoords:o,normals:f,tangents:d}}function es(e,t={}){let s=Math.abs(t.radius??1),i=Math.max(Math.round(t.segments??32),3),n=Math.max(Math.round(t.internalSegments??1),1),h=new Array,a=new Array,r=new Array,c=new Array,o=new Array;for(let f=0;f<=n;f++){let d=s*(f/n);for(let l=0;l<=i;l++){let u=2*Math.PI*(l/i),E=-d*Math.cos(u),x=d*Math.sin(u);if(h.push(E,x,0),c.push(0,0,1),o.push(1,0,0),r.push((E/s+1)/2,(x/s+1)/2),f<n&&l<i){let _=f*(i+1)+l,y=f*(i+1)+l+1,A=(f+1)*(i+1)+l+1,m=(f+1)*(i+1)+l;a.push(_,y,m),a.push(y,A,m)}}}return{name:e,positions:h,indices:a,texCoords:r,normals:c,tangents:o}}function $t(e,t={}){let s=t.width??1,i=t.height??1,n=t.depth??1,h=Math.max(1,Math.round(t.widthSegments??1)),a=Math.max(1,Math.round(t.heightSegments??1)),r=Math.max(1,Math.round(t.depthSegments??1)),c=t.textureXform??V.identity(),o=new Array,f=new Array,d=new Array,l=new Array,u=new Array;function E(y,A,m,R,b,w){let I=y/2,O=A/2,p=m/2,D=y/R,$=A/b,G=o.length/3,U=R+1,z=new P,mt=new k,zt=new P(0,0,1).rotateQuat(w),Ut=new P(1,0,0).rotateQuat(w);for(let et=0;et<=b;et++){let re=et*$-O;for(let st=0;st<=R;st++)if(z.set(st*D-I,re,p).rotateQuat(w),o.push(z.x,z.y,z.z),mt.set(st/R,et/b),mt.applyMat3(c),d.push(mt.x,mt.y),l.push(zt.x,zt.y,zt.z),u.push(Ut.x,Ut.y,Ut.z),et<b&&st<R){let ce=G+st+U*et,Ht=G+st+U*(et+1),oe=G+(st+1)+U*(et+1),kt=G+(st+1)+U*et;f.push(ce,kt,Ht),f.push(Ht,kt,oe)}}}let x=new P,_=new ut;return E(n,i,s,r,a,_.fromAxisAngle(x.set(0,1,0),Math.PI/-2)),E(n,i,s,r,a,_.fromAxisAngle(x.set(0,1,0),Math.PI/2)),E(s,n,i,h,r,_.fromAxisAngle(x.set(1,0,0),Math.PI/2)),E(s,n,i,h,r,_.fromAxisAngle(x.set(1,0,0),Math.PI/-2)),E(s,i,n,h,a,_.fromAxisAngle(x.set(0,1,0),Math.PI)),E(s,i,n,h,a,_.fromAxisAngle(x.set(0,1,0),0)),{name:e,positions:o,indices:f,texCoords:d,normals:l,tangents:u}}function ss(e,t={}){let s=Math.max(0,t.radius??1),i=Math.max(3,Math.floor(t.widthSegments??32)),n=Math.max(2,Math.floor(t.heightSegments??16)),h=t.textureXform??V.identity(),a=new Array,r=new Array,c=new Array,o=new Array,f=new k;for(let d=0;d<=n;d++){let l=d*Math.PI/n,u=Math.sin(l),E=Math.cos(l),x=0;d===0?x=.5/i:d===n&&(x=-.5/i);for(let _=0;_<=i;_++){let y=_*2*Math.PI/i,A=Math.cos(y)*u,m=E,R=Math.sin(y)*u;if(f.x=1-_/i+x,f.y=1-d/n,f.applyMat3(h),a.push(s*A,s*m,s*R),o.push(A,m,R),c.push(f.x,f.y),d<n&&_<i){let b=d*(i+1)+_,w=b+i+1;r.push(b,b+1,w),r.push(w,b+1,w+1)}}}return ie(e,r,a,c,o),{name:e,positions:a,indices:r,texCoords:c,normals:o,tangents:Bt(a,c,r,o)}}function Gt(e,t={}){let s=t.in2D??!0,i=t.left??-1,n=t.right??1,h=t.top??1,a=t.bottom??-1;return{name:e,positions:s?[i,a,i,h,n,h,n,a]:[i,a,0,i,h,0,n,h,0,n,a,0],indices:[0,1,2,0,2,3],texCoords:[0,0,0,1,1,1,1,0],normals:s?[]:[0,0,1,0,0,1,0,0,1,0,0,1],tangents:s?[]:[1,0,0,1,0,0,1,0,0,1,0,0]}}function is(e,t={}){let s=Math.max(0,t.knotRadius??1),i=Math.max(0,t.tubeRadius??.4),n=Math.max(3,Math.floor(t.tubeSegments??64)),h=Math.max(3,Math.floor(t.radialSegments??8)),a=Math.max(1,Math.floor(t.p??2)),r=Math.max(1,Math.floor(t.q??3)),c=[],o=[],f=[],d=[],l=(A,m,R,b,w)=>{let I=Math.cos(A),O=Math.sin(A),p=R/m*A,D=Math.cos(p);w.x=b*(2+D)*.5*I,w.y=b*(2+D)*O*.5,w.z=b*Math.sin(p)*.5},u=new P,E=new P,x=new P,_=new P,y=new P;for(let A=0;A<=n;++A){let m=A/n*a*Math.PI*2;l(m,a,r,s,E),l(m+.01,a,r,s,y),_.copy(y).subtract(E),x.crossOf(_,y),y.crossOf(x,_),x.normalize(),y.normalize();for(let R=0;R<=h;++R){let b=R/h*Math.PI*2,w=-i*Math.cos(b),I=i*Math.sin(b);if(u.x=E.x+(w*y.x+I*x.x),u.y=E.y+(w*y.y+I*x.y),u.z=E.z+(w*y.z+I*x.z),c.push(u.x,u.y,u.z),u.subtract(E).normalize(),f.push(u.x,u.y,u.z),d.push(A/n),d.push(R/h),A>=1&&R>=1){let O=(h+1)*(A-1)+(R-1),p=(h+1)*A+(R-1),D=(h+1)*A+R,$=(h+1)*(A-1)+R;o.push(O,p,$,p,D,$)}}}return{name:e,positions:c,indices:o,texCoords:d,normals:f,tangents:Bt(c,d,o,f)}}function ns(e){let t=new Set(["#","mtllib","usemtl","g","l","s",""]),s,i=[],n=[],h=[],a=[],r=e.split(`
`);for(let[c,o]of r.entries()){let f=o.split(" "),d=f[0];if(!t.has(d))if(d==="o")s===void 0?s=f[1]:M(()=>`Multiple object names defined in OBJ file (on line ${c})`);else if(d==="v")i.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(d==="vn")h.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(d==="vt")a.push(parseFloat(f[1]),parseFloat(f[2]));else if(d==="f")for(let l=1;l<=3;l++){let u=f[l].split("/"),E=parseInt(u[0])-1,x=u.length>1&&u[1]!==""?parseInt(u[1])-1:E,_=u.length>2?parseInt(u[2])-1:E;n.push([E,x,_])}else v(()=>`Unexpected OBJ token: "${d}" on line ${c}`)}return s===void 0&&M(()=>`No object name defined in OBJ file: "${e}"`),h.length===0&&(console.log(`Calculating normals for object "${s}"`),h.push(...cs(i,n.map(c=>c[2])))),a.length===0&&(v(()=>`No texture coordinates defined for object "${s}"`),a.push(...new Array(i.length/3*2).fill(0))),{name:s,positions:i,texCoords:a,normals:h,splitIndices:n}}function hs(e,t){let s=t.positions,i=t.texCoords,n=t.normals,h=t.indices,a=0,r=new Map;for(let c of e.splitIndices){let o=c.join("|"),f=r.get(o);if(f!==void 0){h.push(f);continue}let[d,l,u]=c,E=d*3;s.push(...e.positions.slice(E,E+3));let x=l*2;i.push(...e.texCoords.slice(x,x+2));let _=u*3;n.push(...e.normals.slice(_,_+3)),h.push(a),r.set(o,a),a++}t.tangents=Bt(s,i,h,n)}async function pt(e){let s=await(await fetch(e,{mode:"cors",method:"GET",headers:{"Content-Type":"text/plain"}})).text(),i=ns(s),n={name:i.name,positions:[],indices:[],texCoords:[],normals:[],tangents:[]};return hs(i,n),n.name,n.indices,n.positions,ie(n.name,n.indices,n.positions,n.texCoords,n.normals,n.tangents),n}function as(e){let t=new Set,s=e.indices.length,i=e.positions.length/3,n=i;for(let h=0;h<s;h++){let a=e.indices[h];t.has(a)?(e.indices[h]=n,t.add(n++),e.positions.push(e.positions[a*3],e.positions[a*3+1],e.positions[a*3+2]),e.texCoords.push(e.texCoords[a*2],e.texCoords[a*2+1]),e.normals.push(e.normals[a*3],e.normals[a*3+1],e.normals[a*3+2]),e.tangents.push(e.tangents[a*3],e.tangents[a*3+1],e.tangents[a*3+2])):t.add(a)}i!==n&&C(()=>`Uniquified ${n-i} vertices.`)}function rs(e){new Set(e.indices).size!==e.indices.length&&M(()=>`The geometry "${e.name}" must have unique vertices to generate barycentric coordinates.`);let t=new Array(e.positions.length).fill(0),s=e.indices;for(let i=0;i<e.indices.length;i+=3)t[s[i]*3]=1,t[s[i+1]*3+1]=1,t[s[i+2]*3+2]=1;return g(t.length===e.positions.length,()=>`Failed to calculate barycentric coordinates for geometry "${e.name}"`),t}function ie(e,t,s,i,n,h){s.length%3!==0&&M(()=>`The positions array of "${e}" must have a length that is a multiple of 3, but it is ${s.length}.`),t.length%3!==0&&M(()=>`The indices array of "${e}" must have a length that is a multiple of 3, but it is ${t.length}.`),i&&i.length%2!==0&&M(()=>`The UVs array of "${e}" must have a length that is a multiple of 2, but it is ${i.length}.`),n&&n.length%3!==0&&M(()=>`The normals array of "${e}" must have a length that is a multiple of 3, but it is ${n.length}.`),h&&h.length%3!==0&&M(()=>`The tangents array of "${e}" must have a length that is a multiple of 3, but it is ${h.length}.`);let a=s.length/3;i&&i.length/2!==a&&M(()=>`The UVs array of "${e}" must have the same number of elements as the positions array.`),n&&n.length!==s.length&&M(()=>`The normals array of "${e}" must have the same number of elements as the positions array.`),h&&h.length!==s.length&&M(()=>`The tangents array of "${e}" must have the same number of elements as the positions array.`);let r=new Set;for(let f of t)r.add(f);if(r.size===a)return;let c=new Array;for(let f=0;f<a;f++)r.has(f)||c.push(f);for(let f=c.length-1;f>=0;f--){let d=c[f];s.splice(d*3,3),i&&i.splice(d*2,2),n&&n.splice(d*3,3),h&&h.splice(d*3,3)}let o=[];{let f=0,d=c[0],l=1;for(let u=0;u<a;u++)u===d&&(f++,d=c[l++]),o.push(f)}for(let f=0;f<t.length;f++)t[f]-=o[t[f]];C(()=>`Removed ${c.length} unused vertices from "${e}".`)}function cs(e,t){if(e.length===0||t.length===0)return v(()=>"Skipping computation of normals for an empty mesh."),[];t.length%3!==0&&M(()=>"The indices array must be a multiple of 3."),e.length%3!==0&&M(()=>"The positions array must be a multiple of 3.");let s=new Array(e.length).fill(0);for(let i=0;i<t.length;i+=3){let n=t[i]*3,h=t[i+1]*3,a=t[i+2]*3,r=e[n],c=e[n+1],o=e[n+2],f=e[h]-r,d=e[h+1]-c,l=e[h+2]-o,u=e[a]-r,E=e[a+1]-c,x=e[a+2]-o,_=d*x-l*E,y=l*u-f*x,A=f*E-d*u;s[n]+=_,s[n+1]+=y,s[n+2]+=A,s[h]+=_,s[h+1]+=y,s[h+2]+=A,s[a]+=_,s[a+1]+=y,s[a+2]+=A}for(let i=0;i<s.length;i+=3){let n=Math.hypot(s[i],s[i+1],s[i+2]);if(n===0){v(()=>`Cannot generate normal for vertex ${i/3} because it is not part of a face.`);continue}s[i]/=n,s[i+1]/=n,s[i+2]/=n}return s}function Bt(e,t,s,i){if(e.length===0||t.length===0||s.length===0)return v(()=>"Skipping computation of tangents for an empty mesh."),[];s.length%3!==0&&M(()=>"The indices array must be a multiple of 3."),e.length%3!==0&&M(()=>"The positions array must be a multiple of 3."),t.length%2!==0&&M(()=>"The UVs array must be a multiple of 2."),i&&i.length%3!==0&&M(()=>"The normals array must be a multiple of 3.");let n=e.length/3;t.length/2!==n&&M(()=>"The UVs array must have the same number of elements as the positions array."),i&&i.length!==e.length&&M(()=>"The normals array must have the same number of elements as the positions array.");let h=Array(e.length).fill(0);for(let a=0;a<s.length;a+=3){let r=s[a],c=s[a+1],o=s[a+2],f=e[r*3],d=e[r*3+1],l=e[r*3+2],u=e[c*3]-f,E=e[c*3+1]-d,x=e[c*3+2]-l,_=e[o*3]-f,y=e[o*3+1]-d,A=e[o*3+2]-l,m=t[r*2],R=t[r*2+1],b=t[c*2]-m,w=t[c*2+1]-R,I=t[o*2]-m,O=t[o*2+1]-R,p=1/(b*O-I*w),D=(O*u-w*_)*p,$=(O*E-w*y)*p,G=(O*x-w*A)*p;h[r*3]+=D,h[r*3+1]+=$,h[r*3+2]+=G,h[c*3]+=D,h[c*3+1]+=$,h[c*3+2]+=G,h[o*3]+=D,h[o*3+1]+=$,h[o*3+2]+=G}if(i)for(let a=0;a<h.length;a+=3){let r=h[a],c=h[a+1],o=h[a+2],f=i[a],d=i[a+1],l=i[a+2],u=f*r+d*c+l*o;r-=u*f,c-=u*d,o-=u*l;let E=Math.hypot(r,c,o);E!==0&&(h[a]=r/E,h[a+1]=c/E,h[a+2]=o/E)}else for(let a=0;a<h.length;a+=3){let r=Math.hypot(h[a],h[a+1],h[a+2]);r!==0&&(h[a]/=r,h[a+1]/=r,h[a+2]/=r)}return h}async function Lt(e){let t=await os(e);return{data:us(t.data,t.exposure),width:t.width,height:t.height}}async function os(e){let s=await(await fetch(e)).arrayBuffer(),i=new Uint8Array(s),n="",h=0;for(;!n.match(/\n\n[^\n]+\n/g)&&h<i.length;)n+=String.fromCharCode(i[h++]);h>=i.length&&M(()=>"HDR header not found"),n.startsWith(`#?RADIANCE
`)||M(()=>"Missing #?RADIANCE identifier");let a=n.match(/FORMAT=(.*)$/m)?.[1];a!="32-bit_rle_rgbe"&&(a==="32-bit_rle_xyze"&&M(()=>"XYZE HDR format is not supported"),M(()=>`Not a valid HDR format: ${a}`));let r=1;for(let E of n.matchAll(/EXPOSURE=([^\n]*)\n/gm)){let x=parseFloat(E[1]);isNaN(x)&&M(()=>"Invalid HDR exposure"),r*=x}let c=n.split(/\n/).reverse()[1].split(" "),o=parseInt(c[3]),f=parseInt(c[1]);(o<8||o>32767||f<8||f>32767)&&M(()=>"Invalid HDR resolution");let d=!0;(i[h]!=2||i[h+1]!=2||i[h+2]&128)&&(d=!1);let l;if(d){l=new Uint8Array(o*f*4);let E=0;for(let x=0;x<f;x++){let _=i.slice(h,h+=4);(_[2]<<8)+_[3]!=o&&M(()=>"HDR line mismatch");let y=Array(o*4);for(var u=0;u<4;u++){let A=u*o,m=(u+1)*o;for(;A<m;){let[R,b]=i.slice(h,h+=2);if(R>128)for(R-=128;R-- >0;)y[A++]=b;else for(R-=1,y[A++]=b;R-- >0;)y[A++]=i[h++]}}for(var u=0;u<o;u++)l[E++]=y[u+o*0],l[E++]=y[u+o*1],l[E++]=y[u+o*2],l[E++]=y[u+o*3]}}else{l=i.slice(h);for(let E=0;E<l.length;E+=4)l[E]==1&&l[E+1]==1&&l[E+2]==1&&M(()=>"Old HDR RLE encoding is not supported")}return{data:l,width:o,height:f,exposure:r}}function us(e,t){let s=e.byteLength/4,i=new Float32Array(s*3);for(var n=0;n<s;n++){let h=e[n*4+3];if(h==0)i[n*3+0]=0,i[n*3+1]=0,i[n*3+2]=0;else{let a=Math.pow(2,h-136)/t;i[n*3+0]=e[n*4+0]*a,i[n*3+1]=e[n*4+1]*a,i[n*3+2]=e[n*4+2]*a}}return i}async function Xt(e,t,s={}){let i=t.split("/").at(-1).split(".").at(0),n;try{if(t.endsWith(".hdr")){s.srcDataType!==void 0&&s.srcDataType!==e.FLOAT&&v(()=>`Ignoring srcDataType option for HDR texture: ${s.srcDataType}`),s.internalFormat===void 0&&(s.internalFormat=T.R11F_G11F_B10F);let h=await Lt(new URL(t,window.location.href));n=ht(e,i,h.width,h.height,s),yt(e,n,h.data,{...s,srcDataType:e.FLOAT})}else{let a=await new Promise((r,c)=>{let o=new Image;o.onload=()=>r(o),o.onerror=c,new URL(t,window.location.href).origin!==window.location.origin&&(o.crossOrigin="anonymous"),o.src=t});n=ht(e,i,a.naturalWidth,a.naturalHeight,s),yt(e,n,a,s)}return n}catch(h){n!==void 0&&e.deleteTexture(n.glo),M(()=>`Failed to create texture from url: "${t}": ${h.message}`)}}async function he(e,t,s={}){if(t.length!==6)throw new Error(`loadCubemap requires 6 URLs, got ${t.length}`);let i=t.map(h=>new Promise((a,r)=>{let c=new Image;c.onload=()=>a(c),c.onerror=r,new URL(h,window.location.href).origin!==window.location.origin&&(c.crossOrigin="anonymous"),c.src=h})),n=t[0].split("/").at(-1).split(".").at(0);n.endsWith("-px")?n=n.slice(0,-3):n.endsWith("-right")&&(n=n.slice(0,-6));try{let h=await Promise.all(i),[a,r]=[h[0].naturalWidth,h[0].naturalHeight];for(let o=1;o<6;o++)(h[o].naturalWidth!==a||h[o].naturalHeight!==r)&&M(()=>`Cubemap images at index 0 and ${o} have different dimensions: ${a}x${r} vs ${h[o].naturalWidth}x${h[o].naturalHeight}`);let c=ht(e,n,a,r,{...s,target:e.TEXTURE_CUBE_MAP});for(let o=0;o<6;o++)yt(e,c,h[o],{...s,dataTarget:e.TEXTURE_CUBE_MAP_POSITIVE_X+o});return c}catch(h){M(()=>`Failed to create cubemap texture from urls: "${t}": ${h.message}`)}}async function fs(e,t,s={}){let[i,n]=[void 0,void 0],h=t.length,a=[];for(let d of t)a.push(new Promise((l,u)=>{let E=d,x=new Image;x.onload=()=>{i===void 0&&n===void 0?(i=x.naturalWidth,n=x.naturalHeight):(x.naturalWidth!==i||x.naturalHeight!==n)&&u(new Error(`Data volume slices must have the same dimensions, but slice ${E} has dimensions ${x.naturalWidth}x${x.naturalHeight} instead of ${i}x${n}`)),l(x)},x.onerror=u,new URL(E,window.location.href).origin!==window.location.origin&&(x.crossOrigin="anonymous"),x.src=E}));let r=t[0].split("/").at(-1).split(".").at(0);r=r.replace(/[-_.]*\d+$/,""),await Promise.all(a),(i===void 0||n===void 0||a.length===0)&&M(()=>"No slices were loaded");let o=new OffscreenCanvas(i,n).getContext("2d",{willReadFrequently:!0});o===null&&M(()=>"Failed to create 2D context for offscreen canvas");let f=ht(e,r,i,n,{target:e.TEXTURE_3D,depth:h,levels:s.levels??1,filter:s.filter??L.LINEAR,internalFormat:s.internalFormat??T.R16F});try{e.bindTexture(e.TEXTURE_3D,f.glo);let d=s.input_min??0,l=s.input_max??255,u=s.output_min??0,E=s.output_max??1,x=l-d,_=E-u;for(let y=0;y<h;y++){let A=await a[y];o.drawImage(A,0,0);let m=o.getImageData(0,0,i,n),R=new Uint8ClampedArray(m.data.buffer);R.length!==i*n*4&&M(()=>`Unexpected pixel data length: ${R.length} instead of ${i*n*4}`);let b=new Float32Array(i*n);for(let w=0;w<b.length;w++){let I=Y(R[w*4],d,l);b[w]=u+(I-d)/x*_}e.texSubImage3D(e.TEXTURE_3D,0,0,0,y,i,n,1,e.RED,e.FLOAT,b)}return s.levels!==1&&e.generateMipmap(e.TEXTURE_3D),f}catch(d){e.deleteTexture(f.glo),M(()=>`Failed to create volume data texture "${r}": ${d.message}`)}finally{e.bindTexture(e.TEXTURE_3D,null)}}var Ft=class{_stack=[];push(t,s,i){i===s&&(i=void 0);let[n,h]=this._stack.at(-1)??[null,void 0];if(!(n===s&&h===i)){this._stack.push([s,i]);try{this._bindFramebuffer(t,s,i)}catch(a){throw this.pop(t),a}}}pop(t,s=1){s=Math.max(0,s);for(let i=0;i<s;i++){this._stack.pop();let[n,h]=this._stack.at(-1)??[null,void 0];this._bindFramebuffer(t,n,h)}}_bindFramebuffer(t,s,i){if(i===void 0){let[n,h]=s===null?[t.canvas.width,t.canvas.height]:ne(s);t.bindFramebuffer(t.FRAMEBUFFER,s?.glo??null),t.viewport(0,0,n,h)}else{let[n,h]=i===null?[t.canvas.width,t.canvas.height]:ne(i);t.bindFramebuffer(t.READ_FRAMEBUFFER,s?.glo??null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i?.glo??null),t.viewport(0,0,n,h)}}};function ne(e){if(e.color.length>0){let t=e.color[0].attachment;return[t.width,t.height]}else if(e.depth!==null){let t=e.depth.attachment;return[t.width,t.height]}else if(e.stencil!==null){let t=e.stencil.attachment;return[t.width,t.height]}else M(()=>`Framebuffer ${e.name} has no attachments`)}var St=class{_ext;_query;constructor(t,s){this._ext=s,this._query=t.createQuery(),t.beginQuery(this._ext.TIME_ELAPSED_EXT,this._query)}stop(t,s){t.endQuery(this._ext.TIME_ELAPSED_EXT);let i=()=>{if(this._query===null){v(()=>"WebGLTimer query has ended already");return}let n=t.getQueryParameter(this._query,t.QUERY_RESULT_AVAILABLE),h=t.getParameter(this._ext.GPU_DISJOINT_EXT);if(n&&!h){let a=t.getQueryParameter(this._query,t.QUERY_RESULT);s(a/1e6)}if(n||h){t.deleteQuery(this._query),this._query=null;return}requestAnimationFrame(i)};setTimeout(i,0)}},Ct=class{_ext;constructor(t){this._ext=t.getExtension("EXT_disjoint_timer_query_webgl2"),this._ext===null&&(this._ext=t.getExtension("EXT_disjoint_timer_query")),this._ext===null&&M(()=>"WebGL2 Timer Query extension not supported. In Firefox, enable `webgl.enable-privileged-extensions` in `about:config`")}start(t){return new St(t,this._ext)}};async function ls(e,t,s,i={}){let n=`#version 300 es
precision highp float;

uniform mat4 u_modelXform;
uniform mat4 u_viewXform;
uniform mat4 u_projectionXform;

in vec3 a_pos;
in vec3 a_normal;
in vec2 a_texCoord;

out vec3 f_worldPosition;
out vec3 f_normal;
out vec2 f_texCoord;

void main() {
    vec4 worldPosition = u_modelXform * vec4(a_pos, 1.0);
    f_worldPosition = worldPosition.xyz;
    f_normal = (u_modelXform * vec4(a_normal, 0.0)).xyz;
    f_texCoord = a_texCoord;
    gl_Position = u_projectionXform * u_viewXform * worldPosition;
}`,h=`#version 300 es
precision mediump float;

#define HAS_DIFFUSE_TEXTURE ${s.diffuse?1:0}
#define HAS_SPECULAR_TEXTURE ${s.specular?1:0}
#define HAS_AMBIENT_TEXTURE ${s.ambient?1:0}
#define RENDER_NORMALS ${i.renderNormals?1:0}
#define RENDER_DEPTH ${i.renderDepth?1:0}

uniform float u_ambient;
uniform float u_specularPower;
uniform float u_specularIntensity;
uniform vec3 u_lightDirection;
uniform vec3 u_viewPosition;
#if RENDER_DEPTH
    uniform float u_near;
    uniform float u_far;
#endif
#if HAS_DIFFUSE_TEXTURE
    uniform sampler2D u_texDiffuse;
#else
    uniform vec3 u_diffuseColor;
#endif
#if HAS_SPECULAR_TEXTURE
    uniform sampler2D u_texSpecular;
#endif
#if HAS_AMBIENT_TEXTURE
    uniform sampler2D u_texAmbient;
#endif

in vec3 f_worldPosition;
in vec3 f_normal;
in vec2 f_texCoord;

layout (location = 0) out vec4 o_fragColor;
#if RENDER_NORMALS
    layout (location = 1) out vec4 o_fragNormal;
    #if RENDER_DEPTH
        layout (location = 2) out vec4 o_fragDepth;
    #endif
#elif RENDER_DEPTH
    layout (location = 1) out vec4 o_fragDepth;
#endif

void main() {
#if HAS_DIFFUSE_TEXTURE
    vec3 diffuseColor = texture(u_texDiffuse, f_texCoord).rgb;
#else
    vec3 diffuseColor = u_diffuseColor;
#endif
#if HAS_SPECULAR_TEXTURE
    float specularFactor = texture(u_texSpecular, f_texCoord).r;
#else
    const float specularFactor = 1.0;
#endif
#if HAS_AMBIENT_TEXTURE
    float ambient = u_ambient + texture(u_texAmbient, f_texCoord).r * (1.0 - u_ambient);
#else
    float ambient = u_ambient;
#endif
    vec3 normal = normalize(f_normal);

    float diffuse = ambient + max(0.0, dot(u_lightDirection, normal)) * (1.0 - ambient);
    vec3 viewDirection = normalize(u_viewPosition - f_worldPosition);
    vec3 halfway = normalize(viewDirection + u_lightDirection);
    float specular = max(0.0, dot(normal, halfway));
    vec3 color = diffuseColor * diffuse + vec3(1.0) * (specularFactor * pow(specular, u_specularPower) * u_specularIntensity);
    o_fragColor = vec4(color, 1.0);

#if RENDER_NORMALS
    o_fragNormal = vec4(normal, 1.0);
#endif

#if RENDER_DEPTH
    float depth = gl_FragCoord.z * 2.0 - 1.0; // back to NDC
    depth = (2.0 * u_near * u_far) / (u_far + u_near - depth * (u_far - u_near));
    depth = depth / u_far;
    o_fragDepth = vec4(vec3(depth), 1.0);
#endif
}`,a=typeof t=="string"?pt(t):Promise.resolve(t),r=E=>E===void 0?Promise.resolve(null):typeof E=="string"?Xt(e,E,{wrap:e.REPEAT}):Promise.resolve(E),c=Promise.all([r(s.diffuse),r(s.specular),r(s.ambient)]),o={u_ambient:.15,u_specularPower:64,u_specularFactor:.8,u_lightDirection:P.normalOf(P.all(1)),u_viewPosition:[0,0,0]};s.diffuse||(o.u_diffuseColor=[1,1,1]);let f=lt(e,"__glance-blinn-phong-program",n,h,o);t=await a;let d=ot(e,"__glance-blinn-phong-vao",t.indices,{a_pos:{data:t.positions,height:3},a_normal:{data:t.normals,height:3},a_texCoord:{data:t.texCoords,height:2}},f),l=await c,u={};return l[0]!==null&&(u.u_texDiffuse=l[0]),l[1]!==null&&(u.u_texSpecular=l[1]),l[2]!==null&&(u.u_texAmbient=l[2]),dt(e,t.name,d,f,{cullFace:Z.BACK,depthTest:J.LESS,textures:u})}async function ds(e,t,s){let i=typeof s<"u"&&!Array.isArray(s),n=`#version 300 es
precision highp float;

#define HAS_TEXTURE ${i?1:0}

uniform mat4 u_modelXform;
uniform mat4 u_viewXform;
uniform mat4 u_projectionXform;

in vec3 a_pos;
#if HAS_TEXTURE
    in vec2 a_texCoord;
    out vec2 f_texCoord;
#endif

void main() {
    gl_Position = u_projectionXform * u_viewXform * u_modelXform * vec4(a_pos, 1.0);
#if HAS_TEXTURE
    f_texCoord = a_texCoord;
#endif
}`,h=`#version 300 es
precision mediump float;

#define HAS_TEXTURE ${i?1:0}

uniform vec3 u_color;
#if HAS_TEXTURE
    uniform sampler2D u_texDiffuse;
    in vec2 f_texCoord;
#endif

layout (location = 0) out vec4 o_fragColor;
void main() {
#if HAS_TEXTURE
    o_fragColor = texture(u_texDiffuse, f_texCoord);
#else
    o_fragColor = vec4(u_color, 1.0);
#endif
}`;typeof t=="string"&&(t=await pt(t));let a=t.name.replace(/(-geo)$/,""),r=lt(e,"__glance-flat-program",n,h),c={a_pos:{data:t.positions,height:3}};i&&(c.a_texCoord={data:t.texCoords,height:2});let o=ot(e,`${a}-vao`,t.indices,c,r),f={},d={};return i?typeof s=="string"?d.u_texDiffuse=await Xt(e,s):d.u_texDiffuse=s:f.u_color=s??[1,1,1],dt(e,a,o,r,{cullFace:Z.BACK,depthTest:J.LESS,uniforms:f,textures:d})}async function Es(e,t,s={}){let i=`#version 300 es
precision highp float;
uniform mat4 u_viewXform;
uniform mat4 u_projectionXform;
in vec3 a_pos;
out vec3 f_texCoord;
void main() {
    f_texCoord = a_pos;
    vec4 ndcCoord = u_projectionXform * u_viewXform * vec4(a_pos, 0.0);
    gl_Position = ndcCoord.xyww;
}`,n=`#version 300 es
precision mediump float;

#define RENDER_NORMALS ${s.renderNormals?1:0}
#define RENDER_DEPTH ${s.renderDepth?1:0}

uniform samplerCube u_skybox;

in vec3 f_texCoord;

layout (location = 0) out vec4 o_fragColor;
#if RENDER_NORMALS
    layout (location = 1) out vec4 o_fragNormal;
    #if RENDER_DEPTH
        layout (location = 2) out vec4 o_fragDepth;
    #endif
#elif RENDER_DEPTH
    layout (location = 1) out vec4 o_fragDepth;
#endif

void main() {
    o_fragColor = texture(u_skybox, f_texCoord);
#if RENDER_NORMALS
    o_fragNormal = vec4(vec3(0), 1);
#endif
#if RENDER_DEPTH
    o_fragNormal = vec4(1);
#endif
}`,h=he(e,t,s),a=$t("__glance-skybox-geo"),r=lt(e,"__glance-skybox-program",i,n),c=ot(e,"__glance-skybox-vao",a.indices,{a_pos:{data:a.positions,height:3}},r),o=await h;return dt(e,o.name,c,r,{cullFace:Z.NONE,depthTest:J.LEQUAL,textures:{u_skybox:o}})}async function xs(e,t,s,i={}){let n=`#version 300 es
precision highp float;

in vec2 a_pos;
in vec2 a_texCoord;

out vec2 f_texCoord;

void main() {
    gl_Position = vec4(a_pos, 0.0, 1.0);
    f_texCoord = a_texCoord;
}`;typeof s=="string"&&(s=_t(e,`${t}-fs`,xt.FRAGMENT,s));let h=lt(e,"__glance-quad-program",n,s),a=Gt("__glance-quad-geo"),r=ot(e,`${t}-vao`,a.indices,{a_pos:{data:a.positions,height:2},a_texCoord:{data:a.texCoords,height:2}},h);return Promise.resolve(dt(e,t,r,h,{cullFace:Z.NONE,depthTest:J.NONE,...i}))}function _s(e){if(e.ctx===void 0&&(e.width===void 0||e.height===void 0))throw new Error("Either ctx or width and height must be provided.");let t=e.width??e.ctx.canvas.width,s=e.height??e.ctx.canvas.height;return ht(e.gl,e.name,t,s,{useAnisotropy:!0,internalFormat:T.RGBA8})}function ys(e,t={}){let s=t.gridSize??10,i=t.axisWidth??2,n=t.gridWidth??1,h=t.axisColorX??"rgb(255, 255, 255)",a=t.axisColorY??"rgb(255, 255, 255)",r=t.gridColor??"rgb(255, 255, 255)",c=t.axisAlpha??1,o=t.gridAlpha??.9;if(s%2!=0)throw new Error(`Grid Size must be an even number, got ${s}`);let f=e.canvas.width,d=e.canvas.height,l=Math.max(i,n),u=(f-l*2)/s;e.lineWidth=n,e.lineCap="round",e.globalAlpha=1,e.strokeStyle=r;for(let x=0;x<=s;x++){let _=l+x*u;e.beginPath(),e.moveTo(_,l),e.lineTo(_,d-l),e.stroke(),e.beginPath(),e.moveTo(l,_),e.lineTo(f-l,_),e.stroke()}if(o<1){var E=e.getImageData(0,0,e.canvas.width,e.canvas.height);let x=E.data;for(let _=0;_<x.length;_+=4)x[_+3]*=o;e.putImageData(E,0,0)}e.lineWidth=i,e.globalAlpha=c,e.strokeStyle=h,e.beginPath(),e.moveTo(l,d/2),e.lineTo(f-l,d/2),e.stroke(),e.strokeStyle=a,e.beginPath(),e.moveTo(f/2,l),e.lineTo(f/2,d-l),e.stroke(),e.globalAlpha=1}function ms(e,t,s){try{e.bindTexture(e.TEXTURE_2D,s.glo),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,t.canvas),e.generateMipmap(e.TEXTURE_2D)}finally{e.bindTexture(e.TEXTURE_2D,null)}}function ae(e,t){return Array.from({length:t},()=>e).flat()}function As(e,t,s){return e.slice(t,t+s)}function Ms(e,t=1){if(e.length===0)return[];if(e.length===1)return e[0];Array.isArray(t)?t.length!==e.length&&M(()=>`'quantities' must be either a number or an array with the same length as 'arrays'.
    'quantities' length: ${t.length}
    'arrays' length: ${e.length}`):t=ae([t],e.length);let s=e[0].length/t[0];for(let n=0;n<e.length;n++){let h=t[n];h<1&&M(()=>`'quantity' must be greater than 0, but the value at index ${n} is ${h}`),h%1!==0&&M(()=>`'quantity' must be an integer, but the value at index ${n} is ${h}`),e[n].length%h!==0&&M(()=>`The length of the corresponding array must be a multiple of 'quantity'
    but the quantity at index ${n} is ${h}
    whereas the length of the corresponding array is ${e[n].length}`),e[n].length/h!==s&&M(()=>`All arrays must have the same number of quantities,
    but array ${n} of size ${e[n].length} contains ${e[n].length/h} times ${h} quantities,
    whereas the first array conttains ${e[0].length/h} times ${t[0]} quantities.`)}let i=[];for(let n=0;n<s;n++)for(let h=0;h<e.length;h++){let a=e[h],r=t[h];i.push(...a.slice(n*r,(n+1)*r))}return i}async function Rs(e){try{return await(await fetch(e)).text()}catch(t){throw new Error(`Failed to load code snippet from ${e}: ${t}`)}}return xe(bs);})();
/// @license MIT

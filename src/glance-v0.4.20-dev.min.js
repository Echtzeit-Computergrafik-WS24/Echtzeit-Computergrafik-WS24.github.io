"use strict";var glance=(()=>{var Nt=Object.defineProperty;var ns=Object.getOwnPropertyDescriptor;var hs=Object.getOwnPropertyNames;var as=Object.prototype.hasOwnProperty;var rs=(s,t)=>{for(var e in t)Nt(s,e,{get:t[e],enumerable:!0})},cs=(s,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of hs(t))!as.call(s,n)&&n!==e&&Nt(s,n,{get:()=>t[n],enumerable:!(i=ns(t,n))||i.enumerable});return s};var os=s=>cs(Nt({},"__esModule",{value:!0}),s);var ye={};rs(ye,{AttachmentType:()=>tt,AttributeDataType:()=>z,BlendFunc:()=>ut,BufferUsage:()=>ot,CullFace:()=>et,DepthTest:()=>it,DrawMode:()=>W,EPSILON:()=>H,FramebufferStack:()=>$t,IndexDataType:()=>K,Mat3:()=>V,Mat4:()=>nt,Quat:()=>rt,Rect:()=>Rt,RenderbufferInternalFormat:()=>zt,ShaderStage:()=>pt,TextureCompareFunc:()=>ht,TextureDataTarget:()=>Z,TextureFilter:()=>L,TextureInternalFormat:()=>T,TextureSrcDataType:()=>N,TextureTarget:()=>D,TextureWrap:()=>st,Vec2:()=>k,Vec3:()=>P,Vec4:()=>X,clamp:()=>Y,copyCanvasToTexture:()=>le,countDigits:()=>xs,createAttributeBuffer:()=>Ct,createBPGeometry:()=>ce,createBox:()=>Dt,createCanvasTexture:()=>ue,createCircularPlane:()=>Qs,createDrawCall:()=>_t,createFramebuffer:()=>ms,createIndexBuffer:()=>Xt,createPlane:()=>Zs,createProgram:()=>Et,createRenderbuffer:()=>Ms,createScreenQuat:()=>te,createShader:()=>Ot,createSkybox:()=>oe,createSphere:()=>Js,createTexture:()=>at,createTorusKnot:()=>se,createVertexArrayObject:()=>xt,degrees:()=>fs,draw:()=>bs,draw2DGrid:()=>fe,getBaricentricCoordinates:()=>he,getContext:()=>As,hex:()=>ds,interleaveArrays:()=>Ee,isPowerOf2:()=>Es,loadCodeSnippet:()=>xe,loadCubemap:()=>Jt,loadDataVolume:()=>re,loadObj:()=>Pt,loadTexture:()=>bt,mapRange:()=>_s,mulberry32:()=>qs,nextEven:()=>ys,openSimplex2SHeightmap:()=>Ks,radians:()=>us,range:()=>ls,repeat:()=>ts,resetContext:()=>ws,slice:()=>de,uniquifyVertices:()=>ne,updateFramebufferLayer:()=>Rs,updateTextureData:()=>yt});function C(s){console.log(s())}function B(s){console.warn(s())}function b(s){throw new Error(s())}function g(s,t){if(!s)throw new Error(t?t():"Assertion failed.")}var Ae=async function(){}.constructor;function lt(s,t){if(s===t)return!0;if(s===null||t===null||s===void 0||t===void 0||typeof s!=typeof t||typeof s!="object")return!1;if(Array.isArray(s)){if(!Array.isArray(t)||s.length!==t.length)return!1;for(let e=0;e<s.length;e++)if(!lt(s[e],t[e]))return!1}else{let e=Object.keys(s);if(e.length!==Object.keys(t).length)return!1;for(let i of e)if(!lt(s[i],t[i]))return!1}return!0}function q(s){if(typeof s!="object"||s===null)return s;let t,e,i=Object.prototype.toString.call(s);if(i==="[object Object]"){if(s.constructor!==Object&&typeof s.constructor=="function"){e=new s.constructor;for(t in s)s.hasOwnProperty(t)&&e[t]!==s[t]&&(e[t]=q(s[t]))}else{e={};for(t in s)t==="__proto__"?Object.defineProperty(e,t,{value:q(s[t]),configurable:!0,enumerable:!0,writable:!0}):e[t]=q(s[t])}return e}if(i==="[object Array]"){for(t=s.length,e=Array(t);t--;)e[t]=q(s[t]);return e}return i==="[object Set]"?(e=new Set,s.forEach(function(n){e.add(q(n))}),e):i==="[object Map]"?(e=new Map,s.forEach(function(n,h){e.set(q(h),q(n))}),e):i==="[object Date]"?new Date(+s):i==="[object RegExp]"?(e=new RegExp(s.source,s.flags),e.lastIndex=s.lastIndex,e):i==="[object DataView]"?new s.constructor(q(s.buffer)):i==="[object ArrayBuffer]"?s.slice(0):i.slice(-6)==="Array]"?new s.constructor(s):s}function ct(s){throw new Error(`Unexpected object: ${s}`)}var H=1e-7;function us(s){return s*Math.PI/180}function fs(s){return s*180/Math.PI}function Y(s,t,e){return Math.min(Math.max(s,t),e)}function*ls(s,t,e=1){s=Math.round(s),t===void 0?(t=s,s=0):t=Math.round(t),e=Math.max(1,Math.round(Math.abs(e)));let i=Math.sign(t-s)||1;for(;Math.sign(t-s)!==-i;)yield s,s+=e*i}function ds(s){return s.toString(16).padStart(2,"0")}function Es(s){return Number.isInteger(s)&&(s&s-1)===0}function xs(s){return s===0?1:Math.floor(Math.log10(Math.abs(s)))+1}function ys(s){return Math.ceil(s/2)*2}function _s(s,t,e,i=0,n=1){return i+(s-t)/(e-t)*(n-i)}var pt;(function(s){s[s.VERTEX=35633]="VERTEX",s[s.FRAGMENT=35632]="FRAGMENT"})(pt||(pt={}));var tt;(function(s){s[s.TEXTURE=1]="TEXTURE",s[s.RENDERBUFFER=2]="RENDERBUFFER"})(tt||(tt={}));var z;(function(s){s[s.BYTE=5120]="BYTE",s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.SHORT=5122]="SHORT",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.INT=5124]="INT",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.FLOAT=5126]="FLOAT",s[s.HALF_FLOAT=5131]="HALF_FLOAT",s[s.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV"})(z||(z={}));var K;(function(s){s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT"})(K||(K={}));var ot;(function(s){s[s.STATIC_DRAW=35044]="STATIC_DRAW",s[s.STREAM_DRAW=35040]="STREAM_DRAW",s[s.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",s[s.STATIC_READ=35045]="STATIC_READ",s[s.DYNAMIC_READ=35049]="DYNAMIC_READ",s[s.STREAM_READ=35041]="STREAM_READ",s[s.STATIC_COPY=35046]="STATIC_COPY",s[s.DYNAMIC_COPY=35050]="DYNAMIC_COPY",s[s.STREAM_COPY=35042]="STREAM_COPY"})(ot||(ot={}));var D;(function(s){s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_3D=32879]="TEXTURE_3D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(D||(D={}));var Z;(function(s){s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s[s.TEXTURE_3D=32879]="TEXTURE_3D",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(Z||(Z={}));var N;(function(s){s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.HALF_FLOAT=5131]="HALF_FLOAT",s[s.FLOAT=5126]="FLOAT"})(N||(N={}));var T;(function(s){s[s.R8=33321]="R8",s[s.R16F=33325]="R16F",s[s.R32F=33326]="R32F",s[s.R8UI=33330]="R8UI",s[s.RG8=33323]="RG8",s[s.RG16F=33327]="RG16F",s[s.RG32F=33328]="RG32F",s[s.RG8UI=33336]="RG8UI",s[s.RGB8=32849]="RGB8",s[s.SRGB8=35905]="SRGB8",s[s.RGB565=36194]="RGB565",s[s.R11F_G11F_B10F=35898]="R11F_G11F_B10F",s[s.RGB9_E5=35901]="RGB9_E5",s[s.RGB16F=34843]="RGB16F",s[s.RGB32F=34837]="RGB32F",s[s.RGB8UI=36221]="RGB8UI",s[s.RGBA8=32856]="RGBA8",s[s.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",s[s.RGB5_A1=32855]="RGB5_A1",s[s.RGBA4=32854]="RGBA4",s[s.RGB10_A2=32857]="RGB10_A2",s[s.RGBA16F=34842]="RGBA16F",s[s.RGBA32F=34836]="RGBA32F",s[s.RGBA8UI=36220]="RGBA8UI",s[s.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",s[s.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",s[s.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",s[s.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",s[s.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",s[s.STENCIL_INDEX8=36168]="STENCIL_INDEX8"})(T||(T={}));var L;(function(s){s[s.NEAREST=9728]="NEAREST",s[s.LINEAR=9729]="LINEAR",s[s.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",s[s.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",s[s.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",s[s.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(L||(L={}));var st;(function(s){s[s.REPEAT=10497]="REPEAT",s[s.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(st||(st={}));var ht;(function(s){s[s.NONE=0]="NONE",s[s.NEVER=512]="NEVER",s[s.LESS=513]="LESS",s[s.EQUAL=514]="EQUAL",s[s.LEQUAL=515]="LEQUAL",s[s.GREATER=516]="GREATER",s[s.NOTEQUAL=517]="NOTEQUAL",s[s.GEQUAL=518]="GEQUAL",s[s.ALWAYS=519]="ALWAYS"})(ht||(ht={}));var zt;(function(s){s[s.RGBA4=32854]="RGBA4",s[s.RGB565=36194]="RGB565",s[s.RGB5_A1=32855]="RGB5_A1",s[s.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",s[s.STENCIL_INDEX8=36168]="STENCIL_INDEX8",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s[s.R8=33321]="R8",s[s.R8UI=33330]="R8UI",s[s.R8I=33329]="R8I",s[s.R16UI=33332]="R16UI",s[s.R16I=33331]="R16I",s[s.R32UI=33334]="R32UI",s[s.R32I=33333]="R32I",s[s.RG8=33323]="RG8",s[s.RG8UI=33336]="RG8UI",s[s.RG8I=33335]="RG8I",s[s.RG16UI=33338]="RG16UI",s[s.RG16I=33337]="RG16I",s[s.RG32UI=33340]="RG32UI",s[s.RG32I=33339]="RG32I",s[s.RGB8=32849]="RGB8",s[s.RGBA8=32856]="RGBA8",s[s.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",s[s.RGB10_A2=32857]="RGB10_A2",s[s.RGBA8UI=36220]="RGBA8UI",s[s.RGBA8I=36238]="RGBA8I",s[s.RGB10_A2UI=36975]="RGB10_A2UI",s[s.RGBA16UI=36214]="RGBA16UI",s[s.RGBA16I=36232]="RGBA16I",s[s.RGBA32I=36226]="RGBA32I",s[s.RGBA32UI=36208]="RGBA32UI",s[s.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",s[s.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",s[s.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",s[s.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",s[s.R16F=33325]="R16F",s[s.RG16F=33327]="RG16F",s[s.RGBA16F=34842]="RGBA16F",s[s.R32F=33326]="R32F",s[s.RG32F=33328]="RG32F",s[s.RGBA32F=34836]="RGBA32F",s[s.R11F_G11F_B10F=35898]="R11F_G11F_B10F"})(zt||(zt={}));var et;(function(s){s[s.NONE=0]="NONE",s[s.FRONT=1028]="FRONT",s[s.BACK=1029]="BACK",s[s.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(et||(et={}));var it;(function(s){s[s.NONE=0]="NONE",s[s.NEVER=512]="NEVER",s[s.LESS=513]="LESS",s[s.EQUAL=514]="EQUAL",s[s.LEQUAL=515]="LEQUAL",s[s.GREATER=516]="GREATER",s[s.NOTEQUAL=517]="NOTEQUAL",s[s.GEQUAL=518]="GEQUAL",s[s.ALWAYS=519]="ALWAYS"})(it||(it={}));var ut;(function(s){s[s.ZERO=0]="ZERO",s[s.ONE=1]="ONE",s[s.SRC_COLOR=768]="SRC_COLOR",s[s.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",s[s.DST_COLOR=774]="DST_COLOR",s[s.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",s[s.SRC_ALPHA=770]="SRC_ALPHA",s[s.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",s[s.DST_ALPHA=772]="DST_ALPHA",s[s.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",s[s.CONSTANT_COLOR=32769]="CONSTANT_COLOR",s[s.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",s[s.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",s[s.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",s[s.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(ut||(ut={}));var W;(function(s){s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP"})(W||(W={}));function As(s,t={}){let e=null;typeof s=="string"?(e=document.querySelector(`#${s}`),e==null&&b(()=>`Could not find canvas element with id "${s}"`)):s instanceof HTMLCanvasElement?e=s:b(()=>`Invalid canvas element "${s}"`);let i=e.id??"unnamed canvas",n=e.getContext("webgl2",{alpha:t.alpha??!0,depth:t.depth??!0,stencil:t.stencil??!1,antialias:t.antialias??!1,premultipliedAlpha:t.premultipliedAlpha??!1,preserveDrawingBuffer:t.preserveDrawingBuffer??!0,powerPreference:t.powerPreference??"high-performance",desynchronized:t.desynchronized??!0});return n===null&&b(()=>`Could not acquire a WebGL2 context from canvas "${i}"`),n.getExtension("EXT_color_buffer_float")===null&&B(()=>"Extension 'EXT_color_buffer_float' is not supported."),n.getExtension("EXT_texture_filter_anisotropic")===null&&B(()=>"Extension 'EXT_texture_filter_anisotropic' is not supported."),n.__glance={generation:1,shaders:new Map,programs:new Map,buffers:new Array,vaos:new Array,textures:new Array,renderbuffers:new Array,framebuffers:new Array},n}function Ot(s,t,e,i){e!==s.VERTEX_SHADER&&e!==s.FRAGMENT_SHADER&&b(()=>`Invalid shader stage ${e} for shader "${t}"`);let n=e===s.VERTEX_SHADER?"vertex":"fragment";{let r=s.__glance.shaders.get(i);if(r){let c=r.object;return c.stage!==e&&b(()=>`Shader "${t}" already exists as a ${c.stage===s.VERTEX_SHADER?"vertex":"fragment"} shader.`),r.generation=s.__glance.generation,C(()=>`Reusing cached ${n} shader "${t}"`),c}}let h=s.createShader(e);if(h||b(()=>`Failed to create ${n} shader "${t}"`),s.shaderSource(h,i),s.compileShader(h),!s.getShaderParameter(h,s.COMPILE_STATUS)){let r=s.getShaderInfoLog(h);s.deleteShader(h),b(()=>`Failed to compile ${n} shader "${t}": ${r}`)}let a={glo:h,name:t,stage:e,source:i};return C(()=>`Created ${n} shader "${t}"`),s.__glance.shaders.set(i,{object:a,generation:s.__glance.generation}),a}function Et(s,t,e,i,n){let h=`${typeof e=="string"?e:e.source}
${typeof i=="string"?i:i.source}`,a=s.__glance.programs.get(h);if(a)return a.generation=s.__glance.generation,C(()=>`Reusing cached program "${t}"`),a.object;let r=t.replace(/(-program|-shader)$/,"");typeof e=="string"?e=Ot(s,`${r}-vertex`,s.VERTEX_SHADER,e):(!s.isShader(e.glo)||e.stage!==s.VERTEX_SHADER)&&b(()=>`Invalid vertex shader for program "${t}"`),typeof i=="string"?i=Ot(s,`${r}-fragment`,s.FRAGMENT_SHADER,i):(!s.isShader(i.glo)||i.stage!==s.FRAGMENT_SHADER)&&b(()=>`Invalid fragment shader for program "${t}"`);let c=s.createProgram();c||b(()=>`Failed to create program "${t}"`),s.attachShader(c,e.glo),s.attachShader(c,i.glo),s.linkProgram(c);try{s.getProgramParameter(c,s.LINK_STATUS)||b(()=>`Failed to link shader program "${t}": ${s.getProgramInfoLog(c)}
Vertex Shader log: ${s.getShaderInfoLog(e.glo)}
Fragent Shader log: ${s.getShaderInfoLog(i.glo)}`);let o={name:t,vertex:e,fragment:i,glo:c,attributes:new Map,uniforms:new Map};return Ts(s,o),vs(s,o,n??{}),C(()=>`Created program "${t}"`),s.__glance.programs.set(h,{object:o,generation:s.__glance.generation}),o}catch(o){throw s.deleteProgram(c),o}}function Ct(s,t,e,i){i=i??ot.STATIC_DRAW;let n=new Map,h,a=0;for(let[l,u]of Object.entries(e)){let E={type:u.type??z.FLOAT,height:u.height,width:u.width??1,normalized:u.normalized,divisor:u.divisor},x=E.height*E.width;x===0&&b(()=>`Invalid size ${x} for Attribute "${l}" of ABO "${t}"`);let y=u.data.length/x;y===0&&b(()=>`The data for Attribute "${l}" of ABO "${t}" must not be empty.`),y%1!==0&&b(()=>`The data length for Attribute "${l}" of ABO "${t}" must be a multiple of the number of scalars required per attribute. Data length is ${u.data.length}, attribute length is ${x}.`),ps(E.type)&&(E.height!==3&&E.height!==4&&b(()=>`Attribute "${l}" of ABO "${t}" must have a height of 3 or 4 when using packed integer data.`),E.width!==1&&b(()=>`Attribute "${l}" of ABO "${t}" must have a width of 1 when using packed integer data.`)),h===void 0?h=y:h!==y&&b(()=>`Attribute buffer "${t}" has inconsistent vertex counts`),n.set(l,E),a+=x*dt(E.type)}h===void 0&&b(()=>`Attribute Buffer "${t}" must have at least one attribute.`);let r=new ArrayBuffer(h*a),c=new DataView(r),o=new Map([[z.BYTE,c.setInt8.bind(c)],[z.UNSIGNED_BYTE,c.setUint8.bind(c)],[z.SHORT,c.setInt16.bind(c)],[z.UNSIGNED_SHORT,c.setUint16.bind(c)],[z.INT,c.setInt32.bind(c)],[z.UNSIGNED_INT,c.setUint32.bind(c)],[z.FLOAT,c.setFloat32.bind(c)],[z.HALF_FLOAT,(l,u)=>c.setUint16(l,Us(u),!0)]]),f=0;for(let[l,u]of n.entries()){let E=e[l].data,x=u.height*u.width,y=dt(u.type),A=x*y,M=a-A,_=f,m=o.get(u.type);if(m)for(let R=0;R<E.length;R++)g(_<r.byteLength,()=>`Attribute "${l}" of ABO "${t}" is out of bounds.`),m(_,E[R],!0),_+=y,(R+1)%x===0&&(_+=M);else{let R;switch(u.type){case z.INT_2_10_10_10_REV:{R=Os;break}case z.UNSIGNED_INT_2_10_10_10_REV:{R=gs;break}default:b(()=>`Unsupported data type for attribute "${l}" of buffer "${t}"`)}if(u.height===3)for(let w=0;w<E.length;w+=3)c.setUint32(_,R(E[w],E[w+1],E[w+2],1),!1),_+=M;else for(let w=0;w<E.length;w+=4)c.setUint32(_,R(E[w],E[w+1],E[w+2],E[w+3]),!1),_+=M}f+=A}let d=s.createBuffer();d||b(()=>`Failed to create attribute buffer "${t}"`);try{return s.bindBuffer(s.ARRAY_BUFFER,d),s.bufferData(s.ARRAY_BUFFER,r,i),C(()=>`Created Attribute Buffer "${t}" with ${n.size} attributes for ${h} vertices and a size of ${r.byteLength} bytes.`),s.__glance.buffers.push(d),{glo:d,name:t,vertexCount:h,attributes:n,usage:i}}catch(l){throw s.deleteBuffer(d),l}finally{s.bindBuffer(s.ARRAY_BUFFER,null)}}function Xt(s,t,e,i={}){let n=i.drawMode??W.TRIANGLES;switch(g(e.length>0,()=>`Index buffer "${t}" must have at least one index.`),n){case W.TRIANGLES:g(e.length%3===0,()=>`Size of Index buffer "${t}" with draw mode 'TRIANGLES' must be a multiple of 3.`);break;case W.TRIANGLE_STRIP:g(e.length>=3,()=>`Size of Index buffer "${t}" draw mode 'TRIANGLE_STRIP' must be at least 3.`);break;case W.LINES:g(e.length%2===0,()=>`Size of Index buffer "${t}" with draw mode 'LINES' must be a multiple of 2.`);break;case W.LINE_STRIP:g(e.length>=2,()=>`Size of Index buffer "${t}" with draw mode 'LINE_STRIP' must be at least 2.`);break;case W.LINE_LOOP:g(e.length>=2,()=>`Size of Index buffer "${t}" with draw mode 'LINE_LOOP' must be at least 2.`);break;case W.POINTS:break;default:b(()=>`Index buffer "${t}" has invalid draw mode: ${n}.`)}e.some(f=>!Number.isSafeInteger(f))&&b(()=>`Index buffer "${t}" must contain only (safe) integers.`);let h=0;for(let f of e)h=Math.max(h,f);let a;h<256?a=K.UNSIGNED_BYTE:h<65536?a=K.UNSIGNED_SHORT:h<4294967296?a=K.UNSIGNED_INT:b(()=>`Index ${h} does not fit in a 32-bit unsigned integer.`);let r;switch(a){case K.UNSIGNED_BYTE:r=new Uint8Array(e);break;case K.UNSIGNED_SHORT:r=new Uint16Array(e);break;case K.UNSIGNED_INT:r=new Uint32Array(e);break}let c=s.createBuffer();c||b(()=>`Failed to create index buffer "${t}"`);let o=i.usage??ot.STATIC_DRAW;try{return s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,c),s.bufferData(s.ELEMENT_ARRAY_BUFFER,r,o),C(()=>`Created Index Buffer "${t}" with ${e.length} indices and a size of ${r.byteLength} bytes.`),s.__glance.buffers.push(c),{glo:c,name:t,type:a,size:e.length,usage:o,drawMode:n}}catch(f){throw s.deleteBuffer(c),f}finally{s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null)}}function xt(s,t,e,i,n){let h=t.replace(/-vao$/,"");Array.isArray(e)&&(e=Xt(s,`${h}-ibo`,e)),!Array.isArray(i)&&!i.hasOwnProperty("glo")&&(i=Ct(s,`${h}-abo`,i)),Array.isArray(i)||(i=[i]);let a=s.createVertexArray();a||b(()=>`Failed to create VAO "${t}"`);let r=new Map;try{s.bindVertexArray(a),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.glo);let c=s.getParameter(s.MAX_VERTEX_ATTRIBS);for(let o of i){s.bindBuffer(s.ARRAY_BUFFER,o.glo);let f=zs(o),d=0;for(let[l,u]of o.attributes){let E=d;d+=Ht(u);let x=n.attributes.get(l);if(!x)continue;if(r.has(x.location)){let A=r.get(x.location).buffer;console.warn(`Ignoring attribute "${l}" in buffer "${o.name}" as the attribute is already bound to buffer "${A.name}".`);continue}r.set(x.location,{buffer:o,name:l});let y=u.height*dt(u.type);for(let A=0;A<u.width;++A){let M=x.location+A;M>=c&&b(()=>`Attribute "${l}" of VAO "${t}" cannot be bound to location ${M}, because it would exceed the maximum number of vertex attributes (${c}).`);let _=E+A*y;s.enableVertexAttribArray(M),Ns(u.type)?s.vertexAttribIPointer(M,u.height,u.type,f,_):s.vertexAttribPointer(M,u.height,u.type,u.normalized||!1,f,_),s.vertexAttribDivisor(M,u.divisor||0)}}}return C(()=>`Created Vertex Array Object "${t}" with ${r.size} attributes.`),s.__glance.vaos.push(a),{glo:a,name:t,ibo:e,attributes:r}}catch(c){throw s.deleteVertexArray(a),c}finally{s.bindVertexArray(null),s.bindBuffer(s.ARRAY_BUFFER,null),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null)}}function at(s,t,e,i,n={}){let h=n.target??D.TEXTURE_2D;n.depth!==void 0&&(!Number.isSafeInteger(n.depth)||n.depth<1)&&b(()=>`Invalid depth ${n.depth} for texture "${t}"`);let a=n.depth??1,r=Ls(h);h==D.TEXTURE_2D||h==D.TEXTURE_CUBE_MAP?(a!==1&&B(()=>`Ignoring given depth ${a} of ${r} texture "${t}".`),(e<1||i<1||!Number.isSafeInteger(e)||!Number.isSafeInteger(i))&&b(()=>`Invalid texture dimensions: ${e}x${i} of ${r} texture "${t}".`)):(e<1||i<1||a<1||!Number.isSafeInteger(e)||!Number.isSafeInteger(i)||!Number.isSafeInteger(a))&&b(()=>`Invalid texture dimensions: ${e}x${i}x${a} of ${r} texture "${t}".`);let c=Math.floor(Math.log2(Math.max(e,i,a)))+1;n.levels!==void 0&&((n.levels<1||!Number.isSafeInteger(n.levels))&&b(()=>`Invalid number of levels for ${r} texture "${t}": ${n.levels}.`),n.levels>c&&(B(()=>`Ignoring given number of levels for ${r} texture "${t}" because ${n.levels} is larger than the maximum possible number of levels ${c}.`),n.levels=c));let o=n.levels??c,f=n.internalFormat??T.RGBA8;n.compareFunc&&!ks(f)&&(B(()=>`Ignoring given comparison function for ${r} texture "${t}" because it is not a depth texture.`),n.compareFunc=ht.NONE);let d=n.compareFunc??ht.NONE,l=s.createTexture();l===null&&b(()=>`Failed to create WebGL texture for ${r} texture "${t}"`);try{let u=n.wipTextureUnit??Wt(s,n.wipTextureUnit);if(s.activeTexture(s.TEXTURE0+u),s.bindTexture(h,l),a===1){if(s.texStorage2D(h,o,f,e,i),f===T.RGBA8){let _=new Uint8Array(e*i*4);if(h===D.TEXTURE_2D)s.texSubImage2D(h,0,0,0,e,i,s.RGBA,s.UNSIGNED_BYTE,_);else for(let m=0;m<6;++m)s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,0,0,e,i,s.RGBA,s.UNSIGNED_BYTE,_);o>1&&s.generateMipmap(h)}d!==ht.NONE&&(s.texParameteri(h,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(h,s.TEXTURE_COMPARE_FUNC,d))}else s.texStorage3D(h,o,f,e,i,a);let E,x;n.filter===void 0?(o>1?E=L.LINEAR_MIPMAP_LINEAR:E=L.LINEAR,x=L.LINEAR):Array.isArray(n.filter)?(E=n.filter[0],x=n.filter[1]):(E=n.filter,x=n.filter),o===1&&([L.NEAREST,L.LINEAR].includes(E)||(B(()=>`Ignoring given minification filter for ${r} texture "${t}" because it has only one level.`),[L.NEAREST_MIPMAP_NEAREST,L.NEAREST_MIPMAP_LINEAR].includes(E)?E=L.NEAREST:E=L.LINEAR)),[L.NEAREST,L.LINEAR].includes(x)||(B(()=>`Ignoring given magnification filter for ${r} texture "${t}".`),[L.NEAREST_MIPMAP_NEAREST,L.NEAREST_MIPMAP_LINEAR].includes(x)?x=L.NEAREST:x=L.LINEAR),Vs(f)&&(![L.NEAREST,L.NEAREST_MIPMAP_NEAREST].includes(E)||x!==L.NEAREST)&&s.getExtension("OES_texture_float_linear")===null&&(B(()=>"Linear filtering for floating point textures is not supported on this system."),E=L.NEAREST,x=L.NEAREST),s.texParameteri(h,s.TEXTURE_MIN_FILTER,E),s.texParameteri(h,s.TEXTURE_MAG_FILTER,x);let y,A,M;if(n.wrap===void 0?(y=st.CLAMP_TO_EDGE,A=st.CLAMP_TO_EDGE,M=st.CLAMP_TO_EDGE):Array.isArray(n.wrap)?(y=n.wrap[0],A=n.wrap[1],M=n.wrap[2]??st.CLAMP_TO_EDGE,h===D.TEXTURE_2D&&n.wrap.length>2&&B(()=>`Ignoring given wrap R mode for ${r} texture "${t}" because it has only two dimensions.`)):(y=n.wrap,A=n.wrap,M=n.wrap),s.texParameteri(h,s.TEXTURE_WRAP_S,y),s.texParameteri(h,s.TEXTURE_WRAP_T,A),h!==D.TEXTURE_2D&&s.texParameteri(h,s.TEXTURE_WRAP_R,M),n.useAnisotropy){let _=s.getExtension("EXT_texture_filter_anisotropic");_?s.texParameterf(s.TEXTURE_2D,_.TEXTURE_MAX_ANISOTROPY_EXT,s.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):B(()=>"Anisotropic filtering is not supported.")}return C(()=>`Created ${r} texture "${t}" with dimensions ${e}x${i}x${a} and ${o} levels.`),s.__glance.textures.push(l),{glo:l,name:t,target:h,width:e,height:i,depth:a,levels:o,internalFormat:f,compareFunc:d,attachmentType:tt.TEXTURE}}catch(u){throw s.deleteTexture(l),u.message=`Failed to create ${r} texture "${t}": ${u.message}`,u}finally{s.bindTexture(h,null),s.activeTexture(s.TEXTURE0)}}function yt(s,t,e,i={}){i.dataTarget===void 0?t.target===D.TEXTURE_CUBE_MAP&&b(()=>`You need to specify an explicit target when updating a face of cube map texture "${t.name}".`):t.target===D.TEXTURE_CUBE_MAP&&(i.dataTarget>=Z.TEXTURE_CUBE_MAP_POSITIVE_X&&i.dataTarget<=Z.TEXTURE_CUBE_MAP_NEGATIVE_Z||b(()=>`Invalid data target '${i.dataTarget}' for cube map texture: "${t.name}".`));let n=i.dataTarget??t.target;i.level!==void 0&&(i.level<0||!Number.isSafeInteger(i.level))&&b(()=>`Invalid mipmap level: ${i.level}.`);let h=i.level??0,a=Wt(s,i.wipTextureUnit);i.srcDataType===void 0?ArrayBuffer.isView(e)?i.srcDataType=Fs(e):i.srcDataType=N.UNSIGNED_BYTE:ArrayBuffer.isView(e)?Cs(e,i.srcDataType):i.srcDataType!==N.UNSIGNED_BYTE&&b(()=>"When defining a texture with a 'TexImageSource', the source data type must be 'UNSIGNED_BYTE'");let r=i.srcDataType;Xs(t.internalFormat,r)||b(()=>`Invalid combination of internal format ${t.internalFormat} and source data type ${r}. See https://registry.khronos.org/webgl/specs/latest/2.0/#TEXTURE_TYPES_FORMATS_FROM_DOM_ELEMENTS_TABLE`);let c=Hs(s,t.internalFormat),o=i.flipY??t.target===D.TEXTURE_2D,f=i.createMipMaps??t.levels>1;try{s.activeTexture(s.TEXTURE0+a),s.bindTexture(t.target,t.glo),o&&s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),t.depth>1?s.texSubImage3D(n,h,0,0,0,t.width,t.height,t.depth,c,r,e):s.texSubImage2D(n,h,0,0,t.width,t.height,c,r,e),f&&s.generateMipmap(t.target)}catch(d){throw d.message=`Failed to define texture "${t.name}": ${d.message}`,d}finally{s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE0)}}function Ms(s,t,e,i,n){(e<1||i<1||!Number.isSafeInteger(e)||!Number.isSafeInteger(i))&&b(()=>`Invalid renderbuffer dimensions: ${e}x${i} of renderbuffer "${t}".`);let h=s.getParameter(s.MAX_RENDERBUFFER_SIZE);(e>h||i>h)&&b(()=>`Renderbuffer "${t}" exceeds the maximum renderbuffer size of ${h}.`);let a=s.createRenderbuffer();a===null&&b(()=>`Failed to create a new WebGL renderbuffer object for "${t}".`);try{return s.bindRenderbuffer(s.RENDERBUFFER,a),s.renderbufferStorage(s.RENDERBUFFER,n,e,i),C(()=>`Created Renderbuffer "${t}" with dimensions ${e}x${i} and internal format ${n}.`),s.__glance.renderbuffers.push(a),{glo:a,name:t,width:e,height:i,internalFormat:n,attachmentType:tt.RENDERBUFFER}}catch(r){throw s.deleteRenderbuffer(a),r}finally{s.bindRenderbuffer(s.RENDERBUFFER,null)}}function ms(s,t,e=null,i=null,n=null){let h=u=>Object.hasOwn(u,"attachmentType"),a=(Array.isArray(e)?e:e===null?[]:[e]).map(u=>h(u)?{attachment:u}:u),r=i===null?null:h(i)?{attachment:i}:i,c=n===null?null:h(n)?{attachment:n}:n,o=s.getParameter(s.MAX_COLOR_ATTACHMENTS);a.length>o&&b(()=>`Framebuffer "${t}" has ${a.length} color attachments, but the maximum is ${o}.`);let f;for(let u=0;u<a.length;++u){let E=a[u].attachment;f===void 0?f=[E.width,E.height]:(E.width!==f[0]||E.height!==f[1])&&b(()=>`Framebuffer "${t}" has color attachments with different dimensions.`)}if(r!==null){let u=r.attachment;f===void 0?f=[u.width,u.height]:(u.width!==f[0]||u.height!==f[1])&&b(()=>`Framebuffer "${t}" has color/depth attachments with different dimensions.`)}let d=s.createFramebuffer();d===null&&b(()=>`Failed to create a new WebGL framebuffer object for "${t}".`);function l(u,E){let x=E===s.DEPTH_ATTACHMENT?"depth":`color[${E-s.COLOR_ATTACHMENT0}]`;if(u.attachment.attachmentType===tt.TEXTURE){let y=u.attachment;if(y.target===D.TEXTURE_2D)(u.target??Z.TEXTURE_2D)!==Z.TEXTURE_2D&&B(()=>`Ignoring the target "${u.target}" for ${x} attachment of framebuffer "${t}", using 'gl.TEXTURE_2D' instead.`),s.framebufferTexture2D(s.FRAMEBUFFER,E,s.TEXTURE_2D,y.glo,u.level??0);else if(y.target===D.TEXTURE_CUBE_MAP)u.target===void 0&&b(()=>`Missing target for cubemap ${x} attachment of framebuffer "${t}".`),u.target>=Z.TEXTURE_CUBE_MAP_POSITIVE_X&&u.target<=Z.TEXTURE_CUBE_MAP_NEGATIVE_Z||b(()=>`Invalid data target for cube map texture: ${u.target}.`),s.framebufferTexture2D(s.FRAMEBUFFER,E,u.target,y.glo,u.level??0);else{if(u.target??y.target!==y.target){let A=y.target===D.TEXTURE_2D_ARRAY?"gl.TEXTURE_2D_ARRAY":"gl.TEXTURE_3D";B(()=>`Ignoring the target "${u.target}" for ${x} attachment of framebuffer "${t}", using ${A} instead.`)}if(u.layer===void 0){let A=y.target===D.TEXTURE_2D_ARRAY?"2D array":"3D";B(()=>`Missing layer for ${x} attachment (which is a ${A} texture) of framebuffer "${t}", using layer 0 by default.`)}s.framebufferTextureLayer(s.FRAMEBUFFER,E,y.glo,u.level??0,u.layer??0)}}else{let y=u.attachment;u.level!==void 0&&B(()=>`Ignoring given level ${u.level} for renderbuffer ${x} attachment of framebuffer "${t}".`),u.target!==void 0&&B(()=>`Ignoring given target ${u.target} for renderbuffer ${x} attachment of framebuffer "${t}".`),s.framebufferRenderbuffer(s.FRAMEBUFFER,E,s.RENDERBUFFER,y.glo)}}try{if(s.bindFramebuffer(s.FRAMEBUFFER,d),a.length===0)s.drawBuffers([s.NONE]),s.readBuffer(s.NONE);else{let E=[];for(let x=0;x<a.length;++x){let y=s.COLOR_ATTACHMENT0+x;l(a[x],y),E.push(y)}s.drawBuffers(E)}r!==null&&l(r,s.DEPTH_ATTACHMENT),c!==null&&b(()=>"Stencil attachments are not supported yet.");let u=s.checkFramebufferStatus(s.FRAMEBUFFER);return u!==s.FRAMEBUFFER_COMPLETE&&b(()=>{switch(u){case s.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return`Incomplete framebuffer '${t}'! One or more framebuffer attachment points are incomplete.`;case s.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return`Incomplete framebuffer '${t}'! One or more of the framebuffer attachment's dimensions are not the same.`;case s.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return`Incomplete framebuffer '${t}'! No images are attached to the framebuffer.`;case s.FRAMEBUFFER_UNSUPPORTED:return`Incomplete framebuffer '${t}'! The combination of internal formats of the attached images violates an implementation-dependent set of restrictions.`;case s.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return`Incomplete framebuffer '${t}'! The value of GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES is not the same for all attached textures.`;default:return`Incomplete framebuffer '${t}'! Unknown error code ${u}.`}}),r!==null?c!==null?C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments, and a depth- and stencil attachment.`):C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments and a depth attachment.`):c!==null?C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments and a stencil attachment.`):C(()=>`Created Framebuffer "${t}" with ${a.length} color attachments.`),s.__glance.framebuffers.push(d),{glo:d,name:t,color:a,depth:r,stencil:c}}catch(u){throw s.deleteFramebuffer(d),u.message=`Failed to define framebuffer "${t}": ${u.message}`,u}finally{s.bindFramebuffer(s.FRAMEBUFFER,null)}}function Rs(s,t,e,i,n=0){let h,a;switch(e){case s.DEPTH_ATTACHMENT:h=t.depth??b(()=>`Framebuffer "${t.name}" has no depth attachment.`),a="depth";break;case s.STENCIL_ATTACHMENT:h=t.stencil??b(()=>`Framebuffer "${t.name}" has no stencil attachment.`),a="stencil";break;default:h=t.color[e-s.COLOR_ATTACHMENT0]??b(()=>`Framebuffer "${t.name}" has no color attachment at location ${e}.`),a=`color[${e-s.COLOR_ATTACHMENT0}]`}if(h.layer===i&&h.level===(n??h.level))return;h.attachment.attachmentType!==tt.TEXTURE&&b(()=>`Framebuffer "${t.name}" has no texture as its ${a} attachment, but a renderbuffer.`);let r=h.attachment;if(r.target!==D.TEXTURE_2D_ARRAY&&r.target!==D.TEXTURE_3D){let o=r.target===D.TEXTURE_2D?"2D":"cubemap";b(()=>`Framebuffer "${t.name}" has no 3D or 2D array texture as its ${a} attachment, but a ${o} texture.`)}(i<0||i>=r.depth)&&b(()=>`Invalid layer ${i} for ${a} attachment of framebuffer "${t.name}", which has a depth of ${r.depth}.`);let c=s.getParameter(s.FRAMEBUFFER_BINDING);try{s.bindFramebuffer(s.FRAMEBUFFER,t.glo),s.framebufferTextureLayer(s.FRAMEBUFFER,e,r.glo,n??h.level??0,i)}finally{s.bindFramebuffer(s.FRAMEBUFFER,c)}}function _t(s,t,e,i,n={}){n.indexCount!==void 0&&n.indexCount<=0&&b(()=>`Invalid index count: ${n.indexCount}.`),n.indexOffset!==void 0&&(n.indexOffset<0&&b(()=>`Invalid index offset: ${n.indexOffset}.`),n.indexOffset=Math.ceil(n.indexOffset));let h=n.indexCount??e.ibo.size,a=n.indexOffset??0;a+h>e.ibo.size&&b(()=>`Index offset ${a} and count ${h} exceed the size of the index buffer (${e.ibo.size}).`),n.instances!==void 0&&(n.instances<=0&&b(()=>`Instance count cannot be <= 0, is: ${n.instances}.`),Number.isSafeInteger(n.instances)||B(()=>`Instance count is not an integer, is: ${n.instances}.`),n.instances=Math.ceil(n.instances));for(let[o,f]of i.attributes.entries()){let d=e.attributes.get(f.location);d===void 0&&b(()=>`VAO "${e.name}" does not provide an attribute for "${o}" (at location ${f.location}) of shader program "${i.name}"!`);let l=d.buffer.attributes.get(d.name);l===void 0&&b(()=>`Missing attribute "${d.name}" in VBO "${d.buffer.name}"!`),Ss(l,f.type)||b(()=>{let u=Is(l);return`Attribute "${d.name}" in VBO "${d.buffer.name}" has type '${u}' but shader program "${i.name}" expects type '${f.type} at location ${f.location}'!`}),o!=d.name&&B(()=>`Attribute "${o}" of shader program "${i.name}" at location ${f.location} is bound to attribute "${d.name}" in VBO "${d.buffer.name}"!`)}for(let o of Object.keys(n.uniforms??{}))i.uniforms.has(o)||B(()=>`Uniform "${o}" of Draw Call "${t}" not found in shader program "${i.name}"!`);let r=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS),c=new Map;if(n.textures!==void 0)for(let[o,f]of Object.entries(n.textures)){let d=i.uniforms.get(o);if(d===void 0){B(()=>`Uniform "${o}" of Draw Call "${t}" not found in shader program "${i.name}".`);continue}gt(d.type)||b(()=>`Uniform "${o}" in program "${i.name}" is not a texture sampler.`);let l=d.value;(typeof l!="number"||!Number.isSafeInteger(l)||l<0||l>=r)&&b(()=>`Invalid texture unit id: ${l}. Valid range is [0, ${r}).`);let u=c.get(l);u===void 0?c.set(l,Ys(f)):js(u,f,l)}return{name:t,vao:e,program:i,textures:c,indexCount:h,indexOffset:a,drawMode:n.drawModeOverride??e.ibo.drawMode,instances:n.instances??1,uniform:n.uniforms??{},cullFace:n.cullFace,depthTest:n.depthTest,blendFunc:n.blendFunc,updateDepthBuffer:n.updateDepthBuffer}}function bs(s,t){let e=t.vao,i=t.program;try{s.bindVertexArray(e.glo),s.useProgram(i.glo),t.cullFace!==void 0&&(t.cullFace===et.NONE?s.disable(s.CULL_FACE):(s.enable(s.CULL_FACE),s.cullFace(t.cullFace))),t.depthTest!==void 0&&(t.depthTest===it.NONE?s.disable(s.DEPTH_TEST):(s.enable(s.DEPTH_TEST),s.depthFunc(t.depthTest))),t.blendFunc!==void 0&&(t.blendFunc[0]===ut.ONE&&t.blendFunc[1]===ut.ZERO?s.disable(s.BLEND):(s.enable(s.BLEND),t.blendFunc.length===4?s.blendFuncSeparate(t.blendFunc[0],t.blendFunc[1],t.blendFunc[2],t.blendFunc[3]):t.blendFunc.length===2?s.blendFunc(t.blendFunc[0],t.blendFunc[1]):b(()=>`Invalid blend function array length: ${t.blendFunc.length}.`))),t.updateDepthBuffer!==void 0&&s.depthMask(t.updateDepthBuffer);for(let[h,a]of Object.entries(t.uniform)){let r=i.uniforms.get(h);r||b(()=>`Uniform "${h}" not found in program "${i.name}"`),lt(r.value,a)||(r.value=q(a),jt(s,r))}for(let[h,a]of t.textures)s.activeTexture(s.TEXTURE0+h),a.texture_2d!==void 0&&s.bindTexture(s.TEXTURE_2D,a.texture_2d.glo),a.texture_3d!==void 0&&s.bindTexture(s.TEXTURE_3D,a.texture_3d.glo),a.texture_cube!==void 0&&s.bindTexture(s.TEXTURE_CUBE_MAP,a.texture_cube.glo),a.texture_2d_array!==void 0&&s.bindTexture(s.TEXTURE_2D_ARRAY,a.texture_2d_array.glo);let n=t.instances??1;(isNaN(n)||!isFinite(n)||n<1)&&b(()=>`Invalid instance count: ${n}.`),n=Math.ceil(n),n==1?s.drawElements(t.drawMode,t.indexCount,t.vao.ibo.type,t.indexOffset):s.drawElementsInstanced(t.drawMode,t.indexCount,t.vao.ibo.type,t.indexOffset,n)}finally{t.textures.size>0&&(s.bindTexture(s.TEXTURE_2D_ARRAY,null),s.bindTexture(s.TEXTURE_CUBE_MAP,null),s.bindTexture(s.TEXTURE_3D,null),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE0)),t.updateDepthBuffer!==void 0&&s.depthMask(!0),t.blendFunc!==void 0&&(s.blendFunc(s.ONE,s.ZERO),s.disable(s.BLEND)),t.depthTest!==void 0&&(s.depthFunc(s.ALWAYS),s.disable(s.DEPTH_TEST)),t.cullFace!==void 0&&(s.cullFace(s.BACK),s.disable(s.CULL_FACE)),s.useProgram(null),s.bindVertexArray(null)}}function ws(s,t=0){let e=!1,i=s.__glance.generation-t,n=(u,E)=>{let x=0;for(let[y,A]of u.entries())A.generation<=i&&(E(A.object),u.delete(y),x++,e=!0);return x},h=(u,E)=>{let x=u.length;for(let y=0;y<x;++y)E(u[y]),e=!0;return u.length=0,x},a=n(s.__glance.shaders,u=>s.deleteShader(u.glo)),r=n(s.__glance.programs,u=>s.deleteProgram(u.glo)),c=h(s.__glance.buffers,u=>s.deleteBuffer(u)),o=h(s.__glance.vaos,u=>s.deleteVertexArray(u)),f=h(s.__glance.textures,u=>s.deleteTexture(u)),d=h(s.__glance.renderbuffers,u=>s.deleteRenderbuffer(u)),l=h(s.__glance.framebuffers,u=>s.deleteFramebuffer(u));if(e){let u=`Cleaned up WebGL resources:
`;a>0&&(u+=` - ${a} shader${a>1?"s":""}
`),r>0&&(u+=` - ${r} program${r>1?"s":""}
`),c>0&&(u+=` - ${c} buffer${c>1?"s":""}
`),o>0&&(u+=` - ${o} VAO${o>1?"s":""}
`),f>0&&(u+=` - ${f} texture${f>1?"s":""}
`),d>0&&(u+=` - ${d} renderbuffer${d>1?"s":""}
`),l>0&&(u+=` - ${l} framebuffer${l>1?"s":""}
`),C(()=>u.slice(0,-1))}s.__glance.generation+=1,Ws(s)}function Ts(s,t){let e=/^\s*(?:layout\s*\(location\s*=\s*(?<location>\d+)\)\s*)?in\s+(?:(?<precision>lowp|mediump|highp)\s+)?(?<type>\w+)\s+(?<name>\w+)\s*;/gm;if(t.attributes.size>0){B(()=>`Attributes of shader program "${t.name}" are already defined.`);return}let i;for(;(i=e.exec(t.vertex.source))!==null;){let{name:n,type:h,location:a,precision:r}=i.groups,c=s.getAttribLocation(t.glo,n);c<0||(a!==void 0&&c!==parseInt(a)&&B(()=>`Vertex shader of shader program "${n}" specifies the location of attribute "${n}" to be ${a}, but it was found at ${c}.`),(n.startsWith("webgl_")||n.startsWith("_webgl_"))&&b(()=>`Attribute name "${n}" is reserved by WebGL.`),t.attributes.set(n,{type:h,location:c,precision:r}))}}function Ns(s){switch(s){case z.BYTE:case z.UNSIGNED_BYTE:case z.SHORT:case z.UNSIGNED_SHORT:case z.INT:case z.UNSIGNED_INT:return!0;default:return!1}}function ps(s){switch(s){case z.INT_2_10_10_10_REV:case z.UNSIGNED_INT_2_10_10_10_REV:return!0;default:return!1}}function dt(s){switch(s){case z.BYTE:case z.UNSIGNED_BYTE:return 1;case z.SHORT:case z.UNSIGNED_SHORT:case z.HALF_FLOAT:return 2;case z.INT:case z.UNSIGNED_INT:case z.FLOAT:case z.INT_2_10_10_10_REV:case z.UNSIGNED_INT_2_10_10_10_REV:return 4;default:ct(s)}}function Ht(s){return dt(s.type)*s.height*s.width}function zs(s){let t=0;for(let e of s.attributes.values())t+=Ht(e);return t}function Ss(s,t){switch(s.type){case z.BYTE:case z.UNSIGNED_BYTE:case z.SHORT:case z.UNSIGNED_SHORT:case z.INT:case z.UNSIGNED_INT:switch(t){case"int":case"uint":return s.height===1&&s.width===1;case"ivec2":case"uvec2":return s.height===2&&s.width===1;case"ivec3":case"uvec3":return s.height===3&&s.width===1;case"ivec4":case"uvec4":return s.height===4&&s.width===1;default:return!1}case z.INT_2_10_10_10_REV:return t==="int";case z.UNSIGNED_INT_2_10_10_10_REV:return t==="uint";case z.FLOAT:case z.HALF_FLOAT:switch(t){case"float":return s.height===1&&s.width===1;case"vec2":return s.height===2&&s.width===1;case"vec3":return s.height===3&&s.width===1;case"vec4":return s.height===4&&s.width===1;case"mat2":case"mat2x2":return s.height===2&&s.width===2;case"mat2x3":return s.height===3&&s.width===2;case"mat2x4":return s.height===4&&s.width===2;case"mat3x2":return s.height===2&&s.width===3;case"mat3":case"mat3x3":return s.height===3&&s.width===3;case"mat3x4":return s.height===4&&s.width===3;case"mat4x2":return s.height===2&&s.width===4;case"mat4x3":return s.height===3&&s.width===4;case"mat4":case"mat4x4":return s.height===4&&s.width===4;default:return!1}default:ct(s.type)}}function Is(s){switch(s.type){case z.BYTE:case z.SHORT:case z.INT:switch(s.width){case 1:switch(s.height){case 1:return"int";case 2:return"ivec2";case 3:return"ivec3";case 4:return"ivec4"}}break;case z.INT_2_10_10_10_REV:return"int";case z.UNSIGNED_INT_2_10_10_10_REV:return"uint";case z.UNSIGNED_BYTE:case z.UNSIGNED_SHORT:case z.UNSIGNED_INT:switch(s.width){case 1:switch(s.height){case 1:return"uint";case 2:return"uvec2";case 3:return"uvec3";case 4:return"uvec4"}}break;case z.FLOAT:case z.HALF_FLOAT:switch(s.width){case 1:switch(s.height){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}break;case 2:switch(s.height){case 2:return"mat2";case 3:return"mat2x3";case 4:return"mat2x4"}break;case 3:switch(s.height){case 2:return"mat3x2";case 3:return"mat3";case 4:return"mat3x4"}break;case 4:switch(s.height){case 2:return"mat4x2";case 3:return"mat4x3";case 4:return"mat4"}break}}b(()=>`Invalid attribute type: ${s.type} with a size of ${s.height} and a width of ${s.width}.`)}function Us(s){let t=new Float32Array(1),e=new Uint16Array(t.buffer);t[0]=s;let i=e[1]<<16|e[0],n=i>>31<<15,h=(i>>23&255)-127+15,a=i&8388607;return h<0?(h=0,a=(a|8388608)>>1-h):h>31&&(h=31,a=0),n|h<<10|a>>13}function Os(s,t,e,i){return Y(Math.round(i),0,3)<<30|Y(Math.round(e),0,1023)<<20|Y(Math.round(t),0,1023)<<10|Y(Math.round(s),0,1023)}function gs(s,t,e,i){return Math.sign(i)<<31|Y(Math.round(Math.abs(i)),0,1)<<30|Math.sign(e)<<29|Y(Math.round(Math.abs(e)),0,511)<<20|Math.sign(t)<<19|Y(Math.round(Math.abs(t)),0,511)<<10|Math.sign(s)<<9|Y(Math.round(Math.abs(s)),0,511)}function vs(s,t,e){let i=/^\s*uniform\s+(?<precision>lowp|mediump|highp)?\s*(?<type>\w+)\s+(?<name>\w+)(?:\s*\[\s*(?<sizeString>\d+)\s*\])?\s*;/gm;t.uniforms.clear();let n=[],h=new Set,a;for(let r of[t.vertex.source,t.fragment.source])for(;(a=i.exec(r))!==null;){let{name:c,type:o,precision:f,sizeString:d}=a.groups;if(t.uniforms.has(c))continue;let l=s.getUniformLocation(t.glo,c);if(!l)continue;let u=d?parseInt(d):1,E=e[c];if(E===void 0){if(gt(o)){n.push([c,{type:o,location:l,size:u,value:E,precision:f}]);continue}E=Ds(o,u)}else gt(o)&&h.add(E);t.uniforms.set(c,{type:o,location:l,size:u,value:E,precision:f})}for(let[r,c]of n){let o=0;for(;h.has(o);)o++;h.add(o),c.value=o,C(()=>`Auto-assigning texture sampler "${r}" to texture unit ${o}.`),t.uniforms.set(r,c)}try{s.useProgram(t.glo);for(let r of t.uniforms.values())jt(s,r)}finally{s.useProgram(null)}}function gt(s){return s.indexOf("sampler")!==-1}function Ds(s,t){let e;switch(s){case"float":case"int":case"uint":case"bool":case"sampler2D":case"sampler2DArray":case"samplerCube":case"sampler3D":case"isampler2D":case"isampler2DArray":case"isamplerCube":case"isampler3D":case"usampler2D":case"usampler2DArray":case"usamplerCube":case"usampler3D":case"sampler2DShadow":case"sampler2DArrayShadow":case"samplerCubeShadow":e=0;break;case"vec2":case"ivec2":case"uvec2":case"bvec2":e=[0,0];break;case"vec3":case"ivec3":case"uvec3":case"bvec3":e=[0,0,0];break;case"vec4":case"ivec4":case"uvec4":case"bvec4":e=[0,0,0,0];break;case"mat2":case"mat2x2":e=[1,0,0,1];break;case"mat3":case"mat3x3":e=[1,0,0,0,1,0,0,0,1];break;case"mat4":case"mat4x4":e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];break;case"mat2x3":e=[1,0,0,1,0,0];break;case"mat2x4":e=[1,0,0,1,0,0,0,0];break;case"mat3x2":e=[1,0,0,0,1,0];break;case"mat3x4":e=[1,0,0,0,1,0,0,0,1,0,0,0];break;case"mat4x2":e=[1,0,0,0,0,1,0,0];break;case"mat4x3":e=[1,0,0,0,0,1,0,0,0,0,1,0];break;default:ct(s)}return t===1?e:Array(t).fill(e).flat()}var kt=s=>typeof s=="number",At=s=>Number.isSafeInteger(s),Vt=s=>At(s)&&s>=0,Yt=s=>typeof s=="boolean"||At(s)&&(s===0||s===1),Mt=s=>Array.isArray(s)||ArrayBuffer.isView(s),j=(s,t)=>Mt(s.value)&&s.value.length==t*s.size&&s.value.every(e=>kt(e)),St=(s,t)=>Mt(s.value)&&s.value.length==t*s.size&&s.value.every(e=>Yt(e)),It=(s,t)=>Mt(s.value)&&s.value.length==t*s.size&&s.value.every(e=>At(e)),Ut=(s,t)=>Mt(s.value)&&s.value.length==t*s.size&&s.value.every(e=>Vt(e)),Ps=s=>(s.value.isVec2??!1)||j(s,2),Gs=s=>(s.value.isVec3??!1)||j(s,3),$s=s=>(s.value.isMat3??!1)||j(s,9),Bs=s=>(s.value.isMat4??!1)||j(s,16),F=(s,t,e)=>`Value of uniform must be an array of ${t*s.size} ${e}s, but is: ${JSON.stringify(s.value)}.`;function jt(s,t){switch(t.type){case"float":return g(kt(t.value),()=>"Value of uniform must be a number!"),s.uniform1f(t.location,t.value);case"vec2":return g(Ps(t),()=>F(t,2,"number")),s.uniform2fv(t.location,t.value);case"vec3":return g(Gs(t),()=>F(t,3,"number")),s.uniform3fv(t.location,t.value);case"vec4":return g(j(t,4),()=>F(t,4,"number")),s.uniform4fv(t.location,t.value);case"mat2":case"mat2x2":return g(j(t,4),()=>F(t,4,"number")),s.uniformMatrix2fv(t.location,!1,t.value);case"mat3":case"mat3x3":return g($s(t),()=>F(t,9,"number")),s.uniformMatrix3fv(t.location,!1,t.value);case"mat4":case"mat4x4":return g(Bs(t),()=>F(t,16,"number")),s.uniformMatrix4fv(t.location,!1,t.value);case"int":case"sampler2D":case"sampler2DArray":case"samplerCube":case"sampler3D":case"isampler2D":case"isampler2DArray":case"isamplerCube":case"isampler3D":case"usampler2D":case"usampler2DArray":case"usamplerCube":case"usampler3D":case"sampler2DShadow":case"sampler2DArrayShadow":case"samplerCubeShadow":return g(At(t.value),()=>"Value of uniform must be an integer!"),s.uniform1i(t.location,t.value);case"uint":return g(Vt(t.value),()=>"Value of uniform must be a positive integer!"),s.uniform1ui(t.location,t.value);case"bool":return g(Yt(t.value),()=>"Value of uniform must be a boolean, zero or one!"),s.uniform1i(t.location,t.value?1:0);case"mat2x3":return g(j(t,6),()=>F(t,6,"number")),s.uniformMatrix2x3fv(t.location,!1,t.value);case"mat3x2":return g(j(t,6),()=>F(t,6,"number")),s.uniformMatrix3x2fv(t.location,!1,t.value);case"mat2x4":return g(j(t,8),()=>F(t,8,"number")),s.uniformMatrix2x4fv(t.location,!1,t.value);case"mat4x2":return g(j(t,8),()=>F(t,8,"number")),s.uniformMatrix4x2fv(t.location,!1,t.value);case"mat3x4":return g(j(t,12),()=>F(t,12,"number")),s.uniformMatrix3x4fv(t.location,!1,t.value);case"mat4x3":return g(j(t,12),()=>F(t,12,"number")),s.uniformMatrix4x3fv(t.location,!1,t.value);case"ivec2":return g(It(t,2),()=>F(t,2,"integer")),s.uniform2iv(t.location,t.value);case"ivec3":return g(It(t,3),()=>F(t,3,"integer")),s.uniform3iv(t.location,t.value);case"ivec4":return g(It(t,4),()=>F(t,4,"integer")),s.uniform4iv(t.location,t.value);case"uvec2":return g(Ut(t,2),()=>F(t,2,"positive integer")),s.uniform2uiv(t.location,t.value);case"uvec3":return g(Ut(t,3),()=>F(t,3,"positive integer")),s.uniform3uiv(t.location,t.value);case"uvec4":return g(Ut(t,4),()=>F(t,4,"positive integer")),s.uniform4uiv(t.location,t.value);case"bvec2":return g(St(t,2),()=>F(t,2,"boolean")),s.uniform2iv(t.location,t.value);case"bvec3":return g(St(t,3),()=>F(t,3,"boolean")),s.uniform3iv(t.location,t.value);case"bvec4":return g(St(t,4),()=>F(t,4,"boolean")),s.uniform4iv(t.location,t.value);default:b(()=>`Unsupported uniform type "${t.type}"`)}}function Ls(s){switch(s){case D.TEXTURE_2D:return"2D";case D.TEXTURE_3D:return"3D";case D.TEXTURE_CUBE_MAP:return"cubemap";case D.TEXTURE_2D_ARRAY:return"2D array"}}function Wt(s,t){let e=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);return t===void 0?e-1:(t<0&&b(()=>`WIP texture unit cannot be negative, got: ${t}.`),t>=e&&b(()=>`Invalid WIP texture unit: ${t}, maximal texture unit available is ${e-1}.`),t)}function Fs(s){if(s instanceof Uint8Array)return N.UNSIGNED_BYTE;if(s instanceof Uint16Array)return N.UNSIGNED_SHORT;if(s instanceof Uint32Array)return N.UNSIGNED_INT;if(s instanceof Float32Array)return N.FLOAT;s instanceof Int8Array||s instanceof Int16Array||s instanceof Int32Array?b(()=>"Signed integer buffers are not supported when defining a texture."):b(()=>`Invalid data type: ${s.constructor.name}.`)}function Cs(s,t){s instanceof Uint8Array?t!==N.UNSIGNED_BYTE&&b(()=>"When defining a texture with a 'Uint8Array', the source data type must be 'UNSIGNED_BYTE'"):s instanceof Uint8ClampedArray?t!==N.UNSIGNED_BYTE&&b(()=>"When defining a texture with a 'Uint8ClampedArray'source data type must be 'UNSIGNED_BYTE'"):s instanceof Float32Array?t!==N.FLOAT&&b(()=>"When defining a texture with a 'Float32Array', the source data type must be 'FLOAT'"):s instanceof Uint16Array?[N.UNSIGNED_SHORT,N.UNSIGNED_SHORT_5_6_5,N.UNSIGNED_SHORT_5_5_5_1,N.UNSIGNED_SHORT_4_4_4_4,N.HALF_FLOAT].includes(t)||b(()=>"When defining a texture with a 'Uint16Array', the source data type must be one of 'UNSIGNED_SHORT', 'UNSIGNED_SHORT_5_6_5', 'UNSIGNED_SHORT_5_5_5_1', 'UNSIGNED_SHORT_4_4_4_4', or 'HALF_FLOAT'"):s instanceof Uint32Array?[N.UNSIGNED_INT,N.UNSIGNED_INT_5_9_9_9_REV,N.UNSIGNED_INT_2_10_10_10_REV,N.UNSIGNED_INT_10F_11F_11F_REV,N.UNSIGNED_INT_24_8].includes(t)||b(()=>"When defining a texture with a 'Uint32Array', the source data type must be one of 'UNSIGNED_INT', 'UNSIGNED_INT_5_9_9_9_REV', 'UNSIGNED_INT_2_10_10_10_REV', 'UNSIGNED_INT_10F_11F_11F_REV', or'UNSIGNED_INT_24_8'"):s instanceof Int8Array||s instanceof Int16Array||s instanceof Int32Array?b(()=>"Signed integer buffers are not supported when defining a texture."):b(()=>`Invalid data type for texture: ${s.constructor.name}`)}function Xs(s,t){switch(s){case T.R8:return t===N.UNSIGNED_BYTE;case T.R16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.R32F:return t==N.FLOAT;case T.R8UI:return t===N.UNSIGNED_BYTE;case T.RG8:return t===N.UNSIGNED_BYTE;case T.RG16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.RG32F:return t==N.FLOAT;case T.RG8UI:return t===N.UNSIGNED_BYTE;case T.RGB8:return t===N.UNSIGNED_BYTE;case T.SRGB8:return t===N.UNSIGNED_BYTE;case T.RGB565:return[N.UNSIGNED_BYTE,N.UNSIGNED_SHORT_5_6_5].includes(t);case T.R11F_G11F_B10F:return[N.UNSIGNED_INT_10F_11F_11F_REV,N.HALF_FLOAT,N.FLOAT].includes(t);case T.RGB9_E5:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.RGB16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.RGB32F:return t==N.FLOAT;case T.RGB8UI:return t===N.UNSIGNED_BYTE;case T.RGBA8:return t===N.UNSIGNED_BYTE;case T.SRGB8_ALPHA8:return t===N.UNSIGNED_BYTE;case T.RGB5_A1:return[N.UNSIGNED_BYTE,N.UNSIGNED_SHORT_5_5_5_1].includes(t);case T.RGB10_A2:return t===N.UNSIGNED_INT_2_10_10_10_REV;case T.RGBA4:return[N.UNSIGNED_BYTE,N.UNSIGNED_SHORT_4_4_4_4].includes(t);case T.RGBA16F:return[N.HALF_FLOAT,N.FLOAT].includes(t);case T.RGBA32F:return t==N.FLOAT;case T.RGBA8UI:return t===N.UNSIGNED_BYTE;case T.DEPTH_COMPONENT16:return t===N.UNSIGNED_SHORT;case T.DEPTH_COMPONENT24:return t===N.UNSIGNED_INT;case T.DEPTH_COMPONENT32F:return t===N.FLOAT}return!1}function Hs(s,t){switch(t){case T.R8:return s.RED;case T.R16F:return s.RED;case T.R32F:return s.RED;case T.R8UI:return s.RED_INTEGER;case T.RG8:return s.RG;case T.RG16F:return s.RG;case T.RG32F:return s.RG;case T.RG8UI:return s.RG_INTEGER;case T.RGB8:return s.RGB;case T.SRGB8:return s.RGB;case T.RGB565:return s.RGB;case T.R11F_G11F_B10F:return s.RGB;case T.RGB9_E5:return s.RGB;case T.RGB16F:return s.RGB;case T.RGB32F:return s.RGB;case T.RGB8UI:return s.RGB_INTEGER;case T.RGBA8:return s.RGBA;case T.SRGB8_ALPHA8:return s.RGBA;case T.RGB5_A1:return s.RGBA;case T.RGB10_A2:return s.RGBA;case T.RGBA4:return s.RGBA;case T.RGBA16F:return s.RGBA;case T.RGBA32F:return s.RGBA;case T.RGBA8UI:return s.RGBA_INTEGER;case T.DEPTH_COMPONENT16:case T.DEPTH_COMPONENT24:case T.DEPTH_COMPONENT32F:return s.DEPTH_COMPONENT;default:b(()=>`Invalid internal format: ${t}.`)}}function ks(s){switch(s){case T.DEPTH_COMPONENT16:case T.DEPTH_COMPONENT24:case T.DEPTH_COMPONENT32F:return!0;default:return!1}}function Vs(s){switch(s){case T.R16F:case T.R32F:case T.RG16F:case T.RG32F:case T.RGB16F:case T.RGB32F:case T.RGBA16F:case T.RGBA32F:case T.DEPTH_COMPONENT32F:return!0;default:return!1}}function Ys(s){switch(s.target){case D.TEXTURE_2D:return{texture_2d:s};case D.TEXTURE_3D:return{texture_3d:s};case D.TEXTURE_CUBE_MAP:return{texture_cube:s};case D.TEXTURE_2D_ARRAY:return{texture_2d_array:s};default:ct(s.target)}}function js(s,t,e){switch(t.target){case D.TEXTURE_2D:s.texture_2d!==void 0&&b(()=>`Texture unit ${e} already contains a 2D texture!`),s.texture_2d=t;break;case D.TEXTURE_3D:s.texture_3d!==void 0&&b(()=>`Texture unit ${e} already contains a 3D texture!`),s.texture_3d=t;break;case D.TEXTURE_CUBE_MAP:s.texture_cube!==void 0&&b(()=>`Texture unit ${e} already contains a cube map!`),s.texture_cube=t;break;case D.TEXTURE_2D_ARRAY:s.texture_2d_array!==void 0&&b(()=>`Texture unit ${e} already contains a 2D array texture!`),s.texture_2d_array=t;break;default:ct(t.target)}}function Ws(s){let t=!!s.createTransformFeedback;t&&s.bindVertexArray(null);let e=s.getParameter(s.MAX_VERTEX_ATTRIBS),i=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,i);for(let h=0;h<e;++h)s.disableVertexAttribArray(h),s.vertexAttribPointer(h,4,s.FLOAT,!1,0,0),s.vertexAttrib1f(h,0),t&&s.vertexAttribDivisor(h,0);s.deleteBuffer(i);let n=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS);for(let h=0;h<n;++h)s.activeTexture(s.TEXTURE0+h),s.bindTexture(s.TEXTURE_CUBE_MAP,null),s.bindTexture(s.TEXTURE_2D,null),t&&(s.bindTexture(s.TEXTURE_2D_ARRAY,null),s.bindTexture(s.TEXTURE_3D,null),s.bindSampler(h,null));if(s.activeTexture(s.TEXTURE0),s.useProgram(null),s.bindBuffer(s.ARRAY_BUFFER,null),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindRenderbuffer(s.RENDERBUFFER,null),s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.DITHER),s.disable(s.SCISSOR_TEST),s.blendColor(0,0,0,0),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.clearColor(0,0,0,0),s.clearDepth(1),s.clearStencil(-1),s.colorMask(!0,!0,!0,!0),s.cullFace(s.BACK),s.depthFunc(s.LESS),s.depthMask(!0),s.depthRange(0,1),s.frontFace(s.CCW),s.hint(s.GENERATE_MIPMAP_HINT,s.DONT_CARE),s.lineWidth(1),s.pixelStorei(s.PACK_ALIGNMENT,4),s.pixelStorei(s.UNPACK_ALIGNMENT,4),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.BROWSER_DEFAULT_WEBGL),s.polygonOffset(0,0),s.sampleCoverage(1,!1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilMask(4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.viewport(0,0,s.canvas.width,s.canvas.height),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT|s.STENCIL_BUFFER_BIT),t){s.drawBuffers([s.BACK]),s.readBuffer(s.BACK),s.bindBuffer(s.COPY_READ_BUFFER,null),s.bindBuffer(s.COPY_WRITE_BUFFER,null),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),s.bindBuffer(s.PIXEL_UNPACK_BUFFER,null);let h=s.getParameter(s.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(let r=0;r<h;++r)s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,r,null);let a=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS);for(let r=0;r<a;++r)s.bindBufferBase(s.UNIFORM_BUFFER,r,null);s.disable(s.RASTERIZER_DISCARD),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,0),s.pixelStorei(s.UNPACK_SKIP_IMAGES,0),s.pixelStorei(s.UNPACK_ROW_LENGTH,0),s.pixelStorei(s.UNPACK_SKIP_ROWS,0),s.pixelStorei(s.UNPACK_SKIP_PIXELS,0),s.pixelStorei(s.PACK_ROW_LENGTH,0),s.pixelStorei(s.PACK_SKIP_ROWS,0),s.pixelStorei(s.PACK_SKIP_PIXELS,0),s.hint(s.FRAGMENT_SHADER_DERIVATIVE_HINT,s.DONT_CARE)}}var V=class s{a;b;c;d;e;f;g;h;i;static of(t,e,i,n,h,a,r,c,o){return new s(t,e,i,n,h,a,r,c,o)}static all(t){return new s(t,t,t,t,t,t,t,t,t)}static random(){return new s(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random())}static fromArray(t,e=0){return new s(t[e+0],t[e+1],t[e+2],t[e+3],t[e+4],t[e+5],t[e+6],t[e+7],t[e+8])}static identity(){return new s}static translate(t){return new s(1,0,0,0,1,0,t.x,t.y,1)}static fromTranslation=s.translate;static translateX(t){return new s(1,0,0,0,1,0,t,0,1)}static fromTranslationX=s.translateX;static translateY(t){return new s(1,0,0,0,1,0,0,t,1)}static fromTranslationY=s.translateY;static rotate(t){let e=Math.sin(t),i=Math.cos(t);return new s(i,e,0,-e,i,0,0,0,1)}static fromRotation=s.rotate;static scale(t,e){return typeof t=="number"?e===void 0?new s(t,0,0,0,t,0,0,0,1):new s(t,0,0,0,e,0,0,0,1):new s(t.x,0,0,0,t.y,0,0,0,1)}static fromScale=s.scale;static fromMat4(t){return new s(t.a,t.b,t.c,t.e,t.f,t.g,t.i,t.j,t.k)}static projection(t,e){return new s(2/t,0,0,0,-2/e,0,-1,1,1)}static normalMatrixOf(t){let e=t.a,i=t.b,n=t.c,h=t.e,a=t.f,r=t.g,c=t.i,o=t.j,f=t.k,d=f*a-r*o,l=-f*h+r*c,u=o*h-a*c,E=e*d+i*l+n*u;return E?(E=1/E,new s(d*E,l*E,u*E,(-f*i+n*o)*E,(f*e-n*c)*E,(-o*e+i*c)*E,(r*i-n*a)*E,(-r*e+n*h)*E,(a*e-i*h)*E)):null}constructor(t=1,e=0,i=0,n=0,h=1,a=0,r=0,c=0,o=1){this.a=t,this.b=e,this.c=i,this.d=n,this.e=h,this.f=a,this.g=r,this.h=c,this.i=o}get 0(){return this.a}get 1(){return this.b}get 2(){return this.c}get 3(){return this.d}get 4(){return this.e}get 5(){return this.f}get 6(){return this.g}get 7(){return this.h}get 8(){return this.i}get length(){return 9}reset(){return this.a=1,this.b=0,this.c=0,this.d=0,this.e=1,this.f=0,this.g=0,this.h=0,this.i=1,this}fromArray(t,e=0){return this.a=t[e+0],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.e=t[e+4],this.f=t[e+5],this.g=t[e+6],this.h=t[e+7],this.i=t[e+8],this}toArray(t=null,e=0){return t===null&&(t=new Array(9)),t[e+0]=this.a,t[e+1]=this.b,t[e+2]=this.c,t[e+3]=this.d,t[e+4]=this.e,t[e+5]=this.f,t[e+6]=this.g,t[e+7]=this.h,t[e+8]=this.i,t}clone(){return new s(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i)}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this}equals(t,e=H){return Math.abs(this.a-t.a)<=e&&Math.abs(this.b-t.b)<=e&&Math.abs(this.c-t.c)<=e&&Math.abs(this.d-t.d)<=e&&Math.abs(this.e-t.e)<=e&&Math.abs(this.f-t.f)<=e&&Math.abs(this.g-t.g)<=e&&Math.abs(this.h-t.h)<=e&&Math.abs(this.i-t.i)<=e}transpose(){let t;return t=this.b,this.b=this.d,this.d=t,t=this.c,this.c=this.g,this.g=t,t=this.f,this.f=this.h,this.h=t,this}transposeOf(t){return this.a=t.a,this.b=t.d,this.c=t.g,this.d=t.b,this.e=t.e,this.f=t.h,this.g=t.c,this.h=t.f,this.i=t.i,this}invert(){let t=this.a,e=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=o*h-a*c,d=-o*n+a*r,l=c*n-h*r,u=t*f+e*d+i*l;return u?(u=1/u,this.a=f*u,this.b=(-o*e+i*c)*u,this.c=(a*e-i*h)*u,this.d=d*u,this.e=(o*t-i*r)*u,this.f=(-a*t+i*n)*u,this.g=l*u,this.h=(-c*t+e*r)*u,this.i=(h*t-e*n)*u,this):null}inverseOf(t){let e=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=f*a-r*o,l=-f*h+r*c,u=o*h-a*c,E=e*d+i*l+n*u;return E?(E=1/E,this.a=d*E,this.b=(-f*i+n*o)*E,this.c=(r*i-n*a)*E,this.d=l*E,this.e=(f*e-n*c)*E,this.f=(-r*e+n*h)*E,this.g=u*E,this.h=(-o*e+i*c)*E,this.i=(a*e-i*h)*E,this):null}adjoint(){let t=this.a,e=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i;return this.a=h*o-a*c,this.b=i*c-e*o,this.c=e*a-i*h,this.d=a*r-n*o,this.e=t*o-i*r,this.f=i*n-t*a,this.g=n*c-h*r,this.h=e*r-t*c,this.i=t*h-e*n,this}adjointOf(t){let e=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i;return this.a=a*f-r*o,this.b=n*o-i*f,this.c=i*r-n*a,this.d=r*c-h*f,this.e=e*f-n*c,this.f=n*h-e*r,this.g=h*o-a*c,this.h=i*c-e*o,this.i=e*a-i*h,this}determinant(){let t=this.d,e=this.e,i=this.f,n=this.g,h=this.h,a=this.i;return this.a*(a*e-i*h)+this.b*(-a*t+i*n)+this.c*(h*t-e*n)}multiply(t){let e=this.a,i=this.d,n=this.g,h=this.b,a=this.e,r=this.h,c=this.c,o=this.f,f=this.i,d=t.a,l=t.b,u=t.c;return this.a=e*d+i*l+n*u,this.b=h*d+a*l+r*u,this.c=c*d+o*l+f*u,d=t.d,l=t.e,u=t.f,this.d=e*d+i*l+n*u,this.e=h*d+a*l+r*u,this.f=c*d+o*l+f*u,d=t.g,l=t.h,u=t.i,this.g=e*d+i*l+n*u,this.h=h*d+a*l+r*u,this.i=c*d+o*l+f*u,this}preMultiply(t){let e=t.a,i=t.d,n=t.g,h=t.b,a=t.e,r=t.h,c=t.c,o=t.f,f=t.i,d=this.a,l=this.b,u=this.c;return this.a=e*d+i*l+n*u,this.b=h*d+a*l+r*u,this.c=c*d+o*l+f*u,d=this.d,l=this.e,u=this.f,this.d=e*d+i*l+n*u,this.e=h*d+a*l+r*u,this.f=c*d+o*l+f*u,d=this.g,l=this.h,u=this.i,this.g=e*d+i*l+n*u,this.h=h*d+a*l+r*u,this.i=c*d+o*l+f*u,this}productOf(t,e){let i=t.a,n=t.d,h=t.g,a=t.b,r=t.e,c=t.h,o=t.c,f=t.f,d=t.i,l=e.a,u=e.b,E=e.c;return this.a=i*l+n*u+h*E,this.b=a*l+r*u+c*E,this.c=o*l+f*u+d*E,l=e.d,u=e.e,E=e.f,this.d=i*l+n*u+h*E,this.e=a*l+r*u+c*E,this.f=o*l+f*u+d*E,l=e.g,u=e.h,E=e.i,this.g=i*l+n*u+h*E,this.h=a*l+r*u+c*E,this.i=o*l+f*u+d*E,this}translate(t,e){let i;return typeof t=="number"?(i=t,e=e??0):(i=t.x,e=t.y),this.g+=this.a*i+this.d*e,this.h+=this.b*i+this.e*e,this.i+=this.c*i+this.f*e,this}translateX(t){return this.g+=this.a*t,this.h+=this.b*t,this.i+=this.c*t,this}translateY(t){return this.g+=this.d*t,this.h+=this.e*t,this.i+=this.f*t,this}rotate(t){let e=this.a,i=this.b,n=this.c,h=this.d,a=this.e,r=this.f,c=Math.sin(t),o=Math.cos(t);return this.a=o*e+c*h,this.b=o*i+c*a,this.c=o*n+c*r,this.d=o*h-c*e,this.e=o*a-c*i,this.f=o*r-c*n,this}scale(t,e){let i;return typeof t=="number"?(i=t,e=e??i):(i=t.x,e=t.y),this.a*=i,this.b*=i,this.c*=i,this.d*=e,this.e*=e,this.f*=e,this}scaleX(t){return this.a*=t,this.b*=t,this.c*=t,this}scaleY(t){return this.d*=t,this.e*=t,this.f*=t,this}fromMat4(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.e,this.e=t.f,this.f=t.g,this.g=t.i,this.h=t.j,this.i=t.k,this}*[Symbol.iterator](){yield this.a,yield this.b,yield this.c,yield this.d,yield this.e,yield this.f,yield this.g,yield this.h,yield this.i}};V.prototype.isMat3=!0;V.prototype.isMathPrimitive=!0;var P=class s{x;y;z;static of(t,e,i){return new s(t,e,i)}static zero(){return new s(0,0,0)}static all(t){return new s(t,t,t)}static random(){return new s(Math.random(),Math.random(),Math.random())}static xAxis(){return new s(1,0,0)}static yAxis(){return new s(0,1,0)}static zAxis(){return new s(0,0,1)}static translateX(t){return new s(t,0,0)}static translateY(t){return new s(0,t,0)}static translateZ(t){return new s(0,0,t)}static randomDir(){let t=Math.random()*2-1,e=Math.random()*2-1,i=Math.random()*2-1,n=Math.hypot(t,e,i);return new s(t/n,e/n,i/n)}static fromArray(t,e=0){return new s(t[e],t[e+1],t[e+2])}static fromSpherical(t,e,i=1){let n=Math.sin(e)*i;return new s(n*Math.sin(t),Math.cos(e)*i,n*Math.cos(t))}static fromCylindrical(t,e,i=1){return new s(Math.sin(t)*i,e,Math.cos(t)*i)}static sumOf(t,e){return new s(t.x+e.x,t.y+e.y,t.z+e.z)}static differenceOf(t,e){return new s(t.x-e.x,t.y-e.y,t.z-e.z)}static productOf(t,e){return new s(t.x*e.x,t.y*e.y,t.z*e.z)}static quotientOf(t,e){return new s(t.x/e.x,t.y/e.y,t.z/e.z)}static scaled(t,e){return new s(t.x*e,t.y*e,t.z*e)}static normalOf(t){let e=t.x*t.x+t.y*t.y;if(e>0){let i=1/Math.sqrt(e);return new s(t.x*i,t.y*i,t.z*i)}else return new s(0,0,0)}static minOf(t,e){return new s(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))}static maxOf(t,e){return new s(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))}constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get 2(){return this.z}set 2(t){this.z=t}get length(){return 3}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get depth(){return this.z}set depth(t){this.z=t}get r(){return this.x}set r(t){this.x=t}get g(){return this.y}set g(t){this.y=t}get b(){return this.z}set b(t){this.z=t}get u(){return this.x}set u(t){this.x=t}get v(){return this.y}set v(t){this.y=t}get w(){return this.z}set w(t){this.z=t}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error(`Invalid Vec3 index: ${t}`)}}setIndex(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error(`Invalid Vec3 index: ${t}`)}}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=null,e=0){return t===null&&(t=new Array(3)),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}clone(){return new s(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equals(t,e=H){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e&&Math.abs(this.z-t.z)<=e}any(){return this.x!=0||this.y!=0||this.z!=0}set(t,e,i){return this.x=t,this.y=e??t,this.z=i??(e===void 0?t:0),this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}randomize(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addAll(t){return this.x+=t,this.y+=t,this.z+=t,this}sumOf(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subtractAll(t){return this.x-=t,this.y-=t,this.z-=t,this}differenceOf(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}productOf(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}divideBy(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}quotientOf(t,e){return this.x=t.x/e.x,this.y=t.y/e.y,this.z=t.z/e.z,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}invert(){return this.x=this.x==0?0:1/this.x,this.y=this.y==0?0:1/this.y,this.z=this.z==0?0:1/this.z,this}inverseOf(t){return this.x=t.x==0?0:1/t.x,this.y=t.y==0?0:1/t.y,this.z=t.z==0?0:1/t.z,this}addScaled(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}mod(t){return this.x%=t.x,this.y%=t.y,this.z%=t.z,this}modAll(t){return this.x%=t,this.y%=t,this.z%=t,this}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpOf(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}slerp(t,e){let i=this.x,n=this.y,h=this.z,a=t.x,r=t.y,c=t.z,o=Math.acos(Math.min(Math.max(i*a+n*r+i*c,-1),1)),f=o?Math.sin(o):1,d=Math.sin((1-e)*o)/f,l=Math.sin(e*o)/f;return this.x=d*i+l*a,this.y=d*n+l*r,this.z=d*i+l*c,this}slerpOf(t,e,i){let n=t.x,h=t.y,a=t.z,r=e.x,c=e.y,o=e.z,f=Math.acos(Math.min(Math.max(n*r+h*c+n*o,-1),1)),d=f?Math.sin(f):1,l=Math.sin((1-i)*f)/d,u=Math.sin(i*f)/d;return this.x=l*n+u*r,this.y=l*h+u*c,this.z=l*n+u*o,this}hermiteOf(t,e,i,n,h){let a=h*h,r=a*(2*h-3)+1,c=a*(h-2)+h,o=a*(h-1),f=a*(3-2*h);return this.x=t.x*r+e.x*c+i.x*o+n.x*f,this.y=t.y*r+e.y*c+i.y*o+n.y*f,this.z=t.z*r+e.z*c+i.z*o+n.z*f,this}bezierOf(t,e,i,n,h){let a=h*h,r=1-h,c=r*r,o=c*r,f=3*h*c,d=3*a*r,l=a*h;return this.x=t.x*o+e.x*f+i.x*d+n.x*l,this.y=t.y*o+e.y*f+i.y*d+n.y*l,this.z=t.z*o+e.z*f+i.z*d+n.z*l,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){let e=this.x,i=this.y,n=this.z,h=t.x,a=t.y,r=t.z;return this.x=i*r-n*a,this.y=n*h-e*r,this.z=e*a-i*h,this}crossOf(t,e){let i=t.x,n=t.y,h=t.z,a=e.x,r=e.y,c=e.z;return this.x=n*c-h*r,this.y=h*a-i*c,this.z=i*r-n*a,this}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z}magnitude(){return Math.hypot(this.x,this.y,this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;if(t>0){let e=1/Math.sqrt(t);this.x*=e,this.y*=e,this.z*=e}return this}normalOf(t){let e=t.x*t.x+t.y*t.y+t.z*t.z;if(e>0){let i=1/Math.sqrt(e);this.x=t.x*i,this.y=t.y*i,this.z=t.z*i}else this.x=0,this.y=0,this.z=0;return this}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z)}distanceToSq(t){let e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}minOf(t,e){return this.x=Math.min(t.x,e.x),this.y=Math.min(t.y,e.y),this.z=Math.min(t.z,e.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}maxOf(t,e){return this.x=Math.max(t.x,e.x),this.y=Math.max(t.y,e.y),this.z=Math.max(t.z,e.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampMagnitude(t,e){let i=this.x*this.x+this.y*this.y+this.z*this.z;if(i>0){let n=Math.sqrt(i),h=Math.max(t,Math.min(e,n))/n;this.x*=h,this.y*=h,this.z*=h}return this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}projectOnVector(t){let e=t.x,i=t.y,n=t.z,h=e*e+i*i+n*n;if(h==0)this.x=0,this.y=0,this.z=0;else{let a=(this.x*e+this.y*i+this.z*n)/h;this.x=e*a,this.y=i*a,this.z=n*a}return this}projectOnPlane(t){let e=t.x,i=t.y,n=t.z,h=this.x*e+this.y*i+this.z*n;return this.x-=e*h,this.y-=i*h,this.z-=n*h,this}reflect(t){let e=t.x,i=t.y,n=t.z,h=2*(this.x*e+this.y*i+this.z*n);return this.x-=e*h,this.y-=i*h,this.z-=n*h,this}angleTo(t){let e=this.x,i=this.y,n=this.z,h=t.x,a=t.y,r=t.z,c=Math.sqrt((e*e+i*i+n*n)*(h*h+a*a+r*r)),o=c&&(e*h+i*a+n*r)/c;return Math.acos(Math.min(Math.max(o,-1),1))}rotateAround(t,e){let i=this.x,n=this.y,h=this.z,a=t.x,r=t.y,c=t.z,o=Math.cos(e),f=Math.sin(e),d=(a*i+r*n+c*h)*(1-o);return this.x=a*d+i*o+(-c*n+r*h)*f,this.y=r*d+n*o+(c*i-a*h)*f,this.z=c*d+h*o+(-r*i+a*n)*f,this}translateX(t){return this.x+=t,this}translateY(t){return this.y+=t,this}translateZ(t){return this.z+=t,this}rotateX(t){let e=this.y,i=this.z,n=Math.cos(t),h=Math.sin(t);return this.y=e*n-i*h,this.z=e*h+i*n,this}rotateY(t){let e=this.x,i=this.z,n=Math.cos(t),h=Math.sin(t);return this.x=e*n+i*h,this.z=-e*h+i*n,this}rotateZ(t){let e=this.x,i=this.y,n=Math.cos(t),h=Math.sin(t);return this.x=e*n-i*h,this.y=e*h+i*n,this}applyMat3(t){let e=this.x,i=this.y,n=this.z;return this.x=e*t.a+i*t.d+n*t.g,this.y=e*t.b+i*t.e+n*t.h,this.z=e*t.c+i*t.f+n*t.i,this}applyMat4(t){let e=this.x,i=this.y,n=this.z,h=t.d*e+t.h*i+t.l*n+t.p||1;return this.x=(e*t.a+i*t.e+n*t.i+t.m)/h,this.y=(e*t.b+i*t.f+n*t.j+t.n)/h,this.z=(e*t.c+i*t.g+n*t.k+t.o)/h,this}rotateMat4(t){let e=this.x,i=this.y,n=this.z;return this.x=e*t.a+i*t.e+n*t.i,this.y=e*t.b+i*t.f+n*t.j,this.z=e*t.c+i*t.g+n*t.k,this}rotateQuat(t){let e=this.x,i=this.y,n=this.z,h=t.x,a=t.y,r=t.z,c=t.w,o=2*(a*n-r*i),f=2*(r*e-h*n),d=2*(h*i-a*e);return this.x=e+c*o+a*d-r*f,this.y=i+c*f+r*o-h*d,this.z=n+c*d+h*f-a*o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};P.prototype.isVec3=!0;P.prototype.isMathPrimitive=!0;var nt=class s{a;b;c;d;e;f;g;h;i;j;k;l;m;n;o;p;static of(t,e,i,n,h,a,r,c,o,f,d,l,u,E,x,y){return new s(t,e,i,n,h,a,r,c,o,f,d,l,u,E,x,y)}static all(t){return new s(t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t)}static random(){return new s(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random())}static fromArray(t,e=0){return new s(t[e+0],t[e+1],t[e+2],t[e+3],t[e+4],t[e+5],t[e+6],t[e+7],t[e+8],t[e+9],t[e+10],t[e+11],t[e+12],t[e+13],t[e+14],t[e+15])}static identity(){return new s}static translate(t,e,i){return typeof t=="number"?new s(1,0,0,0,0,1,0,0,0,0,1,0,t,e??t,i??t,1):new s(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1)}static fromTranslation=s.translate;static fromVec3s(t,e,i,n){return new s(t.x,t.y,t.z,0,e.x,e.y,e.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,1)}static fromVec4s(t,e,i,n){return new s(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,i.x,i.y,i.z,i.w,n.x,n.y,n.z,n.w)}static translateX(t){return new s(1,0,0,0,0,1,0,0,0,0,1,0,t,0,0,1)}static fromTranslationX=s.translateX;static translateY(t){return new s(1,0,0,0,0,1,0,0,0,0,1,0,0,t,0,1)}static fromTranslationY=s.translateY;static translateZ(t){return new s(1,0,0,0,0,1,0,0,0,0,1,0,0,0,t,1)}static fromTranslationZ=s.translateZ;static rotate(t,e){let i=Math.sin(e),n=Math.cos(e),h=1-n,a=t.x,r=t.y,c=t.z,o=h*a,f=h*r,d=h*c,l=i*a,u=i*r,E=i*c;return new s(o*a+n,o*r+E,o*c-u,0,f*a-E,f*r+n,f*c+l,0,d*a+u,d*r-l,d*c+n,0,0,0,0,1)}static fromRotation=s.rotate;static rotateX(t){let e=Math.sin(t),i=Math.cos(t);return new s(1,0,0,0,0,i,e,0,0,-e,i,0,0,0,0,1)}static fromRotationX=s.rotateX;static rotateY(t){let e=Math.sin(t),i=Math.cos(t);return new s(i,0,-e,0,0,1,0,0,e,0,i,0,0,0,0,1)}static fromRotationY=s.rotateY;static rotateZ(t){let e=Math.sin(t),i=Math.cos(t);return new s(i,e,0,0,-e,i,0,0,0,0,1,0,0,0,0,1)}static fromRotationZ=s.rotateZ;static fromQuat(t){let e=t.x,i=t.y,n=t.z,h=t.w,a=e+e,r=i+i,c=n+n,o=e*a,f=e*r,d=e*c,l=i*r,u=i*c,E=n*c,x=h*a,y=h*r,A=h*c;return new s(1-(l+E),f+A,d-y,0,f-A,1-(o+E),u+x,0,d+y,u-x,1-(o+l),0,0,0,0,1)}static scale(t){let e,i,n;return typeof t=="number"?(e=t,i=t,n=t):(e=t.x,i=t.y,n=t.z),new s(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1)}static fromScale=s.scale;static fromBasis(t,e,i){return new s(t.x,t.y,t.z,0,e.x,e.y,e.z,0,i.x,i.y,i.z,0,0,0,0,1)}static compose(t,e,i){let n=e.x,h=e.y,a=e.z,r=e.w,c=i.x,o=i.y,f=i.z,d=n+n,l=h+h,u=a+a,E=n*d,x=n*l,y=n*u,A=h*l,M=h*u,_=a*u,m=r*d,R=r*l,w=r*u;return new s((1-(A+_))*c,(x+w)*c,(y-R)*c,0,(x-w)*o,(1-(E+_))*o,(M+m)*o,0,(y+R)*f,(M-m)*f,(1-(E+A))*f,0,t.x,t.y,t.z,1)}static fromMat3(t){return new s(t.a,t.b,t.c,0,t.d,t.e,t.f,0,t.g,t.h,t.i,0,0,0,0,1)}static ortho(t,e,i,n,h,a){let r=1/(t-e),c=1/(i-n),o=1/(h-a);return new s(-2*r,0,0,0,0,-2*c,0,0,0,0,2*o,0,(t+e)*r,(n+i)*c,(a+h)*o,1)}static perspective(t,e,i,n){let h=1/Math.tan(t/2),a=1/(i-n);return new s(h/e,0,0,0,0,h,0,0,0,0,(n+i)*a,-1,0,0,2*n*i*a,0)}static lookAt(t,e,i){let n=t.x,h=t.y,a=t.z,r=n-e.x,c=h-e.y,o=a-e.z;if(Math.abs(r)==0&&Math.abs(c)==0&&Math.abs(o)==0)return new s;let f=1/Math.hypot(r,c,o);r*=f,c*=f,o*=f;let d=i.x,l=i.y,u=i.z,E=l*o-u*c,x=u*r-d*o,y=d*c-l*r;f=Math.hypot(E,x,y),f==0?(E=0,x=0,y=0):(f=1/f,E*=f,x*=f,y*=f);let A=c*y-o*x,M=o*E-r*y,_=r*x-c*E;return f=Math.hypot(A,M,_),f==0?(A=0,M=0,_=0):(f=1/f,A*=f,M*=f,_*=f),new s(E,A,r,0,x,M,c,0,y,_,o,0,-(E*n+x*h+y*a),-(A*n+M*h+_*a),-(r*n+c*h+o*a),1)}static inverseOf(t){let e=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,E=t.m,x=t.n,y=t.o,A=t.p,M=e*r-i*a,_=e*c-n*a,m=e*o-h*a,R=i*c-n*r,w=i*o-h*r,U=n*o-h*c,O=f*x-d*E,p=f*y-l*E,v=f*A-u*E,G=d*y-l*x,$=d*A-u*x,I=l*A-u*y,S=M*I-_*$+m*G+R*v-w*p+U*O;return S?(S=1/S,new s((r*I-c*$+o*G)*S,(n*$-i*I-h*G)*S,(x*U-y*w+A*R)*S,(l*w-d*U-u*R)*S,(c*v-a*I-o*p)*S,(e*I-n*v+h*p)*S,(y*m-E*U-A*_)*S,(f*U-l*m+u*_)*S,(a*$-r*v+o*O)*S,(i*v-e*$-h*O)*S,(E*w-x*m+A*M)*S,(d*m-f*w-u*M)*S,(r*p-a*G-c*O)*S,(e*G-i*p+n*O)*S,(x*_-E*R-y*M)*S,(f*R-d*_+l*M)*S)):null}constructor(t=1,e=0,i=0,n=0,h=0,a=1,r=0,c=0,o=0,f=0,d=1,l=0,u=0,E=0,x=0,y=1){this.a=t,this.b=e,this.c=i,this.d=n,this.e=h,this.f=a,this.g=r,this.h=c,this.i=o,this.j=f,this.k=d,this.l=l,this.m=u,this.n=E,this.o=x,this.p=y}get 0(){return this.a}get 1(){return this.b}get 2(){return this.c}get 3(){return this.d}get 4(){return this.e}get 5(){return this.f}get 6(){return this.g}get 7(){return this.h}get 8(){return this.i}get 9(){return this.j}get 10(){return this.k}get 11(){return this.l}get 12(){return this.m}get 13(){return this.n}get 14(){return this.o}get 15(){return this.p}get length(){return 16}reset(){return this.a=1,this.b=0,this.c=0,this.d=0,this.e=0,this.f=1,this.g=0,this.h=0,this.i=0,this.j=0,this.k=1,this.l=0,this.m=0,this.n=0,this.o=0,this.p=1,this}set(t,e,i,n,h,a,r,c,o,f,d,l,u,E,x,y){return this.a=t,this.b=e,this.c=i,this.d=n,this.e=h,this.f=a,this.g=r,this.h=c,this.i=o,this.j=f,this.k=d,this.l=l,this.m=u,this.n=E,this.o=x,this.p=y,this}fromArray(t,e=0){return this.a=t[e+0],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.e=t[e+4],this.f=t[e+5],this.g=t[e+6],this.h=t[e+7],this.i=t[e+8],this.j=t[e+9],this.k=t[e+10],this.l=t[e+11],this.m=t[e+12],this.n=t[e+13],this.o=t[e+14],this.p=t[e+15],this}toArray(t=null,e=0){return t===null&&(t=new Array(16)),t[e+0]=this.a,t[e+1]=this.b,t[e+2]=this.c,t[e+3]=this.d,t[e+4]=this.e,t[e+5]=this.f,t[e+6]=this.g,t[e+7]=this.h,t[e+8]=this.i,t[e+9]=this.j,t[e+10]=this.k,t[e+11]=this.l,t[e+12]=this.m,t[e+13]=this.n,t[e+14]=this.o,t[e+15]=this.p,t}clone(){return new s(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m,this.n,this.o,this.p)}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this.j=t.j,this.k=t.k,this.l=t.l,this.m=t.m,this.n=t.n,this.o=t.o,this.p=t.p,this}compose(t,e,i){let n=e.x,h=e.y,a=e.z,r=e.w,c=i.x,o=i.y,f=i.z,d=n+n,l=h+h,u=a+a,E=n*d,x=n*l,y=n*u,A=h*l,M=h*u,_=a*u,m=r*d,R=r*l,w=r*u;return this.a=(1-(A+_))*c,this.b=(x+w)*c,this.c=(y-R)*c,this.d=0,this.e=(x-w)*o,this.f=(1-(E+_))*o,this.g=(M+m)*o,this.h=0,this.i=(y+R)*f,this.j=(M-m)*f,this.k=(1-(E+A))*f,this.l=0,this.m=t.x,this.n=t.y,this.o=t.z,this.p=1,this}decompose(t,e,i){let n=this.a,h=this.b,a=this.c,r=this.d,c=this.e,o=this.f,f=this.g,d=this.h,l=this.i,u=this.j,E=this.k,x=this.l,y=this.m,A=this.n,M=this.o,_=this.p,m=(n*o-h*c)*(E*_-x*M)-(n*f-a*c)*(u*_-x*A)+(n*d-r*c)*(u*M-E*A)+(h*f-a*o)*(l*_-x*y)-(h*d-r*o)*(l*M-E*y)+(a*d-r*f)*(l*A-u*y),R=Math.hypot(n,h,a)*Math.sign(m),w=Math.hypot(c,o,f),U=Math.hypot(l,u,E);t.x=y,t.y=A,t.z=M,n/=R,h/=R,a/=R,c/=w,o/=w,f/=w,l/=U,u/=U,E/=U;let O=n+o+E;if(O>0){let p=.5/Math.sqrt(O+1);e.x=(f-u)*p,e.y=(l-a)*p,e.z=(h-c)*p,e.w=.25/p}else if(n>o&&n>E){let p=2*Math.sqrt(1+n-o-E);e.x=.25*p,e.y=(c+h)/p,e.z=(l+a)/p,e.w=(f-u)/p}else if(o>E){let p=2*Math.sqrt(1+o-n-E);e.x=(c+h)/p,e.y=.25*p,e.z=(u+f)/p,e.w=(l-a)/p}else{let p=2*Math.sqrt(1+E-n-o);e.x=(l+a)/p,e.y=(u+f)/p,e.z=.25*p,e.w=(h-c)/p}return i.x=R,i.y=w,i.z=U,this}equals(t,e=H){return Math.abs(this.a-t.a)<=e&&Math.abs(this.b-t.b)<=e&&Math.abs(this.c-t.c)<=e&&Math.abs(this.d-t.d)<=e&&Math.abs(this.e-t.e)<=e&&Math.abs(this.f-t.f)<=e&&Math.abs(this.g-t.g)<=e&&Math.abs(this.h-t.h)<=e&&Math.abs(this.i-t.i)<=e&&Math.abs(this.j-t.j)<=e&&Math.abs(this.k-t.k)<=e&&Math.abs(this.l-t.l)<=e&&Math.abs(this.m-t.m)<=e&&Math.abs(this.n-t.n)<=e&&Math.abs(this.o-t.o)<=e&&Math.abs(this.p-t.p)<=e}transpose(){let t;return t=this.b,this.b=this.e,this.e=t,t=this.c,this.c=this.i,this.i=t,t=this.g,this.g=this.j,this.j=t,t=this.d,this.d=this.m,this.m=t,t=this.h,this.h=this.n,this.n=t,t=this.l,this.l=this.o,this.o=t,this}transposeOf(t){return this.a=t.a,this.b=t.e,this.c=t.i,this.d=t.m,this.e=t.b,this.f=t.f,this.g=t.j,this.h=t.n,this.i=t.c,this.j=t.g,this.k=t.k,this.l=t.o,this.m=t.d,this.n=t.h,this.o=t.l,this.p=t.p,this}invert(){let t=this.a,e=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=this.j,d=this.k,l=this.l,u=this.m,E=this.n,x=this.o,y=this.p,A=t*a-e*h,M=t*r-i*h,_=t*c-n*h,m=e*r-i*a,R=e*c-n*a,w=i*c-n*r,U=o*E-f*u,O=o*x-d*u,p=o*y-l*u,v=f*x-d*E,G=f*y-l*E,$=d*y-l*x,I=A*$-M*G+_*v+m*p-R*O+w*U;return I?(I=1/I,this.a=(a*$-r*G+c*v)*I,this.b=(i*G-e*$-n*v)*I,this.c=(E*w-x*R+y*m)*I,this.d=(d*R-f*w-l*m)*I,this.e=(r*p-h*$-c*O)*I,this.f=(t*$-i*p+n*O)*I,this.g=(x*_-u*w-y*M)*I,this.h=(o*w-d*_+l*M)*I,this.i=(h*G-a*p+c*U)*I,this.j=(e*p-t*G-n*U)*I,this.k=(u*R-E*_+y*A)*I,this.l=(f*_-o*R-l*A)*I,this.m=(a*O-h*v-r*U)*I,this.n=(t*v-e*O+i*U)*I,this.o=(E*M-u*m-x*A)*I,this.p=(o*m-f*M+d*A)*I,this):null}inverseOf(t){let e=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,E=t.m,x=t.n,y=t.o,A=t.p,M=e*r-i*a,_=e*c-n*a,m=e*o-h*a,R=i*c-n*r,w=i*o-h*r,U=n*o-h*c,O=f*x-d*E,p=f*y-l*E,v=f*A-u*E,G=d*y-l*x,$=d*A-u*x,I=l*A-u*y,S=M*I-_*$+m*G+R*v-w*p+U*O;return S?(S=1/S,this.a=(r*I-c*$+o*G)*S,this.b=(n*$-i*I-h*G)*S,this.c=(x*U-y*w+A*R)*S,this.d=(l*w-d*U-u*R)*S,this.e=(c*v-a*I-o*p)*S,this.f=(e*I-n*v+h*p)*S,this.g=(y*m-E*U-A*_)*S,this.h=(f*U-l*m+u*_)*S,this.i=(a*$-r*v+o*O)*S,this.j=(i*v-e*$-h*O)*S,this.k=(E*w-x*m+A*M)*S,this.l=(d*m-f*w-u*M)*S,this.m=(r*p-a*G-c*O)*S,this.n=(e*G-i*p+n*O)*S,this.o=(x*_-E*R-y*M)*S,this.p=(f*R-d*_+l*M)*S,this):null}adjoint(){let t=this.a,e=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=this.j,d=this.k,l=this.l,u=this.m,E=this.n,x=this.o,y=this.p;return this.a=+(a*(d*y-l*x)-f*(r*y-c*x)+E*(r*l-c*d)),this.b=-(e*(d*y-l*x)-f*(i*y-n*x)+E*(i*l-n*d)),this.c=+(e*(r*y-c*x)-a*(i*y-n*x)+E*(i*c-n*r)),this.d=-(e*(r*l-c*d)-a*(i*l-n*d)+f*(i*c-n*r)),this.e=-(h*(d*y-l*x)-o*(r*y-c*x)+u*(r*l-c*d)),this.f=+(t*(d*y-l*x)-o*(i*y-n*x)+u*(i*l-n*d)),this.g=-(t*(r*y-c*x)-h*(i*y-n*x)+u*(i*c-n*r)),this.h=+(t*(r*l-c*d)-h*(i*l-n*d)+o*(i*c-n*r)),this.i=+(h*(f*y-l*E)-o*(a*y-c*E)+u*(a*l-c*f)),this.j=-(t*(f*y-l*E)-o*(e*y-n*E)+u*(e*l-n*f)),this.k=+(t*(a*y-c*E)-h*(e*y-n*E)+u*(e*c-n*a)),this.l=-(t*(a*l-c*f)-h*(e*l-n*f)+o*(e*c-n*a)),this.m=-(h*(f*x-d*E)-o*(a*x-r*E)+u*(a*d-r*f)),this.n=+(t*(f*x-d*E)-o*(e*x-i*E)+u*(e*d-i*f)),this.o=-(t*(a*x-r*E)-h*(e*x-i*E)+u*(e*r-i*a)),this.p=+(t*(a*d-r*f)-h*(e*d-i*f)+o*(e*r-i*a)),this}adjointOf(t){let e=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,E=t.m,x=t.n,y=t.o,A=t.p;return this.a=+(r*(l*A-u*y)-d*(c*A-o*y)+x*(c*u-o*l)),this.b=-(i*(l*A-u*y)-d*(n*A-h*y)+x*(n*u-h*l)),this.c=+(i*(c*A-o*y)-r*(n*A-h*y)+x*(n*o-h*c)),this.d=-(i*(c*u-o*l)-r*(n*u-h*l)+d*(n*o-h*c)),this.e=-(a*(l*A-u*y)-f*(c*A-o*y)+E*(c*u-o*l)),this.f=+(e*(l*A-u*y)-f*(n*A-h*y)+E*(n*u-h*l)),this.g=-(e*(c*A-o*y)-a*(n*A-h*y)+E*(n*o-h*c)),this.h=+(e*(c*u-o*l)-a*(n*u-h*l)+f*(n*o-h*c)),this.i=+(a*(d*A-u*x)-f*(r*A-o*x)+E*(r*u-o*d)),this.j=-(e*(d*A-u*x)-f*(i*A-h*x)+E*(i*u-h*d)),this.k=+(e*(r*A-o*x)-a*(i*A-h*x)+E*(i*o-h*r)),this.l=-(e*(r*u-o*d)-a*(i*u-h*d)+f*(i*o-h*r)),this.m=-(a*(d*y-l*x)-f*(r*y-c*x)+E*(r*l-c*d)),this.n=+(e*(d*y-l*x)-f*(i*y-n*x)+E*(i*l-n*d)),this.o=-(e*(r*y-c*x)-a*(i*y-n*x)+E*(i*c-n*r)),this.p=+(e*(r*l-c*d)-a*(i*l-n*d)+f*(i*c-n*r)),this}determinant(){let t=this.a,e=this.b,i=this.c,n=this.d,h=this.e,a=this.f,r=this.g,c=this.h,o=this.i,f=this.j,d=this.k,l=this.l,u=this.m,E=this.n,x=this.o,y=this.p;return(t*a-e*h)*(d*y-l*x)-(t*r-i*h)*(f*y-l*E)+(t*c-n*h)*(f*x-d*E)+(e*r-i*a)*(o*y-l*u)-(e*c-n*a)*(o*x-d*u)+(i*c-n*r)*(o*E-f*u)}multiply(t){let e=this.a,i=this.b,n=this.c,h=this.d,a=this.e,r=this.f,c=this.g,o=this.h,f=this.i,d=this.j,l=this.k,u=this.l,E=this.m,x=this.n,y=this.o,A=this.p,M=t.a,_=t.b,m=t.c,R=t.d;return this.a=M*e+_*a+m*f+R*E,this.b=M*i+_*r+m*d+R*x,this.c=M*n+_*c+m*l+R*y,this.d=M*h+_*o+m*u+R*A,M=t.e,_=t.f,m=t.g,R=t.h,this.e=M*e+_*a+m*f+R*E,this.f=M*i+_*r+m*d+R*x,this.g=M*n+_*c+m*l+R*y,this.h=M*h+_*o+m*u+R*A,M=t.i,_=t.j,m=t.k,R=t.l,this.i=M*e+_*a+m*f+R*E,this.j=M*i+_*r+m*d+R*x,this.k=M*n+_*c+m*l+R*y,this.l=M*h+_*o+m*u+R*A,M=t.m,_=t.n,m=t.o,R=t.p,this.m=M*e+_*a+m*f+R*E,this.n=M*i+_*r+m*d+R*x,this.o=M*n+_*c+m*l+R*y,this.p=M*h+_*o+m*u+R*A,this}preMultiply(t){let e=t.a,i=t.b,n=t.c,h=t.d,a=t.e,r=t.f,c=t.g,o=t.h,f=t.i,d=t.j,l=t.k,u=t.l,E=t.m,x=t.n,y=t.o,A=t.p,M=this.a,_=this.b,m=this.c,R=this.d;return this.a=M*e+_*a+m*f+R*E,this.b=M*i+_*r+m*d+R*x,this.c=M*n+_*c+m*l+R*y,this.d=M*h+_*o+m*u+R*A,M=this.e,_=this.f,m=this.g,R=this.h,this.e=M*e+_*a+m*f+R*E,this.f=M*i+_*r+m*d+R*x,this.g=M*n+_*c+m*l+R*y,this.h=M*h+_*o+m*u+R*A,M=this.i,_=this.j,m=this.k,R=this.l,this.i=M*e+_*a+m*f+R*E,this.j=M*i+_*r+m*d+R*x,this.k=M*n+_*c+m*l+R*y,this.l=M*h+_*o+m*u+R*A,M=this.m,_=this.n,m=this.o,R=this.p,this.m=M*e+_*a+m*f+R*E,this.n=M*i+_*r+m*d+R*x,this.o=M*n+_*c+m*l+R*y,this.p=M*h+_*o+m*u+R*A,this}productOf(t,e){let i=t.a,n=t.b,h=t.c,a=t.d,r=t.e,c=t.f,o=t.g,f=t.h,d=t.i,l=t.j,u=t.k,E=t.l,x=t.m,y=t.n,A=t.o,M=t.p,_=e.a,m=e.b,R=e.c,w=e.d;return this.a=_*i+m*r+R*d+w*x,this.b=_*n+m*c+R*l+w*y,this.c=_*h+m*o+R*u+w*A,this.d=_*a+m*f+R*E+w*M,_=e.e,m=e.f,R=e.g,w=e.h,this.e=_*i+m*r+R*d+w*x,this.f=_*n+m*c+R*l+w*y,this.g=_*h+m*o+R*u+w*A,this.h=_*a+m*f+R*E+w*M,_=e.i,m=e.j,R=e.k,w=e.l,this.i=_*i+m*r+R*d+w*x,this.j=_*n+m*c+R*l+w*y,this.k=_*h+m*o+R*u+w*A,this.l=_*a+m*f+R*E+w*M,_=e.m,m=e.n,R=e.o,w=e.p,this.m=_*i+m*r+R*d+w*x,this.n=_*n+m*c+R*l+w*y,this.o=_*h+m*o+R*u+w*A,this.p=_*a+m*f+R*E+w*M,this}translate(t,e,i){let n;return typeof t=="number"?(n=t,e=e??0,i=i??0):(n=t.x,e=t.y,i=t.z),this.m+=this.a*n+this.e*e+this.i*i,this.n+=this.b*n+this.f*e+this.j*i,this.o+=this.c*n+this.g*e+this.k*i,this.p+=this.d*n+this.h*e+this.l*i,this}translateX(t){return this.m+=this.a*t,this.n+=this.b*t,this.o+=this.c*t,this.p+=this.d*t,this}translateY(t){return this.m+=this.e*t,this.n+=this.f*t,this.o+=this.g*t,this.p+=this.h*t,this}translateZ(t){return this.m+=this.i*t,this.n+=this.j*t,this.o+=this.k*t,this.p+=this.l*t,this}rotate(t,e){let i=t.x,n=t.y,h=t.z,a=Math.sin(e),r=Math.cos(e),c=1-r,o=i*i*c+r,f=n*i*c+h*a,d=h*i*c-n*a,l=i*n*c-h*a,u=n*n*c+r,E=h*n*c+i*a,x=i*h*c+n*a,y=n*h*c-i*a,A=h*h*c+r,M=this.a,_=this.b,m=this.c,R=this.d,w=this.e,U=this.f,O=this.g,p=this.h,v=this.i,G=this.j,$=this.k,I=this.l;return this.a=M*o+w*f+v*d,this.b=_*o+U*f+G*d,this.c=m*o+O*f+$*d,this.d=R*o+p*f+I*d,this.e=M*l+w*u+v*E,this.f=_*l+U*u+G*E,this.g=m*l+O*u+$*E,this.h=R*l+p*u+I*E,this.i=M*x+w*y+v*A,this.j=_*x+U*y+G*A,this.k=m*x+O*y+$*A,this.l=R*x+p*y+I*A,this}rotateX(t){let e=Math.sin(t),i=Math.cos(t),n=this.e,h=this.f,a=this.g,r=this.h,c=this.i,o=this.j,f=this.k,d=this.l;return this.e=n*i+c*e,this.f=h*i+o*e,this.g=a*i+f*e,this.h=r*i+d*e,this.i=c*i-n*e,this.j=o*i-h*e,this.k=f*i-a*e,this.l=d*i-r*e,this}rotateY(t){let e=Math.sin(t),i=Math.cos(t),n=this.a,h=this.b,a=this.c,r=this.d,c=this.i,o=this.j,f=this.k,d=this.l;return this.a=n*i-c*e,this.b=h*i-o*e,this.c=a*i-f*e,this.d=r*i-d*e,this.i=c*i+n*e,this.j=o*i+h*e,this.k=f*i+a*e,this.l=d*i+r*e,this}rotateZ(t){let e=Math.sin(t),i=Math.cos(t),n=this.a,h=this.b,a=this.c,r=this.d,c=this.e,o=this.f,f=this.g,d=this.h;return this.a=n*i+c*e,this.b=h*i+o*e,this.c=a*i+f*e,this.d=r*i+d*e,this.e=c*i-n*e,this.f=o*i-h*e,this.g=f*i-a*e,this.h=d*i-r*e,this}scale(t,e,i){let n;return typeof t=="number"?(n=t,e=e??t,i=i??t):(n=t.x,e=t.y,i=t.z),this.a*=n,this.b*=n,this.c*=n,this.d*=n,this.e*=e,this.f*=e,this.g*=e,this.h*=e,this.i*=i,this.j*=i,this.k*=i,this.l*=i,this}perspective(t,e,i,n){let h=1/Math.tan(t/2),a=1/(i-n);return this.set(h/e,0,0,0,0,h,0,0,0,0,(n+i)*a,-1,0,0,2*n*i*a,0)}ortho(t,e,i,n,h,a){let r=1/(t-e),c=1/(i-n),o=1/(h-a);return this.set(-2*r,0,0,0,0,-2*c,0,0,0,0,2*o,0,(t+e)*r,(n+i)*c,(a+h)*o,1)}lookAt(t,e,i){let n=t.x,h=t.y,a=t.z,r=n-e.x,c=h-e.y,o=a-e.z;if(Math.abs(r)==0&&Math.abs(c)==0&&Math.abs(o)==0)return this.reset();let f=1/Math.hypot(r,c,o);r*=f,c*=f,o*=f;let d=i.x,l=i.y,u=i.z,E=l*o-u*c,x=u*r-d*o,y=d*c-l*r;f=Math.hypot(E,x,y),f==0?(E=0,x=0,y=0):(f=1/f,E*=f,x*=f,y*=f);let A=c*y-o*x,M=o*E-r*y,_=r*x-c*E;return f=Math.hypot(A,M,_),f==0?(A=0,M=0,_=0):(f=1/f,A*=f,M*=f,_*=f),this.set(E,A,r,0,x,M,c,0,y,_,o,0,-(E*n+x*h+y*a),-(A*n+M*h+_*a),-(r*n+c*h+o*a),1)}fromQuat(t){let e=t.x,i=t.y,n=t.z,h=t.w,a=e+e,r=i+i,c=n+n,o=e*a,f=e*r,d=e*c,l=i*r,u=i*c,E=n*c,x=h*a,y=h*r,A=h*c;return this.a=1-(l+E),this.b=f+A,this.c=d-y,this.d=0,this.e=f-A,this.f=1-(o+E),this.g=u+x,this.h=0,this.i=d+y,this.j=u-x,this.k=1-(o+l),this.l=0,this.m=0,this.n=0,this.o=0,this.p=1,this}getTranslation(){return new P(this.m,this.n,this.o)}getMat3(){return new V(this.a,this.b,this.c,this.e,this.f,this.g,this.i,this.j,this.k)}getScaling(){return new P(Math.hypot(this.a,this.b,this.c),Math.hypot(this.e,this.f,this.g),Math.hypot(this.i,this.j,this.k))}*[Symbol.iterator](){yield this.a,yield this.b,yield this.c,yield this.d,yield this.e,yield this.f,yield this.g,yield this.h,yield this.i,yield this.j,yield this.k,yield this.l,yield this.m,yield this.n,yield this.o,yield this.p}};nt.prototype.isMat4=!0;nt.prototype.isMathPrimitive=!0;var X=class s{x;y;z;w;static of(t,e,i,n=1){return new s(t,e,i,n)}static zero(){return new s(0,0,0,0)}static all(t){return new s(t,t,t,t)}static random(){return new s(Math.random(),Math.random(),Math.random(),Math.random())}static xAxis(){return new s(1,0,0)}static yAxis(){return new s(0,1,0)}static zAxis(){return new s(0,0,1)}static translateX(t){return new s(t,0,0,1)}static translateY(t){return new s(0,t,0,1)}static translateZ(t){return new s(0,0,t,1)}static randomDir(){let t=Math.random()*2-1,e=Math.random()*2-1,i=Math.random()*2-1,n=Math.hypot(t,e,i);return new s(t/n,e/n,i/n,0)}static fromArray(t,e=0){return new s(t[e],t[e+1],t[e+2],t[e+3])}static sumOf(t,e){return new s(t.x+e.x,t.y+e.y,t.z+e.z,t.w+e.w)}static differenceOf(t,e){return new s(t.x-e.x,t.y-e.y,t.z-e.z,t.w-e.w)}static productOf(t,e){return new s(t.x*e.x,t.y*e.y,t.z*e.z,t.w*e.w)}static quotientOf(t,e){return new s(t.x/e.x,t.y/e.y,t.z/e.z,t.w/e.w)}static minOf(t,e){return new s(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z),Math.min(t.w,e.w))}static maxOf(t,e){return new s(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z),Math.max(t.w,e.w))}constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get 2(){return this.z}set 2(t){this.z=t}get 3(){return this.w}set 3(t){this.w=t}get length(){return 4}get xyz(){return new P(this.x,this.y,this.z)}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error(`Invalid Vec4 index: ${t}`)}}setIndex(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error(`Invalid Vec4 index: ${t}`)}}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=null,e=0){return t===null&&(t=new Array(3)),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}clone(){return new s(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}equals(t,e=H){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e&&Math.abs(this.z-t.z)<=e&&Math.abs(this.w-t.w)<=e}any(){return this.x!=0||this.y!=0||this.z!=0||this.w!=0}set(t,e,i,n){return this.x=t,this.y=e??t,this.z=i??(e===void 0?t:0),this.w=n??1,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}randomize(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addAll(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}sumOf(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subtractAll(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}differenceOf(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}productOf(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this}divideBy(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}quotientOf(t,e){return this.x=t.x/e.x,this.y=t.y/e.y,this.z=t.z/e.z,this.w=t.w/e.w,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}invert(){return this.x=this.x==0?0:1/this.x,this.y=this.y==0?0:1/this.y,this.z=this.z==0?0:1/this.z,this.w=this.w==0?0:1/this.w,this}inverseOf(t){return this.x=t.x==0?0:1/t.x,this.y=t.y==0?0:1/t.y,this.z=t.z==0?0:1/t.z,this.w=t.w==0?0:1/t.w,this}addScaled(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}mod(t){return this.x%=t.x,this.y%=t.y,this.z%=t.z,this.w%=t.w,this}modAll(t){return this.x%=t,this.y%=t,this.z%=t,this.w%=t,this}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpOf(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.w!==0&&(this.x/=this.w,this.y/=this.w,this.z/=this.w,this.w=1),this}normalOf(t){return t.w===0?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x/=t.w,this.y/=t.w,this.z/=t.w,this.w=1),this}min(t){return typeof t=="number"?(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t),this.z=Math.min(this.z,t),this.w=Math.min(this.w,t)):(this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w)),this}minOf(t,e){return this.x=Math.min(t.x,e.x),this.y=Math.min(t.y,e.y),this.z=Math.min(t.z,e.z),this.w=Math.min(t.w,e.w),this}max(t){return typeof t=="number"?(this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),this.z=Math.max(this.z,t),this.w=Math.max(this.w,t)):(this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w)),this}maxOf(t,e){return this.x=Math.max(t.x,e.x),this.y=Math.max(t.y,e.y),this.z=Math.max(t.z,e.z),this.w=Math.max(t.w,e.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}applyMat4(t){let e=this.x,i=this.y,n=this.z,h=this.w;return this.x=e*t.a+i*t.e+n*t.i+h*t.m,this.y=e*t.b+i*t.f+n*t.j+h*t.n,this.z=e*t.c+i*t.g+n*t.k+h*t.o,this.w=e*t.d+i*t.h+n*t.l+h*t.p,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};X.prototype.isVec4=!0;X.prototype.isMathPrimitive=!0;function qs(s){return function(){var t=s+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function vt(s){return s.x*=s.x*34+133,s.y*=s.y*34+133,s.z*=s.z*34+133,s.w*=s.w*34+133,s}function mt(s){let t=new P(s,s/2,s/4).floor().modAll(2).scale(2).subtractAll(1),e=t.clone();e.setIndex(Math.max(0,Math.floor(s/16)),0);let i=Math.floor(s/8)%2,n=t.clone().scale(1-i).add(t.cross(e).add(e).scale(i)),h=e.scale(1.22474487139).add(n);return h.scale((1-.042942436724648037*i)*3.5946317686139184),h}function qt(s){let t=s.clone().floor(),e=new X(s.x-t.x,s.y-t.y,s.z-t.z,2.5),i=t.clone().addAll(Math.floor(e.dot(X.all(.25)))),n=t.clone().add(P.xAxis()).add(new P(-1,1,1).scale(Math.floor(e.dot(new X(-.25,.25,.25,.35))))),h=t.clone().add(P.yAxis()).add(new P(1,-1,1).scale(Math.floor(e.dot(new X(.25,-.25,.25,.35))))),a=t.add(P.zAxis()).add(new P(1,1,-1).scale(Math.floor(e.dot(new X(.25,.25,-.25,.35))))),r=vt(new X(i.x,n.x,h.x,a.x).modAll(289));vt(r.add(new X(i.y,n.y,h.y,a.y)).modAll(289)),vt(r.add(new X(i.z,n.z,h.z,a.z)).modAll(289)).modAll(48);let c=s.clone().subtract(i),o=s.clone().subtract(n),f=s.clone().subtract(h),d=s.subtract(a),l=X.all(.75).subtract(new X(c.dot(c),o.dot(o),f.dot(f),d.dot(d))).max(0),u=l.clone().multiply(l),E=u.clone().multiply(u),x=mt(r.x),y=mt(r.y),A=mt(r.z),M=mt(r.w),_=new X(c.dot(x),o.dot(y),f.dot(A),d.dot(M)),m=E.dot(_),R=u.multiply(l).multiply(_).applyMat4(nt.fromVec3s(c,o,f,d)).scale(-8).add(E.applyMat4(nt.fromVec3s(x,y,A,M)));return new X(R.x,R.y,R.z,m)}var Kt=new V(.788675134594813,-.211324865405187,-.577350269189626,-.211324865405187,.788675134594813,-.577350269189626,.577350269189626,.577350269189626,.577350269189626);function Ks(s){s.applyMat3(Kt);let t=qt(s.clone()).add(qt(s.addAll(144.5))),e=t.xyz.applyMat3(Kt);return new X(e.x,e.y,e.z,t.w)}var rt=class s{x;y;z;w;static identity(){return new s(0,0,0,1)}static random(){let t=Math.random(),e=Math.random()*2*Math.PI,i=Math.random()*2*Math.PI,n=Math.sqrt(1-t),h=Math.sqrt(t);return new s(n*Math.cos(e),h*Math.sin(i),h*Math.cos(i),n*Math.sin(e))}static fromArray(t,e=0){return new s(t[e],t[e+1],t[e+2],t[e+3])}static fromAxisAngle(t,e){let i=e/2,n=Math.sin(i);return new s(t.x*n,t.y*n,t.z*n,Math.cos(i))}static fromMat3(t){let e=t.a,i=t.d,n=t.g,h=t.b,a=t.e,r=t.h,c=t.c,o=t.f,f=t.i,d=e+a+f;if(d>0){let l=.5/Math.sqrt(d+1);return new s((o-r)*l,(n-c)*l,(h-i)*l,.25/l)}else if(e>a&&e>f){let l=2*Math.sqrt(1+e-a-f);return new s(.25*l,(i+h)/l,(n+c)/l,(o-r)/l)}else if(a>f){let l=2*Math.sqrt(1+a-e-f);return new s((i+h)/l,.25*l,(r+o)/l,(n-c)/l)}else{let l=2*Math.sqrt(1+f-e-a);return new s((n+c)/l,(r+o)/l,.25*l,(h-i)/l)}}static fromDirections(t,e){let i=t.dot(e)+1;if(i<H)if(Math.abs(t.x)>Math.abs(t.z)){let n=Math.hypot(t.x,t.y);return new s(-t.y/n,t.x/n,0,0)}else{let n=Math.hypot(t.y,t.z);return new s(0,-t.z/n,t.y/n,0)}else{let n=t.y*e.z-t.z*e.y,h=t.z*e.x-t.x*e.z,a=t.x*e.y-t.y*e.x,r=Math.hypot(n,h,a,i);return new s(n/r,h/r,a/r,i/r)}}static slerpOf(t,e,i){let n=t.x,h=t.y,a=t.z,r=t.w,c=e.x,o=e.y,f=e.z,d=e.w,l=n*c+h*o+a*f+r*d;l<0&&(l=-l,c=-c,o=-o,f=-f,d=-d);let u,E;if(1-l>H){let x=Math.acos(l),y=Math.sin(x);u=Math.sin((1-i)*x)/y,E=Math.sin(i*x)/y}else u=1-i,E=i;return new s(u*n+E*c,u*h+E*o,u*a+E*f,u*r+E*d)}static sqlerpOf(t,e,i,n,h){return s.slerpOf(t,e,h).slerp(s.slerpOf(i,n,h),2*h*(1-h))}constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get 0(){return this.x}get 1(){return this.y}get 2(){return this.x}get 3(){return this.w}get length(){return 4}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=null,e=0){return t===null&&(t=new Array(4)),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}clone(){return new s(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}fromAxisAngle(t,e){let i=e/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this}equals(t,e=H){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e&&Math.abs(this.z-t.z)<=e&&Math.abs(this.w-t.w)<=e}invert(){let t=this.x,e=this.y,i=this.z,n=this.w,h=t*t+e*e+i*i+n*n;return h===0?(this.x=0,this.y=0,this.z=0,this.w=1):(h=1/h,this.x=-t*h,this.y=-e*h,this.z=-i*h,this.w=n*h),this}inverseOf(t){let e=t.x,i=t.y,n=t.z,h=t.w,a=e*e+i*i+n*n+h*h;return a===0?(this.x=0,this.y=0,this.z=0,this.w=1):(a=1/a,this.x=-e*a,this.y=-i*a,this.z=-n*a,this.w=h*a),this}conjugate(){return new s(-this.x,-this.y,-this.z,this.w)}conjugateOf(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalize(){let t=Math.hypot(this.x,this.y,this.z,this.w);return t===0?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this}normalizeOf(t){let e=Math.hypot(t.x,t.y,t.z,t.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e,this.w=t.w/e),this}multiply(t){let e=this.x,i=this.y,n=this.z,h=this.w,a=t.x,r=t.y,c=t.z,o=t.w;return this.x=e*o+h*a+i*c-n*r,this.y=i*o+h*r+n*a-e*c,this.z=n*o+h*c+e*r-i*a,this.w=h*o-e*a-i*r-n*c,this}preMultiply(t){let e=t.x,i=t.y,n=t.z,h=t.w,a=this.x,r=this.y,c=this.z,o=this.w;return this.x=e*o+h*a+i*c-n*r,this.y=i*o+h*r+n*a-e*c,this.z=n*o+h*c+e*r-i*a,this.w=h*o-e*a-i*r-n*c,this}productOf(t,e){let i=t.x,n=t.y,h=t.z,a=t.w,r=e.x,c=e.y,o=e.z,f=e.w;return this.x=i*f+a*r+n*o-h*c,this.y=n*f+a*c+h*r-i*o,this.z=h*f+a*o+i*c-n*r,this.w=a*f-i*r-n*c-h*o,this}slerp(t,e){let i=this.x,n=this.y,h=this.z,a=this.w,r=t.x,c=t.y,o=t.z,f=t.w,d=i*r+n*c+h*o+a*f;d<0&&(d=-d,r=-r,c=-c,o=-o,f=-f);let l,u;if(1-d>H){let E=Math.acos(d),x=Math.sin(E);l=Math.sin((1-e)*E)/x,u=Math.sin(e*E)/x}else l=1-e,u=e;return this.x=l*i+u*r,this.y=l*n+u*c,this.z=l*h+u*o,this.w=l*a+u*f,this}slerpOf(t,e,i){let n=t.x,h=t.y,a=t.z,r=t.w,c=e.x,o=e.y,f=e.z,d=e.w,l=n*c+h*o+a*f+r*d;l<0&&(l=-l,c=-c,o=-o,f=-f,d=-d);let u,E;if(1-l>H){let x=Math.acos(l),y=Math.sin(x);u=Math.sin((1-i)*x)/y,E=Math.sin(i*x)/y}else u=1-i,E=i;return this.x=u*n+E*c,this.y=u*h+E*o,this.z=u*a+E*f,this.w=u*r+E*d,this}angleTo(t){let e=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;return Math.acos(2*e*e-1)}getAxisAngle(t){let e=Math.acos(this.w)*2,i=Math.sin(e/2);return i>H?(t.x=this.x/i,t.y=this.y/i,t.z=this.z/i):(t.x=1,t.y=0,t.z=0),e}rotateX(t){t*=.5;let e=Math.sin(t),i=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return this.x=n*i+r*e,this.y=h*i+a*e,this.z=a*i-h*e,this.w=r*i-n*e,this}rotateY(t){t*=.5;let e=Math.sin(t),i=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return this.x=n*i-a*e,this.y=h*i+r*e,this.z=a*i+n*e,this.w=r*i-h*e,this}rotateZ(t){t*=.5;let e=Math.sin(t),i=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return this.x=n*i+h*e,this.y=h*i-n*e,this.z=a*i+r*e,this.w=r*i-a*e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};rt.prototype.isQuat=!0;rt.prototype.isMathPrimitive=!0;var k=class s{x;y;static of(t,e){return new s(t,e)}static zero(){return new s(0,0)}static all(t){return new s(t,t)}static random(){return new s(Math.random(),Math.random())}static xAxis(){return new s(1,0)}static yAxis(){return new s(0,1)}static translateX(t){return new s(t,0)}static translateY(t){return new s(0,t)}static randomDir(){let t=Math.random()*2-1,e=Math.random()*2-1,i=Math.hypot(t,e);return new s(t/i,e/i)}static fromArray(t,e=0){return new s(t[e],t[e+1])}static sumOf(t,e){return new s(t.x+e.x,t.y+e.y)}static differenceOf(t,e){return new s(t.x-e.x,t.y-e.y)}static productOf(t,e){return new s(t.x*e.x,t.y*e.y)}static quotientOf(t,e){return new s(t.x/e.x,t.y/e.y)}static normalOf(t){let e=t.x*t.x+t.y*t.y;if(e>0){let i=1/Math.sqrt(e);return new s(t.x*i,t.y*i)}else return new s(0,0)}static minOf(t,e){return new s(Math.min(t.x,e.x),Math.min(t.y,e.y))}static maxOf(t,e){return new s(Math.max(t.x,e.x),Math.max(t.y,e.y))}constructor(t=0,e=0){this.x=t,this.y=e}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get length(){return 2}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get ratio(){return this.y===0?0:this.x/this.y}get u(){return this.x}set u(t){this.x=t}get v(){return this.y}set v(t){this.y=t}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error(`Invalid Vec2 index: ${t}`)}}setIndex(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error(`Invalid Vec2 index: ${t}`)}}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=null,e=0){return t===null&&(t=new Array(2)),t[e]=this.x,t[e+1]=this.y,t}clone(){return new s(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}equals(t,e=H){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}any(){return this.x!=0||this.y!=0}set(t,e){return this.x=t,this.y=e??t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}randomize(){return this.x=Math.random(),this.y=Math.random(),this}add(t){return this.x+=t.x,this.y+=t.y,this}addAll(t){return this.x+=t,this.y+=t,this}sumOf(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}subtractAll(t){return this.x-=t,this.y-=t,this}differenceOf(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}productOf(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this}divideBy(t){return this.x/=t.x,this.y/=t.y,this}quotientOf(t,e){return this.x=t.x/e.x,this.y=t.y/e.y,this}scale(t){return this.x*=t,this.y*=t,this}invert(){return this.x=this.x==0?0:1/this.x,this.y=this.y==0?0:1/this.y,this}inverseOf(t){return this.x=t.x==0?0:1/t.x,this.y=t.y==0?0:1/t.y,this}addScaled(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}mod(t){return this.x%=t.x,this.y%=t.y,this}modAll(t){return this.x%=t,this.y%=t,this}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpOf(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}magSq(){return this.x*this.x+this.y*this.y}magnitude(){return Math.hypot(this.x,this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){let t=this.x*this.x+this.y*this.y;if(t>0){let e=1/Math.sqrt(t);this.x*=e,this.y*=e}return this}normalOf(t){let e=t.x*t.x+t.y*t.y;if(e>0){let i=1/Math.sqrt(e);this.x=t.x*i,this.y=t.y*i}else this.x=0,this.y=0;return this}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y)}distanceToSq(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}minOf(t,e){return this.x=Math.min(t.x,e.x),this.y=Math.min(t.y,e.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}maxOf(t,e){return this.x=Math.max(t.x,e.x),this.y=Math.max(t.y,e.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampMagnitude(t,e){let i=this.x*this.x+this.y*this.y;if(i>0){let n=Math.sqrt(i),h=Math.max(t,Math.min(e,n))/n;this.x*=h,this.y*=h}return this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}angle(){return Math.atan2(this.y,this.x)}angleTo(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)}rotate(t){let e=Math.cos(t),i=Math.sin(t),n=this.x,h=this.y;return this.x=n*e-h*i,this.y=n*i+h*e,this}rotateAround(t,e){let i=Math.cos(t),n=Math.sin(t),h=this.x-e.x,a=this.y-e.y;return this.x=h*i-a*n+e.x,this.y=h*n+a*i+e.y,this}translateX(t){return this.x+=t,this}translateY(t){return this.y+=t,this}applyMat3(t){let e=this.x,i=this.y;return this.x=e*t.a+i*t.d+t.g,this.y=e*t.b+i*t.e+t.h,this}*[Symbol.iterator](){yield this.x,yield this.y}};k.prototype.isVec2=!0;k.prototype.isMathPrimitive=!0;var Rt=class s{x;y;width;height;static unionOf(t){if(t.length===0)return new s;let e=t[0].clone();for(let i=1;i<t.length;i++)e.union(t[i]);return e}static fromCorners(t,e){return new s(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.abs(t.x-e.x),Math.abs(t.y-e.y))}constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n}clone(){return new s(this.x,this.y,this.width,this.height)}set(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this}get size(){return new k(this.width,this.height)}set size(t){this.width=t.x,this.height=t.y}get left(){return this.x}set left(t){this.x=t}get top(){return this.y}set top(t){this.y=t}get right(){return this.x+this.width}set right(t){this.width=Math.max(0,t-this.x)}get bottom(){return this.y+this.height}set bottom(t){this.height=Math.max(0,t-this.y)}get topLeft(){return new k(this.x,this.y)}get topRight(){return new k(this.x+this.width,this.y)}get bottomLeft(){return new k(this.x,this.y+this.height)}get bottomRight(){return new k(this.x+this.width,this.y+this.height)}get center(){return new k(this.x+this.width*.5,this.y+this.height*.5)}contains(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}containsRect(t){return t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom}containsRect4(t,e,i,n){return t>=this.x&&e>=this.y&&t+i<=this.right&&e+n<=this.bottom}intersects(t){return this.x<t.right&&this.right>t.x&&this.y<t.bottom&&this.bottom>t.y}intersects4(t,e,i,n){return this.x<t+i&&this.right>t&&this.y<e+n&&this.bottom>e}union(t){let e=this.right,i=this.bottom;this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(e,t.right)-this.x,this.height=Math.max(i,t.bottom)-this.y}unionOf(t){if(t.length===0)this.x=this.y=this.width=this.height=0;else{this.x=t[0].x,this.y=t[0].y,this.width=t[0].width,this.height=t[0].height;for(let e=1;e<t.length;e++)this.union(t[e])}return this}isEmpty(){return this.width<=0||this.height<=0}clear(){this.x=this.y=this.width=this.height=0}include(t,e){return t<this.x?(this.width+=this.x-t,this.x=t):t>this.right&&(this.width=t-this.x),e<this.y?(this.height+=this.y-e,this.y=e):e>this.bottom&&(this.height=e-this.y),this}grow(t){return this.x-=t,this.y-=t,this.width+=t*2,this.height+=t*2,this}fromCorners(t,e){return this.x=Math.min(t.x,e.x),this.y=Math.min(t.y,e.y),this.width=Math.abs(t.x-e.x),this.height=Math.abs(t.y-e.y),this}fromCorners4(t,e,i,n){return this.x=Math.min(t,i),this.y=Math.min(e,n),this.width=Math.abs(t-i),this.height=Math.abs(e-n),this}};Rt.prototype.isRect=!0;function Zs(s,t={}){let e=Math.abs(t.width??1),i=Math.abs(t.height??1),n=Math.max(Math.round(t.widthSegments??1),1),h=Math.max(Math.round(t.heightSegments??1),1),a=t.textureXform??V.identity(),r=new Array,c=new Array,o=new Array,f=new Array,d=new Array,l=new k;for(let u=0;u<=h;u++){let E=u/h;for(let x=0;x<=n;x++){let y=x/n;if(r.push((2*y-1)*e,(2*E-1)*i,0),x<n&&u<h){let A=(n+1)*(u+0)+(x+0),M=(n+1)*(u+0)+(x+1),_=(n+1)*(u+1)+(x+1),m=(n+1)*(u+1)+(x+0);c.push(A,M,m,M,_,m)}f.push(0,0,1),d.push(1,0,0),l.x=y,l.y=E,l.applyMat3(a),o.push(l.x,l.y)}}return{name:s,positions:r,indices:c,texCoords:o,normals:f,tangents:d}}function Qs(s,t={}){let e=Math.abs(t.radius??1),i=Math.max(Math.round(t.segments??32),3),n=Math.max(Math.round(t.internalSegments??1),1),h=new Array,a=new Array,r=new Array,c=new Array,o=new Array;for(let f=0;f<=n;f++){let d=e*(f/n);for(let l=0;l<=i;l++){let u=2*Math.PI*(l/i),E=-d*Math.cos(u),x=d*Math.sin(u);if(h.push(E,x,0),c.push(0,0,1),o.push(1,0,0),r.push((E/e+1)/2,(x/e+1)/2),f<n&&l<i){let y=f*(i+1)+l,A=f*(i+1)+l+1,M=(f+1)*(i+1)+l+1,_=(f+1)*(i+1)+l;a.push(y,A,_),a.push(A,M,_)}}}return{name:s,positions:h,indices:a,texCoords:r,normals:c,tangents:o}}function Dt(s,t={}){let e=t.width??1,i=t.height??1,n=t.depth??1,h=Math.max(1,Math.round(t.widthSegments??1)),a=Math.max(1,Math.round(t.heightSegments??1)),r=Math.max(1,Math.round(t.depthSegments??1)),c=t.textureXform??V.identity(),o=new Array,f=new Array,d=new Array,l=new Array,u=new Array;function E(A,M,_,m,R,w){let U=A/2,O=M/2,p=_/2,v=A/m,G=M/R,$=o.length/3,I=m+1,S=new P,ft=new k,wt=new P(0,0,1).rotateQuat(w),Tt=new P(1,0,0).rotateQuat(w);for(let Q=0;Q<=R;Q++){let ss=Q*G-O;for(let J=0;J<=m;J++)if(S.set(J*v-U,ss,p).rotateQuat(w),o.push(S.x,S.y,S.z),ft.set(J/m,Q/R),ft.applyMat3(c),d.push(ft.x,ft.y),l.push(wt.x,wt.y,wt.z),u.push(Tt.x,Tt.y,Tt.z),Q<R&&J<m){let es=$+J+I*Q,Bt=$+J+I*(Q+1),is=$+(J+1)+I*(Q+1),Lt=$+(J+1)+I*Q;f.push(es,Lt,Bt),f.push(Bt,Lt,is)}}}let x=new P,y=new rt;return E(n,i,e,r,a,y.fromAxisAngle(x.set(0,1,0),Math.PI/-2)),E(n,i,e,r,a,y.fromAxisAngle(x.set(0,1,0),Math.PI/2)),E(e,n,i,h,r,y.fromAxisAngle(x.set(1,0,0),Math.PI/2)),E(e,n,i,h,r,y.fromAxisAngle(x.set(1,0,0),Math.PI/-2)),E(e,i,n,h,a,y.fromAxisAngle(x.set(0,1,0),Math.PI)),E(e,i,n,h,a,y.fromAxisAngle(x.set(0,1,0),0)),{name:s,positions:o,indices:f,texCoords:d,normals:l,tangents:u}}function Js(s,t={}){let e=Math.max(0,t.radius??1),i=Math.max(3,Math.floor(t.widthSegments??32)),n=Math.max(2,Math.floor(t.heightSegments??16)),h=t.textureXform??V.identity(),a=new Array,r=new Array,c=new Array,o=new Array,f=new k;for(let d=0;d<=n;d++){let l=d*Math.PI/n,u=Math.sin(l),E=Math.cos(l),x=0;d===0?x=.5/i:d===n&&(x=-.5/i);for(let y=0;y<=i;y++){let A=y*2*Math.PI/i,M=Math.cos(A)*u,_=E,m=Math.sin(A)*u;if(f.x=1-y/i+x,f.y=1-d/n,f.applyMat3(h),a.push(e*M,e*_,e*m),o.push(M,_,m),c.push(f.x,f.y),d<n&&y<i){let R=d*(i+1)+y,w=R+i+1;r.push(R,R+1,w),r.push(w,R+1,w+1)}}}return Zt(s,r,a,c,o),{name:s,positions:a,indices:r,texCoords:c,normals:o,tangents:Gt(a,c,r,o)}}function te(s,t={}){let e=t.in2D??!1,i=t.left??-1,n=t.right??1,h=t.top??1,a=t.bottom??-1;return{name:s,positions:e?[i,a,i,h,n,h,n,a]:[i,a,0,i,h,0,n,h,0,n,a,0],indices:[0,1,2,0,2,3],texCoords:[0,0,0,1,1,1,1,0],normals:e?[]:[0,0,1,0,0,1,0,0,1,0,0,1],tangents:e?[]:[1,0,0,1,0,0,1,0,0,1,0,0]}}function se(s,t={}){let e=Math.max(0,t.knotRadius??1),i=Math.max(0,t.tubeRadius??.4),n=Math.max(3,Math.floor(t.tubeSegments??64)),h=Math.max(3,Math.floor(t.radialSegments??8)),a=Math.max(1,Math.floor(t.p??2)),r=Math.max(1,Math.floor(t.q??3)),c=[],o=[],f=[],d=[],l=(M,_,m,R,w)=>{let U=Math.cos(M),O=Math.sin(M),p=m/_*M,v=Math.cos(p);w.x=R*(2+v)*.5*U,w.y=R*(2+v)*O*.5,w.z=R*Math.sin(p)*.5},u=new P,E=new P,x=new P,y=new P,A=new P;for(let M=0;M<=n;++M){let _=M/n*a*Math.PI*2;l(_,a,r,e,E),l(_+.01,a,r,e,A),y.copy(A).subtract(E),x.crossOf(y,A),A.crossOf(x,y),x.normalize(),A.normalize();for(let m=0;m<=h;++m){let R=m/h*Math.PI*2,w=-i*Math.cos(R),U=i*Math.sin(R);if(u.x=E.x+(w*A.x+U*x.x),u.y=E.y+(w*A.y+U*x.y),u.z=E.z+(w*A.z+U*x.z),c.push(u.x,u.y,u.z),u.subtract(E).normalize(),f.push(u.x,u.y,u.z),d.push(M/n),d.push(m/h),M>=1&&m>=1){let O=(h+1)*(M-1)+(m-1),p=(h+1)*M+(m-1),v=(h+1)*M+m,G=(h+1)*(M-1)+m;o.push(O,p,G,p,v,G)}}}return{name:s,positions:c,indices:o,texCoords:d,normals:f,tangents:Gt(c,d,o,f)}}function ee(s){let t=new Set(["#","mtllib","usemtl","g","l","s",""]),e,i=[],n=[],h=[],a=[],r=s.split(`
`);for(let[c,o]of r.entries()){let f=o.split(" "),d=f[0];if(!t.has(d))if(d==="o")e===void 0?e=f[1]:b(()=>`Multiple object names defined in OBJ file (on line ${c})`);else if(d==="v")i.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(d==="vn")h.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(d==="vt")a.push(parseFloat(f[1]),parseFloat(f[2]));else if(d==="f")for(let l=1;l<=3;l++){let u=f[l].split("/"),E=parseInt(u[0])-1,x=u.length>1&&u[1]!==""?parseInt(u[1])-1:E,y=u.length>2?parseInt(u[2])-1:E;n.push([E,x,y])}else B(()=>`Unexpected OBJ token: "${d}" on line ${c}`)}return e===void 0&&b(()=>`No object name defined in OBJ file: "${s}"`),h.length===0&&(console.log(`Calculating normals for object "${e}"`),h.push(...ae(i,n.map(c=>c[2])))),a.length===0&&(B(()=>`No texture coordinates defined for object "${e}"`),a.push(...new Array(i.length/3*2).fill(0))),{name:e,positions:i,texCoords:a,normals:h,splitIndices:n}}function ie(s,t){let e=t.positions,i=t.texCoords,n=t.normals,h=t.indices,a=0,r=new Map;for(let c of s.splitIndices){let o=c.join("|"),f=r.get(o);if(f!==void 0){h.push(f);continue}let[d,l,u]=c,E=d*3;e.push(...s.positions.slice(E,E+3));let x=l*2;i.push(...s.texCoords.slice(x,x+2));let y=u*3;n.push(...s.normals.slice(y,y+3)),h.push(a),r.set(o,a),a++}t.tangents=Gt(e,i,h,n)}async function Pt(s){let e=await(await fetch(s,{mode:"cors",method:"GET",headers:{"Content-Type":"text/plain"}})).text(),i=ee(e),n={name:i.name,positions:[],indices:[],texCoords:[],normals:[],tangents:[]};return ie(i,n),n.name,n.indices,n.positions,Zt(n.name,n.indices,n.positions,n.texCoords,n.normals,n.tangents),n}function ne(s){let t=new Set,e=s.indices.length,i=s.positions.length/3,n=i;for(let h=0;h<e;h++){let a=s.indices[h];t.has(a)?(s.indices[h]=n,t.add(n++),s.positions.push(s.positions[a*3],s.positions[a*3+1],s.positions[a*3+2]),s.texCoords.push(s.texCoords[a*2],s.texCoords[a*2+1]),s.normals.push(s.normals[a*3],s.normals[a*3+1],s.normals[a*3+2]),s.tangents.push(s.tangents[a*3],s.tangents[a*3+1],s.tangents[a*3+2])):t.add(a)}i!==n&&C(()=>`Uniquified ${n-i} vertices.`)}function he(s){new Set(s.indices).size!==s.indices.length&&b(()=>`The geometry "${s.name}" must have unique vertices to generate barycentric coordinates.`);let t=new Array(s.positions.length).fill(0),e=s.indices;for(let i=0;i<s.indices.length;i+=3)t[e[i]*3]=1,t[e[i+1]*3+1]=1,t[e[i+2]*3+2]=1;return g(t.length===s.positions.length,()=>`Failed to calculate barycentric coordinates for geometry "${s.name}"`),t}function Zt(s,t,e,i,n,h){e.length%3!==0&&b(()=>`The positions array of "${s}" must have a length that is a multiple of 3, but it is ${e.length}.`),t.length%3!==0&&b(()=>`The indices array of "${s}" must have a length that is a multiple of 3, but it is ${t.length}.`),i&&i.length%2!==0&&b(()=>`The UVs array of "${s}" must have a length that is a multiple of 2, but it is ${i.length}.`),n&&n.length%3!==0&&b(()=>`The normals array of "${s}" must have a length that is a multiple of 3, but it is ${n.length}.`),h&&h.length%3!==0&&b(()=>`The tangents array of "${s}" must have a length that is a multiple of 3, but it is ${h.length}.`);let a=e.length/3;i&&i.length/2!==a&&b(()=>`The UVs array of "${s}" must have the same number of elements as the positions array.`),n&&n.length!==e.length&&b(()=>`The normals array of "${s}" must have the same number of elements as the positions array.`),h&&h.length!==e.length&&b(()=>`The tangents array of "${s}" must have the same number of elements as the positions array.`);let r=new Set;for(let f of t)r.add(f);if(r.size===a)return;let c=new Array;for(let f=0;f<a;f++)r.has(f)||c.push(f);for(let f=c.length-1;f>=0;f--){let d=c[f];e.splice(d*3,3),i&&i.splice(d*2,2),n&&n.splice(d*3,3),h&&h.splice(d*3,3)}let o=[];{let f=0,d=c[0],l=1;for(let u=0;u<a;u++)u===d&&(f++,d=c[l++]),o.push(f)}for(let f=0;f<t.length;f++)t[f]-=o[t[f]];C(()=>`Removed ${c.length} unused vertices from "${s}".`)}function ae(s,t){if(s.length===0||t.length===0)return B(()=>"Skipping computation of normals for an empty mesh."),[];t.length%3!==0&&b(()=>"The indices array must be a multiple of 3."),s.length%3!==0&&b(()=>"The positions array must be a multiple of 3.");let e=new Array(s.length).fill(0);for(let i=0;i<t.length;i+=3){let n=t[i]*3,h=t[i+1]*3,a=t[i+2]*3,r=s[n],c=s[n+1],o=s[n+2],f=s[h]-r,d=s[h+1]-c,l=s[h+2]-o,u=s[a]-r,E=s[a+1]-c,x=s[a+2]-o,y=d*x-l*E,A=l*u-f*x,M=f*E-d*u;e[n]+=y,e[n+1]+=A,e[n+2]+=M,e[h]+=y,e[h+1]+=A,e[h+2]+=M,e[a]+=y,e[a+1]+=A,e[a+2]+=M}for(let i=0;i<e.length;i+=3){let n=Math.hypot(e[i],e[i+1],e[i+2]);if(n===0){B(()=>`Cannot generate normal for vertex ${i/3} because it is not part of a face.`);continue}e[i]/=n,e[i+1]/=n,e[i+2]/=n}return e}function Gt(s,t,e,i){if(s.length===0||t.length===0||e.length===0)return B(()=>"Skipping computation of tangents for an empty mesh."),[];e.length%3!==0&&b(()=>"The indices array must be a multiple of 3."),s.length%3!==0&&b(()=>"The positions array must be a multiple of 3."),t.length%2!==0&&b(()=>"The UVs array must be a multiple of 2."),i&&i.length%3!==0&&b(()=>"The normals array must be a multiple of 3.");let n=s.length/3;t.length/2!==n&&b(()=>"The UVs array must have the same number of elements as the positions array."),i&&i.length!==s.length&&b(()=>"The normals array must have the same number of elements as the positions array.");let h=Array(s.length).fill(0);for(let a=0;a<e.length;a+=3){let r=e[a],c=e[a+1],o=e[a+2],f=s[r*3],d=s[r*3+1],l=s[r*3+2],u=s[c*3]-f,E=s[c*3+1]-d,x=s[c*3+2]-l,y=s[o*3]-f,A=s[o*3+1]-d,M=s[o*3+2]-l,_=t[r*2],m=t[r*2+1],R=t[c*2]-_,w=t[c*2+1]-m,U=t[o*2]-_,O=t[o*2+1]-m,p=1/(R*O-U*w),v=(O*u-w*y)*p,G=(O*E-w*A)*p,$=(O*x-w*M)*p;h[r*3]+=v,h[r*3+1]+=G,h[r*3+2]+=$,h[c*3]+=v,h[c*3+1]+=G,h[c*3+2]+=$,h[o*3]+=v,h[o*3+1]+=G,h[o*3+2]+=$}if(i)for(let a=0;a<h.length;a+=3){let r=h[a],c=h[a+1],o=h[a+2],f=i[a],d=i[a+1],l=i[a+2],u=f*r+d*c+l*o;r-=u*f,c-=u*d,o-=u*l;let E=Math.hypot(r,c,o);E!==0&&(h[a]=r/E,h[a+1]=c/E,h[a+2]=o/E)}else for(let a=0;a<h.length;a+=3){let r=Math.hypot(h[a],h[a+1],h[a+2]);r!==0&&(h[a]/=r,h[a+1]/=r,h[a+2]/=r)}return h}async function bt(s,t,e={}){let i=new Promise((h,a)=>{let r=new Image;r.onload=()=>h(r),r.onerror=a,new URL(t,window.location.href).origin!==window.location.origin&&(r.crossOrigin="anonymous"),r.src=t}),n=t.split("/").at(-1).split(".").at(0);try{let h=await i,a=at(s,n,h.naturalWidth,h.naturalHeight,e);return yt(s,a,h,e),a}catch(h){b(()=>`Failed to create texture from url: "${t}": ${h.message}`)}}async function Jt(s,t,e={}){if(t.length!==6)throw new Error(`loadCubemap requires 6 URLs, got ${t.length}`);let i=t.map(h=>new Promise((a,r)=>{let c=new Image;c.onload=()=>a(c),c.onerror=r,new URL(h,window.location.href).origin!==window.location.origin&&(c.crossOrigin="anonymous"),c.src=h})),n=t[0].split("/").at(-1).split(".").at(0);n.endsWith("-px")?n=n.slice(0,-3):n.endsWith("-right")&&(n=n.slice(0,-6));try{let h=await Promise.all(i),[a,r]=[h[0].naturalWidth,h[0].naturalHeight];for(let o=1;o<6;o++)(h[o].naturalWidth!==a||h[o].naturalHeight!==r)&&b(()=>`Cubemap images at index 0 and ${o} have different dimensions: ${a}x${r} vs ${h[o].naturalWidth}x${h[o].naturalHeight}`);let c=at(s,n,a,r,{...e,target:s.TEXTURE_CUBE_MAP});for(let o=0;o<6;o++)yt(s,c,h[o],{...e,dataTarget:s.TEXTURE_CUBE_MAP_POSITIVE_X+o});return c}catch(h){b(()=>`Failed to create cubemap texture from urls: "${t}": ${h.message}`)}}async function re(s,t,e={}){let[i,n]=[void 0,void 0],h=t.length,a=[];for(let d of t)a.push(new Promise((l,u)=>{let E=d,x=new Image;x.onload=()=>{i===void 0&&n===void 0?(i=x.naturalWidth,n=x.naturalHeight):(x.naturalWidth!==i||x.naturalHeight!==n)&&u(new Error(`Data volume slices must have the same dimensions, but slice ${E} has dimensions ${x.naturalWidth}x${x.naturalHeight} instead of ${i}x${n}`)),l(x)},x.onerror=u,new URL(E,window.location.href).origin!==window.location.origin&&(x.crossOrigin="anonymous"),x.src=E}));let r=t[0].split("/").at(-1).split(".").at(0);r=r.replace(/[-_.]*\d+$/,""),await Promise.all(a),(i===void 0||n===void 0||a.length===0)&&b(()=>"No slices were loaded");let o=new OffscreenCanvas(i,n).getContext("2d",{willReadFrequently:!0});o===null&&b(()=>"Failed to create 2D context for offscreen canvas");let f=at(s,r,i,n,{target:s.TEXTURE_3D,depth:h,levels:e.levels??1,filter:e.filter??L.LINEAR,internalFormat:e.internalFormat??T.R16F});try{s.bindTexture(s.TEXTURE_3D,f.glo);let d=e.input_min??0,l=e.input_max??255,u=e.output_min??0,E=e.output_max??1,x=l-d,y=E-u;for(let A=0;A<h;A++){let M=await a[A];o.drawImage(M,0,0);let _=o.getImageData(0,0,i,n),m=new Uint8ClampedArray(_.data.buffer);m.length!==i*n*4&&b(()=>`Unexpected pixel data length: ${m.length} instead of ${i*n*4}`);let R=new Float32Array(i*n);for(let w=0;w<R.length;w++){let U=Y(m[w*4],d,l);R[w]=u+(U-d)/x*y}s.texSubImage3D(s.TEXTURE_3D,0,0,0,A,i,n,1,s.RED,s.FLOAT,R)}return e.levels!==1&&s.generateMipmap(s.TEXTURE_3D),f}catch(d){s.deleteTexture(f.glo),b(()=>`Failed to create volume data texture "${r}": ${d.message}`)}finally{s.bindTexture(s.TEXTURE_3D,null)}}var $t=class{_stack=[];push(t,e,i){i===e&&(i=void 0);let[n,h]=this._stack.at(-1)??[null,void 0];if(!(n===e&&h===i)){this._stack.push([e,i]);try{this._bindFramebuffer(t,e,i)}catch(a){throw this.pop(t),a}}}pop(t,e=1){e=Math.max(0,e);for(let i=0;i<e;i++){this._stack.pop();let[n,h]=this._stack.at(-1)??[null,void 0];this._bindFramebuffer(t,n,h)}}_bindFramebuffer(t,e,i){if(i===void 0){let[n,h]=e===null?[t.canvas.width,t.canvas.height]:Qt(e);t.bindFramebuffer(t.FRAMEBUFFER,e?.glo??null),t.viewport(0,0,n,h)}else{let[n,h]=i===null?[t.canvas.width,t.canvas.height]:Qt(i);t.bindFramebuffer(t.READ_FRAMEBUFFER,e?.glo??null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i?.glo??null),t.viewport(0,0,n,h)}}};function Qt(s){if(s.color.length>0){let t=s.color[0].attachment;return[t.width,t.height]}else if(s.depth!==null){let t=s.depth.attachment;return[t.width,t.height]}else if(s.stencil!==null){let t=s.stencil.attachment;return[t.width,t.height]}else b(()=>`Framebuffer ${s.name} has no attachments`)}async function ce(s,t,e,i={}){let n=`#version 300 es
precision highp float;

uniform mat4 u_modelXform;
uniform mat4 u_viewXform;
uniform mat4 u_projectionXform;

in vec3 a_pos;
in vec3 a_normal;
in vec2 a_texCoord;

out vec3 f_worldPosition;
out vec3 f_normal;
out vec2 f_texCoord;

void main() {
    vec4 worldPosition = u_modelXform * vec4(a_pos, 1.0);
    f_worldPosition = worldPosition.xyz;
    f_normal = (u_modelXform * vec4(a_normal, 0)).xyz;
    f_texCoord = a_texCoord;
    gl_Position = u_projectionXform * u_viewXform * worldPosition;
}`,h=`#version 300 es
precision mediump float;

#define HAS_DIFFUSE_TEXTURE ${e.diffuse?1:0}
#define HAS_SPECULAR_TEXTURE ${e.specular?1:0}
#define HAS_AMBIENT_TEXTURE ${e.ambient?1:0}
#define RENDER_NORMALS ${i.renderNormals?1:0}
#define RENDER_DEPTH ${i.renderDepth?1:0}

uniform float u_ambient;
uniform float u_specularPower;
uniform float u_specularIntensity;
uniform vec3 u_lightDirection;
uniform vec3 u_cameraPosition;
#if RENDER_DEPTH
    uniform float u_near;
    uniform float u_far;
#endif
#if HAS_DIFFUSE_TEXTURE
    uniform sampler2D u_texDiffuse;
#else
    uniform vec3 u_diffuseColor;
#endif
#if HAS_SPECULAR_TEXTURE
    uniform sampler2D u_texSpecular;
#endif
#if HAS_AMBIENT_TEXTURE
    uniform sampler2D u_texAmbient;
#endif

in vec3 f_worldPosition;
in vec3 f_normal;
in vec2 f_texCoord;

layout (location = 0) out vec4 o_fragColor;
#if RENDER_NORMALS
    layout (location = 1) out vec4 o_fragNormal;
    #if RENDER_DEPTH
        layout (location = 2) out vec4 o_fragDepth;
    #endif
#elif RENDER_DEPTH
    layout (location = 1) out vec4 o_fragDepth;
#endif

void main() {
#if HAS_DIFFUSE_TEXTURE
    vec3 diffuseColor = texture(u_texDiffuse, f_texCoord).rgb;
#else
    vec3 diffuseColor = u_diffuseColor;
#endif
#if HAS_SPECULAR_TEXTURE
    float specularFactor = texture(u_texSpecular, f_texCoord).r;
#else
    const float specularFactor = 1.0;
#endif
#if HAS_AMBIENT_TEXTURE
    float ambient = u_ambient + texture(u_texAmbient, f_texCoord).r * (1.0 - u_ambient);
#else
    float ambient = u_ambient;
#endif
    vec3 normal = normalize(f_normal);

    float diffuse = ambient + max(0.0, dot(u_lightDirection, normal)) * (1.0 - ambient);
    vec3 viewDirection = normalize(u_cameraPosition - f_worldPosition);
    vec3 halfway = normalize(viewDirection + u_lightDirection);
    float specular = max(0.0, dot(normal, halfway));
    vec3 color = diffuseColor * diffuse + vec3(1.0) * (specularFactor * pow(specular, u_specularPower) * u_specularIntensity);
    o_fragColor = vec4(color, 1.0);

#if RENDER_NORMALS
    o_fragNormal = vec4(normal, 1.0);
#endif

#if RENDER_DEPTH
    float depth = gl_FragCoord.z * 2.0 - 1.0; // back to NDC
    depth = (2.0 * u_near * u_far) / (u_far + u_near - depth * (u_far - u_near));
    depth = depth / u_far;
    o_fragDepth = vec4(vec3(depth), 1.0);
#endif
}`,a=Pt(t),r=Promise.all([e.diffuse?bt(s,e.diffuse):null,e.specular?bt(s,e.specular):null,e.ambient?bt(s,e.ambient):null]),c={u_ambient:.15,u_specularPower:64,u_specularFactor:.8,u_lightDirection:P.normalOf(P.all(1)),u_cameraPosition:[0,0,0]};e.diffuse||(c.u_diffuseColor=[1,1,1]);let o=Et(s,"__glance-blinn-phong-program",n,h,c),f=await a,d=xt(s,"__glance-blinn-phong-vao",f.indices,{a_pos:{data:f.positions,height:3},a_normal:{data:f.normals,height:3},a_texCoord:{data:f.texCoords,height:2}},o),l=await r,u={};return l[0]!==null&&(u.u_texDiffuse=l[0]),l[1]!==null&&(u.u_texSpecular=l[1]),l[2]!==null&&(u.u_texAmbient=l[2]),_t(s,f.name,d,o,{cullFace:et.BACK,depthTest:it.LESS,textures:u})}async function oe(s,t,e={}){let i=`#version 300 es
precision highp float;
uniform mat4 u_viewXform;
uniform mat4 u_projectionXform;
in vec3 a_pos;
out vec3 f_texCoord;
void main() {
    f_texCoord = a_pos;
    vec4 ndcCoord = u_projectionXform * u_viewXform * vec4(a_pos, 0.0);
    gl_Position = ndcCoord.xyww;
}`,n=`#version 300 es
precision mediump float;

#define RENDER_NORMALS ${e.renderNormals?1:0}
#define RENDER_DEPTH ${e.renderDepth?1:0}

uniform samplerCube u_skybox;

in vec3 f_texCoord;

layout (location = 0) out vec4 o_fragColor;
#if RENDER_NORMALS
    layout (location = 1) out vec4 o_fragNormal;
    #if RENDER_DEPTH
        layout (location = 2) out vec4 o_fragDepth;
    #endif
#elif RENDER_DEPTH
    layout (location = 1) out vec4 o_fragDepth;
#endif

void main() {
    o_fragColor = texture(u_skybox, f_texCoord);
#if RENDER_NORMALS
    o_fragNormal = vec4(vec3(0), 1);
#endif
#if RENDER_DEPTH
    o_fragNormal = vec4(1);
#endif
}`,h=Jt(s,t),a=Dt("__glance-skybox-geo"),r=Et(s,"__glance-skybox-program",i,n),c=xt(s,"__glance-skybox-vao",a.indices,{a_pos:{data:a.positions,height:3}},r),o=await h;return _t(s,o.name,c,r,{cullFace:et.NONE,depthTest:it.LEQUAL,textures:{u_skybox:o}})}function ue(s){if(s.ctx===void 0&&(s.width===void 0||s.height===void 0))throw new Error("Either ctx or width and height must be provided.");let t=s.width??s.ctx.canvas.width,e=s.height??s.ctx.canvas.height;return at(s.gl,s.name,t,e,{useAnisotropy:!0,internalFormat:T.RGBA8})}function fe(s,t={}){let e=t.gridSize??10,i=t.axisWidth??2,n=t.gridWidth??1,h=t.axisColorX??"rgb(255, 255, 255)",a=t.axisColorY??"rgb(255, 255, 255)",r=t.gridColor??"rgb(255, 255, 255)",c=t.axisAlpha??1,o=t.gridAlpha??.9;if(e%2!=0)throw new Error(`Grid Size must be an even number, got ${e}`);let f=s.canvas.width,d=s.canvas.height,l=Math.max(i,n),u=(f-l*2)/e;s.lineWidth=n,s.lineCap="round",s.globalAlpha=1,s.strokeStyle=r;for(let x=0;x<=e;x++){let y=l+x*u;s.beginPath(),s.moveTo(y,l),s.lineTo(y,d-l),s.stroke(),s.beginPath(),s.moveTo(l,y),s.lineTo(f-l,y),s.stroke()}if(o<1){var E=s.getImageData(0,0,s.canvas.width,s.canvas.height);let x=E.data;for(let y=0;y<x.length;y+=4)x[y+3]*=o;s.putImageData(E,0,0)}s.lineWidth=i,s.globalAlpha=c,s.strokeStyle=h,s.beginPath(),s.moveTo(l,d/2),s.lineTo(f-l,d/2),s.stroke(),s.strokeStyle=a,s.beginPath(),s.moveTo(f/2,l),s.lineTo(f/2,d-l),s.stroke(),s.globalAlpha=1}function le(s,t,e){try{s.bindTexture(s.TEXTURE_2D,e.glo),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,t.canvas),s.generateMipmap(s.TEXTURE_2D)}finally{s.bindTexture(s.TEXTURE_2D,null)}}function ts(s,t){return Array.from({length:t},()=>s).flat()}function de(s,t,e){return s.slice(t,t+e)}function Ee(s,t=1){if(s.length===0)return[];if(s.length===1)return s[0];Array.isArray(t)?t.length!==s.length&&b(()=>`'quantities' must be either a number or an array with the same length as 'arrays'.
    'quantities' length: ${t.length}
    'arrays' length: ${s.length}`):t=ts([t],s.length);let e=s[0].length/t[0];for(let n=0;n<s.length;n++){let h=t[n];h<1&&b(()=>`'quantity' must be greater than 0, but the value at index ${n} is ${h}`),h%1!==0&&b(()=>`'quantity' must be an integer, but the value at index ${n} is ${h}`),s[n].length%h!==0&&b(()=>`The length of the corresponding array must be a multiple of 'quantity'
    but the quantity at index ${n} is ${h}
    whereas the length of the corresponding array is ${s[n].length}`),s[n].length/h!==e&&b(()=>`All arrays must have the same number of quantities,
    but array ${n} of size ${s[n].length} contains ${s[n].length/h} times ${h} quantities,
    whereas the first array conttains ${s[0].length/h} times ${t[0]} quantities.`)}let i=[];for(let n=0;n<e;n++)for(let h=0;h<s.length;h++){let a=s[h],r=t[h];i.push(...a.slice(n*r,(n+1)*r))}return i}async function xe(s){try{return await(await fetch(s)).text()}catch(t){throw new Error(`Failed to load code snippet from ${s}: ${t}`)}}return os(ye);})();
/// @license MIT
